"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const image_1 = __importDefault(require("next/image"));
const head_1 = __importDefault(require("next/head"));
const router_1 = require("next/router");
const react_2 = require("@chakra-ui/react");
const external_attendee_1 = __importDefault(require("./meeting/external-attendee"));
const internal_attendee_1 = __importDefault(require("./meeting/internal-attendee"));
const constants_1 = require("@lib/constants");
const calendar_sync_1 = __importDefault(require("./meeting/calendar-sync"));
const time_preferences_1 = __importDefault(require("./meeting/time-preferences"));
const Home_module_css_1 = __importDefault(require("../styles/Home.module.css"));
const axios_1 = __importDefault(require("axios"));
const Handshake = () => {
    // const [attendanceStepCompleted, setAttendanceStepCompleted] = useState<boolean>(false)
    // const [calendarSyncStepCompleted, setCalendarSyncStepCompleted] = useState<boolean>(false)
    const [meetingAssist, setMeetingAssist] = (0, react_1.useState)();
    const [meetingAssistAttendee, setMeetingAssistAttendee] = (0, react_1.useState)();
    const [isExternalUser, setIsExternalUser] = (0, react_1.useState)(false);
    const [activeIndex, setActiveIndex] = (0, react_1.useState)(0);
    const [completedStep, setCompletedStep] = (0, react_1.useState)(-1);
    const router = (0, router_1.useRouter)();
    const toast = (0, react_2.useToast)();
    // using query strings
    const meetingId = router?.query?.meetingId;
    const attendeeId = router?.query?.attendeeId;
    const calendarSyncCompleted = router?.query?.calendarSyncCompleted === 'true';
    const primaryEmail = router?.query?.primaryEmail;
    console.log(meetingId, ' meetingId');
    console.log(attendeeId, ' attendeeId');
    // get existing meetingAssist
    (0, react_1.useEffect)(() => {
        (async () => {
            try {
                if (typeof meetingId !== 'string') {
                    console.log(meetingId, 'meetingId not a string');
                    return;
                }
                const oldMeetingAssist = (await axios_1.default.post('/api/external-attendee', { method: 'getMeetingAssist', variables: { id: meetingId } }))?.data;
                setMeetingAssist(oldMeetingAssist);
                if (oldMeetingAssist?.cancelIfAnyRefuse) {
                    toast({
                        title: 'Meeting cancelled',
                        description: 'The meeting has been called',
                        status: 'warning',
                        duration: 9000,
                        isClosable: true
                    });
                }
            }
            catch (e) {
                console.log(e, ' unable to get meeting');
            }
        })();
    }, [meetingId, toast]);
    // get meetingAssistAttendee
    (0, react_1.useEffect)(() => {
        (async () => {
            try {
                // validate
                if (!attendeeId) {
                    return;
                }
                const oldMeetingAttendee = (await axios_1.default.post('/api/external-attendee', { method: 'getMeetingAssistAttendee', variables: { id: attendeeId } }))?.data;
                if (oldMeetingAttendee?.id) {
                    setMeetingAssistAttendee(oldMeetingAttendee);
                }
            }
            catch (e) {
                console.log(e, ' unable to get meeting assist attendee');
            }
        })();
    }, [attendeeId]);
    // if calendarsynccompleted go to last page = 3
    (0, react_1.useEffect)(() => {
        (() => {
            if (calendarSyncCompleted) {
                setActiveIndex(3);
                setCompletedStep(2);
            }
            else {
                setActiveIndex(0);
                setCompletedStep(-1);
            }
        })();
    }, [calendarSyncCompleted]);
    const goToPrevStep = () => {
        const prevActiveIndex = activeIndex;
        let newActiveIndex = prevActiveIndex === 0 ? 0 : prevActiveIndex - 1;
        // if internal attendee skip 2
        if ((prevActiveIndex === 3) && !isExternalUser) {
            newActiveIndex = prevActiveIndex - 2;
        }
        setActiveIndex(newActiveIndex);
    };
    const renderPrevButton = () => {
        if (activeIndex === 0) {
            return (0, jsx_runtime_1.jsx)("div", { className: "lg:m-2 sm:m-3" });
        }
        return ((0, jsx_runtime_1.jsx)("div", { className: "lg:m-2 sm:m-3", children: (0, jsx_runtime_1.jsxs)("button", { className: 'btn', onClick: goToPrevStep, children: [(0, jsx_runtime_1.jsx)("svg", { className: "w-6 h-6", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", xmlns: "http://www.w3.org/2000/svg", children: (0, jsx_runtime_1.jsx)("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M15 19l-7-7 7-7" }) }), "Back"] }) }));
    };
    const goToNextStep = () => {
        const prevActiveIndex = activeIndex;
        const prevCompletedStep = completedStep;
        if (prevActiveIndex === 3) {
            return;
        }
        // if internal attendee skip 2 
        if ((prevActiveIndex === 1) && !isExternalUser) {
            let newActiveIndex = prevActiveIndex + 2;
            if (!prevCompletedStep || (prevCompletedStep < prevActiveIndex)) {
                const newCompletedStep = prevActiveIndex + 1;
                setCompletedStep(newCompletedStep);
            }
            if (newActiveIndex !== prevActiveIndex) {
                setActiveIndex(newActiveIndex);
            }
            return;
        }
        let newActiveIndex = prevActiveIndex + 1;
        if (!prevCompletedStep || (prevCompletedStep < prevActiveIndex)) {
            const newCompletedStep = prevActiveIndex;
            setCompletedStep(newCompletedStep);
        }
        if (newActiveIndex !== prevActiveIndex) {
            setActiveIndex(newActiveIndex);
        }
    };
    const renderNextButton = () => {
        if (activeIndex === 3) {
            return (0, jsx_runtime_1.jsx)("div", { className: "lg:m-2 sm:m-3" });
        }
        if (activeIndex === 0) {
            return (0, jsx_runtime_1.jsx)("div", { className: "lg:m-2 sm:m-3" });
        }
        return ((0, jsx_runtime_1.jsx)("div", { className: "lg:m-2 sm:m-3", children: (0, jsx_runtime_1.jsxs)("button", { className: 'btn', onClick: goToNextStep, children: ["Next", (0, jsx_runtime_1.jsx)("svg", { className: "w-6 h-6", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24", xmlns: "http://www.w3.org/2000/svg", children: (0, jsx_runtime_1.jsx)("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M9 5l7 7-7 7" }) })] }) }));
    };
    const goToExternalUser = () => {
        setIsExternalUser(true);
        goToNextStep();
    };
    const goToInternalUser = () => {
        setIsExternalUser(false);
        goToNextStep();
    };
    // check if events already synced then go straight to time preferences
    const renderStep = () => {
        switch (activeIndex) {
            case 0:
                return ((0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col justify-center items-center h-full lg:w-full", children: [(0, jsx_runtime_1.jsxs)("div", { className: "m-8 sm:text-left lg:my-12 sm:my-8 lg:h-1/4 lg:w-1/2", children: [(0, jsx_runtime_1.jsx)("h1", { className: "  text-xl font-bold text-gray-900 dark:text-gray-300 sm:text-2xl", children: "Welcome, do you use Atomic?" }), (0, jsx_runtime_1.jsx)("p", { className: " mt-1.5 text-sm text-gray-500 dark:text-gray-300", children: "If you use Atomic, we can use your account to help find a flexible schedule for everyone involved! ðŸŽ‰" })] }), (0, jsx_runtime_1.jsx)("div", { className: "flex flex-col justify-center items-center lg:h-3/4 lg:w-3/4", children: (0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col flex-start items-center lg:space-y-4 sm:space-y-5", children: [(0, jsx_runtime_1.jsx)("div", { children: (0, jsx_runtime_1.jsx)("button", { className: 'btn btn-primary m-2', onClick: goToExternalUser, children: "I don't use Atomic" }) }), (0, jsx_runtime_1.jsx)("div", { children: (0, jsx_runtime_1.jsx)("button", { className: 'btn btn-primary m-2', onClick: goToInternalUser, children: "I'm an Atomic User" }) })] }) })] }));
            case 1:
                return ((0, jsx_runtime_1.jsx)("div", { className: "flex flex-col justify-center items-center h-full w-full", children: isExternalUser && meetingAssist?.userId
                        ? ((0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col justify-center items-center h-full w-full", children: [(0, jsx_runtime_1.jsx)("div", { className: " flex flex-col justify-center items-center h-full w-full", children: (0, jsx_runtime_1.jsx)(external_attendee_1.default, { meetingAssistAttendee: meetingAssistAttendee, hostId: meetingAssist?.userId, primaryEmail: primaryEmail, meetingId: meetingId, attendeeId: attendeeId }) }), (0, jsx_runtime_1.jsxs)("div", { className: "my-2 flex justify-between items-center w-3/4", children: [renderPrevButton(), renderNextButton()] })] })) :
                        meetingAssist?.userId ? ((0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col justify-center items-center w-full", children: [(0, jsx_runtime_1.jsx)("div", { className: " flex flex-col justify-center items-center w-full", children: (0, jsx_runtime_1.jsx)(internal_attendee_1.default, { meetingAssistAttendee: meetingAssistAttendee, hostId: meetingAssist?.userId, primaryEmail: primaryEmail, meetingId: meetingId, attendeeId: attendeeId }) }), (0, jsx_runtime_1.jsxs)("div", { className: "my-2 flex justify-between items-center w-3/4", children: [renderPrevButton(), renderNextButton()] })] })) : ((0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col h-full w-full justify-center items-center", children: [(0, jsx_runtime_1.jsx)("div", { className: "mt-16 grid h-full place-content-center w-full", children: (0, jsx_runtime_1.jsxs)("div", { className: "text-center", children: [(0, jsx_runtime_1.jsx)(image_1.default, { src: constants_1.messyDoodleSVG, alt: "messy doodle svg", width: 512, height: 384 }), (0, jsx_runtime_1.jsx)("h1", { className: "mt-6 text-2xl font-bold tracking-tight text-gray-900 dark:text-gray-200 sm:text-4xl", children: "Loading... Please wait" }), (0, jsx_runtime_1.jsx)("p", { className: "mt-4 text-gray-500", children: "We are loading the page. Pleaes wait." })] }) }), (0, jsx_runtime_1.jsxs)("div", { className: "my-2 flex justify-between items-center w-3/4", children: [renderPrevButton(), (0, jsx_runtime_1.jsx)("div", {})] })] })) }));
            case 2:
                return ((0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col justify-center items-center h-full w-full", children: [(0, jsx_runtime_1.jsx)(calendar_sync_1.default, { meetingId: meetingId, attendeeId: attendeeId }), (0, jsx_runtime_1.jsxs)("div", { className: "my-2 flex justify-between items-center w-3/4", children: [renderPrevButton(), renderNextButton()] })] }));
            case 3:
                return ((0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col justify-center items-center h-full w-full", children: [(0, jsx_runtime_1.jsx)(time_preferences_1.default, { meetingId: meetingId, attendeeId: attendeeId }), (0, jsx_runtime_1.jsxs)("div", { className: "my-2 flex justify-between items-center w-3/4", children: [renderPrevButton(), renderNextButton()] })] }));
        }
    };
    return ((0, jsx_runtime_1.jsxs)("div", { className: "h-full flex flex-col justify-center items-center w-full", children: [(0, jsx_runtime_1.jsxs)(head_1.default, { children: [(0, jsx_runtime_1.jsx)("title", { children: "Atomic | Save time planning your Google calendar" }), (0, jsx_runtime_1.jsx)("meta", { name: "Description", content: "Save time " }), (0, jsx_runtime_1.jsx)("meta", { name: "theme-color", content: "#9d0191" }), (0, jsx_runtime_1.jsx)("meta", { name: "keywords", content: "meeting assist, meeting, schedule a meeting, scheduling, Atomic, planner for google calendar, google calendar, schedule assist, artificial intelligence, AI scheduler, smart tags, integrate with google calendar" })] }), (0, jsx_runtime_1.jsx)("div", { className: "h-screen flex flex-col justify-center items-center w-full", children: renderStep() }), (0, jsx_runtime_1.jsx)("footer", { className: Home_module_css_1.default.footer, children: (0, jsx_runtime_1.jsxs)("a", { href: "https://atomiclife.app", target: "_blank", rel: "noopener noreferrer", children: ["Powered by", ' ', (0, jsx_runtime_1.jsx)("span", { className: Home_module_css_1.default.logo, children: (0, jsx_runtime_1.jsx)(image_1.default, { src: "/1024.png", alt: "Atomic Logo", width: 16, height: 16 }) })] }) })] }));
};
exports.default = Handshake;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsaUNBQTJDO0FBRTNDLHVEQUE4QjtBQUM5QixxREFBNEI7QUFDNUIsd0NBQXVDO0FBR3ZDLDRDQUFtRDtBQUNuRCxvRkFBd0U7QUFDeEUsb0ZBQXVFO0FBQ3ZFLDhDQUErQztBQUMvQyw0RUFBa0Q7QUFDbEQsa0ZBQXFFO0FBQ3JFLGdGQUE4QztBQUM5QyxrREFBeUI7QUFDekIsTUFBTSxTQUFTLEdBQWEsR0FBRyxFQUFFO0lBQzdCLHlGQUF5RjtJQUN6Riw2RkFBNkY7SUFDN0YsTUFBTSxDQUFDLGFBQWEsRUFBRSxnQkFBZ0IsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsR0FBcUIsQ0FBQTtJQUN2RSxNQUFNLENBQUMscUJBQXFCLEVBQUUsd0JBQXdCLENBQUMsR0FBRyxJQUFBLGdCQUFRLEdBQTZCLENBQUE7SUFDL0YsTUFBTSxDQUFDLGNBQWMsRUFBRSxpQkFBaUIsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBVSxLQUFLLENBQUMsQ0FBQTtJQUNwRSxNQUFNLENBQUMsV0FBVyxFQUFFLGNBQWMsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBUyxDQUFDLENBQUMsQ0FBQTtJQUN6RCxNQUFNLENBQUMsYUFBYSxFQUFFLGdCQUFnQixDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFBO0lBRTFFLE1BQU0sTUFBTSxHQUFHLElBQUEsa0JBQVMsR0FBRSxDQUFBO0lBQzFCLE1BQU0sS0FBSyxHQUFHLElBQUEsZ0JBQVEsR0FBRSxDQUFBO0lBRXhCLHNCQUFzQjtJQUN0QixNQUFNLFNBQVMsR0FBVyxNQUFNLEVBQUUsS0FBSyxFQUFFLFNBQW1CLENBQUE7SUFDNUQsTUFBTSxVQUFVLEdBQVcsTUFBTSxFQUFFLEtBQUssRUFBRSxVQUFvQixDQUFBO0lBQzlELE1BQU0scUJBQXFCLEdBQVksTUFBTSxF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LEVBQ2hELGlDQUFNLElBQUksRUFBQyxhQUFhLEVBQUMsT0FBTyxFQUFDLFNBQVMsR0FBRyxFQUM3QyxpQ0FDSSxJQUFJLEVBQUMsVUFBVSxFQUNmLE9BQU8sRUFBQyxtTkFBbU4sR0FDN04sSUFFQyxFQUNQLGdDQUFLLFNBQVMsRUFBQywyREFBMkQsWUFDckUsVUFBVSxFQUFFLEdBQ1gsRUFDTixtQ0FBUSxTQUFTLEVBQUUseUJBQU0sQ0FBQyxNQUFNLFlBQzVCLCtCQUNJLElBQUksRUFBQyx3QkFBd0IsRUFDN0IsTUFBTSxFQUFDLFFBQVEsRUFDZixHQUFHLEVBQUMscUJBQXFCLDJCQUVkLEdBQUcsRUFDZCxpQ0FBTSxTQUFTLEVBQUUseUJBQU0sQ0FBQyxJQUFJLFlBQzVCLHVCQUFDLGVBQUssSUFBQyxHQUFHLEVBQUMsV0FBVyxFQUFDLEdBQUcsRUFBQyxhQUFhLEVBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxHQUFJLEdBQzNELElBQ1AsR0FDQyxJQUNQLENBQ1QsQ0FBQTtBQUNMLENBQUMsQ0FBQTtBQUVELGtCQUFlLFNBQVMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZUVmZmVjdCwgdXNlU3RhdGUgfSBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IHR5cGUgeyBOZXh0UGFnZSB9IGZyb20gJ25leHQnXG5pbXBvcnQgSW1hZ2UgZnJvbSAnbmV4dC9pbWFnZSdcbmltcG9ydCBIZWFkIGZyb20gJ25leHQvaGVhZCdcbmltcG9ydCB7IHVzZVJvdXRlciB9IGZyb20gJ25leHQvcm91dGVyJ1xuaW1wb3J0IHsgTWVldGluZ0Fzc2lzdEF0dGVuZGVlVHlwZSwgTWVldGluZ0Fzc2lzdFR5cGUgfSBmcm9tIFwiQGxpYi90eXBlc1wiXG5pbXBvcnQgeyBnZXRNZWV0aW5nQXNzaXN0LCBnZXRNZWV0aW5nQXNzaXN0QXR0ZW5kZWUgfSBmcm9tIFwiQGxpYi9hcGktaGVscGVyXCJcbmltcG9ydCB7IEJ1dHRvbiwgdXNlVG9hc3QgfSBmcm9tIFwiQGNoYWtyYS11aS9yZWFjdFwiXG5pbXBvcnQgTWVldGluZ0Fzc2lzdEV4dGVybmFsQXR0ZW5kZWUgZnJvbSAnLi9tZWV0aW5nL2V4dGVybmFsLWF0dGVuZGVlJztcbmltcG9ydCBNZWV0aW5nQXNzaXN0SW50ZXJuYWxBdHRlbmRlZSBmcm9tIFwiLi9tZWV0aW5nL2ludGVybmFsLWF0dGVuZGVlXCJcbmltcG9ydCB7IG1lc3N5RG9vZGxlU1ZHIH0gZnJvbSBcIkBsaWIvY29uc3RhbnRzXCJcbmltcG9ydCBDYWxlbmRhclN5bmMgZnJvbSBcIi4vbWVldGluZy9jYWxlbmRhci1zeW5jXCJcbmltcG9ydCBNZWV0aW5nQXNzaXN0VGltZVByZWZlcmVuY2VzIGZyb20gXCIuL21lZXRpbmcvdGltZS1wcmVmZXJlbmNlc1wiXG5pbXBvcnQgc3R5bGVzIGZyb20gJy4uL3N0eWxlcy9Ib21lLm1vZHVsZS5jc3MnXG5pbXBvcnQgYXhpb3MgZnJvbSBcImF4aW9zXCJcbmNvbnN0IEhhbmRzaGFrZTogTmV4dFBhZ2UgPSAoKSA9PiB7XG4gICAgLy8gY29uc3QgW2F0dGVuZGFuY2VTdGVwQ29tcGxldGVkLCBzZXRBdHRlbmRhbmNlU3RlcENvbXBsZXRlZF0gPSB1c2VTdGF0ZTxib29sZWFuPihmYWxzZSlcbiAgICAvLyBjb25zdCBbY2FsZW5kYXJTeW5jU3RlcENvbXBsZXRlZCwgc2V0Q2FsZW5kYXJTeW5jU3RlcENvbXBsZXRlZF0gPSB1c2VTdGF0ZTxib29sZWFuPihmYWxzZSlcbiAgICBjb25zdCBbbWVldGluZ0Fzc2lzdCwgc2V0TWVldGluZ0Fzc2lzdF0gPSB1c2VTdGF0ZTxNZWV0aW5nQXNzaXN0VHlwZT4oKVxuICAgIGNvbnN0IFttZWV0aW5nQXNzaXN0QXR0ZW5kZWUsIHNldE1lZXRpbmdBc3Npc3RBdHRlbmRlZV0gPSB1c2VTdGF0ZTxNZWV0aW5nQXNzaXN0QXR0ZW5kZWVUeXBlPigpXG4gICAgY29uc3QgW2lzRXh0ZXJuYWxVc2VyLCBzZXRJc0V4dGVybmFsVXNlcl0gPSB1c2VTdGF0ZTxib29sZWFuPihmYWxzZSlcbiAgICBjb25zdCBbYWN0aXZlSW5kZXgsIHNldEFjdGl2ZUluZGV4XSA9IHVzZVN0YXRlPG51bWJlcj4oMClcbiAgICBjb25zdCBbY29tcGxldGVkU3RlcCwgc2V0Q29tcGxldGVkU3RlcF0gPSB1c2VTdGF0ZTxudW1iZXIgfCB1bmRlZmluZWQ+KC0xKVxuXG4gICAgY29uc3Qgcm91dGVyID0gdXNlUm91dGVyKClcbiAgICBjb25zdCB0b2FzdCA9IHVzZVRvYXN0KClcbiAgICBcbiAgICAvLyB1c2luZyBxdWVyeSBzdHJpbmdzXG4gICAgY29uc3QgbWVldGluZ0lkOiBzdHJpbmcgPSByb3V0ZXI/LnF1ZXJ5Py5tZWV0aW5nSWQgYXMgc3RyaW5nXG4gICAgY29uc3QgYXR0ZW5kZWVJZDogc3RyaW5nID0gcm91dGVyPy5xdWVyeT8uYXR0ZW5kZWVJZCBhcyBzdHJpbmdcbiAgICBjb25zdCBjYWxlbmRhclN5bmNDb21wbGV0ZWQ6IGJvb2xlYW4gPSByb3V0ZXI/LnF1ZXJ5Py5jYWxlbmRhclN5bmNDb21wbGV0ZWQgPT09ICd0cnVlJ1xuICAgIGNvbnN0IHByaW1hcnlFbWFpbDogc3RyaW5nID0gcm91dGVyPy5xdWVyeT8ucHJpbWFyeUVtYWlsIGFzIHN0cmluZ1xuXG4gICAgY29uc29sZS5sb2cobWVldGluZ0lkLCAnIG1lZXRpbmdJZCcpXG4gICAgY29uc29sZS5sb2coYXR0ZW5kZWVJZCwgJyBhdHRlbmRlZUlkJylcblxuICAgIC8vIGdldCBleGlzdGluZyBtZWV0aW5nQXNzaXN0XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBtZWV0aW5nSWQgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG1lZXRpbmdJZCwgJ21lZXRpbmdJZCBub3QgYSBzdHJpbmcnKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3Qgb2xkTWVldGluZ0Fzc2lzdDogTWVldGluZ0Fzc2lzdFR5cGUgPSAoYXdhaXQgYXhpb3MucG9zdCgnL2FwaS9leHRlcm5hbC1hdHRlbmRlZScsIHsgbWV0aG9kOiAnZ2V0TWVldGluZ0Fzc2lzdCcsIHZhcmlhYmxlczogeyBpZDogbWVldGluZ0lkICB9fSkpPy5kYXRhXG4gICAgICAgICAgICAgICAgc2V0TWVldGluZ0Fzc2lzdChvbGRNZWV0aW5nQXNzaXN0KVxuXG4gICAgICAgICAgICAgICAgaWYgKG9sZE1lZXRpbmdBc3Npc3Q/LmNhbmNlbElmQW55UmVmdXNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnTWVldGluZyBjYW5jZWxsZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdUaGUgbWVldGluZyBoYXMgYmVlbiBjYWxsZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnd2FybmluZycsXG4gICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogOTAwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ2xvc2FibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSwgJyB1bmFibGUgdG8gZ2V0IG1lZXRpbmcnKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KSgpXG4gICAgfSwgW21lZXRpbmdJZCwgdG9hc3RdKVxuXG4gICAgLy8gZ2V0IG1lZXRpbmdBc3Npc3RBdHRlbmRlZVxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIC8vIHZhbGlkYXRlXG4gICAgICAgICAgICAgICAgaWYgKCFhdHRlbmRlZUlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnN0IG9sZE1lZXRpbmdBdHRlbmRlZTogTWVldGluZ0Fzc2lzdEF0dGVuZGVlVHlwZSA9IChhd2FpdCBheGlvcy5wb3N0KCcvYXBpL2V4dGVybmFsLWF0dGVuZGVlJywgeyBtZXRob2Q6ICdnZXRNZWV0aW5nQXNzaXN0QXR0ZW5kZWUnLCB2YXJpYWJsZXM6IHsgaWQ6IGF0dGVuZGVlSWQgfSB9KSk/LmRhdGFcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBpZiAob2xkTWVldGluZ0F0dGVuZGVlPy5pZCkge1xuICAgICAgICAgICAgICAgICAgICBzZXRNZWV0aW5nQXNzaXN0QXR0ZW5kZWUob2xkTWVldGluZ0F0dGVuZGVlKSAgICBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSwgJyB1bmFibGUgdG8gZ2V0IG1lZXRpbmcgYXNzaXN0IGF0dGVuZGVlJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkoKVxuICAgIH0sIFthdHRlbmRlZUlkXSlcblxuICAgIFxuXG4gICAgLy8gaWYgY2FsZW5kYXJzeW5jY29tcGxldGVkIGdvIHRvIGxhc3QgcGFnZSA9IDNcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICAoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGNhbGVuZGFyU3luY0NvbXBsZXRlZCkge1xuICAgICAgICAgICAgICAgIHNldEFjdGl2ZUluZGV4KDMpXG4gICAgICAgICAgICAgICAgc2V0Q29tcGxldGVkU3RlcCgyKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZXRBY3RpdmVJbmRleCgwKVxuICAgICAgICAgICAgICAgIHNldENvbXBsZXRlZFN0ZXAoLTEpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKClcbiAgICB9LCBbY2FsZW5kYXJTeW5jQ29tcGxldGVkXSlcblxuICAgIGNvbnN0IGdvVG9QcmV2U3RlcCA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgcHJldkFjdGl2ZUluZGV4ID0gYWN0aXZlSW5kZXhcbiAgICAgICAgbGV0IG5ld0FjdGl2ZUluZGV4ID0gcHJldkFjdGl2ZUluZGV4ID09PSAwID8gMCA6IHByZXZBY3RpdmVJbmRleCAtIDFcblxuICAgICAgICAvLyBpZiBpbnRlcm5hbCBhdHRlbmRlZSBza2lwIDJcbiAgICAgICAgaWYgKChwcmV2QWN0aXZlSW5kZXggPT09IDMpICYmICFpc0V4dGVybmFsVXNlcikge1xuICAgICAgICAgICAgbmV3QWN0aXZlSW5kZXggPSBwcmV2QWN0aXZlSW5kZXggLSAyXG4gICAgICAgIH1cbiAgICAgICAgc2V0QWN0aXZlSW5kZXgobmV3QWN0aXZlSW5kZXgpXG4gICAgfVxuXG4gICAgXG5cbiAgICBjb25zdCByZW5kZXJQcmV2QnV0dG9uID0gKCkgPT4ge1xuICAgICAgICBpZiAoYWN0aXZlSW5kZXggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cImxnOm0tMiBzbTptLTNcIiAvPlxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibGc6bS0yIHNtOm0tM1wiPlxuICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3NOYW1lPSdidG4nIG9uQ2xpY2s9e2dvVG9QcmV2U3RlcH0+XG4gICAgICAgICAgICAgICAgPHN2ZyBjbGFzc05hbWU9XCJ3LTYgaC02XCIgZmlsbD1cIm5vbmVcIiBzdHJva2U9XCJjdXJyZW50Q29sb3JcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiPjxwYXRoIHN0cm9rZUxpbmVjYXA9XCJyb3VuZFwiIHN0cm9rZUxpbmVqb2luPVwicm91bmRcIiBzdHJva2VXaWR0aD17Mn0gZD1cIk0xNSAxOWwtNy03IDctN1wiIC8+PC9zdmc+XG4gICAgICAgICAgICAgICAgICAgIEJhY2tcbiAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICApXG4gICAgfVxuXG4gICAgY29uc3QgZ29Ub05leHRTdGVwID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBwcmV2QWN0aXZlSW5kZXggPSBhY3RpdmVJbmRleFxuICAgICAgICBjb25zdCBwcmV2Q29tcGxldGVkU3RlcCA9IGNvbXBsZXRlZFN0ZXBcblxuICAgICAgICBpZiAocHJldkFjdGl2ZUluZGV4ID09PSAzKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGlmIGludGVybmFsIGF0dGVuZGVlIHNraXAgMiBcbiAgICAgICAgaWYgKChwcmV2QWN0aXZlSW5kZXggPT09IDEpICYmICFpc0V4dGVybmFsVXNlcikge1xuICAgICAgICAgICAgbGV0IG5ld0FjdGl2ZUluZGV4ID0gcHJldkFjdGl2ZUluZGV4ICsgMlxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoIXByZXZDb21wbGV0ZWRTdGVwIHx8IChwcmV2Q29tcGxldGVkU3RlcCA8IHByZXZBY3RpdmVJbmRleCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdDb21wbGV0ZWRTdGVwID0gcHJldkFjdGl2ZUluZGV4ICsgMVxuICAgICAgICAgICAgICAgIHNldENvbXBsZXRlZFN0ZXAobmV3Q29tcGxldGVkU3RlcClcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKG5ld0FjdGl2ZUluZGV4ICE9PSBwcmV2QWN0aXZlSW5kZXgpIHtcbiAgICAgICAgICAgICAgICBzZXRBY3RpdmVJbmRleChuZXdBY3RpdmVJbmRleClcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuXG5cbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBuZXdBY3RpdmVJbmRleCA9IHByZXZBY3RpdmVJbmRleCArIDFcblxuICAgICAgICBpZiAoIXByZXZDb21wbGV0ZWRTdGVwIHx8IChwcmV2Q29tcGxldGVkU3RlcCA8IHByZXZBY3RpdmVJbmRleCkpIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0NvbXBsZXRlZFN0ZXAgPSBwcmV2QWN0aXZlSW5kZXhcbiAgICAgICAgICAgIHNldENvbXBsZXRlZFN0ZXAobmV3Q29tcGxldGVkU3RlcClcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuZXdBY3RpdmVJbmRleCAhPT0gcHJldkFjdGl2ZUluZGV4KSB7XG4gICAgICAgICAgICBzZXRBY3RpdmVJbmRleChuZXdBY3RpdmVJbmRleClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHJlbmRlck5leHRCdXR0b24gPSAoKSA9PiB7XG4gICAgICAgIGlmIChhY3RpdmVJbmRleCA9PT0gMykge1xuICAgICAgICAgICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPVwibGc6bS0yIHNtOm0tM1wiIC8+XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYWN0aXZlSW5kZXggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT1cImxnOm0tMiBzbTptLTNcIiAvPlxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJsZzptLTIgc206bS0zXCI+XG4gICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT0nYnRuJyBvbkNsaWNrPXtnb1RvTmV4dFN0ZXB9PlxuICAgICAgICAgICAgICAgIE5leHRcbiAgICAgICAgICAgICAgICA8c3ZnIGNsYXNzTmFtZT1cInctNiBoLTZcIiBmaWxsPVwibm9uZVwiIHN0cm9rZT1cImN1cnJlbnRDb2xvclwiIHZpZXdCb3g9XCIwIDAgMjQgMjRcIiB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCI+PHBhdGggc3Ryb2tlTGluZWNhcD1cInJvdW5kXCIgc3Ryb2tlTGluZWpvaW49XCJyb3VuZFwiIHN0cm9rZVdpZHRoPXsyfSBkPVwiTTkgNWw3IDctNyA3XCIgLz48L3N2Zz5cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IGdvVG9FeHRlcm5hbFVzZXI9ICgpID0+IHtcbiAgICAgICAgc2V0SXNFeHRlcm5hbFVzZXIodHJ1ZSlcbiAgICAgICAgZ29Ub05leHRTdGVwKClcbiAgICB9XG5cbiAgICBjb25zdCBnb1RvSW50ZXJuYWxVc2VyID0gKCkgPT4ge1xuICAgICAgICBzZXRJc0V4dGVybmFsVXNlcihmYWxzZSlcbiAgICAgICAgZ29Ub05leHRTdGVwKClcbiAgICB9XG5cbiAgICAvLyBjaGVjayBpZiBldmVudHMgYWxyZWFkeSBzeW5jZWQgdGhlbiBnbyBzdHJhaWdodCB0byB0aW1lIHByZWZlcmVuY2VzXG5cbiAgICBjb25zdCByZW5kZXJTdGVwID0gKCkgPT4ge1xuICAgICAgICBzd2l0Y2ggKGFjdGl2ZUluZGV4KSB7XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtY29sIGp1c3RpZnktY2VudGVyIGl0ZW1zLWNlbnRlciBoLWZ1bGwgbGc6dy1mdWxsXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm0tOCBzbTp0ZXh0LWxlZnQgbGc6bXktMTIgc206bXktOCBsZzpoLTEvNCBsZzp3LTEvMlwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMSBjbGFzc05hbWU9XCIgIHRleHQteGwgZm9udC1ib2xkIHRleHQtZ3JheS05MDAgZGFyazp0ZXh0LWdyYXktMzAwIHNtOnRleHQtMnhsXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcIldlbGNvbWUsIGRvIHlvdSB1c2UgQXRvbWljP1wifVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvaDE+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9XCIgbXQtMS41IHRleHQtc20gdGV4dC1ncmF5LTUwMCBkYXJrOnRleHQtZ3JheS0zMDBcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1wiSWYgeW91IHVzZSBBdG9taWMsIHdlIGNhbiB1c2UgeW91ciBhY2NvdW50IHRvIGhlbHAgZmluZCBhIGZsZXhpYmxlIHNjaGVkdWxlIGZvciBldmVyeW9uZSBpbnZvbHZlZCEg8J+OiVwifVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvcD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtY29sIGp1c3RpZnktY2VudGVyIGl0ZW1zLWNlbnRlciBsZzpoLTMvNCBsZzp3LTMvNFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBmbGV4LWNvbCBmbGV4LXN0YXJ0IGl0ZW1zLWNlbnRlciBsZzpzcGFjZS15LTQgc206c3BhY2UteS01XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT0nYnRuIGJ0bi1wcmltYXJ5IG0tMicgb25DbGljaz17Z29Ub0V4dGVybmFsVXNlcn0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1wiSSBkb24ndCB1c2UgQXRvbWljXCJ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT0nYnRuIGJ0bi1wcmltYXJ5IG0tMicgb25DbGljaz17Z29Ub0ludGVybmFsVXNlcn0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1wiSSdtIGFuIEF0b21pYyBVc2VyXCJ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtY29sIGp1c3RpZnktY2VudGVyIGl0ZW1zLWNlbnRlciBoLWZ1bGwgdy1mdWxsXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNFeHRlcm5hbFVzZXIgJiYgbWVldGluZ0Fzc2lzdD8udXNlcklkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtY29sIGp1c3RpZnktY2VudGVyIGl0ZW1zLWNlbnRlciBoLWZ1bGwgdy1mdWxsXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCIgZmxleCBmbGV4LWNvbCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXIgaC1mdWxsIHctZnVsbFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8TWVldGluZ0Fzc2lzdEV4dGVybmFsQXR0ZW5kZWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZXRpbmdBc3Npc3RBdHRlbmRlZT17bWVldGluZ0Fzc2lzdEF0dGVuZGVlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9zdElkPXttZWV0aW5nQXNzaXN0Py51c2VySWR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmltYXJ5RW1haWw9e3ByaW1hcnlFbWFpbH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lZXRpbmdJZD17bWVldGluZ0lkfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0ZW5kZWVJZD17YXR0ZW5kZWVJZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm15LTIgZmxleCBqdXN0aWZ5LWJldHdlZW4gaXRlbXMtY2VudGVyIHctMy80XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtyZW5kZXJQcmV2QnV0dG9uKCl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtyZW5kZXJOZXh0QnV0dG9uKCl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWV0aW5nQXNzaXN0Py51c2VySWQgPyAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtY29sIGp1c3RpZnktY2VudGVyIGl0ZW1zLWNlbnRlciB3LWZ1bGxcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCIgZmxleCBmbGV4LWNvbCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXIgdy1mdWxsXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8TWVldGluZ0Fzc2lzdEludGVybmFsQXR0ZW5kZWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWV0aW5nQXNzaXN0QXR0ZW5kZWU9e21lZXRpbmdBc3Npc3RBdHRlbmRlZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3N0SWQ9e21lZXRpbmdBc3Npc3Q/LnVzZXJJZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmltYXJ5RW1haWw9e3ByaW1hcnlFbWFpbH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWV0aW5nSWQ9e21lZXRpbmdJZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRlbmRlZUlkPXthdHRlbmRlZUlkfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXktMiBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgdy0zLzRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtyZW5kZXJQcmV2QnV0dG9uKCl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7cmVuZGVyTmV4dEJ1dHRvbigpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSA6IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZmxleC1jb2wgaC1mdWxsIHctZnVsbCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJtdC0xNiBncmlkIGgtZnVsbCBwbGFjZS1jb250ZW50LWNlbnRlciB3LWZ1bGxcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGV4dC1jZW50ZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8SW1hZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3JjPXttZXNzeURvb2RsZVNWR31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWx0PVwibWVzc3kgZG9vZGxlIHN2Z1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoPXs1MTJ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodD17Mzg0fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibXQtNiB0ZXh0LTJ4bCBmb250LWJvbGQgdHJhY2tpbmctdGlnaHQgdGV4dC1ncmF5LTkwMCBkYXJrOnRleHQtZ3JheS0yMDAgc206dGV4dC00eGxcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2FkaW5nLi4uIFBsZWFzZSB3YWl0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9oMT5cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cIm10LTQgdGV4dC1ncmF5LTUwMFwiPntcIldlIGFyZSBsb2FkaW5nIHRoZSBwYWdlLiBQbGVhZXMgd2FpdC5cIn08L3A+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXktMiBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgdy0zLzRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge3JlbmRlclByZXZCdXR0b24oKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZmxleC1jb2wganVzdGlmeS1jZW50ZXIgaXRlbXMtY2VudGVyIGgtZnVsbCB3LWZ1bGxcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxDYWxlbmRhclN5bmNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWV0aW5nSWQ9e21lZXRpbmdJZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRlbmRlZUlkPXthdHRlbmRlZUlkfVxuICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXktMiBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgdy0zLzRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7cmVuZGVyUHJldkJ1dHRvbigpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtyZW5kZXJOZXh0QnV0dG9uKCl9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBmbGV4LWNvbCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXIgaC1mdWxsIHctZnVsbFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPE1lZXRpbmdBc3Npc3RUaW1lUHJlZmVyZW5jZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWV0aW5nSWQ9e21lZXRpbmdJZH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRlbmRlZUlkPXthdHRlbmRlZUlkfVxuICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibXktMiBmbGV4IGp1c3RpZnktYmV0d2VlbiBpdGVtcy1jZW50ZXIgdy0zLzRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7cmVuZGVyUHJldkJ1dHRvbigpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtyZW5kZXJOZXh0QnV0dG9uKCl9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJoLWZ1bGwgZmxleCBmbGV4LWNvbCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXIgdy1mdWxsXCI+XG4gICAgICAgICAgICA8SGVhZD5cbiAgICAgICAgICAgICAgICA8dGl0bGU+QXRvbWljIHwgU2F2ZSB0aW1lIHBsYW5uaW5nIHlvdXIgR29vZ2xlIGNhbGVuZGFyPC90aXRsZT5cbiAgICAgICAgICAgICAgICA8bWV0YSBuYW1lPVwiRGVzY3JpcHRpb25cIiBjb250ZW50PVwiU2F2ZSB0aW1lIFwiIC8+XG4gICAgICAgICAgICAgICAgPG1ldGEgbmFtZT1cInRoZW1lLWNvbG9yXCIgY29udGVudD1cIiM5ZDAxOTFcIiAvPlxuICAgICAgICAgICAgICAgIDxtZXRhXG4gICAgICAgICAgICAgICAgICAgIG5hbWU9XCJrZXl3b3Jkc1wiXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ9XCJtZWV0aW5nIGFzc2lzdCwgbWVldGluZywgc2NoZWR1bGUgYSBtZWV0aW5nLCBzY2hlZHVsaW5nLCBBdG9taWMsIHBsYW5uZXIgZm9yIGdvb2dsZSBjYWxlbmRhciwgZ29vZ2xlIGNhbGVuZGFyLCBzY2hlZHVsZSBhc3Npc3QsIGFydGlmaWNpYWwgaW50ZWxsaWdlbmNlLCBBSSBzY2hlZHVsZXIsIHNtYXJ0IHRhZ3MsIGludGVncmF0ZSB3aXRoIGdvb2dsZSBjYWxlbmRhclwiXG4gICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICBcbiAgICAgICAgICAgIDwvSGVhZD5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiaC1zY3JlZW4gZmxleCBmbGV4LWNvbCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXIgdy1mdWxsXCI+XG4gICAgICAgICAgICAgICAge3JlbmRlclN0ZXAoKX1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGZvb3RlciBjbGFzc05hbWU9e3N0eWxlcy5mb290ZXJ9PlxuICAgICAgICAgICAgICAgIDxhXG4gICAgICAgICAgICAgICAgICAgIGhyZWY9XCJodHRwczovL2F0b21pY2xpZmUuYXBwXCJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0PVwiX2JsYW5rXCJcbiAgICAgICAgICAgICAgICAgICAgcmVsPVwibm9vcGVuZXIgbm9yZWZlcnJlclwiXG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICBQb3dlcmVkIGJ5eycgJ31cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPXtzdHlsZXMubG9nb30+XG4gICAgICAgICAgICAgICAgICAgIDxJbWFnZSBzcmM9XCIvMTAyNC5wbmdcIiBhbHQ9XCJBdG9taWMgTG9nb1wiIHdpZHRoPXsxNn0gaGVpZ2h0PXsxNn0gLz5cbiAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICAgIDwvZm9vdGVyPlxuICAgICAgICA8L2Rpdj5cbiAgICApXG59XG5cbmV4cG9ydCBkZWZhdWx0IEhhbmRzaGFrZSJdfQ==