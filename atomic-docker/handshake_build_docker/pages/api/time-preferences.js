"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = handler;
// Next.js API route support: https://nextjs.org/docs/api-routes/introduction
const api_helper_1 = require("@lib/api-helper");
async function handler(req, res) {
    try {
        const body = req.body;
        if (body?.method === 'findEventsForUserGivenMeetingId') {
            const { userId, hostStartDate, hostEndDate, userTimezone, hostTimezone, meetingId, } = body?.variables;
            const events = await (0, api_helper_1.findEventsForUserGivenMeetingId)(userId, hostStartDate, hostEndDate, userTimezone, hostTimezone, meetingId);
            return res.status(200).json(events);
        }
        if (body?.method === 'generateAvailableSlotsforTimeWindow') {
            const { windowStartDate, windowEndDate, slotDuration, hostPreferences, hostTimezone, userTimezone, notAvailableSlotsInUserTimezone, } = body
                ?.variables;
            const { availableSlotsByDate } = await (0, api_helper_1.generateAvailableSlotsforTimeWindow)(windowStartDate, windowEndDate, slotDuration, hostPreferences, hostTimezone, userTimezone, notAvailableSlotsInUserTimezone);
            return res.status(200).json(availableSlotsByDate);
        }
        if (body?.method === 'getMeetingAssist') {
            const { id } = body?.variables;
            const meetingAssist = await (0, api_helper_1.getMeetingAssist)(id);
            if (meetingAssist) {
                return res.status(200).json(meetingAssist);
            }
        }
        if (body?.method === 'getUserPreferences') {
            const { userId } = body
                ?.variables;
            const userPreferences = await (0, api_helper_1.getUserPreferences)(userId);
            if (userPreferences) {
                return res.status(200).json(userPreferences);
            }
        }
        if (body?.method === 'listEventsForUserGivenDates') {
            const { userId, hostStartDate, hostEndDate, userTimezone, hostTimezone } = body?.variables;
            const events = await (0, api_helper_1.listEventsForUserGivenDates)(userId, hostStartDate, hostEndDate, userTimezone, hostTimezone);
            return res.status(200).json(events);
        }
        if (body?.method === 'listMeetingAssistAttendeesGivenMeetingId') {
            const { meetingId } = body?.variables;
            const attendees = await (0, api_helper_1.listMeetingAssistAttendeesGivenMeetingId)(meetingId);
            if (attendees) {
                return res.status(200).json(attendees);
            }
        }
        if (body?.method === 'listMeetingAssistEventsForAttendeeGivenDates') {
            const { attendeeId, hostStartDate, hostEndDate, userTimezone, hostTimezone, } = body
                ?.variables;
            const meetingAssistEvents = await (0, api_helper_1.listMeetingAssistEventsForAttendeeGivenDates)(attendeeId, hostStartDate, hostEndDate, userTimezone, hostTimezone);
            return res.status(200).json(meetingAssistEvents);
        }
        if (body?.method === 'listMeetingAssistPreferredTimeRangesGivenMeetingId') {
            const { meetingId } = body?.variables;
            const meetingAssistPreferredTimeRanges = await (0, api_helper_1.listMeetingAssistPreferredTimeRangesGivenMeetingId)(meetingId);
            return res.status(200).json(meetingAssistPreferredTimeRanges);
        }
        if (body?.method === 'startMeetingAssist') {
            const { body: subBody } = body
                ?.variables;
            await (0, api_helper_1.startMeetingAssist)(subBody);
            return res.status(204).end();
        }
        if (body?.method === 'upsertMeetingAssistPreferredTimes') {
            const { preferredTimes } = body?.variables;
            const meetingAssistPreferredTimesAffectedRows = await (0, api_helper_1.upsertMeetingAssistPreferredTimes)(preferredTimes);
            if (typeof meetingAssistPreferredTimesAffectedRows === 'number' &&
                meetingAssistPreferredTimesAffectedRows > -1) {
                return res.status(200).json(meetingAssistPreferredTimesAffectedRows);
            }
        }
        if (body?.method === 'deleteMeetingAssistPreferredTimesByIds') {
            const { ids } = body?.variables;
            await (0, api_helper_1.deleteMeetingAssistPreferredTimesByIds)(ids);
            return res.status(204).end();
        }
        if (body?.method === 'createRecurringMeetingAssists') {
            const { originalMeetingAssist, originalPreferredTimes } = body?.variables;
            console.log('inside api createRecurringMeetingAssists');
            await (0, api_helper_1.createRecurringMeetingAssists)(originalMeetingAssist, originalPreferredTimes);
            return res.status(204).end();
        }
        return res.status(404).end();
    }
    catch (e) {
        console.log(e, ' unable to get meeting assist');
        return res.status(404).end();
    }
    // res.status(200).json({ name: 'John Doe' })
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZS1wcmVmZXJlbmNlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRpbWUtcHJlZmVyZW5jZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUEySUEsMEJBMk1DO0FBdFZELDZFQUE2RTtBQUM3RSxnREFheUI7QUE2SFYsS0FBSyxVQUFVLE9BQU8sQ0FDbkMsR0FBbUIsRUFDbkIsR0FVQztJQUVELElBQUksQ0FBQztRQUNILE1BQU0sSUFBSSxHQWE0QyxHQUFHLENBQUMsSUFBSSxDQUFDO1FBRS9ELElBQUksSUFBSSxFQUFFLE1BQU0sS0FBSyxpQ0FBaUMsRUFBRSxDQUFDO1lBQ3ZELE1BQU0sRUFDSixNQUFNLEVBQ04sYUFBYSxFQUNiLFdBQVcsRUFDWCxZQUFZLEVBQ1osWUFBWSxFQUNaLFNBQVMsR0FDVixHQUFJLElBQTJDLEVBQUUsU0FBUyxDQUFDO1lBQzVELE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBQSw0Q0FBK0IsRUFDbEQsTUFBTSxFQUNOLGFBQWEsRUFDYixXQUFXLEVBQ1gsWUFBWSxFQUNaLFlBQVksRUFDWixTQUFTLENBQ1YsQ0FBQztZQUVGLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDdEMsQ0FBQztRQUVELElBQUksSUFBSSxFQUFFLE1BQU0sS0FBSyxxQ0FBcUMsRUFBRSxDQUFDO1lBQzNELE1BQU0sRUFDSixlQUFlLEVBQ2YsYUFBYSxFQUNiLFlBQVksRUFDWixlQUFlLEVBQ2YsWUFBWSxFQUNaLFlBQVksRUFDWiwrQkFBK0IsR0FDaEMsR0FBSSxJQUE4RDtnQkFDakUsRUFBRSxTQUFTLENBQUM7WUFDZCxNQUFNLEVBQUUsb0JBQW9CLEVBQUUsR0FDNUIsTUFBTSxJQUFBLGdEQUFtQyxFQUN2QyxlQUFlLEVBQ2YsYUFBYSxFQUNiLFlBQVksRUFDWixlQUFlLEVBQ2YsWUFBWSxFQUNaLFlBQVksRUFDWiwrQkFBK0IsQ0FDaEMsQ0FBQztZ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QUMsR0FBRyxDQUFDLDBDQUEwQyxDQUFDLENBQUM7WUFDeEQsTUFBTSxJQUFBLDBDQUE2QixFQUNqQyxxQkFBcUIsRUFDckIsc0JBQXNCLENBQ3ZCLENBQUM7WUFFRixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDL0IsQ0FBQztRQUVELE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUMvQixDQUFDO0lBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztRQUNYLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLCtCQUErQixDQUFDLENBQUM7UUFDaEQsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQy9CLENBQUM7SUFDRCw2Q0FBNkM7QUFDL0MsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIE5leHQuanMgQVBJIHJvdXRlIHN1cHBvcnQ6IGh0dHBzOi8vbmV4dGpzLm9yZy9kb2NzL2FwaS1yb3V0ZXMvaW50cm9kdWN0aW9uXG5pbXBvcnQge1xuICBjcmVhdGVSZWN1cnJpbmdNZWV0aW5nQXNzaXN0cyxcbiAgZGVsZXRlTWVldGluZ0Fzc2lzdFByZWZlcnJlZFRpbWVzQnlJZHMsXG4gIGZpbmRFdmVudHNGb3JVc2VyR2l2ZW5NZWV0aW5nSWQsXG4gIGdlbmVyYXRlQXZhaWxhYmxlU2xvdHNmb3JUaW1lV2luZG93LFxuICBnZXRNZWV0aW5nQXNzaXN0LFxuICBnZXRVc2VyUHJlZmVyZW5jZXMsXG4gIGxpc3RFdmVudHNGb3JVc2VyR2l2ZW5EYXRlcyxcbiAgbGlzdE1lZXRpbmdBc3Npc3RBdHRlbmRlZXNHaXZlbk1lZXRpbmdJZCxcbiAgbGlzdE1lZXRpbmdBc3Npc3RFdmVudHNGb3JBdHRlbmRlZUdpdmVuRGF0ZXMsXG4gIGxpc3RNZWV0aW5nQXNzaXN0UHJlZmVycmVkVGltZVJhbmdlc0dpdmVuTWVldGluZ0lkLFxuICBzdGFydE1lZXRpbmdBc3Npc3QsXG4gIHVwc2VydE1lZXRpbmdBc3Npc3RQcmVmZXJyZWRUaW1lcyxcbn0gZnJvbSAnQGxpYi9hcGktaGVscGVyJztcbmltcG9ydCB7XG4gIEF2YWlsYWJsZVNsb3RzQnlEYXRlLFxuICBFdmVudFR5cGUsXG4gIE1lZXRpbmdBc3Npc3RBdHRlbmRlZVR5cGUsXG4gIE1lZXRpbmdBc3Npc3RFdmVudFR5cGUsXG4gIE1lZXRpbmdBc3Npc3RQcmVmZXJyZWRUaW1lUmFuZ2VUeXBlLFxuICBTY2hlZHVsZUFzc2lzdFdpdGhNZWV0aW5nUXVldWVCb2R5VHlwZSxcbiAgTWVldGluZ0Fzc2lzdFR5cGUsXG4gIE5vdEF2YWlsYWJsZVNsb3QsXG4gIFVzZXJQcmVmZXJlbmNlVHlwZSxcbn0gZnJvbSAnQGxpYi90eXBlcyc7XG5pbXBvcnQgdHlwZSB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcblxudHlwZSBSZXF1ZXN0RGF0YUZvckRlbGV0ZU1lZXRpbmdBc3Npc3RQcmVmZXJyZWRUaW1lc1R5cGUgPSB7XG4gIG1ldGhvZDogJ2RlbGV0ZU1lZXRpbmdBc3Npc3RQcmVmZXJyZWRUaW1lcyc7XG4gIHZhcmlhYmxlczoge1xuICAgIGlkczogc3RyaW5nW107XG4gIH07XG59O1xuXG50eXBlIFJlcXVlc3REYXRhRm9yRmluZEV2ZW50Rm9yVXNlclR5cGUgPSB7XG4gIG1ldGhvZDogJ2ZpbmRFdmVudHNGb3JVc2VyR2l2ZW5NZWV0aW5nSWQnO1xuICB2YXJpYWJsZXM6IHtcbiAgICB1c2VySWQ6IHN0cmluZztcbiAgICBob3N0U3RhcnREYXRlOiBzdHJpbmc7XG4gICAgaG9zdEVuZERhdGU6IHN0cmluZztcbiAgICB1c2VyVGltZXpvbmU6IHN0cmluZztcbiAgICBob3N0VGltZXpvbmU6IHN0cmluZztcbiAgICBtZWV0aW5nSWQ6IHN0cmluZztcbiAgfTtcbn07XG5cbnR5cGUgUmVxdWVzdERhdGFGb3JHZW5lcmF0ZUF2YWlsYWJsZVNsb3RzZm9yVGltZVdpbmRvd1R5cGUgPSB7XG4gIG1ldGhvZDogJ2dlbmVyYXRlQXZhaWxhYmxlU2xvdHNmb3JUaW1lV2luZG93JztcbiAgdmFyaWFibGVzOiB7XG4gICAgd2luZG93U3RhcnREYXRlOiBzdHJpbmc7XG4gICAgd2luZG93RW5kRGF0ZTogc3RyaW5nO1xuICAgIHNsb3REdXJhdGlvbjogbnVtYmVyO1xuICAgIGhvc3RQcmVmZXJlbmNlczogVXNlclByZWZlcmVuY2VUeXBlO1xuICAgIGhvc3RUaW1lem9uZTogc3RyaW5nO1xuICAgIHVzZXJUaW1lem9uZTogc3RyaW5nO1xuICAgIG5vdEF2YWlsYWJsZVNsb3RzSW5Vc2VyVGltZXpvbmU/OiBOb3RBdmFpbGFibGVTbG90W107XG4gIH07XG59O1xuXG50eXBlIFJlcXVlc3REYXRhRm9yR2V0TWVldGluZ0Fzc2lzdFR5cGUgPSB7XG4gIG1ldGhvZDogJ2dldE1lZXRpbmdBc3Npc3QnO1xuICB2YXJpYWJsZXM6IHtcbiAgICBpZDogc3RyaW5nO1xuICB9O1xufTtcblxudHlwZSBSZXF1ZXN0RGF0YUZvckdldFVzZXJQcmVmZXJlbmNlc1R5cGUgPSB7XG4gIG1ldGhvZDogJ2dldFVzZXJQcmVmZXJlbmNlcyc7XG4gIHZhcmlhYmxlczoge1xuICAgIHVzZXJJZDogc3RyaW5nO1xuICB9O1xufTtcblxudHlwZSBSZXF1ZXN0RGF0YUZvckxpc3RFdmVudHNGb3JVc2VyR2l2ZW5EYXRlc1R5cGUgPSB7XG4gIG1ldGhvZDogJ2xpc3RFdmVudHNGb3JVc2VyR2l2ZW5EYXRlcyc7XG4gIHZhcmlhYmxlczoge1xuICAgIHVzZXJJZDogc3RyaW5nO1xuICAgIGhvc3RTdGFydERhdGU6IHN0cmluZztcbiAgICBob3N0RW5kRGF0ZTogc3RyaW5nO1xuICAgIHVzZXJUaW1lem9uZTogc3RyaW5nO1xuICAgIGhvc3RUaW1lem9uZTogc3RyaW5nO1xuICB9O1xufTtcblxudHlwZSBSZXF1ZXN0RGF0YUZvckxpc3RNZWV0aW5nQXNzaXN0QXR0ZW5kZWVzVHlwZSA9IHtcbiAgbWV0aG9kOiAnbGlzdE1lZXRpbmdBc3Npc3RBdHRlbmRlZXNHaXZlbk1lZXRpbmdJZCc7XG4gIHZhcmlhYmxlczoge1xuICAgIG1lZXRpbmdJZDogc3RyaW5nO1xuICB9O1xufTtcblxudHlwZSBSZXF1ZXN0RGF0YUZvckxpc3RNZWV0aW5nQXNzaXN0RXZlbnRzRm9yQXR0ZW5kZWVUeXBlID0ge1xuICBtZXRob2Q6ICdsaXN0TWVldGluZ0Fzc2lzdEV2ZW50c0ZvckF0dGVuZGVlR2l2ZW5EYXRlcyc7XG4gIHZhcmlhYmxlczoge1xuICAgIGF0dGVuZGVlSWQ6IHN0cmluZztcbiAgICBob3N0U3RhcnREYXRlOiBzdHJpbmc7XG4gICAgaG9zdEVuZERhdGU6IHN0cmluZztcbiAgICB1c2VyVGltZXpvbmU6IHN0cmluZztcbiAgICBob3N0VGltZXpvbmU6IHN0cmluZztcbiAgfTtcbn07XG5cbnR5cGUgUmVxdWVzdERhdGFGb3JMaXN0TWVldGluZ0Fzc2lzdFByZWZlcnJlZFRpbWVSYW5nZXNUeXBlID0ge1xuICBtZXRob2Q6ICdsaXN0TWVldGluZ0Fzc2lzdFByZWZlcnJlZFRpbWVSYW5nZXNHaXZlbk1lZXRpbmdJZCc7XG4gIHZhcmlhYmxlczoge1xuICAgIG1lZXRpbmdJZDogc3RyaW5nO1xuICB9O1xufTtcblxudHlwZSBSZXF1ZXN0RGF0YUZvclN0YXJ0TWVldGluZ0Fzc2lzdFR5cGUgPSB7XG4gIG1ldGhvZDogJ3N0YXJ0TWVldGluZ0Fzc2lzdCc7XG4gIHZhcmlhYmxlczoge1xuICAgIGJvZHk6IFNjaGVkdWxlQXNzaXN0V2l0aE1lZXRpbmdRdWV1ZUJvZHlUeXBlO1xuICB9O1xufTtcblxudHlwZSBSZXF1ZXN0RGF0YVVwc2VydE1lZXRpbmdBc2lzdFByZWZlcnJlZFRpbWVzVHlwZSA9IHtcbiAgbWV0aG9kOiAndXBzZXJ0TWVldGluZ0Fzc2lzdFByZWZlcnJlZFRpbWVzJztcbiAgdmFyaWFibGVzOiB7XG4gICAgcHJlZmVycmVkVGltZXM6IE1lZXRpbmdBc3Npc3RQcmVmZXJyZWRUaW1lUmFuZ2VUeXBlW107XG4gIH07XG59O1xuXG50eXBlIFJlcXVlc3REYXRhRm9yRGVsZXRlTWVldGluZ0Fzc2lzdFByZWZlcnJlZFRpbWVzQnlJZHNUeXBlID0ge1xuICBtZXRob2Q6ICdkZWxldGVNZWV0aW5nQXNzaXN0UHJlZmVycmVkVGltZXNCeUlkcyc7XG4gIHZhcmlhYmxlczoge1xuICAgIGlkczogc3RyaW5nW107XG4gIH07XG59O1xuXG50eXBlIFJlcXVlc3REYXRhRm9yQ3JlYXRlUmVjdXJyaW5nTWVldGluZ0Fzc2lzdHNUeXBlID0ge1xuICBtZXRob2Q6ICdjcmVhdGVSZWN1cnJpbmdNZWV0aW5nQXNzaXN0cyc7XG4gIHZhcmlhYmxlczoge1xuICAgIG9yaWdpbmFsTWVldGluZ0Fzc2lzdDogTWVldGluZ0Fzc2lzdFR5cGU7XG4gICAgb3JpZ2luYWxQcmVmZXJyZWRUaW1lcz86IE1lZXRpbmdBc3Npc3RQcmVmZXJyZWRUaW1lUmFuZ2VUeXBlW107XG4gIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKFxuICByZXE6IE5leHRBcGlSZXF1ZXN0LFxuICByZXM6IE5leHRBcGlSZXNwb25zZTxcbiAgICB8IEV2ZW50VHlwZVtdXG4gICAgfCBBdmFpbGFibGVTbG90c0J5RGF0ZVxuICAgIHwgTWVldGluZ0Fzc2lzdFR5cGVcbiAgICB8IFVzZXJQcmVmZXJlbmNlVHlwZVxuICAgIHwgTWVldGluZ0Fzc2lzdEF0dGVuZGVlVHlwZVtdXG4gICAgfCBNZWV0aW5nQXNzaXN0RXZlbnRUeXBlW11cbiAgICB8IE1lZXRpbmdBc3Npc3RQcmVmZXJyZWRUaW1lUmFuZ2VUeXBlW11cbiAgICB8IHVuZGVmaW5lZFxuICAgIHwgbnVtYmVyXG4gID5cbikge1xuICB0cnkge1xuICAgIGNvbnN0IGJvZHk6XG4gICAgICB8IFJlcXVlc3REYXRhRm9yRGVsZXRlTWVldGluZ0Fzc2lzdFByZWZlcnJlZFRpbWVzVHlwZVxuICAgICAgfCBSZXF1ZXN0RGF0YUZvckZpbmRFdmVudEZvclVzZXJUeXBlXG4gICAgICB8IFJlcXVlc3REYXRhRm9yR2VuZXJhdGVBdmFpbGFibGVTbG90c2ZvclRpbWVXaW5kb3dUeXBlXG4gICAgICB8IFJlcXVlc3REYXRhRm9yR2V0TWVldGluZ0Fzc2lzdFR5cGVcbiAgICAgIHwgUmVxdWVzdERhdGFGb3JHZXRVc2VyUHJlZmVyZW5jZXNUeXBlXG4gICAgICB8IFJlcXVlc3REYXRhRm9yTGlzdEV2ZW50c0ZvclVzZXJHaXZlbkRhdGVzVHlwZVxuICAgICAgfCBSZXF1ZXN0RGF0YUZvckxpc3RNZWV0aW5nQXNzaXN0QXR0ZW5kZWVzVHlwZVxuICAgICAgfCBSZXF1ZXN0RGF0YUZvckxpc3RNZWV0aW5nQXNzaXN0RXZlbnRzRm9yQXR0ZW5kZWVUeXBlXG4gICAgICB8IFJlcXVlc3REYXRhRm9yTGlzdE1lZXRpbmdBc3Npc3RQcmVmZXJyZWRUaW1lUmFuZ2VzVHlwZVxuICAgICAgfCBSZXF1ZXN0RGF0YUZvclN0YXJ0TWVldGluZ0Fzc2lzdFR5cGVcbiAgICAgIHwgUmVxdWVzdERhdGFVcHNlcnRNZWV0aW5nQXNpc3RQcmVmZXJyZWRUaW1lc1R5cGVcbiAgICAgIHwgUmVxdWVzdERhdGFGb3JEZWxldGVNZWV0aW5nQXNzaXN0UHJlZmVycmVkVGltZXNCeUlkc1R5cGVcbiAgICAgIHwgUmVxdWVzdERhdGFGb3JDcmVhdGVSZWN1cnJpbmdNZWV0aW5nQXNzaXN0c1R5cGUgPSByZXEuYm9keTtcblxuICAgIGlmIChib2R5Py5tZXRob2QgPT09ICdmaW5kRXZlbnRzRm9yVXNlckdpdmVuTWVldGluZ0lkJykge1xuICAgICAgY29uc3Qge1xuICAgICAgICB1c2VySWQsXG4gICAgICAgIGhvc3RTdGFydERhdGUsXG4gICAgICAgIGhvc3RFbmREYXRlLFxuICAgICAgICB1c2VyVGltZXpvbmUsXG4gICAgICAgIGhvc3RUaW1lem9uZSxcbiAgICAgICAgbWVldGluZ0lkLFxuICAgICAgfSA9IChib2R5IGFzIFJlcXVlc3REYXRhRm9yRmluZEV2ZW50Rm9yVXNlclR5cGUpPy52YXJpYWJsZXM7XG4gICAgICBjb25zdCBldmVudHMgPSBhd2FpdCBmaW5kRXZlbnRzRm9yVXNlckdpdmVuTWVldGluZ0lkKFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIGhvc3RTdGFydERhdGUsXG4gICAgICAgIGhvc3RFbmREYXRlLFxuICAgICAgICB1c2VyVGltZXpvbmUsXG4gICAgICAgIGhvc3RUaW1lem9uZSxcbiAgICAgICAgbWVldGluZ0lkXG4gICAgICApO1xuXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oZXZlbnRzKTtcbiAgICB9XG5cbiAgICBpZiAoYm9keT8ubWV0aG9kID09PSAnZ2VuZXJhdGVBdmFpbGFibGVTbG90c2ZvclRpbWVXaW5kb3cnKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIHdpbmRvd1N0YXJ0RGF0ZSxcbiAgICAgICAgd2luZG93RW5kRGF0ZSxcbiAgICAgICAgc2xvdER1cmF0aW9uLFxuICAgICAgICBob3N0UHJlZmVyZW5jZXMsXG4gICAgICAgIGhvc3RUaW1lem9uZSxcbiAgICAgICAgdXNlclRpbWV6b25lLFxuICAgICAgICBub3RBdmFpbGFibGVTbG90c0luVXNlclRpbWV6b25lLFxuICAgICAgfSA9IChib2R5IGFzIFJlcXVlc3REYXRhRm9yR2VuZXJhdGVBdmFpbGFibGVTbG90c2ZvclRpbWVXaW5kb3dUeXBlKVxuICAgICAgICA/LnZhcmlhYmxlcztcbiAgICAgIGNvbnN0IHsgYXZhaWxhYmxlU2xvdHNCeURhdGUgfSA9XG4gICAgICAgIGF3YWl0IGdlbmVyYXRlQXZhaWxhYmxlU2xvdHNmb3JUaW1lV2luZG93KFxuICAgICAgICAgIHdpbmRvd1N0YXJ0RGF0ZSxcbiAgICAgICAgICB3aW5kb3dFbmREYXRlLFxuICAgICAgICAgIHNsb3REdXJhdGlvbixcbiAgICAgICAgICBob3N0UHJlZmVyZW5jZXMsXG4gICAgICAgICAgaG9zdFRpbWV6b25lLFxuICAgICAgICAgIHVzZXJUaW1lem9uZSxcbiAgICAgICAgICBub3RBdmFpbGFibGVTbG90c0luVXNlclRpbWV6b25lXG4gICAgICAgICk7XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbihhdmFpbGFibGVTbG90c0J5RGF0ZSk7XG4gICAgfVxuXG4gICAgaWYgKGJvZHk/Lm1ldGhvZCA9PT0gJ2dldE1lZXRpbmdBc3Npc3QnKSB7XG4gICAgICBjb25zdCB7IGlkIH0gPSAoYm9keSBhcyBSZXF1ZXN0RGF0YUZvckdldE1lZXRpbmdBc3Npc3RUeXBlKT8udmFyaWFibGVzO1xuICAgICAgY29uc3QgbWVldGluZ0Fzc2lzdCA9IGF3YWl0IGdldE1lZXRpbmdBc3Npc3QoaWQpO1xuXG4gICAgICBpZiAobWVldGluZ0Fzc2lzdCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24obWVldGluZ0Fzc2lzdCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGJvZHk/Lm1ldGhvZCA9PT0gJ2dldFVzZXJQcmVmZXJlbmNlcycpIHtcbiAgICAgIGNvbnN0IHsgdXNlcklkIH0gPSAoYm9keSBhcyBSZXF1ZXN0RGF0YUZvckdldFVzZXJQcmVmZXJlbmNlc1R5cGUpXG4gICAgICAgID8udmFyaWFibGVzO1xuICAgICAgY29uc3QgdXNlclByZWZlcmVuY2VzID0gYXdhaXQgZ2V0VXNlclByZWZlcmVuY2VzKHVzZXJJZCk7XG5cbiAgICAgIGlmICh1c2VyUHJlZmVyZW5jZXMpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHVzZXJQcmVmZXJlbmNlcyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGJvZHk/Lm1ldGhvZCA9PT0gJ2xpc3RFdmVudHNGb3JVc2VyR2l2ZW5EYXRlcycpIHtcbiAgICAgIGNvbnN0IHsgdXNlcklkLCBob3N0U3RhcnREYXRlLCBob3N0RW5kRGF0ZSwgdXNlclRpbWV6b25lLCBob3N0VGltZXpvbmUgfSA9XG4gICAgICAgIChib2R5IGFzIFJlcXVlc3REYXRhRm9yTGlzdEV2ZW50c0ZvclVzZXJHaXZlbkRhdGVzVHlwZSk/LnZhcmlhYmxlcztcbiAgICAgIGNvbnN0IGV2ZW50cyA9IGF3YWl0IGxpc3RFdmVudHNGb3JVc2VyR2l2ZW5EYXRlcyhcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBob3N0U3RhcnREYXRlLFxuICAgICAgICBob3N0RW5kRGF0ZSxcbiAgICAgICAgdXNlclRpbWV6b25lLFxuICAgICAgICBob3N0VGltZXpvbmVcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbihldmVudHMpO1xuICAgIH1cblxuICAgIGlmIChib2R5Py5tZXRob2QgPT09ICdsaXN0TWVldGluZ0Fzc2lzdEF0dGVuZGVlc0dpdmVuTWVldGluZ0lkJykge1xuICAgICAgY29uc3QgeyBtZWV0aW5nSWQgfSA9IChcbiAgICAgICAgYm9keSBhcyBSZXF1ZXN0RGF0YUZvckxpc3RNZWV0aW5nQXNzaXN0QXR0ZW5kZWVzVHlwZVxuICAgICAgKT8udmFyaWFibGVzO1xuICAgICAgY29uc3QgYXR0ZW5kZWVzID1cbiAgICAgICAgYXdhaXQgbGlzdE1lZXRpbmdBc3Npc3RBdHRlbmRlZXNHaXZlbk1lZXRpbmdJZChtZWV0aW5nSWQpO1xuXG4gICAgICBpZiAoYXR0ZW5kZWVzKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbihhdHRlbmRlZXMpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChib2R5Py5tZXRob2QgPT09ICdsaXN0TWVldGluZ0Fzc2lzdEV2ZW50c0ZvckF0dGVuZGVlR2l2ZW5EYXRlcycpIHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgYXR0ZW5kZWVJZCxcbiAgICAgICAgaG9zdFN0YXJ0RGF0ZSxcbiAgICAgICAgaG9zdEVuZERhdGUsXG4gICAgICAgIHVzZXJUaW1lem9uZSxcbiAgICAgICAgaG9zdFRpbWV6b25lLFxuICAgICAgfSA9IChib2R5IGFzIFJlcXVlc3REYXRhRm9yTGlzdE1lZXRpbmdBc3Npc3RFdmVudHNGb3JBdHRlbmRlZVR5cGUpXG4gICAgICAgID8udmFyaWFibGVzO1xuICAgICAgY29uc3QgbWVldGluZ0Fzc2lzdEV2ZW50cyA9XG4gICAgICAgIGF3YWl0IGxpc3RNZWV0aW5nQXNzaXN0RXZlbnRzRm9yQXR0ZW5kZWVHaXZlbkRhdGVzKFxuICAgICAgICAgIGF0dGVuZGVlSWQsXG4gICAgICAgICAgaG9zdFN0YXJ0RGF0ZSxcbiAgICAgICAgICBob3N0RW5kRGF0ZSxcbiAgICAgICAgICB1c2VyVGltZXpvbmUsXG4gICAgICAgICAgaG9zdFRpbWV6b25lXG4gICAgICAgICk7XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbihtZWV0aW5nQXNzaXN0RXZlbnRzKTtcbiAgICB9XG5cbiAgICBpZiAoYm9keT8ubWV0aG9kID09PSAnbGlzdE1lZXRpbmdBc3Npc3RQcmVmZXJyZWRUaW1lUmFuZ2VzR2l2ZW5NZWV0aW5nSWQnKSB7XG4gICAgICBjb25zdCB7IG1lZXRpbmdJZCB9ID0gKFxuICAgICAgICBib2R5IGFzIFJlcXVlc3REYXRhRm9yTGlzdE1lZXRpbmdBc3Npc3RQcmVmZXJyZWRUaW1lUmFuZ2VzVHlwZVxuICAgICAgKT8udmFyaWFibGVzO1xuICAgICAgY29uc3QgbWVldGluZ0Fzc2lzdFByZWZlcnJlZFRpbWVSYW5nZXMgPVxuICAgICAgICBhd2FpdCBsaXN0TWVldGluZ0Fzc2lzdFByZWZlcnJlZFRpbWVSYW5nZXNHaXZlbk1lZXRpbmdJZChtZWV0aW5nSWQpO1xuXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24obWVldGluZ0Fzc2lzdFByZWZlcnJlZFRpbWVSYW5nZXMpO1xuICAgIH1cblxuICAgIGlmIChib2R5Py5tZXRob2QgPT09ICdzdGFydE1lZXRpbmdBc3Npc3QnKSB7XG4gICAgICBjb25zdCB7IGJvZHk6IHN1YkJvZHkgfSA9IChib2R5IGFzIFJlcXVlc3REYXRhRm9yU3RhcnRNZWV0aW5nQXNzaXN0VHlwZSlcbiAgICAgICAgPy52YXJpYWJsZXM7XG4gICAgICBhd2FpdCBzdGFydE1lZXRpbmdBc3Npc3Qoc3ViQm9keSk7XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwNCkuZW5kKCk7XG4gICAgfVxuXG4gICAgaWYgKGJvZHk/Lm1ldGhvZCA9PT0gJ3Vwc2VydE1lZXRpbmdBc3Npc3RQcmVmZXJyZWRUaW1lcycpIHtcbiAgICAgIGNvbnN0IHsgcHJlZmVycmVkVGltZXMgfSA9IChcbiAgICAgICAgYm9keSBhcyBSZXF1ZXN0RGF0YVVwc2VydE1lZXRpbmdBc2lzdFByZWZlcnJlZFRpbWVzVHlwZVxuICAgICAgKT8udmFyaWFibGVzO1xuICAgICAgY29uc3QgbWVldGluZ0Fzc2lzdFByZWZlcnJlZFRpbWVzQWZmZWN0ZWRSb3dzID1cbiAgICAgICAgYXdhaXQgdXBzZXJ0TWVldGluZ0Fzc2lzdFByZWZlcnJlZFRpbWVzKHByZWZlcnJlZFRpbWVzKTtcblxuICAgICAgaWYgKFxuICAgICAgICB0eXBlb2YgbWVldGluZ0Fzc2lzdFByZWZlcnJlZFRpbWVzQWZmZWN0ZWRSb3dzID09PSAnbnVtYmVyJyAmJlxuICAgICAgICBtZWV0aW5nQXNzaXN0UHJlZmVycmVkVGltZXNBZmZlY3RlZFJvd3MgPiAtMVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuanNvbihtZWV0aW5nQXNzaXN0UHJlZmVycmVkVGltZXNBZmZlY3RlZFJvd3MpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChib2R5Py5tZXRob2QgPT09ICdkZWxldGVNZWV0aW5nQXNzaXN0UHJlZmVycmVkVGltZXNCeUlkcycpIHtcbiAgICAgIGNvbnN0IHsgaWRzIH0gPSAoXG4gICAgICAgIGJvZHkgYXMgUmVxdWVzdERhdGFGb3JEZWxldGVNZWV0aW5nQXNzaXN0UHJlZmVycmVkVGltZXNCeUlkc1R5cGVcbiAgICAgICk/LnZhcmlhYmxlcztcbiAgICAgIGF3YWl0IGRlbGV0ZU1lZXRpbmdBc3Npc3RQcmVmZXJyZWRUaW1lc0J5SWRzKGlkcyk7XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwNCkuZW5kKCk7XG4gICAgfVxuXG4gICAgaWYgKGJvZHk/Lm1ldGhvZCA9PT0gJ2NyZWF0ZVJlY3VycmluZ01lZXRpbmdBc3Npc3RzJykge1xuICAgICAgY29uc3QgeyBvcmlnaW5hbE1lZXRpbmdBc3Npc3QsIG9yaWdpbmFsUHJlZmVycmVkVGltZXMgfSA9IChcbiAgICAgICAgYm9keSBhcyBSZXF1ZXN0RGF0YUZvckNyZWF0ZVJlY3VycmluZ01lZXRpbmdBc3Npc3RzVHlwZVxuICAgICAgKT8udmFyaWFibGVzO1xuICAgICAgY29uc29sZS5sb2coJ2luc2lkZSBhcGkgY3JlYXRlUmVjdXJyaW5nTWVldGluZ0Fzc2lzdHMnKTtcbiAgICAgIGF3YWl0IGNyZWF0ZVJlY3VycmluZ01lZXRpbmdBc3Npc3RzKFxuICAgICAgICBvcmlnaW5hbE1lZXRpbmdBc3Npc3QsXG4gICAgICAgIG9yaWdpbmFsUHJlZmVycmVkVGltZXNcbiAgICAgICk7XG5cbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwNCkuZW5kKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5lbmQoKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUubG9nKGUsICcgdW5hYmxlIHRvIGdldCBtZWV0aW5nIGFzc2lzdCcpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuZW5kKCk7XG4gIH1cbiAgLy8gcmVzLnN0YXR1cygyMDApLmpzb24oeyBuYW1lOiAnSm9obiBEb2UnIH0pXG59XG4iXX0=