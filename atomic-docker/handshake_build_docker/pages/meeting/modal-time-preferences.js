"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const axios_1 = __importDefault(require("axios"));
const date_fns_1 = require("date-fns");
const dayjs_1 = __importDefault(require("dayjs"));
// import isoWeek from 'dayjs/plugin/isoWeek'
const duration_1 = __importDefault(require("dayjs/plugin/duration"));
const isBetween_1 = __importDefault(require("dayjs/plugin/isBetween"));
const timezone_1 = __importDefault(require("dayjs/plugin/timezone"));
const utc_1 = __importDefault(require("dayjs/plugin/utc"));
const customParseFormat_1 = __importDefault(require("dayjs/plugin/customParseFormat"));
const react_2 = require("@chakra-ui/react");
const react_datepicker_1 = __importDefault(require("react-datepicker"));
require("react-datepicker/dist/react-datepicker.css");
// dayjs.extend(isoWeek)
dayjs_1.default.extend(duration_1.default);
dayjs_1.default.extend(isBetween_1.default);
dayjs_1.default.extend(timezone_1.default);
dayjs_1.default.extend(utc_1.default);
dayjs_1.default.extend(customParseFormat_1.default);
const dayOfWeekIntConstant = -1;
const ModalTimePreferences = (props) => {
    // const [customDate, setCustomDate] = useState<Date>(props?.minDate)
    // const [minTime, setMinTime] = useState<Date>()
    // const [maxTime, setMaxTime] = useState<Date>()
    const [availableTimes, setAvailableTimes] = (0, react_1.useState)();
    const [availableStartTime, setAvailableStartTime] = (0, react_1.useState)(new Date());
    const [availableEndTime, setAvailableEndTime] = (0, react_1.useState)((0, dayjs_1.default)().add(5, 'h').toDate());
    const [startTime, setStartTime] = (0, react_1.useState)();
    const [endTime, setEndTime] = (0, react_1.useState)();
    const [dayOfWeekInt, setDayOfWeekInt] = (0, react_1.useState)(-2);
    const [dayOfWeekOptions, setDayOfWeekOptions] = (0, react_1.useState)();
    const toast = (0, react_2.useToast)();
    const minDate = props?.minDate;
    const maxDate = props?.maxDate;
    const hostPreferences = props?.hostPreferences;
    const hostTimezone = props?.meetingAssist?.timezone;
    const meetingAssist = props?.meetingAssist;
    const slotDuration = props?.slotDuration;
    const onSubmit = props?.onSubmit;
    const onCancel = props?.onCancel;
    // generate and set available times for time window
    (0, react_1.useEffect)(() => {
        (async () => {
            try {
                const diffDays = (0, dayjs_1.default)(maxDate).diff((0, dayjs_1.default)(minDate), 'd');
                const startDatesForEachDay = [];
                const newDayOfWeekOptions = [];
                const newAvailableTimes = [];
                for (let i = 0; i <= diffDays; i++) {
                    startDatesForEachDay.push((0, dayjs_1.default)((0, dayjs_1.default)(minDate).format().slice(0, 19)).tz(hostTimezone, true).add(i, 'day').format());
                }
                for (let i = 0; i < startDatesForEachDay.length; i++) {
                    if (i === 0) {
                        const availableTime = (await axios_1.default.post('api/modal-time-preferences', {
                            method: 'getCustomAvailableTimes',
                            variables: {
                                slotDuration,
                                hostStartDate: startDatesForEachDay?.[i],
                                hostPreferences,
                                hostTimezone,
                                userTimezone: dayjs_1.default.tz.guess(),
                                isFirstDay: true,
                                isLastDay: false,
                            },
                        }))?.data;
                        //  0123456789
                        //  2020-04-02T08:02:17-05:00
                        if ((availableTime)?.startTime) {
                            newAvailableTimes.push(availableTime);
                        }
                        continue;
                    }
                    if (i === (startDatesForEachDay.length - 1)) {
                        // const availableTime = getCustomAvailableTimes(
                        //     slotDuration,
                        //     startDatesForEachDay?.[i],
                        //     hostPreferences,
                        //     hostTimezone as string,
                        //     dayjs.tz.guess(),
                        //     false,
                        //     true,
                        // )
                        const availableTime = (await axios_1.default.post('api/modal-time-preferences', {
                            method: 'getCustomAvailableTimes',
                            variables: {
                                slotDuration,
                                hostStartDate: startDatesForEachDay?.[i],
                                hostPreferences,
                                hostTimezone,
                                userTimezone: dayjs_1.default.tz.guess(),
                                isFirstDay: false,
                                isLastDay: true,
                            },
                        }))?.data;
                        if (availableTime?.startTime) {
                            newAvailableTimes.push(availableTime);
                        }
                        continue;
                    }
                    // const availableTime = getCustomAvailableTimes(
                    //     slotDuration,
                    //     startDatesForEachDay?.[i],
                    //     hostPreferences,
                    //     hostTimezone as string,
                    //     dayjs.tz.guess(),
                    // )
                    const availableTime = (await axios_1.default.post('api/modal-time-preferences', {
                        method: 'getCustomAvailableTimes',
                        variables: {
                            slotDuration,
                            hostStartDate: startDatesForEachDay?.[i],
                            hostPreferences,
                            hostTimezone,
                            userTimezone: dayjs_1.default.tz.guess(),
                            isFirstDay: false,
                            isLastDay: false,
                        },
                    }))?.data;
                    if (availableTime?.startTime) {
                        newAvailableTimes.push(availableTime);
                    }
                }
                if (newAvailableTimes?.[0]?.startTime) {
                    const oldStartTime = (0, date_fns_1.setISODay)((0, dayjs_1.default)()
                        .hour(parseInt(newAvailableTimes?.[0]?.startTime?.slice(0, 2), 10))
                        .minute(parseInt(newAvailableTimes?.[0]?.startTime?.slice(3), 10))
                        .toDate(), newAvailableTimes?.[0]?.dayOfWeekInt ?? 1);
                    setAvailableStartTime(oldStartTime);
                    const oldEndTime = (0, date_fns_1.setISODay)((0, dayjs_1.default)()
                        .hour(parseInt(newAvailableTimes?.[0]?.endTime?.slice(0, 2), 10))
                        .minute(parseInt(newAvailableTimes?.[0]?.endTime?.slice(3), 10))
                        .toDate(), newAvailableTimes?.[0]?.dayOfWeekInt ?? 1);
                    setAvailableEndTime(oldEndTime);
                    setAvailableTimes(newAvailableTimes);
                }
                // create dayOfWeekOptions
                for (let i = 0; i < startDatesForEachDay.length; i++) {
                    const option = (0, date_fns_1.getISODay)((0, dayjs_1.default)((0, dayjs_1.default)(minDate).format().slice(0, 19)).tz(hostTimezone, true).add(i, 'day').toDate());
                    const value = (option !== -1 ? (0, dayjs_1.default)((0, date_fns_1.setISODay)((0, dayjs_1.default)().toDate(), option)).format('dddd') : 'Any day of the week');
                    newDayOfWeekOptions.push([option, value]);
                }
                newDayOfWeekOptions.push([-1, 'Any day of the week']);
                setDayOfWeekOptions(newDayOfWeekOptions);
            }
            catch (e) {
                console.log(e, ' unable to check modal time preferences');
            }
        })();
    }, [minDate, maxDate, hostTimezone, slotDuration, hostPreferences]);
    // change available time based on dayOfWeekInt
    (0, react_1.useEffect)(() => {
        (() => {
            const availableTime = availableTimes?.find(a => (a?.dayOfWeekInt === dayOfWeekInt));
            if (availableTime) {
                const oldStartTime = (0, date_fns_1.setISODay)((0, dayjs_1.default)()
                    .hour(parseInt(availableTime?.startTime?.slice(0, 2), 10))
                    .minute(parseInt(availableTime?.startTime?.slice(3), 10))
                    .toDate(), availableTime?.dayOfWeekInt ?? 1);
                setAvailableStartTime(oldStartTime);
                const oldEndTime = (0, date_fns_1.setISODay)((0, dayjs_1.default)()
                    .hour(parseInt(availableTime?.endTime?.slice(0, 2), 10))
                    .minute(parseInt(availableTime?.endTime?.slice(3), 10))
                    .toDate(), availableTime?.dayOfWeekInt ?? 1);
                setAvailableEndTime(oldEndTime);
            }
        })();
    }, [availableTimes, dayOfWeekInt]);
    const onChangeOption = (e) => setDayOfWeekInt(e.target.value || -1);
    const onSave = () => {
        onSubmit({
            dayOfWeekInt: typeof dayOfWeekInt === 'string' ? parseInt(dayOfWeekInt, 10) : dayOfWeekInt,
            startTime: (0, dayjs_1.default)(startTime || new Date()).format('HH:mm'),
            endTime: (0, dayjs_1.default)(endTime || (0, dayjs_1.default)().add(8, 'h')).format('HH:mm'),
        });
    };
    return ((0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col justify-center items-center h-full w-full", children: [(0, jsx_runtime_1.jsxs)("div", { className: "text-center sm:text-left", children: [(0, jsx_runtime_1.jsx)("h2", { className: "lg:text-lg font-bold text-gray-900 dark:text-gray-200 sm:text-xl", children: "Select a Custom Time" }), (0, jsx_runtime_1.jsx)("p", { className: "mt-1.5 text-sm text-gray-500", children: "You can select a time as broad as possible that works for you" })] }), (0, jsx_runtime_1.jsx)("div", { className: "text-left sm:text-xl lg:text-lg lg:my-2 sm:my-3", children: (0, jsx_runtime_1.jsxs)("label", { children: [(0, jsx_runtime_1.jsx)("span", { className: "label-text dark:text-gray-500", children: 'Day Of Week: optional' }), (0, jsx_runtime_1.jsxs)("select", { className: "select select-bordered w-full max-w-xs text-gray-900 bg-gray-200 dark:text-gray-200 dark:bg-gray-900", placeholder: 'Select day of week', onChange: onChangeOption, value: dayOfWeekInt, children: [(0, jsx_runtime_1.jsx)("option", { disabled: true, selected: true, value: -2, children: "Select day of week" }, -2), dayOfWeekOptions?.map(values => ((0, jsx_runtime_1.jsx)("option", { value: values[0], children: values[1] }, values[0])))] })] }) }), (0, jsx_runtime_1.jsx)("div", { className: "text-left sm:text-xl lg:text-lg lg:my-2 sm:my-3", children: (0, jsx_runtime_1.jsxs)("label", { children: [(0, jsx_runtime_1.jsx)("span", { className: "label-text dark:text-gray-500 lg:my-1 sm:my-2", children: 'Start Time:' }), (0, jsx_runtime_1.jsx)(react_datepicker_1.default, { selected: startTime, onChange: (date) => setStartTime(date), showTimeSelect: true, showTimeSelectOnly: true, timeIntervals: slotDuration, timeCaption: "Time", dateFormat: "h:mm aa", minTime: availableStartTime, maxTime: availableEndTime, className: "text-gray-900 bg-gray-200 dark:text-gray-200 dark:bg-gray-900 rounded-lg text-center" })] }) }), (0, jsx_runtime_1.jsx)("div", { className: "text-left sm:text-xl lg:text-lg lg:my-2 sm:my-3", children: (0, jsx_runtime_1.jsxs)("label", { children: [(0, jsx_runtime_1.jsx)("span", { className: "label-text dark:text-gray-500 lg:my-1 sm:my-2", children: 'End Time:' }), (0, jsx_runtime_1.jsx)(react_datepicker_1.default, { selected: endTime, onChange: (date) => setEndTime(date), showTimeSelect: true, showTimeSelectOnly: true, timeIntervals: slotDuration, timeCaption: "Time", dateFormat: "h:mm aa", minTime: availableStartTime, maxTime: availableEndTime, className: "text-gray-900 bg-gray-200 dark:text-gray-200 dark:bg-gray-900 rounded-lg text-center" })] }) }), (0, jsx_runtime_1.jsxs)("div", { className: "flex justify-center items-center space-x-4 w-1/2 lg:m-3 m-4", children: [(0, jsx_runtime_1.jsx)("button", { className: 'btn btn-secondary', onClick: onSave, children: 'Submit' }), (0, jsx_runtime_1.jsx)("button", { className: 'btn btn-ghost', onClick: onCancel, children: 'Cancel' })] })] }));
};
exports.default = ModalTimePreferences;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwtdGltZS1wcmVmZXJlbmNlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm1vZGFsLXRpbWUtcHJlZmVyZW5jZXMudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLGlDQUEyQztBQUUzQyxrREFBeUI7QUFDekIsdUNBQStDO0FBQy9DLGtEQUF5QjtBQUN6Qiw2Q0FBNkM7QUFDN0MscUVBQTRDO0FBQzVDLHVFQUE4QztBQUM5QyxxRUFBNEM7QUFDNUMsMkRBQWtDO0FBQ2xDLHVGQUE4RDtBQUM5RCw0Q0FJeUI7QUFDekIsd0VBQXlDO0FBQ3pDLHNEQUFtRDtBQUluRCx3QkFBd0I7QUFDeEIsZUFBSyxDQUFDLE1BQU0sQ0FBQyxrQkFBUSxDQUFDLENBQUE7QUFDdEIsZUFBSyxDQUFDLE1BQU0sQ0FBQyxtQkFBUyxDQUFDLENBQUE7QUFDdkIsZUFBSyxDQUFDLE1BQU0sQ0FBQyxrQkFBUSxDQUFDLENBQUE7QUFDdEIsZUFBSyxDQUFDLE1BQU0sQ0FBQyxhQUFHLENBQUMsQ0FBQTtBQUNqQixlQUFLLENBQUMsTUFBTSxDQUFDLDJCQUFpQixDQUFDLENBQUE7QUFlL0IsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLENBQUMsQ0FBQTtBQUUvQixNQUFNLG9CQUFvQixHQUFvQixDQUFDLEtBQVksRUFBRSxFQUFFO0lBQzNELHFFQUFxRTtJQUNyRSxpREFBaUQ7SUFDakQsaURBQWlEO0lBQ2pELE1BQU0sQ0FBQyxjQUFjLEVBQUUsaUJBQWlCLENBQUMsR0FBRyxJQUFBLGdCQUFRLEdBQTZCLENBQUE7SUFDakYsTUFBTSxDQUFDLGtCQUFrQixFQUFFLHFCQUFxQixDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFPLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQTtJQUM5RSxNQUFNLENBQUMsZ0JBQWdCLEVBQUUsbUJBQW1CLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQU8sSUFBQSxlQUFLLEdBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdB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LFNBQVMsRUFBQywrQ0FBK0MsWUFDMUQsV0FBVyxHQUNULEVBQ1AsdUJBQUMsMEJBQVUsSUFDUCxRQUFRLEVBQUUsT0FBTyxFQUNqQixRQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsRUFDcEMsY0FBYyxRQUNkLGtCQUFrQixRQUNsQixhQUFhLEVBQUUsWUFBWSxFQUMzQixXQUFXLEVBQUMsTUFBTSxFQUNsQixVQUFVLEVBQUMsU0FBUyxFQUNwQixPQUFPLEVBQUUsa0JBQWtCLEVBQzNCLE9BQU8sRUFBRSxnQkFBZ0IsRUFDekIsU0FBUyxFQUFDLHNGQUFzRixHQUNsRyxJQUNFLEdBQ04sRUFDTixpQ0FBSyxTQUFTLEVBQUMsNkRBQTZELGFBQ3hFLG1DQUFRLFNBQVMsRUFBQyxtQkFBbUIsRUFBQyxPQUFPLEVBQUUsTUFBTSxZQUNoRCxRQUFRLEdBQ0osRUFDVCxtQ0FBUSxTQUFTLEVBQUMsZUFBZSxFQUFDLE9BQU8sRUFBRSxRQUFRLFlBQzlDLFFBQVEsR0FDSixJQUNQLElBQ0osQ0FDVCxDQUFBO0FBQ0wsQ0FBQyxDQUFBO0FBRUQsa0JBQWUsb0JBQW9CLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB1c2VFZmZlY3QsIHVzZVN0YXRlIH0gZnJvbSBcInJlYWN0XCJcbmltcG9ydCB0eXBlIHsgTmV4dFBhZ2UgfSBmcm9tICduZXh0J1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJ1xuaW1wb3J0IHsgZ2V0SVNPRGF5LCBzZXRJU09EYXkgfSBmcm9tICdkYXRlLWZucydcbmltcG9ydCBkYXlqcyBmcm9tICdkYXlqcydcbi8vIGltcG9ydCBpc29XZWVrIGZyb20gJ2RheWpzL3BsdWdpbi9pc29XZWVrJ1xuaW1wb3J0IGR1cmF0aW9uIGZyb20gJ2RheWpzL3BsdWdpbi9kdXJhdGlvbidcbmltcG9ydCBpc0JldHdlZW4gZnJvbSAnZGF5anMvcGx1Z2luL2lzQmV0d2VlbidcbmltcG9ydCB0aW1lem9uZSBmcm9tICdkYXlqcy9wbHVnaW4vdGltZXpvbmUnXG5pbXBvcnQgdXRjIGZyb20gJ2RheWpzL3BsdWdpbi91dGMnXG5pbXBvcnQgY3VzdG9tUGFyc2VGb3JtYXQgZnJvbSAnZGF5anMvcGx1Z2luL2N1c3RvbVBhcnNlRm9ybWF0J1xuaW1wb3J0IHtcbiAgICB1c2VUb2FzdCxcbiAgICBTZWxlY3QsXG4gICAgQnV0dG9uLFxufSBmcm9tICdAY2hha3JhLXVpL3JlYWN0J1xuaW1wb3J0IERhdGVQaWNrZXIgZnJvbSBcInJlYWN0LWRhdGVwaWNrZXJcIlxuaW1wb3J0IFwicmVhY3QtZGF0ZXBpY2tlci9kaXN0L3JlYWN0LWRhdGVwaWNrZXIuY3NzXCJcbmltcG9ydCBfIGZyb20gXCJsb2Rhc2hcIlxuaW1wb3J0IHsgQ3VzdG9tQXZhaWxhYmxlVGltZVR5cGUsIE1lZXRpbmdBc3Npc3RUeXBlLCBUaW1lLCBVc2VyUHJlZmVyZW5jZVR5cGUgfSBmcm9tIFwiQGxpYi90eXBlc1wiXG5cbi8vIGRheWpzLmV4dGVuZChpc29XZWVrKVxuZGF5anMuZXh0ZW5kKGR1cmF0aW9uKVxuZGF5anMuZXh0ZW5kKGlzQmV0d2VlbilcbmRheWpzLmV4dGVuZCh0aW1lem9uZSlcbmRheWpzLmV4dGVuZCh1dGMpXG5kYXlqcy5leHRlbmQoY3VzdG9tUGFyc2VGb3JtYXQpXG5cbnR5cGUgUHJvcHMgPSB7XG4gICAgLy8gY3VzdG9tUHJlZmVycmVkVGltZXM6IChNZWV0aW5nQXNzaXN0UHJlZmVycmVkVGltZVJhbmdlVHlwZSAmIHsgc2xvdElkPzogc3RyaW5nIH0pW10sXG4gICAgLy8gc2V0Q3VzdG9tUHJlZmVycmVkVGltZXM6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPChNZWV0aW5nQXNzaXN0UHJlZmVycmVkVGltZVJhbmdlVHlwZSAmIHsgc2xvdElkPzogc3RyaW5nIH0pW10+PixcbiAgICBtaW5EYXRlOiBEYXRlLFxuICAgIC8vIHNldE1pbkRhdGU6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPERhdGU+PixcbiAgICBtYXhEYXRlOiBEYXRlLFxuICAgIC8vIHNldE1heERhdGU6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPERhdGU+PixcbiAgICBzbG90RHVyYXRpb246IG51bWJlcixcbiAgICBob3N0UHJlZmVyZW5jZXM6IFVzZXJQcmVmZXJlbmNlVHlwZSxcbiAgICBtZWV0aW5nQXNzaXN0OiBNZWV0aW5nQXNzaXN0VHlwZSxcbiAgICBvblN1Ym1pdDogKGF2YWlsYWJsZVRpbWU6IEN1c3RvbUF2YWlsYWJsZVRpbWVUeXBlKSA9PiB2b2lkLFxuICAgIG9uQ2FuY2VsOiAoKSA9PiB2b2lkLFxufVxuY29uc3QgZGF5T2ZXZWVrSW50Q29uc3RhbnQgPSAtMVxuXG5jb25zdCBNb2RhbFRpbWVQcmVmZXJlbmNlczogTmV4dFBhZ2U8UHJvcHM+ID0gKHByb3BzOiBQcm9wcykgPT4ge1xuICAgIC8vIGNvbnN0IFtjdXN0b21EYXRlLCBzZXRDdXN0b21EYXRlXSA9IHVzZVN0YXRlPERhdGU+KHByb3BzPy5taW5EYXRlKVxuICAgIC8vIGNvbnN0IFttaW5UaW1lLCBzZXRNaW5UaW1lXSA9IHVzZVN0YXRlPERhdGU+KClcbiAgICAvLyBjb25zdCBbbWF4VGltZSwgc2V0TWF4VGltZV0gPSB1c2VTdGF0ZTxEYXRlPigpXG4gICAgY29uc3QgW2F2YWlsYWJsZVRpbWVzLCBzZXRBdmFpbGFibGVUaW1lc10gPSB1c2VTdGF0ZTxDdXN0b21BdmFpbGFibGVUaW1lVHlwZVtdPigpXG4gICAgY29uc3QgW2F2YWlsYWJsZVN0YXJ0VGltZSwgc2V0QXZhaWxhYmxlU3RhcnRUaW1lXSA9IHVzZVN0YXRlPERhdGU+KG5ldyBEYXRlKCkpXG4gICAgY29uc3QgW2F2YWlsYWJsZUVuZFRpbWUsIHNldEF2YWlsYWJsZUVuZFRpbWVdID0gdXNlU3RhdGU8RGF0ZT4oZGF5anMoKS5hZGQoNSwgJ2gnKS50b0RhdGUoKSlcbiAgICBjb25zdCBbc3RhcnRUaW1lLCBzZXRTdGFydFRpbWVdID0gdXNlU3RhdGU8RGF0ZSB8IG51bGw+KClcbiAgICBjb25zdCBbZW5kVGltZSwgc2V0RW5kVGltZV0gPSB1c2VTdGF0ZTxEYXRlIHwgbnVsbD4oKVxuICAgIGNvbnN0IFtkYXlPZldlZWtJbnQsIHNldERheU9mV2Vla0ludF0gPSB1c2VTdGF0ZTxudW1iZXI+KC0yKVxuICAgIGNvbnN0IFtkYXlPZldlZWtPcHRpb25zLCBzZXREYXlPZldlZWtPcHRpb25zXSA9IHVzZVN0YXRlPFtudW1iZXIsIHN0cmluZ11bXT4oKVxuXG4gICAgY29uc3QgdG9hc3QgPSB1c2VUb2FzdCgpXG5cbiAgICBjb25zdCBtaW5EYXRlID0gcHJvcHM/Lm1pbkRhdGVcbiAgICBjb25zdCBtYXhEYXRlID0gcHJvcHM/Lm1heERhdGVcbiAgICBjb25zdCBob3N0UHJlZmVyZW5jZXMgPSBwcm9wcz8uaG9zdFByZWZlcmVuY2VzXG4gICAgY29uc3QgaG9zdFRpbWV6b25lID0gcHJvcHM/Lm1lZXRpbmdBc3Npc3Q/LnRpbWV6b25lXG4gICAgY29uc3QgbWVldGluZ0Fzc2lzdCA9IHByb3BzPy5tZWV0aW5nQXNzaXN0XG4gICAgY29uc3Qgc2xvdER1cmF0aW9uID0gcHJvcHM/LnNsb3REdXJhdGlvblxuICAgIGNvbnN0IG9uU3VibWl0ID0gcHJvcHM/Lm9uU3VibWl0XG4gICAgY29uc3Qgb25DYW5jZWwgPSBwcm9wcz8ub25DYW5jZWxcblxuICAgIC8vIGdlbmVyYXRlIGFuZCBzZXQgYXZhaWxhYmxlIHRpbWVzIGZvciB0aW1lIHdpbmRvd1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG5cbiAgICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGlmZkRheXMgPSBkYXlqcyhtYXhEYXRlKS5kaWZmKGRheWpzKG1pbkRhdGUpLCAnZCcpXG4gICAgICAgIGNvbnN0IHN0YXJ0RGF0ZXNGb3JFYWNoRGF5ID0gW11cbiAgICAgICAgY29uc3QgbmV3RGF5T2ZXZWVrT3B0aW9uczogW251bWJlciwgc3RyaW5nXVtdID0gW11cblxuICAgICAgICBjb25zdCBuZXdBdmFpbGFibGVUaW1lczogQ3VzdG9tQXZhaWxhYmxlVGltZVR5cGVbXSA9IFtdXG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gZGlmZkRheXM7IGkrKykge1xuICAgICAgICAgICAgc3RhcnREYXRlc0ZvckVhY2hEYXkucHVzaChkYXlqcyhkYXlqcyhtaW5EYXRlKS5mb3JtYXQoKS5zbGljZSgwLCAxOSkpLnR6KGhvc3RUaW1lem9uZSwgdHJ1ZSkuYWRkKGksICdkYXknKS5mb3JtYXQoKSlcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RhcnREYXRlc0ZvckVhY2hEYXkubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgaWYgKGkgPT09IDApIHtcbiAgICAgICAgICAgICAgICBcblxuICAgICAgICAgICAgICAgIGNvbnN0IGF2YWlsYWJsZVRpbWUgPSAoYXdhaXQgYXhpb3MucG9zdDxDdXN0b21BdmFpbGFibGVUaW1lVHlwZT4oJ2FwaS9tb2RhbC10aW1lLXByZWZlcmVuY2VzJywge1xuICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnZ2V0Q3VzdG9tQXZhaWxhYmxlVGltZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2xvdER1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvc3RTdGFydERhdGU6IHN0YXJ0RGF0ZXNGb3JFYWNoRGF5Py5baV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9zdFByZWZlcmVuY2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvc3RUaW1lem9uZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyVGltZXpvbmU6IGRheWpzLnR6Lmd1ZXNzKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNGaXJzdERheTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0xhc3REYXk6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KSk/LmRhdGFcbiAgICAgICAgICAgICAgICAvLyAgMDEyMzQ1Njc4OVxuICAgICAgICAgICAgICAgIC8vICAyMDIwLTA0LTAyVDA4OjAyOjE3LTA1OjAwXG4gICAgICAgICAgICAgICAgaWYgKChhdmFpbGFibGVUaW1lKT8uc3RhcnRUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0F2YWlsYWJsZVRpbWVzLnB1c2goYXZhaWxhYmxlVGltZSBhcyBDdXN0b21BdmFpbGFibGVUaW1lVHlwZSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaSA9PT0gKHN0YXJ0RGF0ZXNGb3JFYWNoRGF5Lmxlbmd0aCAtIDEpKSB7XG4gICAgICAgICAgICAgICAgLy8gY29uc3QgYXZhaWxhYmxlVGltZSA9IGdldEN1c3RvbUF2YWlsYWJsZVRpbWVzKFxuICAgICAgICAgICAgICAgIC8vICAgICBzbG90RHVyYXRpb24sXG4gICAgICAgICAgICAgICAgLy8gICAgIHN0YXJ0RGF0ZXNGb3JFYWNoRGF5Py5baV0sXG4gICAgICAgICAgICAgICAgLy8gICAgIGhvc3RQcmVmZXJlbmNlcyxcbiAgICAgICAgICAgICAgICAvLyAgICAgaG9zdFRpbWV6b25lIGFzIHN0cmluZyxcbiAgICAgICAgICAgICAgICAvLyAgICAgZGF5anMudHouZ3Vlc3MoKSxcbiAgICAgICAgICAgICAgICAvLyAgICAgZmFsc2UsXG4gICAgICAgICAgICAgICAgLy8gICAgIHRydWUsXG4gICAgICAgICAgICAgICAgLy8gKVxuXG4gICAgICAgICAgICAgICAgY29uc3QgYXZhaWxhYmxlVGltZSA9IChhd2FpdCBheGlvcy5wb3N0PEN1c3RvbUF2YWlsYWJsZVRpbWVUeXBlPignYXBpL21vZGFsLXRpbWUtcHJlZmVyZW5jZXMnLCB7XG4gICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdnZXRDdXN0b21BdmFpbGFibGVUaW1lcycsXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzbG90RHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9zdFN0YXJ0RGF0ZTogc3RhcnREYXRlc0ZvckVhY2hEYXk/LltpXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3N0UHJlZmVyZW5jZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9zdFRpbWV6b25lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJUaW1lem9uZTogZGF5anMudHouZ3Vlc3MoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0ZpcnN0RGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0xhc3REYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pKT8uZGF0YVxuXG4gICAgICAgICAgICAgICAgaWYgKChhdmFpbGFibGVUaW1lIGFzIEN1c3RvbUF2YWlsYWJsZVRpbWVUeXBlKT8uc3RhcnRUaW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0F2YWlsYWJsZVRpbWVzLnB1c2goYXZhaWxhYmxlVGltZSBhcyBDdXN0b21BdmFpbGFibGVUaW1lVHlwZSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29udGludWVcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gY29uc3QgYXZhaWxhYmxlVGltZSA9IGdldEN1c3RvbUF2YWlsYWJsZVRpbWVzKFxuICAgICAgICAgICAgLy8gICAgIHNsb3REdXJhdGlvbixcbiAgICAgICAgICAgIC8vICAgICBzdGFydERhdGVzRm9yRWFjaERheT8uW2ldLFxuICAgICAgICAgICAgLy8gICAgIGhvc3RQcmVmZXJlbmNlcyxcbiAgICAgICAgICAgIC8vICAgICBob3N0VGltZXpvbmUgYXMgc3RyaW5nLFxuICAgICAgICAgICAgLy8gICAgIGRheWpzLnR6Lmd1ZXNzKCksXG4gICAgICAgICAgICAvLyApXG5cbiAgICAgICAgICAgIGNvbnN0IGF2YWlsYWJsZVRpbWUgPSAoYXdhaXQgYXhpb3MucG9zdDxDdXN0b21BdmFpbGFibGVUaW1lVHlwZT4oJ2FwaS9tb2RhbC10aW1lLXByZWZlcmVuY2VzJywge1xuICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnZ2V0Q3VzdG9tQXZhaWxhYmxlVGltZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2xvdER1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvc3RTdGFydERhdGU6IHN0YXJ0RGF0ZXNGb3JFYWNoRGF5Py5baV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9zdFByZWZlcmVuY2VzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvc3RUaW1lem9uZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyVGltZXpvbmU6IGRheWpzLnR6Lmd1ZXNzKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNGaXJzdERheTogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNMYXN0RGF5OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSkpPy5kYXRhXG5cbiAgICAgICAgICAgIGlmICgoYXZhaWxhYmxlVGltZSBhcyBDdXN0b21BdmFpbGFibGVUaW1lVHlwZSk/LnN0YXJ0VGltZSkge1xuICAgICAgICAgICAgICAgIG5ld0F2YWlsYWJsZVRpbWVzLnB1c2goYXZhaWxhYmxlVGltZSBhcyBDdXN0b21BdmFpbGFibGVUaW1lVHlwZSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuZXdBdmFpbGFibGVUaW1lcz8uWzBdPy5zdGFydFRpbWUpIHtcbiAgICAgICAgICAgIGNvbnN0IG9sZFN0YXJ0VGltZSA9IHNldElTT0RheShkYXlqcygpXG4gICAgICAgICAgICAgICAgLmhvdXIocGFyc2VJbnQobmV3QXZhaWxhYmxlVGltZXM/LlswXT8uc3RhcnRUaW1lPy5zbGljZSgwLCAyKSwgMTApKVxuICAgICAgICAgICAgICAgIC5taW51dGUocGFyc2VJbnQobmV3QXZhaWxhYmxlVGltZXM/LlswXT8uc3RhcnRUaW1lPy5zbGljZSgzKSwgMTApKVxuICAgICAgICAgICAgICAgIC50b0RhdGUoKSwgbmV3QXZhaWxhYmxlVGltZXM/LlswXT8uZGF5T2ZXZWVrSW50ID8/IDEpXG4gICAgICAgICAgICBzZXRBdmFpbGFibGVTdGFydFRpbWUob2xkU3RhcnRUaW1lKVxuXG4gICAgICAgICAgICBjb25zdCBvbGRFbmRUaW1lID0gc2V0SVNPRGF5KGRheWpzKClcbiAgICAgICAgICAgICAgICAuaG91cihwYXJzZUludChuZXdBdmFpbGFibGVUaW1lcz8uWzBdPy5lbmRUaW1lPy5zbGljZSgwLCAyKSwgMTApKVxuICAgICAgICAgICAgICAgIC5taW51dGUocGFyc2VJbnQobmV3QXZhaWxhYmxlVGltZXM/LlswXT8uZW5kVGltZT8uc2xpY2UoMyksIDEwKSlcbiAgICAgICAgICAgICAgICAudG9EYXRlKCksIG5ld0F2YWlsYWJsZVRpbWVzPy5bMF0/LmRheU9mV2Vla0ludCA/PyAxKVxuICAgICAgICAgICAgc2V0QXZhaWxhYmxlRW5kVGltZShvbGRFbmRUaW1lKVxuICAgICAgICAgICAgc2V0QXZhaWxhYmxlVGltZXMobmV3QXZhaWxhYmxlVGltZXMpXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIGNyZWF0ZSBkYXlPZldlZWtPcHRpb25zXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RhcnREYXRlc0ZvckVhY2hEYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbiA9IGdldElTT0RheShkYXlqcyhkYXlqcyhtaW5EYXRlKS5mb3JtYXQoKS5zbGljZSgwLCAxOSkpLnR6KGhvc3RUaW1lem9uZSwgdHJ1ZSkuYWRkKGksICdkYXknKS50b0RhdGUoKSlcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gKG9wdGlvbiAhPT0gLTEgPyBkYXlqcyhzZXRJU09EYXkoZGF5anMoKS50b0RhdGUoKSwgb3B0aW9uKSkuZm9ybWF0KCdkZGRkJykgOiAnQW55IGRheSBvZiB0aGUgd2VlaycpXG4gICAgICAgICAgICBuZXdEYXlPZldlZWtPcHRpb25zLnB1c2goW29wdGlvbiwgdmFsdWVdKVxuICAgICAgICB9XG5cbiAgICAgICAgbmV3RGF5T2ZXZWVrT3B0aW9ucy5wdXNoKFstMSwgJ0FueSBkYXkgb2YgdGhlIHdlZWsnXSlcbiAgICAgICAgXG4gICAgICAgIHNldERheU9mV2Vla09wdGlvbnMobmV3RGF5T2ZXZWVrT3B0aW9ucylcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlLCAnIHVuYWJsZSB0byBjaGVjayBtb2RhbCB0aW1lIHByZWZlcmVuY2VzJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkoKVxuICAgIH0sIFttaW5EYXRlLCBtYXhEYXRlLCBob3N0VGltZXpvbmUsIHNsb3REdXJhdGlvbiwgaG9zdFByZWZlcmVuY2VzXSlcblxuICAgIC8vIGNoYW5nZSBhdmFpbGFibGUgdGltZSBiYXNlZCBvbiBkYXlPZldlZWtJbnRcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICAoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYXZhaWxhYmxlVGltZSA9IGF2YWlsYWJsZVRpbWVzPy5maW5kKGEgPT4gKGE/LmRheU9mV2Vla0ludCA9PT0gZGF5T2ZXZWVrSW50KSlcblxuICAgICAgICAgICAgaWYgKGF2YWlsYWJsZVRpbWUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBvbGRTdGFydFRpbWUgPSBzZXRJU09EYXkoZGF5anMoKVxuICAgICAgICAgICAgICAgIC5ob3VyKHBhcnNlSW50KGF2YWlsYWJsZVRpbWU/LnN0YXJ0VGltZT8uc2xpY2UoMCwgMiksIDEwKSlcbiAgICAgICAgICAgICAgICAubWludXRlKHBhcnNlSW50KGF2YWlsYWJsZVRpbWU/LnN0YXJ0VGltZT8uc2xpY2UoMyksIDEwKSlcbiAgICAgICAgICAgICAgICAudG9EYXRlKCksIGF2YWlsYWJsZVRpbWU/LmRheU9mV2Vla0ludCA/PyAxKVxuICAgICAgICAgICAgc2V0QXZhaWxhYmxlU3RhcnRUaW1lKG9sZFN0YXJ0VGltZSlcblxuICAgICAgICAgICAgY29uc3Qgb2xkRW5kVGltZSA9IHNldElTT0RheShkYXlqcygpXG4gICAgICAgICAgICAgICAgLmhvdXIocGFyc2VJbnQoYXZhaWxhYmxlVGltZT8uZW5kVGltZT8uc2xpY2UoMCwgMiksIDEwKSlcbiAgICAgICAgICAgICAgICAubWludXRlKHBhcnNlSW50KGF2YWlsYWJsZVRpbWU/LmVuZFRpbWU/LnNsaWNlKDMpLCAxMCkpXG4gICAgICAgICAgICAgICAgLnRvRGF0ZSgpLCBhdmFpbGFibGVUaW1lPy5kYXlPZldlZWtJbnQgPz8gMSlcbiAgICAgICAgICAgIHNldEF2YWlsYWJsZUVuZFRpbWUob2xkRW5kVGltZSlcbiAgICAgICAgICAgIH0gICAgICAgIFxuICAgICAgICB9KSgpXG4gICAgfSwgW2F2YWlsYWJsZVRpbWVzLCBkYXlPZldlZWtJbnRdKVxuXG4gICAgY29uc3Qgb25DaGFuZ2VPcHRpb24gPSAoZTogeyB0YXJnZXQ6IHsgdmFsdWU6IGFueSB9IH0pID0+IHNldERheU9mV2Vla0ludChlLnRhcmdldC52YWx1ZSB8fCAtMSlcblxuICAgIGNvbnN0IG9uU2F2ZSA9ICgpID0+IHtcbiAgICAgICAgb25TdWJtaXQoe1xuICAgICAgICAgICAgZGF5T2ZXZWVrSW50OiB0eXBlb2YgZGF5T2ZXZWVrSW50ID09PSAnc3RyaW5nJyA/IHBhcnNlSW50KGRheU9mV2Vla0ludCwgMTApIDogZGF5T2ZXZWVrSW50LFxuICAgICAgICAgICAgc3RhcnRUaW1lOiBkYXlqcyhzdGFydFRpbWUgfHwgbmV3IERhdGUoKSkuZm9ybWF0KCdISDptbScpIGFzIFRpbWUsXG4gICAgICAgICAgICBlbmRUaW1lOiBkYXlqcyhlbmRUaW1lIHx8IGRheWpzKCkuYWRkKDgsICdoJykpLmZvcm1hdCgnSEg6bW0nKSBhcyBUaW1lLFxuICAgICAgICB9KVxuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBmbGV4LWNvbCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXIgaC1mdWxsIHctZnVsbFwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0ZXh0LWNlbnRlciBzbTp0ZXh0LWxlZnRcIj5cbiAgICAgICAgICAgICAgICA8aDIgY2xhc3NOYW1lPVwibGc6dGV4dC1sZyBmb250LWJvbGQgdGV4dC1ncmF5LTkwMCBkYXJrOnRleHQtZ3JheS0yMDAgc206dGV4dC14bFwiPlxuICAgICAgICAgICAgICAgICAgICBTZWxlY3QgYSBDdXN0b20gVGltZVxuICAgICAgICAgICAgICAgIDwvaDI+XG4gICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPVwibXQtMS41IHRleHQtc20gdGV4dC1ncmF5LTUwMFwiPlxuICAgICAgICAgICAgICAgICAgICB7XCJZb3UgY2FuIHNlbGVjdCBhIHRpbWUgYXMgYnJvYWQgYXMgcG9zc2libGUgdGhhdCB3b3JrcyBmb3IgeW91XCJ9XG4gICAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGV4dC1sZWZ0IHNtOnRleHQteGwgbGc6dGV4dC1sZyBsZzpteS0yIHNtOm15LTNcIj5cbiAgICAgICAgICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImxhYmVsLXRleHQgZGFyazp0ZXh0LWdyYXktNTAwXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICB7J0RheSBPZiBXZWVrOiBvcHRpb25hbCd9XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBjbGFzc05hbWU9XCJzZWxlY3Qgc2VsZWN0LWJvcmRlcmVkIHctZnVsbCBtYXgtdy14cyB0ZXh0LWdyYXktOTAwIGJnLWdyYXktMjAwIGRhcms6dGV4dC1ncmF5LTIwMCBkYXJrOmJnLWdyYXktOTAwXCIgcGxhY2Vob2xkZXI9J1NlbGVjdCBkYXkgb2Ygd2Vlaycgb25DaGFuZ2U9e29uQ2hhbmdlT3B0aW9ufSB2YWx1ZT17ZGF5T2ZXZWVrSW50fT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxvcHRpb24gZGlzYWJsZWQgc2VsZWN0ZWQga2V5PXstMn0gdmFsdWU9ey0yfT5TZWxlY3QgZGF5IG9mIHdlZWs8L29wdGlvbj5cbiAgICAgICAgICAgICAgICAgICAgICAgIHtkYXlPZldlZWtPcHRpb25zPy5tYXAodmFsdWVzID0+IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIGtleT17dmFsdWVzWzBdfSB2YWx1ZT17dmFsdWVzWzBdfT57dmFsdWVzWzFdfTwvb3B0aW9uPlxuICAgICAgICAgICAgICAgICAgICAgICAgKSl9XG4gICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PlxuICAgICAgICAgICAgICAgIDwvbGFiZWw+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGV4dC1sZWZ0IHNtOnRleHQteGwgbGc6dGV4dC1sZyBsZzpteS0yIHNtOm15LTNcIj5cbiAgICAgICAgICAgICAgICA8bGFiZWw+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT1cImxhYmVsLXRleHQgZGFyazp0ZXh0LWdyYXktNTAwIGxnOm15LTEgc206bXktMlwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgeydTdGFydCBUaW1lOid9XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPERhdGVQaWNrZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkPXtzdGFydFRpbWV9XG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGRhdGUpID0+IHNldFN0YXJ0VGltZShkYXRlKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dUaW1lU2VsZWN0XG4gICAgICAgICAgICAgICAgICAgICAgICBzaG93VGltZVNlbGVjdE9ubHlcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVJbnRlcnZhbHM9e3Nsb3REdXJhdGlvbn1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVDYXB0aW9uPVwiVGltZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRlRm9ybWF0PVwiaDptbSBhYVwiXG4gICAgICAgICAgICAgICAgICAgICAgICBtaW5UaW1lPXthdmFpbGFibGVTdGFydFRpbWV9XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXhUaW1lPXthdmFpbGFibGVFbmRUaW1lfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPVwidGV4dC1ncmF5LTkwMCBiZy1ncmF5LTIwMCBkYXJrOnRleHQtZ3JheS0yMDAgZGFyazpiZy1ncmF5LTkwMCByb3VuZGVkLWxnIHRleHQtY2VudGVyXCJcbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L2xhYmVsPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0ZXh0LWxlZnQgc206dGV4dC14bCBsZzp0ZXh0LWxnIGxnOm15LTIgc206bXktM1wiPlxuICAgICAgICAgICAgICAgIDxsYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwibGFiZWwtdGV4dCBkYXJrOnRleHQtZ3JheS01MDAgbGc6bXktMSBzbTpteS0yXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICB7J0VuZCBUaW1lOid9XG4gICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgPERhdGVQaWNrZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkPXtlbmRUaW1lfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhkYXRlKSA9PiBzZXRFbmRUaW1lKGRhdGUpfVxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1RpbWVTZWxlY3RcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3dUaW1lU2VsZWN0T25seVxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZUludGVydmFscz17c2xvdER1cmF0aW9ufVxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZUNhcHRpb249XCJUaW1lXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVGb3JtYXQ9XCJoOm1tIGFhXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1pblRpbWU9e2F2YWlsYWJsZVN0YXJ0VGltZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG1heFRpbWU9e2F2YWlsYWJsZUVuZFRpbWV9XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJ0ZXh0LWdyYXktOTAwIGJnLWdyYXktMjAwIGRhcms6dGV4dC1ncmF5LTIwMCBkYXJrOmJnLWdyYXktOTAwIHJvdW5kZWQtbGcgdGV4dC1jZW50ZXJcIlxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDwvbGFiZWw+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBqdXN0aWZ5LWNlbnRlciBpdGVtcy1jZW50ZXIgc3BhY2UteC00IHctMS8yIGxnOm0tMyBtLTRcIj5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT0nYnRuIGJ0bi1zZWNvbmRhcnknIG9uQ2xpY2s9e29uU2F2ZX0+XG4gICAgICAgICAgICAgICAgICAgIHsnU3VibWl0J31cbiAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT0nYnRuIGJ0bi1naG9zdCcgb25DbGljaz17b25DYW5jZWx9PlxuICAgICAgICAgICAgICAgICAgICB7J0NhbmNlbCd9XG4gICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgKVxufVxuXG5leHBvcnQgZGVmYXVsdCBNb2RhbFRpbWVQcmVmZXJlbmNlcyJdfQ==