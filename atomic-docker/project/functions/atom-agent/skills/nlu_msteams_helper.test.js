import { buildMSTeamsSearchQuery } from './nlu_msteams_helper';
describe('buildMSTeamsSearchQuery', () => {
    it('should build a KQL query with textKeywords and fromUser', () => {
        const params = {
            textKeywords: 'project update',
            fromUser: 'john.doe@example.com',
        };
        // Order of terms joined by AND might vary, so check for components.
        const result = buildMSTeamsSearchQuery(params);
        expect(result).toContain('project update');
        expect(result).toContain('from:john.doe@example.com');
        expect(result.split(' AND ').length).toBe(2);
    });
    it('should build a KQL query with subjectContains and onDate', () => {
        const params = {
            subjectContains: 'Weekly Sync',
            onDate: '2024-03-10',
        };
        const result = buildMSTeamsSearchQuery(params);
        expect(result).toContain('subject:Weekly Sync');
        expect(result).toContain('created:2024-03-10');
        expect(result.split(' AND ').length).toBe(2);
    });
    it('should build a KQL query with exactPhrase and hasFile', () => {
        const params = {
            exactPhrase: 'must review this document',
            hasFile: true,
        };
        const result = buildMSTeamsSearchQuery(params);
        expect(result).toContain('"must review this document"');
        expect(result).toContain('hasattachment:true');
        expect(result.split(' AND ').length).toBe(2);
    });
    it('should build a KQL query with date range (afterDate and beforeDate)', () => {
        const params = {
            afterDate: '2024-01-01',
            beforeDate: '2024-01-31',
            textKeywords: 'planning session',
        };
        const result = buildMSTeamsSearchQuery(params);
        expect(result).toContain('created:2024-01-01..2024-01-31');
        expect(result).toContain('planning session');
    });
    it('should handle only afterDate', () => {
        const params = { afterDate: '2024-02-15' };
        expect(buildMSTeamsSearchQuery(params)).toBe('created>=2024-02-15');
    });
    it('should handle only beforeDate', () => {
        const params = { beforeDate: '2024-02-20' };
        expect(buildMSTeamsSearchQuery(params)).toBe('created<=2024-02-20');
    });
    it('should include mentionsUser and inChatOrChannel as text keywords', () => {
        const params = {
            mentionsUser: 'Sarah Connor',
            inChatOrChannel: 'Project Terminator Chat',
        };
        const result = buildMSTeamsSearchQuery(params);
        expect(result).toContain('"Sarah Connor"');
        expect(result).toContain('"Project Terminator Chat"');
    });
    it('should handle hasLink by adding (http OR https)', () => {
        const params = {
            hasLink: true,
        };
        expect(buildMSTeamsSearchQuery(params)).toBe('(http OR https)');
    });
    it('should combine multiple parameters with AND', () => {
        const params = {
            fromUser: 'test@example.com',
            textKeywords: 'urgent task',
            subjectContains: 'Action Required',
            onDate: '2023-01-15',
            hasFile: true,
        };
        const result = buildMSTeamsSearchQuery(params);
        expect(result).toContain('urgent task');
        expect(result).toContain('from:test@example.com');
        expect(result).toContain('subject:Action Required');
        expect(result).toContain('created:2023-01-15');
        expect(result).toContain('hasattachment:true');
        // Check that terms are ANDed together
        const parts = result.split(' AND ');
        expect(parts.length).toBe(5); // 5 terms should be ANDed
    });
    it('should return an empty string for an empty params object', () => {
        const params = {};
        expect(buildMSTeamsSearchQuery(params)).toBe('');
    });
    it('should trim whitespace from parameters', () => {
        const params = {
            textKeywords: '  leading and trailing spaces  ',
            fromUser: '  user@example.com  ',
        };
        const result = buildMSTeamsSearchQuery(params);
        expect(result).toContain('leading and trailing spaces');
        expect(result).toContain('from:user@example.com');
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmx1X21zdGVhbXNfaGVscGVyLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJubHVfbXN0ZWFtc19oZWxwZXIudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUcvRCxRQUFRLENBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO0lBQ3ZDLEVBQUUsQ0FBQyx5REFBeUQsRUFBRSxHQUFHLEVBQUU7UUFDakUsTUFBTSxNQUFNLEdBQTJCO1lBQ3JDLFlBQVksRUFBRSxnQkFBZ0I7WUFDOUIsUUFBUSxFQUFFLHNCQUFzQjtTQUNqQyxDQUFDO1FBQ0Ysb0VBQW9FO1FBQ3BFLE1BQU0sTUFBTSxHQUFHLHVCQUF1QixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQy9DLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUMzQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLDJCQUEyQixDQUFDLENBQUM7UUFDdEQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQy9DLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLDBEQUEwRCxFQUFFLEdBQUcsRUFBRTtRQUNsRSxNQUFNLE1BQU0sR0FBMkI7WUFDckMsZUFBZSxFQUFFLGFBQWE7WUFDOUIsTUFBTSxFQUFFLFlBQVk7U0FDckIsQ0FBQztRQUNGLE1BQU0sTUFBTSxHQUFHLHVCQUF1QixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQy9DLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxTQUFTLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUNoRCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFDL0MsTUFB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LFNBQVMsQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1FBQ3hELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxTQUFTLENBQUMsdUJBQXVCLENBQUMsQ0FBQztJQUNwRCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYnVpbGRNU1RlYW1zU2VhcmNoUXVlcnkgfSBmcm9tICcuL25sdV9tc3RlYW1zX2hlbHBlcic7XG5pbXBvcnQgeyBTdHJ1Y3R1cmVkTVNUZWFtc1F1ZXJ5IH0gZnJvbSAnLi9sbG1fbXN0ZWFtc19xdWVyeV91bmRlcnN0YW5kZXInO1xuXG5kZXNjcmliZSgnYnVpbGRNU1RlYW1zU2VhcmNoUXVlcnknLCAoKSA9PiB7XG4gIGl0KCdzaG91bGQgYnVpbGQgYSBLUUwgcXVlcnkgd2l0aCB0ZXh0S2V5d29yZHMgYW5kIGZyb21Vc2VyJywgKCkgPT4ge1xuICAgIGNvbnN0IHBhcmFtczogU3RydWN0dXJlZE1TVGVhbXNRdWVyeSA9IHtcbiAgICAgIHRleHRLZXl3b3JkczogJ3Byb2plY3QgdXBkYXRlJyxcbiAgICAgIGZyb21Vc2VyOiAnam9obi5kb2VAZXhhbXBsZS5jb20nLFxuICAgIH07XG4gICAgLy8gT3JkZXIgb2YgdGVybXMgam9pbmVkIGJ5IEFORCBtaWdodCB2YXJ5LCBzbyBjaGVjayBmb3IgY29tcG9uZW50cy5cbiAgICBjb25zdCByZXN1bHQgPSBidWlsZE1TVGVhbXNTZWFyY2hRdWVyeShwYXJhbXMpO1xuICAgIGV4cGVjdChyZXN1bHQpLnRvQ29udGFpbigncHJvamVjdCB1cGRhdGUnKTtcbiAgICBleHBlY3QocmVzdWx0KS50b0NvbnRhaW4oJ2Zyb206am9obi5kb2VAZXhhbXBsZS5jb20nKTtcbiAgICBleHBlY3QocmVzdWx0LnNwbGl0KCcgQU5EICcpLmxlbmd0aCkudG9CZSgyKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBidWlsZCBhIEtRTCBxdWVyeSB3aXRoIHN1YmplY3RDb250YWlucyBhbmQgb25EYXRlJywgKCkgPT4ge1xuICAgIGNvbnN0IHBhcmFtczogU3RydWN0dXJlZE1TVGVhbXNRdWVyeSA9IHtcbiAgICAgIHN1YmplY3RDb250YWluczogJ1dlZWtseSBTeW5jJyxcbiAgICAgIG9uRGF0ZTogJzIwMjQtMDMtMTAnLFxuICAgIH07XG4gICAgY29uc3QgcmVzdWx0ID0gYnVpbGRNU1RlYW1zU2VhcmNoUXVlcnkocGFyYW1zKTtcbiAgICBleHBlY3QocmVzdWx0KS50b0NvbnRhaW4oJ3N1YmplY3Q6V2Vla2x5IFN5bmMnKTtcbiAgICBleHBlY3QocmVzdWx0KS50b0NvbnRhaW4oJ2NyZWF0ZWQ6MjAyNC0wMy0xMCcpO1xuICAgIGV4cGVjdChyZXN1bHQuc3BsaXQoJyBBTkQgJykubGVuZ3RoKS50b0JlKDIpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGJ1aWxkIGEgS1FMIHF1ZXJ5IHdpdGggZXhhY3RQaHJhc2UgYW5kIGhhc0ZpbGUnLCAoKSA9PiB7XG4gICAgY29uc3QgcGFyYW1zOiBTdHJ1Y3R1cmVkTVNUZWFtc1F1ZXJ5ID0ge1xuICAgICAgZXhhY3RQaHJhc2U6ICdtdXN0IHJldmlldyB0aGlzIGRvY3VtZW50JyxcbiAgICAgIGhhc0ZpbGU6IHRydWUsXG4gICAgfTtcbiAgICBjb25zdCByZXN1bHQgPSBidWlsZE1TVGVhbXNTZWFyY2hRdWVyeShwYXJhbXMpO1xuICAgIGV4cGVjdChyZXN1bHQpLnRvQ29udGFpbignXCJtdXN0IHJldmlldyB0aGlzIGRvY3VtZW50XCInKTtcbiAgICBleHBlY3QocmVzdWx0KS50b0NvbnRhaW4oJ2hhc2F0dGFjaG1lbnQ6dHJ1ZScpO1xuICAgIGV4cGVjdChyZXN1bHQuc3BsaXQoJyBBTkQgJykubGVuZ3RoKS50b0JlKDIpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGJ1aWxkIGEgS1FMIHF1ZXJ5IHdpdGggZGF0ZSByYW5nZSAoYWZ0ZXJEYXRlIGFuZCBiZWZvcmVEYXRlKScsICgpID0+IHtcbiAgICBjb25zdCBwYXJhbXM6IFN0cnVjdHVyZWRNU1RlYW1zUXVlcnkgPSB7XG4gICAgICBhZnRlckRhdGU6ICcyMDI0LTAxLTAxJyxcbiAgICAgIGJlZm9yZURhdGU6ICcyMDI0LTAxLTMxJyxcbiAgICAgIHRleHRLZXl3b3JkczogJ3BsYW5uaW5nIHNlc3Npb24nLFxuICAgIH07XG4gICAgY29uc3QgcmVzdWx0ID0gYnVpbGRNU1RlYW1zU2VhcmNoUXVlcnkocGFyYW1zKTtcbiAgICBleHBlY3QocmVzdWx0KS50b0NvbnRhaW4oJ2NyZWF0ZWQ6MjAyNC0wMS0wMS4uMjAyNC0wMS0zMScpO1xuICAgIGV4cGVjdChyZXN1bHQpLnRvQ29udGFpbigncGxhbm5pbmcgc2Vzc2lvbicpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGhhbmRsZSBvbmx5IGFmdGVyRGF0ZScsICgpID0+IHtcbiAgICBjb25zdCBwYXJhbXM6IFN0cnVjdHVyZWRNU1RlYW1zUXVlcnkgPSB7IGFmdGVyRGF0ZTogJzIwMjQtMDItMTUnIH07XG4gICAgZXhwZWN0KGJ1aWxkTVNUZWFtc1NlYXJjaFF1ZXJ5KHBhcmFtcykpLnRvQmUoJ2NyZWF0ZWQ+PTIwMjQtMDItMTUnKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBoYW5kbGUgb25seSBiZWZvcmVEYXRlJywgKCkgPT4ge1xuICAgIGNvbnN0IHBhcmFtczogU3RydWN0dXJlZE1TVGVhbXNRdWVyeSA9IHsgYmVmb3JlRGF0ZTogJzIwMjQtMDItMjAnIH07XG4gICAgZXhwZWN0KGJ1aWxkTVNUZWFtc1NlYXJjaFF1ZXJ5KHBhcmFtcykpLnRvQmUoJ2NyZWF0ZWQ8PTIwMjQtMDItMjAnKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBpbmNsdWRlIG1lbnRpb25zVXNlciBhbmQgaW5DaGF0T3JDaGFubmVsIGFzIHRleHQga2V5d29yZHMnLCAoKSA9PiB7XG4gICAgY29uc3QgcGFyYW1zOiBTdHJ1Y3R1cmVkTVNUZWFtc1F1ZXJ5ID0ge1xuICAgICAgbWVudGlvbnNVc2VyOiAnU2FyYWggQ29ubm9yJyxcbiAgICAgIGluQ2hhdE9yQ2hhbm5lbDogJ1Byb2plY3QgVGVybWluYXRvciBDaGF0JyxcbiAgICB9O1xuICAgIGNvbnN0IHJlc3VsdCA9IGJ1aWxkTVNUZWFtc1NlYXJjaFF1ZXJ5KHBhcmFtcyk7XG4gICAgZXhwZWN0KHJlc3VsdCkudG9Db250YWluKCdcIlNhcmFoIENvbm5vclwiJyk7XG4gICAgZXhwZWN0KHJlc3VsdCkudG9Db250YWluKCdcIlByb2plY3QgVGVybWluYXRvciBDaGF0XCInKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBoYW5kbGUgaGFzTGluayBieSBhZGRpbmcgKGh0dHAgT1IgaHR0cHMpJywgKCkgPT4ge1xuICAgIGNvbnN0IHBhcmFtczogU3RydWN0dXJlZE1TVGVhbXNRdWVyeSA9IHtcbiAgICAgIGhhc0xpbms6IHRydWUsXG4gICAgfTtcbiAgICBleHBlY3QoYnVpbGRNU1RlYW1zU2VhcmNoUXVlcnkocGFyYW1zKSkudG9CZSgnKGh0dHAgT1IgaHR0cHMpJyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgY29tYmluZSBtdWx0aXBsZSBwYXJhbWV0ZXJzIHdpdGggQU5EJywgKCkgPT4ge1xuICAgIGNvbnN0IHBhcmFtczogU3RydWN0dXJlZE1TVGVhbXNRdWVyeSA9IHtcbiAgICAgIGZyb21Vc2VyOiAndGVzdEBleGFtcGxlLmNvbScsXG4gICAgICB0ZXh0S2V5d29yZHM6ICd1cmdlbnQgdGFzaycsXG4gICAgICBzdWJqZWN0Q29udGFpbnM6ICdBY3Rpb24gUmVxdWlyZWQnLFxuICAgICAgb25EYXRlOiAnMjAyMy0wMS0xNScsXG4gICAgICBoYXNGaWxlOiB0cnVlLFxuICAgIH07XG4gICAgY29uc3QgcmVzdWx0ID0gYnVpbGRNU1RlYW1zU2VhcmNoUXVlcnkocGFyYW1zKTtcbiAgICBleHBlY3QocmVzdWx0KS50b0NvbnRhaW4oJ3VyZ2VudCB0YXNrJyk7XG4gICAgZXhwZWN0KHJlc3VsdCkudG9Db250YWluKCdmcm9tOnRlc3RAZXhhbXBsZS5jb20nKTtcbiAgICBleHBlY3QocmVzdWx0KS50b0NvbnRhaW4oJ3N1YmplY3Q6QWN0aW9uIFJlcXVpcmVkJyk7XG4gICAgZXhwZWN0KHJlc3VsdCkudG9Db250YWluKCdjcmVhdGVkOjIwMjMtMDEtMTUnKTtcbiAgICBleHBlY3QocmVzdWx0KS50b0NvbnRhaW4oJ2hhc2F0dGFjaG1lbnQ6dHJ1ZScpO1xuICAgIC8vIENoZWNrIHRoYXQgdGVybXMgYXJlIEFORGVkIHRvZ2V0aGVyXG4gICAgY29uc3QgcGFydHMgPSByZXN1bHQuc3BsaXQoJyBBTkQgJyk7XG4gICAgZXhwZWN0KHBhcnRzLmxlbmd0aCkudG9CZSg1KTsgLy8gNSB0ZXJtcyBzaG91bGQgYmUgQU5EZWRcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCByZXR1cm4gYW4gZW1wdHkgc3RyaW5nIGZvciBhbiBlbXB0eSBwYXJhbXMgb2JqZWN0JywgKCkgPT4ge1xuICAgIGNvbnN0IHBhcmFtczogU3RydWN0dXJlZE1TVGVhbXNRdWVyeSA9IHt9O1xuICAgIGV4cGVjdChidWlsZE1TVGVhbXNTZWFyY2hRdWVyeShwYXJhbXMpKS50b0JlKCcnKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCB0cmltIHdoaXRlc3BhY2UgZnJvbSBwYXJhbWV0ZXJzJywgKCkgPT4ge1xuICAgIGNvbnN0IHBhcmFtczogU3RydWN0dXJlZE1TVGVhbXNRdWVyeSA9IHtcbiAgICAgIHRleHRLZXl3b3JkczogJyAgbGVhZGluZyBhbmQgdHJhaWxpbmcgc3BhY2VzICAnLFxuICAgICAgZnJvbVVzZXI6ICcgIHVzZXJAZXhhbXBsZS5jb20gICcsXG4gICAgfTtcbiAgICBjb25zdCByZXN1bHQgPSBidWlsZE1TVGVhbXNTZWFyY2hRdWVyeShwYXJhbXMpO1xuICAgIGV4cGVjdChyZXN1bHQpLnRvQ29udGFpbignbGVhZGluZyBhbmQgdHJhaWxpbmcgc3BhY2VzJyk7XG4gICAgZXhwZWN0KHJlc3VsdCkudG9Db250YWluKCdmcm9tOnVzZXJAZXhhbXBsZS5jb20nKTtcbiAgfSk7XG59KTtcbiJdfQ==