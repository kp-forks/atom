// Mock external dependencies for local testing without real API calls
// Mock OpenAI
export class MockOpenAI {
    constructor(config) { }
    chat = {
        completions: {
            create: async (params) => ({
                id: 'mock-completion-id',
                object: 'chat.completion',
                created: Date.now(),
                model: params.model || 'mock-model',
                choices: [
                    {
                        index: 0,
                        message: {
                            role: 'assistant',
                            content: `Mock response for: ${params.messages[params.messages.length - 1].content}`,
                        },
                        finish_reason: 'stop',
                    },
                ],
                usage: {
                    prompt_tokens: 10,
                    completion_tokens: 10,
                    total_tokens: 20,
                },
            }),
        },
    };
    embeddings = {
        create: async (params) => ({
            object: 'list',
            data: [
                {
                    object: 'embedding',
                    embedding: new Array(1536).fill(0.01), // Mock embedding vector
                    index: 0,
                },
            ],
            model: params.model || 'text-embedding-3-small',
            usage: {
                prompt_tokens: 10,
                total_tokens: 10,
            },
        }),
    };
}
// Mock date-fns
export const mockDateFns = {
    startOfWeek: (date, options) => {
        const d = new Date(date);
        const day = d.getDay();
        const diff = d.getDate() - day + (day === 0 ? -6 : 1);
        return new Date(d.setDate(diff));
    },
    endOfWeek: (date, options) => {
        const d = new Date(date);
        const day = d.getDay();
        const diff = d.getDate() - day + (day === 0 ? 0 : 7);
        return new Date(d.setDate(diff));
    },
    startOfMonth: (date) => {
        return new Date(date.getFullYear(), date.getMonth(), 1);
    },
    endOfMonth: (date) => {
        return new Date(date.getFullYear(), date.getMonth() + 1, 0);
    },
    add: (date, duration) => {
        const d = new Date(date);
        if (duration.days)
            d.setDate(d.getDate() + duration.days);
        if (duration.months)
            d.setMonth(d.getMonth() + duration.months);
        if (duration.years)
            d.setFullYear(d.getFullYear() + duration.years);
        if (duration.hours)
            d.setHours(d.getHours() + duration.hours);
        if (duration.minutes)
            d.setMinutes(d.getMinutes() + duration.minutes);
        return d;
    },
    sub: (date, duration) => {
        const d = new Date(date);
        if (duration.days)
            d.setDate(d.getDate() - duration.days);
        if (duration.months)
            d.setMonth(d.getMonth() - duration.months);
        if (duration.years)
            d.setFullYear(d.getFullYear() - duration.years);
        if (duration.hours)
            d.setHours(d.getHours() - duration.hours);
        if (duration.minutes)
            d.setMinutes(d.getMinutes() - duration.minutes);
        return d;
    },
    format: (date, formatStr) => {
        // Simple format implementation
        const d = new Date(date);
        return formatStr
            .replace('yyyy', d.getFullYear().toString())
            .replace('MM', (d.getMonth() + 1).toString().padStart(2, '0'))
            .replace('dd', d.getDate().toString().padStart(2, '0'))
            .replace('HH', d.getHours().toString().padStart(2, '0'))
            .replace('mm', d.getMinutes().toString().padStart(2, '0'))
            .replace('ss', d.getSeconds().toString().padStart(2, '0'));
    },
    getISODay: (date) => {
        const day = date.getDay();
        return day === 0 ? 7 : day;
    },
};
// Mock googleapis
export const mockGoogleApis = {
    google: {
        auth: {
            OAuth2: class MockOAuth2 {
                credentials = {};
                constructor(clientId, clientSecret, redirectUri) { }
                setCredentials(tokens) {
                    this.credentials = tokens;
                }
                getAccessToken() {
                    return Promise.resolve({
                        token: 'mock-access-token',
                        res: null,
                    });
                }
                refreshAccessToken() {
                    return Promise.resolve({
                        credentials: {
                            access_token: 'mock-refreshed-token',
                            refresh_token: 'mock-refresh-token',
                            expiry_date: Date.now() + 3600000,
                        },
                    });
                }
            },
        },
        calendar: (options) => ({
            events: {
                list: async (params) => ({
                    data: {
                        items: [],
                        nextPageToken: null,
                        summary: 'Mock Calendar',
                        updated: new Date().toISOString(),
                    },
                }),
                get: async (params) => ({
                    data: {
                        id: params.eventId || 'mock-event-id',
                        summary: 'Mock Event',
                        start: { dateTime: new Date().toISOString() },
                        end: { dateTime: new Date(Date.now() + 3600000).toISOString() },
                    },
                }),
                insert: async (params) => ({
                    data: {
                        id: 'mock-new-event-id',
                        ...params.requestBody,
                        created: new Date().toISOString(),
                        updated: new Date().toISOString(),
                    },
                }),
                update: async (params) => ({
                    data: {
                        id: params.eventId,
                        ...params.requestBody,
                        updated: new Date().toISOString(),
                    },
                }),
                delete: async (params) => ({}),
            },
            calendarList: {
                list: async () => ({
                    data: {
                        items: [
                            {
                                id: 'primary',
                                summary: 'Primary Calendar',
                                primary: true,
                                accessRole: 'owner',
                            },
                        ],
                    },
                }),
            },
        }),
    },
};
// Mock OpenSearch
export class MockOpenSearchClient {
    constructor(config) { }
    async search(params) {
        return {
            body: {
                took: 1,
                timed_out: false,
                hits: {
                    total: { value: 0, relation: 'eq' },
                    hits: [],
                },
            },
        };
    }
    async index(params) {
        return {
            body: {
                _index: params.index,
                _id: params.id || 'mock-doc-id',
                _version: 1,
                result: 'created',
            },
        };
    }
    async bulk(params) {
        return {
            body: {
                took: 1,
                errors: false,
                items: [],
            },
        };
    }
    async delete(params) {
        return {
            body: {
                _index: params.index,
                _id: params.id,
                result: 'deleted',
            },
        };
    }
}
// Mock AWS S3
export class MockS3Client {
    constructor(config) { }
    async send(command) {
        if (command instanceof MockPutObjectCommand) {
            return {
                ETag: '"mock-etag"',
                VersionId: 'mock-version-id',
            };
        }
        return {};
    }
}
export class MockPutObjectCommand {
    params;
    constructor(params) {
        this.params = params;
    }
}
// Mock Kafka
export class MockKafka {
    constructor(config) { }
    producer() {
        return {
            connect: async () => { },
            send: async (params) => {
                console.log('Mock Kafka send:', params);
                return [{ topicName: params.topic, partition: 0, errorCode: 0 }];
            },
            disconnect: async () => { },
        };
    }
    consumer(config) {
        return {
            connect: async () => { },
            subscribe: async (params) => { },
            run: async (params) => { },
            disconnect: async () => { },
        };
    }
}
// Mock ip module
export const mockIp = {
    address: () => '127.0.0.1',
    isPrivate: (addr) => addr.startsWith('192.168.') ||
        addr.startsWith('10.') ||
        addr === '127.0.0.1',
    isLoopback: (addr) => addr === '127.0.0.1' || addr === '::1',
    loopback: (family) => (family === 'ipv6' ? '::1' : '127.0.0.1'),
};
// Mock got (HTTP client)
export const mockGot = {
    get: async (url, options) => ({
        body: {},
        statusCode: 200,
        headers: {},
    }),
    post: async (url, options) => ({
        body: {},
        statusCode: 200,
        headers: {},
    }),
    put: async (url, options) => ({
        body: {},
        statusCode: 200,
        headers: {},
    }),
    delete: async (url, options) => ({
        body: {},
        statusCode: 200,
        headers: {},
    }),
};
// Mock axios
export const mockAxios = {
    get: async (url, config) => ({
        data: {},
        status: 200,
        statusText: 'OK',
        headers: {},
        config: config || {},
    }),
    post: async (url, data, config) => ({
        data: {},
        status: 200,
        statusText: 'OK',
        headers: {},
        config: config || {},
    }),
    put: async (url, data, config) => ({
        data: {},
        status: 200,
        statusText: 'OK',
        headers: {},
        config: config || {},
    }),
    delete: async (url, config) => ({
        data: {},
        status: 200,
        statusText: 'OK',
        headers: {},
        config: config || {},
    }),
};
// Export all mocks
export default {
    OpenAI: MockOpenAI,
    dateFns: mockDateFns,
    googleapis: mockGoogleApis,
    OpenSearchClient: MockOpenSearchClient,
    S3Client: MockS3Client,
    PutObjectCommand: MockPutObjectCommand,
    Kafka: MockKafka,
    ip: mockIp,
    got: mockGot,
    axios: mockAxios,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXh0ZXJuYWwtZGVwcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImV4dGVybmFsLWRlcHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsc0VBQXNFO0FBRXRFLGNBQWM7QUFDZCxNQUFNLE9BQU8sVUFBVTtJQUNyQixZQUFZLE1BQVcsSUFBRyxDQUFDO0lBRTNCLElBQUksR0FBRztRQUNMLFdBQVcsRUFBRTtZQUNYLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO2dCQUM5QixFQUFFLEVBQUUsb0JBQW9CO2dCQUN4QixNQUFNLEVBQUUsaUJBQWlCO2dCQUN6QixPQUFPLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRTtnQkFDbkIsS0FBSyxFQUFFLE1BQU0sQ0FBQyxLQUFLLElBQUksWUFBWTtnQkFDbkMsT0FBTyxFQUFFO29CQUNQO3dCQUNFLEtBQUssRUFBRSxDQUFDO3dCQUNSLE9BQU8sRUFBRTs0QkFDUCxJQUFJLEVBQUUsV0FBVzs0QkFDakIsT0FBTyxFQUFFLHNCQUFzQixNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRTt5QkFDckY7d0JBQ0QsYUFBYSxFQUFFLE1BQU07cUJBQ3RCO2lCQUNGO2dCQUNELEtBQUssRUFBRTtvQkFDTCxhQUFhLEVBQUUsRUFBRTtvQkFDakIsaUJBQWlCLEVBQUUsRUFBRTtvQkFDckIsWUFBWSxFQUFFLEVBQUU7aUJBQ2pCO2FBQ0YsQ0FBQztTQUNIO0tBQ0YsQ0FBQztJQUVGLFVBQVUsR0FBRztRQUNYLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBVyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQzlCLE1BQU0sRUFBRSxNQUFNO1lBQ2QsSUFBSSxFQUFFO2dCQUNKO29CQUNFLE1BQU0sRUFBRSxXQUFXO29CQUNuQixTQUFTLEVBQUUsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsSUFB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QUUsT0FBTztJQUNaLEtBQUssRUFBRSxTQUFTO0NBQ2pCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBNb2NrIGV4dGVybmFsIGRlcGVuZGVuY2llcyBmb3IgbG9jYWwgdGVzdGluZyB3aXRob3V0IHJlYWwgQVBJIGNhbGxzXG5cbi8vIE1vY2sgT3BlbkFJXG5leHBvcnQgY2xhc3MgTW9ja09wZW5BSSB7XG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogYW55KSB7fVxuXG4gIGNoYXQgPSB7XG4gICAgY29tcGxldGlvbnM6IHtcbiAgICAgIGNyZWF0ZTogYXN5bmMgKHBhcmFtczogYW55KSA9PiAoe1xuICAgICAgICBpZDogJ21vY2stY29tcGxldGlvbi1pZCcsXG4gICAgICAgIG9iamVjdDogJ2NoYXQuY29tcGxldGlvbicsXG4gICAgICAgIGNyZWF0ZWQ6IERhdGUubm93KCksXG4gICAgICAgIG1vZGVsOiBwYXJhbXMubW9kZWwgfHwgJ21vY2stbW9kZWwnLFxuICAgICAgICBjaG9pY2VzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgaW5kZXg6IDAsXG4gICAgICAgICAgICBtZXNzYWdlOiB7XG4gICAgICAgICAgICAgIHJvbGU6ICdhc3Npc3RhbnQnLFxuICAgICAgICAgICAgICBjb250ZW50OiBgTW9jayByZXNwb25zZSBmb3I6ICR7cGFyYW1zLm1lc3NhZ2VzW3BhcmFtcy5tZXNzYWdlcy5sZW5ndGggLSAxXS5jb250ZW50fWAsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZmluaXNoX3JlYXNvbjogJ3N0b3AnLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIHVzYWdlOiB7XG4gICAgICAgICAgcHJvbXB0X3Rva2VuczogMTAsXG4gICAgICAgICAgY29tcGxldGlvbl90b2tlbnM6IDEwLFxuICAgICAgICAgIHRvdGFsX3Rva2VuczogMjAsXG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICB9LFxuICB9O1xuXG4gIGVtYmVkZGluZ3MgPSB7XG4gICAgY3JlYXRlOiBhc3luYyAocGFyYW1zOiBhbnkpID0+ICh7XG4gICAgICBvYmplY3Q6ICdsaXN0JyxcbiAgICAgIGRhdGE6IFtcbiAgICAgICAge1xuICAgICAgICAgIG9iamVjdDogJ2VtYmVkZGluZycsXG4gICAgICAgICAgZW1iZWRkaW5nOiBuZXcgQXJyYXkoMTUzNikuZmlsbCgwLjAxKSwgLy8gTW9jayBlbWJlZGRpbmcgdmVjdG9yXG4gICAgICAgICAgaW5kZXg6IDAsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgbW9kZWw6IHBhcmFtcy5tb2RlbCB8fCAndGV4dC1lbWJlZGRpbmctMy1zbWFsbCcsXG4gICAgICB1c2FnZToge1xuICAgICAgICBwcm9tcHRfdG9rZW5zOiAxMCxcbiAgICAgICAgdG90YWxfdG9rZW5zOiAxMCxcbiAgICAgIH0sXG4gICAgfSksXG4gIH07XG59XG5cbi8vIE1vY2sgZGF0ZS1mbnNcbmV4cG9ydCBjb25zdCBtb2NrRGF0ZUZucyA9IHtcbiAgc3RhcnRPZldlZWs6IChkYXRlOiBEYXRlLCBvcHRpb25zPzogYW55KSA9PiB7XG4gICAgY29uc3QgZCA9IG5ldyBEYXRlKGRhdGUpO1xuICAgIGNvbnN0IGRheSA9IGQuZ2V0RGF5KCk7XG4gICAgY29uc3QgZGlmZiA9IGQuZ2V0RGF0ZSgpIC0gZGF5ICsgKGRheSA9PT0gMCA/IC02IDogMSk7XG4gICAgcmV0dXJuIG5ldyBEYXRlKGQuc2V0RGF0ZShkaWZmKSk7XG4gIH0sXG4gIGVuZE9mV2VlazogKGRhdGU6IERhdGUsIG9wdGlvbnM/OiBhbnkpID0+IHtcbiAgICBjb25zdCBkID0gbmV3IERhdGUoZGF0ZSk7XG4gICAgY29uc3QgZGF5ID0gZC5nZXREYXkoKTtcbiAgICBjb25zdCBkaWZmID0gZC5nZXREYXRlKCkgLSBkYXkgKyAoZGF5ID09PSAwID8gMCA6IDcpO1xuICAgIHJldHVybiBuZXcgRGF0ZShkLnNldERhdGUoZGlmZikpO1xuICB9LFxuICBzdGFydE9mTW9udGg6IChkYXRlOiBEYXRlKSA9PiB7XG4gICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUuZ2V0RnVsbFllYXIoKSwgZGF0ZS5nZXRNb250aCgpLCAxKTtcbiAgfSxcbiAgZW5kT2ZNb250aDogKGRhdGU6IERhdGUpID0+IHtcbiAgICByZXR1cm4gbmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCkgKyAxLCAwKTtcbiAgfSxcbiAgYWRkOiAoZGF0ZTogRGF0ZSwgZHVyYXRpb246IGFueSkgPT4ge1xuICAgIGNvbnN0IGQgPSBuZXcgRGF0ZShkYXRlKTtcbiAgICBpZiAoZHVyYXRpb24uZGF5cykgZC5zZXREYXRlKGQuZ2V0RGF0ZSgpICsgZHVyYXRpb24uZGF5cyk7XG4gICAgaWYgKGR1cmF0aW9uLm1vbnRocykgZC5zZXRNb250aChkLmdldE1vbnRoKCkgKyBkdXJhdGlvbi5tb250aHMpO1xuICAgIGlmIChkdXJhdGlvbi55ZWFycykgZC5zZXRGdWxsWWVhcihkLmdldEZ1bGxZZWFyKCkgKyBkdXJhdGlvbi55ZWFycyk7XG4gICAgaWYgKGR1cmF0aW9uLmhvdXJzKSBkLnNldEhvdXJzKGQuZ2V0SG91cnMoKSArIGR1cmF0aW9uLmhvdXJzKTtcbiAgICBpZiAoZHVyYXRpb24ubWludXRlcykgZC5zZXRNaW51dGVzKGQuZ2V0TWludXRlcygpICsgZHVyYXRpb24ubWludXRlcyk7XG4gICAgcmV0dXJuIGQ7XG4gIH0sXG4gIHN1YjogKGRhdGU6IERhdGUsIGR1cmF0aW9uOiBhbnkpID0+IHtcbiAgICBjb25zdCBkID0gbmV3IERhdGUoZGF0ZSk7XG4gICAgaWYgKGR1cmF0aW9uLmRheXMpIGQuc2V0RGF0ZShkLmdldERhdGUoKSAtIGR1cmF0aW9uLmRheXMpO1xuICAgIGlmIChkdXJhdGlvbi5tb250aHMpIGQuc2V0TW9udGgoZC5nZXRNb250aCgpIC0gZHVyYXRpb24ubW9udGhzKTtcbiAgICBpZiAoZHVyYXRpb24ueWVhcnMpIGQuc2V0RnVsbFllYXIoZC5nZXRGdWxsWWVhcigpIC0gZHVyYXRpb24ueWVhcnMpO1xuICAgIGlmIChkdXJhdGlvbi5ob3VycykgZC5zZXRIb3VycyhkLmdldEhvdXJzKCkgLSBkdXJhdGlvbi5ob3Vycyk7XG4gICAgaWYgKGR1cmF0aW9uLm1pbnV0ZXMpIGQuc2V0TWludXRlcyhkLmdldE1pbnV0ZXMoKSAtIGR1cmF0aW9uLm1pbnV0ZXMpO1xuICAgIHJldHVybiBkO1xuICB9LFxuICBmb3JtYXQ6IChkYXRlOiBEYXRlLCBmb3JtYXRTdHI6IHN0cmluZykgPT4ge1xuICAgIC8vIFNpbXBsZSBmb3JtYXQgaW1wbGVtZW50YXRpb25cbiAgICBjb25zdCBkID0gbmV3IERhdGUoZGF0ZSk7XG4gICAgcmV0dXJuIGZvcm1hdFN0clxuICAgICAgLnJlcGxhY2UoJ3l5eXknLCBkLmdldEZ1bGxZZWFyKCkudG9TdHJpbmcoKSlcbiAgICAgIC5yZXBsYWNlKCdNTScsIChkLmdldE1vbnRoKCkgKyAxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykpXG4gICAgICAucmVwbGFjZSgnZGQnLCBkLmdldERhdGUoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJykpXG4gICAgICAucmVwbGFjZSgnSEgnLCBkLmdldEhvdXJzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpKVxuICAgICAgLnJlcGxhY2UoJ21tJywgZC5nZXRNaW51dGVzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpKVxuICAgICAgLnJlcGxhY2UoJ3NzJywgZC5nZXRTZWNvbmRzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpKTtcbiAgfSxcbiAgZ2V0SVNPRGF5OiAoZGF0ZTogRGF0ZSkgPT4ge1xuICAgIGNvbnN0IGRheSA9IGRhdGUuZ2V0RGF5KCk7XG4gICAgcmV0dXJuIGRheSA9PT0gMCA/IDcgOiBkYXk7XG4gIH0sXG59O1xuXG4vLyBNb2NrIGdvb2dsZWFwaXNcbmV4cG9ydCBjb25zdCBtb2NrR29vZ2xlQXBpcyA9IHtcbiAgZ29vZ2xlOiB7XG4gICAgYXV0aDoge1xuICAgICAgT0F1dGgyOiBjbGFzcyBNb2NrT0F1dGgyIHtcbiAgICAgICAgY3JlZGVudGlhbHM6IGFueSA9IHt9O1xuXG4gICAgICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICAgIGNsaWVudElkPzogc3RyaW5nLFxuICAgICAgICAgIGNsaWVudFNlY3JldD86IHN0cmluZyxcbiAgICAgICAgICByZWRpcmVjdFVyaT86IHN0cmluZ1xuICAgICAgICApIHt9XG5cbiAgICAgICAgc2V0Q3JlZGVudGlhbHModG9rZW5zOiBhbnkpIHtcbiAgICAgICAgICB0aGlzLmNyZWRlbnRpYWxzID0gdG9rZW5zO1xuICAgICAgICB9XG5cbiAgICAgICAgZ2V0QWNjZXNzVG9rZW4oKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgICAgICB0b2tlbjogJ21vY2stYWNjZXNzLXRva2VuJyxcbiAgICAgICAgICAgIHJlczogbnVsbCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlZnJlc2hBY2Nlc3NUb2tlbigpIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgICAgICAgIGNyZWRlbnRpYWxzOiB7XG4gICAgICAgICAgICAgIGFjY2Vzc190b2tlbjogJ21vY2stcmVmcmVzaGVkLXRva2VuJyxcbiAgICAgICAgICAgICAgcmVmcmVzaF90b2tlbjogJ21vY2stcmVmcmVzaC10b2tlbicsXG4gICAgICAgICAgICAgIGV4cGlyeV9kYXRlOiBEYXRlLm5vdygpICsgMzYwMDAwMCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSxcbiAgICBjYWxlbmRhcjogKG9wdGlvbnM6IGFueSkgPT4gKHtcbiAgICAgIGV2ZW50czoge1xuICAgICAgICBsaXN0OiBhc3luYyAocGFyYW1zOiBhbnkpID0+ICh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgaXRlbXM6IFtdLFxuICAgICAgICAgICAgbmV4dFBhZ2VUb2tlbjogbnVsbCxcbiAgICAgICAgICAgIHN1bW1hcnk6ICdNb2NrIENhbGVuZGFyJyxcbiAgICAgICAgICAgIHVwZGF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgZ2V0OiBhc3luYyAocGFyYW1zOiBhbnkpID0+ICh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgaWQ6IHBhcmFtcy5ldmVudElkIHx8ICdtb2NrLWV2ZW50LWlkJyxcbiAgICAgICAgICAgIHN1bW1hcnk6ICdNb2NrIEV2ZW50JyxcbiAgICAgICAgICAgIHN0YXJ0OiB7IGRhdGVUaW1lOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgfSxcbiAgICAgICAgICAgIGVuZDogeyBkYXRlVGltZTogbmV3IERhdGUoRGF0ZS5ub3coKSArIDM2MDAwMDApLnRvSVNPU3RyaW5nKCkgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgaW5zZXJ0OiBhc3luYyAocGFyYW1zOiBhbnkpID0+ICh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgaWQ6ICdtb2NrLW5ldy1ldmVudC1pZCcsXG4gICAgICAgICAgICAuLi5wYXJhbXMucmVxdWVzdEJvZHksXG4gICAgICAgICAgICBjcmVhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICB1cGRhdGVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICAgIHVwZGF0ZTogYXN5bmMgKHBhcmFtczogYW55KSA9PiAoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGlkOiBwYXJhbXMuZXZlbnRJZCxcbiAgICAgICAgICAgIC4uLnBhcmFtcy5yZXF1ZXN0Qm9keSxcbiAgICAgICAgICAgIHVwZGF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICAgZGVsZXRlOiBhc3luYyAocGFyYW1zOiBhbnkpID0+ICh7fSksXG4gICAgICB9LFxuICAgICAgY2FsZW5kYXJMaXN0OiB7XG4gICAgICAgIGxpc3Q6IGFzeW5jICgpID0+ICh7XG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiAncHJpbWFyeScsXG4gICAgICAgICAgICAgICAgc3VtbWFyeTogJ1ByaW1hcnkgQ2FsZW5kYXInLFxuICAgICAgICAgICAgICAgIHByaW1hcnk6IHRydWUsXG4gICAgICAgICAgICAgICAgYWNjZXNzUm9sZTogJ293bmVyJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSksXG4gICAgICB9LFxuICAgIH0pLFxuICB9LFxufTtcblxuLy8gTW9jayBPcGVuU2VhcmNoXG5leHBvcnQgY2xhc3MgTW9ja09wZW5TZWFyY2hDbGllbnQge1xuICBjb25zdHJ1Y3Rvcihjb25maWc6IGFueSkge31cblxuICBhc3luYyBzZWFyY2gocGFyYW1zOiBhbnkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYm9keToge1xuICAgICAgICB0b29rOiAxLFxuICAgICAgICB0aW1lZF9vdXQ6IGZhbHNlLFxuICAgICAgICBoaXRzOiB7XG4gICAgICAgICAgdG90YWw6IHsgdmFsdWU6IDAsIHJlbGF0aW9uOiAnZXEnIH0sXG4gICAgICAgICAgaGl0czogW10sXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBhc3luYyBpbmRleChwYXJhbXM6IGFueSkge1xuICAgIHJldHVybiB7XG4gICAgICBib2R5OiB7XG4gICAgICAgIF9pbmRleDogcGFyYW1zLmluZGV4LFxuICAgICAgICBfaWQ6IHBhcmFtcy5pZCB8fCAnbW9jay1kb2MtaWQnLFxuICAgICAgICBfdmVyc2lvbjogMSxcbiAgICAgICAgcmVzdWx0OiAnY3JlYXRlZCcsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBhc3luYyBidWxrKHBhcmFtczogYW55KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGJvZHk6IHtcbiAgICAgICAgdG9vazogMSxcbiAgICAgICAgZXJyb3JzOiBmYWxzZSxcbiAgICAgICAgaXRlbXM6IFtdLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlKHBhcmFtczogYW55KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGJvZHk6IHtcbiAgICAgICAgX2luZGV4OiBwYXJhbXMuaW5kZXgsXG4gICAgICAgIF9pZDogcGFyYW1zLmlkLFxuICAgICAgICByZXN1bHQ6ICdkZWxldGVkJyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxufVxuXG4vLyBNb2NrIEFXUyBTM1xuZXhwb3J0IGNsYXNzIE1vY2tTM0NsaWVudCB7XG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogYW55KSB7fVxuXG4gIGFzeW5jIHNlbmQoY29tbWFuZDogYW55KSB7XG4gICAgaWYgKGNvbW1hbmQgaW5zdGFuY2VvZiBNb2NrUHV0T2JqZWN0Q29tbWFuZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgRVRhZzogJ1wibW9jay1ldGFnXCInLFxuICAgICAgICBWZXJzaW9uSWQ6ICdtb2NrLXZlcnNpb24taWQnLFxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHt9O1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBNb2NrUHV0T2JqZWN0Q29tbWFuZCB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBwYXJhbXM6IGFueSkge31cbn1cblxuLy8gTW9jayBLYWZrYVxuZXhwb3J0IGNsYXNzIE1vY2tLYWZrYSB7XG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogYW55KSB7fVxuXG4gIHByb2R1Y2VyKCkge1xuICAgIHJldHVybiB7XG4gICAgICBjb25uZWN0OiBhc3luYyAoKSA9PiB7fSxcbiAgICAgIHNlbmQ6IGFzeW5jIChwYXJhbXM6IGFueSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnTW9jayBLYWZrYSBzZW5kOicsIHBhcmFtcyk7XG4gICAgICAgIHJldHVybiBbeyB0b3BpY05hbWU6IHBhcmFtcy50b3BpYywgcGFydGl0aW9uOiAwLCBlcnJvckNvZGU6IDAgfV07XG4gICAgICB9LFxuICAgICAgZGlzY29ubmVjdDogYXN5bmMgKCkgPT4ge30sXG4gICAgfTtcbiAgfVxuXG4gIGNvbnN1bWVyKGNvbmZpZzogYW55KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvbm5lY3Q6IGFzeW5jICgpID0+IHt9LFxuICAgICAgc3Vic2NyaWJlOiBhc3luYyAocGFyYW1zOiBhbnkpID0+IHt9LFxuICAgICAgcnVuOiBhc3luYyAocGFyYW1zOiBhbnkpID0+IHt9LFxuICAgICAgZGlzY29ubmVjdDogYXN5bmMgKCkgPT4ge30sXG4gICAgfTtcbiAgfVxufVxuXG4vLyBNb2NrIGlwIG1vZHVsZVxuZXhwb3J0IGNvbnN0IG1vY2tJcCA9IHtcbiAgYWRkcmVzczogKCkgPT4gJzEyNy4wLjAuMScsXG4gIGlzUHJpdmF0ZTogKGFkZHI6IHN0cmluZykgPT5cbiAgICBhZGRyLnN0YXJ0c1dpdGgoJzE5Mi4xNjguJykgfHxcbiAgICBhZGRyLnN0YXJ0c1dpdGgoJzEwLicpIHx8XG4gICAgYWRkciA9PT0gJzEyNy4wLjAuMScsXG4gIGlzTG9vcGJhY2s6IChhZGRyOiBzdHJpbmcpID0+IGFkZHIgPT09ICcxMjcuMC4wLjEnIHx8IGFkZHIgPT09ICc6OjEnLFxuICBsb29wYmFjazogKGZhbWlseT86IHN0cmluZykgPT4gKGZhbWlseSA9PT0gJ2lwdjYnID8gJzo6MScgOiAnMTI3LjAuMC4xJyksXG59O1xuXG4vLyBNb2NrIGdvdCAoSFRUUCBjbGllbnQpXG5leHBvcnQgY29uc3QgbW9ja0dvdCA9IHtcbiAgZ2V0OiBhc3luYyAodXJsOiBzdHJpbmcsIG9wdGlvbnM/OiBhbnkpID0+ICh7XG4gICAgYm9keToge30sXG4gICAgc3RhdHVzQ29kZTogMjAwLFxuICAgIGhlYWRlcnM6IHt9LFxuICB9KSxcbiAgcG9zdDogYXN5bmMgKHVybDogc3RyaW5nLCBvcHRpb25zPzogYW55KSA9PiAoe1xuICAgIGJvZHk6IHt9LFxuICAgIHN0YXR1c0NvZGU6IDIwMCxcbiAgICBoZWFkZXJzOiB7fSxcbiAgfSksXG4gIHB1dDogYXN5bmMgKHVybDogc3RyaW5nLCBvcHRpb25zPzogYW55KSA9PiAoe1xuICAgIGJvZHk6IHt9LFxuICAgIHN0YXR1c0NvZGU6IDIwMCxcbiAgICBoZWFkZXJzOiB7fSxcbiAgfSksXG4gIGRlbGV0ZTogYXN5bmMgKHVybDogc3RyaW5nLCBvcHRpb25zPzogYW55KSA9PiAoe1xuICAgIGJvZHk6IHt9LFxuICAgIHN0YXR1c0NvZGU6IDIwMCxcbiAgICBoZWFkZXJzOiB7fSxcbiAgfSksXG59O1xuXG4vLyBNb2NrIGF4aW9zXG5leHBvcnQgY29uc3QgbW9ja0F4aW9zID0ge1xuICBnZXQ6IGFzeW5jICh1cmw6IHN0cmluZywgY29uZmlnPzogYW55KSA9PiAoe1xuICAgIGRhdGE6IHt9LFxuICAgIHN0YXR1czogMjAwLFxuICAgIHN0YXR1c1RleHQ6ICdPSycsXG4gICAgaGVhZGVyczoge30sXG4gICAgY29uZmlnOiBjb25maWcgfHwge30sXG4gIH0pLFxuICBwb3N0OiBhc3luYyAodXJsOiBzdHJpbmcsIGRhdGE/OiBhbnksIGNvbmZpZz86IGFueSkgPT4gKHtcbiAgICBkYXRhOiB7fSxcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBzdGF0dXNUZXh0OiAnT0snLFxuICAgIGhlYWRlcnM6IHt9LFxuICAgIGNvbmZpZzogY29uZmlnIHx8IHt9LFxuICB9KSxcbiAgcHV0OiBhc3luYyAodXJsOiBzdHJpbmcsIGRhdGE/OiBhbnksIGNvbmZpZz86IGFueSkgPT4gKHtcbiAgICBkYXRhOiB7fSxcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBzdGF0dXNUZXh0OiAnT0snLFxuICAgIGhlYWRlcnM6IHt9LFxuICAgIGNvbmZpZzogY29uZmlnIHx8IHt9LFxuICB9KSxcbiAgZGVsZXRlOiBhc3luYyAodXJsOiBzdHJpbmcsIGNvbmZpZz86IGFueSkgPT4gKHtcbiAgICBkYXRhOiB7fSxcbiAgICBzdGF0dXM6IDIwMCxcbiAgICBzdGF0dXNUZXh0OiAnT0snLFxuICAgIGhlYWRlcnM6IHt9LFxuICAgIGNvbmZpZzogY29uZmlnIHx8IHt9LFxuICB9KSxcbn07XG5cbi8vIEV4cG9ydCBhbGwgbW9ja3NcbmV4cG9ydCBkZWZhdWx0IHtcbiAgT3BlbkFJOiBNb2NrT3BlbkFJLFxuICBkYXRlRm5zOiBtb2NrRGF0ZUZucyxcbiAgZ29vZ2xlYXBpczogbW9ja0dvb2dsZUFwaXMsXG4gIE9wZW5TZWFyY2hDbGllbnQ6IE1vY2tPcGVuU2VhcmNoQ2xpZW50LFxuICBTM0NsaWVudDogTW9ja1MzQ2xpZW50LFxuICBQdXRPYmplY3RDb21tYW5kOiBNb2NrUHV0T2JqZWN0Q29tbWFuZCxcbiAgS2Fma2E6IE1vY2tLYWZrYSxcbiAgaXA6IG1vY2tJcCxcbiAgZ290OiBtb2NrR290LFxuICBheGlvczogbW9ja0F4aW9zLFxufTtcbiJdfQ==