import OpenAI from 'openai';
import got from 'got';
import dayjs from 'dayjs';
import timezonePlugin from 'dayjs/plugin/timezone';
import utcPlugin from 'dayjs/plugin/utc';
import customParseFormatPlugin from 'dayjs/plugin/customParseFormat';
import isBetweenPlugin from 'dayjs/plugin/isBetween';
import { google, Auth } from 'googleapis';
import { v4 as uuidv4 } from 'uuid';
import _ from 'lodash';
import { sendEmail } from '@/_utils/email/email';
dayjs.extend(utcPlugin);
dayjs.extend(timezonePlugin);
dayjs.extend(customParseFormatPlugin);
dayjs.extend(isBetweenPlugin);
// --- OpenAI Client Setup ---
const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });
// --- Helper Function Implementations (condensed, from previous steps) ---
import retry from 'async-retry'; // Import async-retry
import Opossum from 'opossum'; // Import opossum
import winston from 'winston'; // Import winston
// --- Logger Setup for api-helper.ts ---
// This local logger will be used for resilience-related events (retries, circuit breaker states)
// and for logging errors within this helper module.
// It's expected that OpenTelemetry's WinstonInstrumentation will patch this instance
// to include trace_id and span_id when an OTel context is active.
const serviceNameForLogger = process.env.OTEL_SERVICE_NAME || 'functions-service';
const serviceVersionForLogger = process.env.OTEL_SERVICE_VERSION || '1.0.0';
const localApiHelperLogger = winston.createLogger({
    level: process.env.LOG_LEVEL || 'info',
    format: winston.format.combine(winston.format.timestamp(), winston.format.json(), winston.format((info) => {
        info.service_name = serviceNameForLogger;
        info.version = serviceVersionForLogger;
        info.module = 'gpt-api-helper'; // Identify logs from this specific module
        return info;
    })()),
    transports: [
        new winston.transports.Console(),
    ],
});
// Standard retry configuration for got
const defaultGotRetryConfig = {
    limit: 3,
    methods: ['GET', 'POST', 'PUT', 'HEAD', 'DELETE', 'OPTIONS', 'TRACE'], // Retrying POST/PUT for Hasura assuming idempotency or acceptance
    statusCodes: [408, 429, 500, 502, 503, 504],
    errorCodes: ['ETIMEDOUT', 'ECONNRESET', 'EADDRINUSE', 'ECONNREFUSED', 'EPIPE', 'ENETUNREACH', 'EAI_AGAIN'],
    calculateDelay: ({ attemptCount }) => {
        // console.warn(`Retrying got request, attempt ${attemptCount}`); // Placeholder for proper logger
        return Math.pow(2, attemptCount - 1) * 500 + Math.random() * 200; // Exponential backoff with jitter
    }
};
// --- Circuit Breaker for Hasura calls using got ---
const hasuraGotBreakerOptions = {
    timeout: false, // got handles its own timeouts per attempt
    errorThresholdPercentage: 50,
    resetTimeout: 30000, // 30 seconds
    volumeThreshold: 10, // Minimum number of requests in a rolling window before breaker considers statistics
    name: 'HasuraGotBreaker', // Name for logging/identification
};
const hasuraGotBreaker = new Opossum(async (action) => {
    // The 'action' will be the got.post call.
    // Opossum expects the action to be a function that returns a Promise.
    return action();
}, hasuraGotBreakerOptions);
// Event listeners for the Hasura circuit breaker
hasuraGotBreaker.on('open', () => {
    localApiHelperLogger.error(`Circuit Breaker Opened: ${hasuraGotBreaker.name}`, {
        circuit_breaker_name: hasuraGotBreaker.name,
        event: 'open',
        message: `Circuit breaker ${hasuraGotBreaker.name} has opened. Calls will be rejected temporarily.`,
    });
});
hasuraGotBreaker.on('close', () => {
    localApiHelperLogger.warn(`Circuit Breaker Closed: ${hasuraGotBreaker.name}`, {
        circuit_breaker_name: hasuraGotBreaker.name,
        event: 'close',
        message: `Circuit breaker ${hasuraGotBreaker.name} has closed. Calls are now flowing normally.`,
    });
});
hasuraGotBreaker.on('halfOpen', () => {
    localApiHelperLogger.warn(`Circuit Breaker HalfOpen: ${hasuraGotBreaker.name}`, {
        circuit_breaker_name: hasuraGotBreaker.name,
        event: 'halfOpen',
        message: `Circuit breaker ${hasuraGotBreaker.name} is now half-open. Test calls will be allowed.`,
    });
});
hasuraGotBreaker.on('reject', () => {
    localApiHelperLogger.warn(`Circuit Breaker Rejected Call: ${hasuraGotBreaker.name}`, {
        circuit_breaker_name: hasuraGotBreaker.name,
        event: 'reject',
        message: `Call rejected by ${hasuraGotBreaker.name} because circuit is open.`,
    });
});
// Opossum also has 'success' and 'failure' events for the wrapped action,
// which could be used for more detailed logging if needed, but might be verbose.
// hasuraGotBreaker.on('failure', (error, executionTime) => {
//   console.error({
//     circuit_breaker_name: hasuraGotBreaker.name,
//     event: 'failure',
//     error_message: error.message,
//     execution_time_ms: executionTime,
//   }, `Breaker action failed for ${hasuraGotBreaker.name}`);
// });
// --- Circuit Breaker for OpenAI calls ---
const openAIBreakerOptions = {
    timeout: false, // async-retry and OpenAI SDK handle individual attempt timeouts
    errorThresholdPercentage: 50,
    resetTimeout: 60000, // 60 seconds
    volumeThreshold: 5, // Minimum requests in rolling window
    name: 'OpenAIBreaker',
};
const openAIBreaker = new Opossum(async (systemMessage, userMessage, exampleInput, exampleOutput, model) => {
    // This is the action opossum will fire, which is our existing retry logic for OpenAI
    const messages = [{ role: 'system', content: systemMessage }];
    if (exampleInput && exampleOutput) {
        messages.push({ role: 'user', content: exampleInput });
        messages.push({ role: 'assistant', content: exampleOutput });
    }
    messages.push({ role: 'user', content: userMessage });
    const chosenModel = model || 'gpt-3.5-turbo-1106';
    const operation_name_inner = 'OpenAICall_AttemptLogic'; // More specific name for inner logic
    return await retry(async (bail, attemptNumber) => {
        try {
            // console.log(`[${operation_name_inner}] Attempt ${attemptNumber} to call OpenAI...`); // Placeholder
            const completion = await openai.chat.completions.create({
                model: chosenModel,
                messages,
                timeout: 20000, // 20s timeout per attempt
            });
            // Explicitly return success structure expected by opossum's .fire() and outer function
            return { success: true, content: completion?.choices?.[0]?.message?.content };
        }
        catch (error) {
            const logContextRetry = {
                operation_name: `${operation_name_inner}_Retry`, // Keep this distinct
                attempt: attemptNumber,
                error_message: error.message,
                error_type: error.constructor.name,
            };
            if (error.response && error.response.status) {
                logContextRetry.error_status = error.response.status;
            }
            // console.warn("OpenAI call attempt failed", logContextRetry); // Placeholder
            if (error.response && [400, 401, 403, 404].includes(error.response.status)) {
                // console.warn(`[${operation_name_inner}] Non-retryable OpenAI API error (status ${error.response.status}). Bailing.`); // Placeholder
                bail(error); // Stop retrying for these client errors
                return; // bail will throw, so this won't be reached.
            }
            throw error; // Re-throw other errors to trigger retry
        }
    }, {
        retries: 3, factor: 2, minTimeout: 1000, maxTimeout: 10000,
        onRetry: (error, attemptNumber) => {
            const logContextOnRetry = {
                operation_name: `${openAIBreaker.name}_AsyncRetry_OnRetry`, // Distinguish this log
                attempt: attemptNumber,
                error_message: error.message,
                error_type: error.constructor.name,
            };
            if (error.response && error.response.status) {
                logContextOnRetry.error_status = error.response.status;
            }
            localApiHelperLogger.warn("Retrying OpenAI call (async-retry)", logContextOnRetry);
        },
    });
}, openAIBreakerOptions);
// Event listeners for the OpenAI circuit breaker
openAIBreaker.on('open', () => {
    localApiHelperLogger.error(`CB Opened: ${openAIBreaker.name}`, { circuit_breaker_name: openAIBreaker.name, event: 'open', message: `Circuit breaker ${openAIBreaker.name} opened.` });
});
openAIBreaker.on('close', () => {
    localApiHelperLogger.warn(`CB Closed: ${openAIBreaker.name}`, { circuit_breaker_name: openAIBreaker.name, event: 'close', message: `Circuit breaker ${openAIBreaker.name} closed.` });
});
openAIBreaker.on('halfOpen', () => {
    localApiHelperLogger.warn(`CB HalfOpen: ${openAIBreaker.name}`, { circuit_breaker_name: openAIBreaker.name, event: 'halfOpen', message: `Circuit breaker ${openAIBreaker.name} half-open.` });
});
openAIBreaker.on('reject', () => {
    localApiHelperLogger.warn(`CB Rejected Call: ${openAIBreaker.name}`, { circuit_breaker_name: openAIBreaker.name, event: 'reject', message: `Call rejected by ${openAIBreaker.name} (circuit open).` });
});
// This is the actual exported function that uses the circuit breaker.
export const callOpenAI = async (systemMessage, userMessage, exampleInput, exampleOutput, model) => {
    const operation_name = 'OpenAICall_CircuitWrapped'; // For outer logging context
    try {
        // Pass the original arguments to the breaker.fire() method.
        // Opossum will then pass these to the async function defined in its constructor.
        const result = await openAIBreaker.fire(systemMessage, userMessage, exampleInput, exampleOutput, model);
        // The action wrapped by openAIBreaker already returns the {success: true/false, ...} structure from async-retry's resolution.
        return result;
    }
    catch (e) {
        // This catch block handles errors primarily from the circuit breaker itself (e.g., EOPENBREAKER)
        // or if the action passed to opossum had an unhandled promise rejection NOT caught by async-retry's .catch()
        // (which shouldn't happen with the current setup as async-retry's .catch() returns a value).
        const errorMessagePrefix = e.code === 'EOPENBREAKER'
            ? `Circuit breaker ${openAIBreaker.name} is open for OpenAI.`
            : `Circuit breaker error for ${operation_name}.`; // Default for unexpected errors from breaker
        const finalErrorContext = {
            operation_name: `${operation_name}_BreakerFailure`,
            circuit_breaker_status: e.code === 'EOPENBREAKER' ? 'Open' : 'UnknownBreakerError',
            error_message: e.message,
            error_type: e.constructor.name,
        };
        localApiHelperLogger.error("Error from OpenAI circuit breaker:", finalErrorContext);
        if (e.code === 'EOPENBREAKER') {
            return { success: false, error: { type: 'CIRCUIT_BREAKER_OPEN', message: errorMessagePrefix, details: e.message } };
        }
        // Fallback for other types of errors caught by the breaker's .fire()
        // These should be rare if the wrapped action (with async-retry) correctly formats all its errors.
        return { success: false, error: { type: 'OPENAI_REQUEST_ERROR', message: errorMessagePrefix, details: e.message } };
    }
};
export const getCalendarIntegration = async (userId, resource) => {
    const query = `query GetCalendarIntegration($userId: String!, $resource: String!) { Calendar_Integration(where: {userId: {_eq: $userId}, resource: {_eq: $resource}}, limit: 1) { id userId clientType token refreshToken expiresAt resource syncEnabled primaryCalendarId } }`;
    const operation_name = 'HasuraGetCalendarIntegration';
    try {
        // Wrap the got call with the circuit breaker
        const response = await hasuraGotBreaker.fire(() => got.post(process.env.HASURA_ENDPOINT_URL || '', {
            json: { query, variables: { userId, resource } },
            headers: { 'x-hasura-admin-secret': process.env.HASURA_ADMIN_SECRET || '' },
            responseType: 'json',
            timeout: { request: 10000 },
            retry: defaultGotRetryConfig
        }));
        const body = response.body; // response from got, breaker passes it through on success
        if (body.errors) {
            /* console.error(`[${operation_name}] Hasura API errors:`, body.errors); */
            return { success: false, error: { message: 'Hasura API error during getCalendarIntegration.', details: body.errors } };
        }
        if (!body.data || !body.data.hasOwnProperty('Calendar_Integration')) {
            /* console.warn(`[${operation_name}] Unexpected response structure:`, body); */
            return { success: false, error: { message: 'Unexpected response structure during getCalendarIntegration.', details: body } };
        }
        return { success: true, data: body.data.Calendar_Integration?.[0] };
    }
    catch (e) {
        const errorMessage = e.code === 'EOPENBREAKER' ? `Circuit breaker ${hasuraGotBreaker.name} is open.` : `Network/request error during ${operation_name}.`;
        /* console.error(`[${operation_name}] Error: ${errorMessage}`, e.message); */
        return { success: false, error: { message: errorMessage, details: e.message, rawResponse: e.response?.body, code: e.code } };
    }
};
export const refreshGoogleToken = async (refreshTokenVal, clientType) => {
    const clientId = clientType === 'web' ? process.env.GOOGLE_CLIENT_ID_WEB : process.env.GOOGLE_CLIENT_ID_IOS;
    const clientSecret = clientType === 'web' ? process.env.GOOGLE_CLIENT_SECRET_WEB : process.env.GOOGLE_CLIENT_SECRET_IOS;
    const operation_name = 'GoogleRefreshToken';
    if (!clientId || !clientSecret) {
        const msg = `Google client ID or secret not configured for clientType: ${clientType}`;
        /* console.error(`[${operation_name}] ${msg}`); */
        return { success: false, error: { message: msg } };
    }
    try {
        const response = await got.post('https://oauth2.googleapis.com/token', {
            form: { client_id: clientId, client_secret: clientSecret, refresh_token: refreshTokenVal, grant_type: 'refresh_token' },
            responseType: 'json',
            timeout: { request: 15000 },
            retry: {
                limit: 2,
                methods: ['POST'],
                statusCodes: [408, 429, 500, 502, 503, 504],
                errorCodes: ['ETIMEDOUT', 'ECONNRESET', 'EADDRINUSE', 'ECONNREFUSED', 'EPIPE', 'ENETUNREACH', 'EAI_AGAIN'],
                calculateDelay: ({ attemptCount }) => Math.pow(2, attemptCount - 1) * 1000 + Math.random() * 300
            }
        });
        return { success: true, data: response.body };
    }
    catch (e) {
        /* console.error(`[${operation_name}] Error refreshing Google token:`, e.message, e.response?.body); */
        return { success: false, error: { message: 'Failed to refresh Google token: ' + e.message, details: e.response?.body } };
    }
};
export const updateCalendarIntegration = async (id, token, expiresAt, refreshTokenVal, syncEnabled) => {
    const operation_name = 'HasuraUpdateCalendarIntegration';
    let setClause = '_set: {';
    if (token !== undefined)
        setClause += `token: $token, `;
    if (expiresAt !== undefined)
        setClause += `expiresAt: $expiresAt, `;
    if (refreshTokenVal !== undefined)
        setClause += `refreshToken: $refreshToken, `;
    if (typeof syncEnabled === 'boolean')
        setClause += `syncEnabled: $syncEnabled, `;
    setClause += `updatedAt: "now()" }`;
    const mutation = `mutation UpdateCalendarIntegration($id: uuid!, ${token !== undefined ? '$token: String,' : ''} ${expiresAt !== undefined ? '$expiresAt: timestamptz,' : ''} ${refreshTokenVal !== undefined ? '$refreshToken: String,' : ''} ${typeof syncEnabled === 'boolean' ? '$syncEnabled: Boolean,' : ''}) { update_Calendar_Integration_by_pk(pk_columns: {id: $id}, ${setClause}) { id } }`;
    const variables = { id };
    if (token !== undefined)
        variables.token = token;
    if (expiresAt !== undefined)
        variables.expiresAt = expiresAt;
    if (refreshTokenVal !== undefined)
        variables.refreshToken = refreshTokenVal;
    if (typeof syncEnabled === 'boolean')
        variables.syncEnabled = syncEnabled;
    try {
        const response = await hasuraGotBreaker.fire(() => got.post(process.env.HASURA_ENDPOINT_URL || '', {
            json: { query: mutation, variables },
            headers: { 'x-hasura-admin-secret': process.env.HASURA_ADMIN_SECRET || '' },
            responseType: 'json',
            timeout: { request: 10000 },
            retry: defaultGotRetryConfig
        }));
        const body = response.body;
        if (body.errors) { /* console.error(`[${operation_name}] Hasura errors:`, body.errors); */
            return { success: false, error: { message: 'Hasura API error during updateCalendarIntegration.', details: body.errors } };
        }
        if (!body.data || !body.data.update_Calendar_Integration_by_pk) { /* console.warn(`[${operation_name}] Unexpected response:`, body); */
            return { success: false, error: { message: 'Unexpected response structure or ID not found during updateCalendarIntegration.', details: body } };
        }
        return { success: true };
    }
    catch (e) {
        const errorMessage = e.code === 'EOPENBREAKER' ? `Circuit breaker ${hasuraGotBreaker.name} is open.` : `Network/request error during ${operation_name}.`;
        /* console.error(`[${operation_name}] Error: ${errorMessage}`, e.message); */
        return { success: false, error: { message: errorMessage, details: e.message, rawResponse: e.response?.body, code: e.code } };
    }
};
export const getGoogleAPIToken = async (userId, resource) => {
    const iResult = await getCalendarIntegration(userId, resource);
    if (!iResult.success)
        return { success: false, error: { message: 'Failed to acquire Google API token: Could not get calendar integration', details: iResult.error } };
    const int = iResult.data;
    if (!int)
        return { success: false, error: { message: 'Failed to acquire Google API token: No calendar integration found.' } };
    if (int.token && int.expiresAt && dayjs(int.expiresAt).isAfter(dayjs().add(5, 'minutes')))
        return { success: true, token: int.token };
    if (!int.refreshToken) { /* console.warn(`User ${userId} resource ${resource} needs refresh but no refresh token.`); */
        if (int.id && int.syncEnabled !== false)
            await updateCalendarIntegration(int.id, null, null, null, false).catch(e => console.warn("Failed to disable sync:", e.message));
        return { success: false, error: { message: 'Refresh needed but no refresh token available.' } };
    }
    const rResult = await refreshGoogleToken(int.refreshToken, int.clientType);
    if (!rResult.success) {
        if (int.id && int.syncEnabled !== false)
            await updateCalendarIntegration(int.id, null, null, null, false).catch(e => console.warn("Failed to disable sync:", e.message));
        return { success: false, error: { message: 'Token refresh failed', details: rResult.error } };
    }
    const { access_token, expires_in } = rResult.data;
    const newExp = dayjs().add(expires_in, 'seconds').toISOString();
    if (!int.id) { /* console.error(`Critical: Integration ID missing for user ${userId} post-refresh.`); */
        return { success: false, error: { message: 'Integration ID missing post-refresh.' } };
    }
    const uResult = await updateCalendarIntegration(int.id, access_token, newExp, int.refreshToken, typeof int.syncEnabled === 'boolean' ? int.syncEnabled : true);
    if (!uResult.success)
        return { success: false, error: { message: 'Failed to update integration with new token', details: uResult.error } };
    return { success: true, token: access_token };
};
export const createGoogleEvent = async (userId, calendarIdVal, clientTypeVal, summaryVal, startDateTimeVal, endDateTimeVal, timezoneVal, descriptionVal, attendeesVal, conferenceSolutionVal) => {
    const operation_name = "GoogleCreateEvent";
    const tokenResult = await getGoogleAPIToken(userId, 'google_calendar');
    if (!tokenResult.success) {
        return { success: false, error: { message: 'Token acquisition failure for Google event.', details: tokenResult.error } };
    }
    const oAuth2Client = new Auth.OAuth2Client();
    oAuth2Client.setCredentials({ access_token: tokenResult.token });
    const calendar = google.calendar({ version: 'v3', auth: oAuth2Client });
    const generatedId = uuidv4(); // For conference request if needed
    const event = {
        summary: summaryVal,
        description: descriptionVal,
        start: { dateTime: startDateTimeVal, timeZone: timezoneVal },
        end: { dateTime: endDateTimeVal, timeZone: timezoneVal },
        attendees: attendeesVal,
        reminders: { useDefault: true },
    };
    if (conferenceSolutionVal) {
        event.conferenceData = {
            createRequest: {
                requestId: generatedId,
                conferenceSolutionKey: { type: conferenceSolutionVal },
            },
        };
    }
    const operation_name_for_retry = "GoogleCreateEvent_RetryAttempt";
    try {
        return await retry(async (bail, attemptNumber) => {
            try {
                // console.log(`[${operation_name_for_retry}] Attempt ${attemptNumber} to insert Google event...`); // Placeholder
                const gEvent = await calendar.events.insert({
                    calendarId: calendarIdVal,
                    requestBody: event,
                    conferenceDataVersion: conferenceSolutionVal ? 1 : 0,
                    // Add timeout to the request options for googleapis
                }, { timeout: 20000 }); // 20 second timeout per attempt
                if (!gEvent.data.id) {
                    // This is an unexpected success response, should not retry.
                    const err = new Error('Google API did not return event ID despite success status.');
                    // console.error(`[${operation_name_for_retry}] Non-retryable error:`, err.message); // Placeholder
                    bail(err);
                    return; // Should not be reached
                }
                const gEventId = gEvent.data.id;
                return {
                    success: true,
                    data: {
                        id: `${gEventId}#${calendarIdVal}`,
                        googleEventId: gEventId,
                        generatedId, // This was for conference, might be confusing here
                        calendarId: calendarIdVal,
                        generatedEventId: generatedId.split('_')?.[0] // Also for conference
                    }
                };
            }
            catch (e) {
                // console.error(`[${operation_name_for_retry}] Error on attempt ${attemptNumber}:`, e.message, e.code, e.errors); // Placeholder
                // Check for Google API specific error reasons and HTTP status codes
                const httpStatusCode = e.code; // googleapis error often has HTTP status code in `e.code`
                const googleErrorReason = e.errors && e.errors[0] ? e.errors[0].reason : null;
                if (httpStatusCode === 400 || httpStatusCode === 401 || httpStatusCode === 404 ||
                    (httpStatusCode === 403 && googleErrorReason !== 'rateLimitExceeded' && googleErrorReason !== 'userRateLimitExceeded')) {
                    // console.warn(`[${operation_name_for_retry}] Non-retryable Google API error (status ${httpStatusCode}, reason ${googleErrorReason}). Bailing.`); // Placeholder
                    bail(e); // Stop retrying for these client errors
                    return;
                }
                // For other errors (e.g., 5xx, rateLimitExceeded, network issues), re-throw to trigger retry
                throw e;
            }
        }, {
            retries: 3,
            factor: 2,
            minTimeout: 1000,
            maxTimeout: 10000,
            onRetry: (error, attemptNumber) => {
                const logContext = {
                    operation_name: `${operation_name}_onRetry`, // operation_name is from outer scope
                    attempt: attemptNumber,
                    error_message: error.message,
                    error_code: error.code, // HTTP status code
                    error_reason: error.errors && error.errors[0] ? error.errors[0].reason : null,
                };
                localApiHelperLogger.warn("Retrying Google event creation", logContext);
            },
        });
    }
    catch (e) { // Catch final error from async-retry (all retries failed or bailed)
        const finalErrorContext = {
            operation_name: `${operation_name}_FinalFailure`,
            error_message: e.message,
            error_code: e.code,
            error_reason: e.errors && e.errors[0] ? e.errors[0].reason : null,
            was_bailed: e.bail, // Check if error has 'bail' property if async-retry adds it
        };
        // console.error("Failed to create Google event after retries or bail", finalErrorContext); // Placeholder
        return { success: false, error: { message: `Google Calendar API error during event creation: ${e.message}`, details: e.response?.data || e.errors || e } };
    }
};
const uniqueEvents = _.uniqBy(events.filter(e => e), 'id');
if (uniqueEvents.length === 0)
    return { success: true, data: { affected_rows: 0, returning: [] } };
const objects = uniqueEvents.map(event => ({ ...event, provider: event.provider || 'google_calendar', status: event.status || 'confirmed' }));
const mutation = `mutation UpsertEvents($objects: [Event_insert_input!]!) { insert_Event(objects: $objects, on_conflict: { constraint: Event_pkey, update_columns: [summary, description, startDateTime, endDateTime, timezone, gEventId, provider, updatedAt, taskId, projectId, status, parentEventId] }) { affected_rows returning { id } } }`;
try {
    const response = await hasuraGotBreaker.fire(() => got.post(process.env.HASURA_ENDPOINT_URL || '', {
        json: { query: mutation, variables: { objects } },
        headers: { 'x-hasura-admin-secret': process.env.HASURA_ADMIN_SECRET || '' },
        responseType: 'json',
        timeout: { request: 15000 }, // Longer timeout for potentially large upserts
        retry: defaultGotRetryConfig
    }));
    const body = response.body;
    if (body.errors) { /* localApiHelperLogger.error(`[${operation_name}] Hasura errors:`, {details: body.errors}); */
        return { success: false, error: { message: 'Hasura API error during event upsert.', details: body.errors } };
    }
    if (!body.data || !body.data.insert_Event) { /* localApiHelperLogger.warn(`[${operation_name}] Unexpected Hasura response:`, {body}); */
        return { success: false, error: { message: 'Unexpected Hasura response during event upsert.', details: body } };
    }
    return { success: true, data: body.data.insert_Event };
}
catch (e) {
    const errorMessage = e.code === 'EOPENBREAKER' ? `Circuit breaker ${hasuraGotBreaker.name} is open.` : `Network/request error during ${operation_name}.`;
    /* localApiHelperLogger.error(`[${operation_name}] Error: ${errorMessage}`, {error_message: e.message, error_code: e.code, raw_response: e.response?.body}); */
    return { success: false, error: { message: errorMessage, details: e.message, rawResponse: e.response?.body, code: e.code } };
}
;
export const getGlobalCalendar = async (userId) => {
    const operation_name = 'HasuraGetGlobalCalendar';
    const query = `query GetGlobalCalendar($userId: String!) { Calendar(where: {userId: {_eq: $userId}, type: {_eq: "global"}}, limit: 1) { id userId primaryCalendarId } }`;
    try {
        const response = await hasuraGotBreaker.fire(() => got.post(process.env.HASURA_ENDPOINT_URL || '', {
            json: { query, variables: { userId } },
            headers: { 'x-hasura-admin-secret': process.env.HASURA_ADMIN_SECRET || '' },
            responseType: 'json',
            timeout: { request: 10000 },
            retry: defaultGotRetryConfig
        }));
        const body = response.body;
        if (body.errors) { /* localApiHelperLogger.error(`[${operation_name}] Hasura errors:`, {details: body.errors}); */
            return { success: false, error: { message: 'Hasura API error during getGlobalCalendar.', details: body.errors } };
        }
        if (!body.data || !body.data.hasOwnProperty('Calendar')) { /* localApiHelperLogger.warn(`[${operation_name}] Unexpected response:`, {body}); */
            return { success: false, error: { message: 'Unexpected response structure during getGlobalCalendar.', details: body } };
        }
        return { success: true, data: body.data.Calendar?.[0] };
    }
    catch (e) {
        const errorMessage = e.code === 'EOPENBREAKER' ? `Circuit breaker ${hasuraGotBreaker.name} is open.` : `Network/request error during ${operation_name}.`;
        /* localApiHelperLogger.error(`[${operation_name}] Error: ${errorMessage}`, {error_message: e.message, error_code: e.code, raw_response: e.response?.body}); */
        return { success: false, error: { message: errorMessage, details: e.message, rawResponse: e.response?.body, code: e.code } };
    }
};
export const listEventsForDate = async (userId, startDate, endDate, timezoneParam) => {
    const operation_name = 'HasuraListEventsForDate';
    const query = `query ListEventsForDate($userId: String!, $startDate: timestamptz!, $endDate: timestamptz!) { Event(where: {userId: {_eq: $userId}, startDateTime: {_gte: $startDate}, endDateTime: {_lte: $endDate}, _or: [{isDeleted: {_is_null: true}}, {isDeleted: {_eq: false}}]}, order_by: {startDateTime: asc}) { id userId summary startDateTime endDateTime timezone } }`;
    try {
        const response = await hasuraGotBreaker.fire(() => got.post(process.env.HASURA_ENDPOINT_URL || '', {
            json: { query, variables: { userId, startDate, endDate } },
            headers: { 'x-hasura-admin-secret': process.env.HASURA_ADMIN_SECRET || '' },
            responseType: 'json',
            timeout: { request: 10000 },
            retry: defaultGotRetryConfig
        }));
        const body = response.body;
        if (body.errors) { /* localApiHelperLogger.error(`[${operation_name}] Hasura errors:`, {details: body.errors}); */
            return { success: false, error: { message: 'Hasura API error during listEventsForDate.', details: body.errors } };
        }
        if (!body.data || !body.data.hasOwnProperty('Event')) { /* localApiHelperLogger.warn(`[${operation_name}] Unexpected response:`, {body}); */
            return { success: false, error: { message: 'Unexpected response structure during listEventsForDate.', details: body } };
        }
        return { success: true, data: body.data.Event || [] };
    }
    catch (e) {
        const errorMessage = e.code === 'EOPENBREAKER' ? `Circuit breaker ${hasuraGotBreaker.name} is open.` : `Network/request error during ${operation_name}.`;
        /* localApiHelperLogger.error(`[${operation_name}] Error: ${errorMessage}`, {error_message: e.message, error_code: e.code, raw_response: e.response?.body}); */
        return { success: false, error: { message: errorMessage, details: e.message, rawResponse: e.response?.body, code: e.code } };
    }
};
export const listEventsForUserGivenDates = async (userId, senderStartDate, senderEndDate) => {
    const operation_name = 'HasuraListEventsForUserGivenDates';
    const query = `query ListEventsForUserGivenDates($userId: String!, $startDate: timestamptz!, $endDate: timestamptz!) { Event(where: {userId: {_eq: $userId}, startDateTime: {_gte: $startDate}, endDateTime: {_lte: $endDate}, _or: [{isDeleted: {_is_null: true}}, {isDeleted: {_eq: false}}]}, order_by: {startDateTime: asc}) { id userId summary startDateTime endDateTime timezone } }`;
    try {
        const response = await hasuraGotBreaker.fire(() => got.post(process.env.HASURA_ENDPOINT_URL || '', {
            json: { query, variables: { userId, startDate: senderStartDate, endDate: senderEndDate } },
            headers: { 'x-hasura-admin-secret': process.env.HASURA_ADMIN_SECRET || '' },
            responseType: 'json',
            timeout: { request: 10000 },
            retry: defaultGotRetryConfig
        }));
        const body = response.body;
        if (body.errors) { /* localApiHelperLogger.error(`[${operation_name}] Hasura errors:`, {details: body.errors}); */
            return { success: false, error: { message: 'Hasura API error during listEventsForUserGivenDates.', details: body.errors } };
        }
        if (!body.data || !body.data.hasOwnProperty('Event')) { /* localApiHelperLogger.warn(`[${operation_name}] Unexpected response:`, {body}); */
            return { success: false, error: { message: 'Unexpected response structure during listEventsForUserGivenDates.', details: body } };
        }
        return { success: true, data: body.data.Event || [] };
    }
    catch (e) {
        const errorMessage = e.code === 'EOPENBREAKER' ? `Circuit breaker ${hasuraGotBreaker.name} is open.` : `Network/request error during ${operation_name}.`;
        /* localApiHelperLogger.error(`[${operation_name}] Error: ${errorMessage}`, {error_message: e.message, error_code: e.code, raw_response: e.response?.body}); */
        return { success: false, error: { message: errorMessage, details: e.message, rawResponse: e.response?.body, code: e.code } };
    }
};
export const getUserPreferences = async (userId) => {
    const operation_name = 'HasuraGetUserPreferences';
    const query = `query GetUserPreferences($userId: String!) { User_Preferences(where: {userId: {_eq: $userId}}, limit: 1) { id userId somePreference workHoursStartTime workHoursEndTime workDays slotDuration timezone bufferBetweenMeetings } }`; // Added more fields
    try {
        const response = await hasuraGotBreaker.fire(() => got.post(process.env.HASURA_ENDPOINT_URL || '', {
            json: { query, variables: { userId } },
            headers: { 'x-hasura-admin-secret': process.env.HASURA_ADMIN_SECRET || '' },
            responseType: 'json',
            timeout: { request: 10000 },
            retry: defaultGotRetryConfig
        }));
        const body = response.body;
        if (body.errors) { /* localApiHelperLogger.error(`[${operation_name}] Hasura errors:`, {details: body.errors}); */
            return { success: false, error: { message: 'Hasura API error during getUserPreferences.', details: body.errors } };
        }
        if (!body.data || !body.data.hasOwnProperty('User_Preferences')) { /* localApiHelperLogger.warn(`[${operation_name}] Unexpected response:`, {body}); */
            return { success: false, error: { message: 'Unexpected response structure during getUserPreferences.', details: body } };
        }
        return { success: true, data: body.data.User_Preferences?.[0] };
    }
    catch (e) {
        const errorMessage = e.code === 'EOPENBREAKER' ? `Circuit breaker ${hasuraGotBreaker.name} is open.` : `Network/request error during ${operation_name}.`;
        /* localApiHelperLogger.error(`[${operation_name}] Error: ${errorMessage}`, {error_message: e.message, error_code: e.code, raw_response: e.response?.body}); */
        return { success: false, error: { message: errorMessage, details: e.message, rawResponse: e.response?.body, code: e.code } };
    }
};
export const sendAgendaEmail = async (to, name, title, body) => {
    // Note: sendEmail itself needs retry logic if it makes network calls. For now, this wrapper doesn't add retries.
    const operation_name = "SendAgendaEmail";
    try {
        await sendEmail({ template: 'agenda', locals: { name, title, body, to }, subject: `Your Meeting Agenda: ${title}`, to });
        return { success: true };
    }
    catch (e) {
        localApiHelperLogger.error(`Error sending agenda email to ${to}:`, { error: e.message, details: e });
        return { success: false, error: { message: 'Failed to send agenda email.', details: e.message } };
    }
};
export const sendSummaryEmail = async (to, name, title, summary) => {
    try {
        await sendEmail({ template: 'summary', locals: { name, title, summary, to }, subject: `Your Meeting Summary: ${title}`, to });
        return { success: true };
    }
    catch (e) {
        localApiHelperLogger.error(`Error sending summary email to ${to}:`, { error: e.message, details: e });
        return { success: false, error: { message: 'Failed to send summary email.', details: e.message } };
    }
};
export const emailTaskBreakDown = async (to, name, title, tasks) => {
    try {
        await sendEmail({ template: 'task_breakdown', locals: { name, title, tasks, to }, subject: `Your Task Breakdown for: ${title}`, to });
        return { success: true };
    }
    catch (e) {
        localApiHelperLogger.error(`Error sending task breakdown email to ${to}:`, { error: e.message, details: e });
        return { success: false, error: { message: 'Failed to send task breakdown email.', details: e.message } };
    }
};
export const sendGenericTaskEmail = async (to, name, title, body) => {
    try {
        await sendEmail({ template: 'generic_task', locals: { name, title, body, to }, subject: title, to });
        return { success: true };
    }
    catch (e) {
        localApiHelperLogger.error(`Error sending generic task email to ${to}:`, { error: e.message, details: e });
        return { success: false, error: { message: 'Failed to send generic task email.', details: e.message } };
    }
};
export const sendMeetingRequestTemplate = async (to, name, title, body, yesLink, noLink) => {
    try {
        await sendEmail({ template: 'meeting_request', locals: { name, title, body, yesLink, noLink, to }, subject: `Meeting Request: ${title}`, to });
        return { success: true };
    }
    catch (e) {
        localApiHelperLogger.error(`Error sending meeting request email to ${to}:`, { error: e.message, details: e });
        return { success: false, error: { message: 'Failed to send meeting request email.', details: e.message } };
    }
};
export const createAgenda = async (userId, clientType, userTimezone, userDate, promptVal, email, nameVal) => {
    const operationName = "createAgenda";
    try {
        const openAIRes = await callOpenAI(`Create agenda for ${userDate} in ${userTimezone}.`, promptVal);
        if (!openAIRes.success || !openAIRes.content) {
            localApiHelperLogger.warn(`${operationName}: OpenAI call failed or no content.`, { userId, error: openAIRes.error });
            return { success: false, error: { message: 'Failed to create agenda due to OpenAI call failed or no content.', details: openAIRes.error } };
        }
        const agendaSum = "Generated Agenda Event";
        const agendaDesc = openAIRes.content;
        const gCalRes = await getGlobalCalendar(userId);
        if (!gCalRes.success || !gCalRes.data?.primaryCalendarId) {
            localApiHelperLogger.warn(`${operationName}: GlobalCalendar retrieval failed.`, { userId, error: gCalRes.error });
            return { success: false, error: { message: 'Failed to create agenda due to global calendar retrieval failure.', details: gCalRes.error } };
        }
        const startDT = dayjs.tz(`${userDate}T09:00:00`, userTimezone).toISOString();
        const endDT = dayjs.tz(`${userDate}T10:00:00`, userTimezone).toISOString();
        const createGEventRes = await createGoogleEvent(userId, gCalRes.data.primaryCalendarId, clientType, agendaSum, startDT, endDT, userTimezone, agendaDesc);
        if (!createGEventRes.success) {
            localApiHelperLogger.warn(`${operationName}: Google event creation failed.`, { userId, error: createGEventRes.error });
            return { success: false, error: { message: 'Failed to create agenda due to Google event creation failure.', details: createGEventRes.error } };
        }
        const eventToUpsert = { userId, calendarId: gCalRes.data.id, gEventId: createGEventRes.data.googleEventId, summary: agendaSum, description: agendaDesc, startDateTime: startDT, endDateTime: endDT, timezone: userTimezone, provider: 'google_calendar', status: 'confirmed' };
        const upsertRes = await upsertEventsPostPlanner([eventToUpsert]);
        if (!upsertRes.success) {
            localApiHelperLogger.warn(`${operationName}: Database event upsert failed.`, { userId, error: upsertRes.error });
            return { success: false, error: { message: 'Failed to create agenda due to database event upsert failure.', details: upsertRes.error } };
        }
        if (email && nameVal) {
            const emailRes = await sendAgendaEmail(email, nameVal, "Your Generated Agenda", agendaDesc);
            if (!emailRes.success) {
                localApiHelperLogger.warn(`${operationName}: Email sending failed.`, { userId, email, error: emailRes.error });
                return { success: false, error: { message: 'Failed to create agenda due to email sending failure.', details: emailRes.error } };
            }
        }
        localApiHelperLogger.info(`${operationName}: Successfully created agenda.`, { userId });
        return { success: true };
    }
    catch (e) {
        localApiHelperLogger.error(`Unexpected error in ${operationName}:`, { userId, error: e.message, details: e });
        return { success: false, error: { message: `Unexpected error during ${operationName}.`, details: e.message } };
    }
};
export const createSummaryOfTimePeriod = async (userId, startDate, endDate, timezone, email, name) => {
    const operationName = "createSummaryOfTimePeriod";
    try {
        const eventsResult = await listEventsForDate(userId, startDate, endDate, timezone);
        if (!eventsResult.success) {
            localApiHelperLogger.warn(`${operationName}: listEventsForDate failed.`, { userId, startDate, endDate, error: eventsResult.error });
            return { success: false, error: { message: 'Failed to create summary due to event listing failure.', details: eventsResult.error } };
        }
        if (!eventsResult.data || eventsResult.data.length === 0) {
            localApiHelperLogger.info(`${operationName}: No events found to summarize.`, { userId, startDate, endDate });
            return { success: false, error: { message: 'No events found to summarize.' } };
        }
        const eventsText = eventsResult.data.map(event => `${event.summary} (from ${event.startDateTime} to ${event.endDateTime})`).join('\n');
        const prompt = `Summarize the following events that occurred between ${startDate} and ${endDate}:\n${eventsText}`;
        const openAIResult = await callOpenAI("You are an assistant that summarizes a list of calendar events.", prompt);
        if (!openAIResult.success || !openAIResult.content) {
            localApiHelperLogger.warn(`${operationName}: callOpenAI failed.`, { userId, error: openAIResult.error });
            return { success: false, error: { message: 'Failed to create summary due to OpenAI call failure.', details: openAIResult.error } };
        }
        const summaryText = openAIResult.content;
        if (email && name) {
            const emailResult = await sendSummaryEmail(email, name, `Summary for ${startDate} to ${endDate}`, summaryText);
            if (!emailResult.success) {
                localApiHelperLogger.warn(`${operationName}: sendSummaryEmail failed.`, { userId, email, error: emailResult.error });
                return { success: false, error: { message: 'Failed to send summary email.', details: emailResult.error } };
            }
        }
        localApiHelperLogger.info(`${operationName}: Successfully created summary.`, { userId, startDate, endDate });
        return { success: true, data: summaryText };
    }
    catch (e) {
        localApiHelperLogger.error(`Unexpected error in ${operationName}:`, { userId, error: e.message, details: e });
        return { success: false, error: { message: `Unexpected error during ${operationName}.`, details: e.message } };
    }
};
const createEventHelper = async (userId, clientType, userTimezone, eventSummary, eventDescription, startDateTime, endDateTime, isAllDay) => {
    const operationName = "createEventHelper";
    const globalCalResult = await getGlobalCalendar(userId);
    if (!globalCalResult.success || !globalCalResult.data?.primaryCalendarId) {
        localApiHelperLogger.warn(`${operationName}: GlobalCalendar retrieval failed.`, { userId, error: globalCalResult.error });
        return { success: false, error: { message: 'Global calendar retrieval failed for event creation.', details: globalCalResult.error } };
    }
    const calendarIdToUse = globalCalResult.data.primaryCalendarId;
    let eventStartDT = startDateTime;
    let eventEndDT = endDateTime;
    if (isAllDay) {
        eventStartDT = dayjs(startDateTime).format('YYYY-MM-DD');
        eventEndDT = dayjs(endDateTime).add(1, 'day').format('YYYY-MM-DD');
    }
    return createGoogleEvent(userId, calendarIdToUse, clientType, eventSummary, eventStartDT, eventEndDT, userTimezone, eventDescription);
};
export const breakDownTask = async (userId, clientType, userTimezone, taskTitle, taskDescription, isAllDay, startDate, endDate, email, name) => {
    const operationName = "breakDownTask";
    try {
        const openAIResult = await callOpenAI("You are an assistant that breaks down a task into smaller sub-events for a calendar.", `Break down the task: "${taskTitle}" (Description: ${taskDescription}) into smaller calendar events. Main task is from ${startDate} to ${endDate} (isAllDay: ${isAllDay}).`);
        if (!openAIResult.success || !openAIResult.content) {
            localApiHelperLogger.warn(`${operationName}: OpenAI call failed.`, { userId, taskTitle, error: openAIResult.error });
            return { success: false, error: { message: 'OpenAI call failed during task breakdown.', details: openAIResult.error } };
        }
        const breakdownText = openAIResult.content;
        const createEventRes = await createEventHelper(userId, clientType, userTimezone, taskTitle, breakdownText, startDate, endDate, isAllDay);
        if (!createEventRes.success) {
            localApiHelperLogger.warn(`${operationName}: Google event creation failed.`, { userId, taskTitle, error: createEventRes.error });
            return { success: false, error: { message: 'Google event creation failed for task breakdown.', details: createEventRes.error } };
        }
        const globalCal = await getGlobalCalendar(userId);
        if (!globalCal.success || !globalCal.data?.id) {
            localApiHelperLogger.warn(`${operationName}: getGlobalCalendar for DB ID failed.`, { userId, taskTitle, error: globalCal.error });
            return { success: false, error: { message: 'Failed to get global calendar ID for DB upsert.', details: globalCal.error } };
        }
        const eventToUpsert = { userId, calendarId: globalCal.data.id, gEventId: createEventRes.data.googleEventId, summary: taskTitle, description: breakdownText, startDateTime: startDate, endDateTime: endDate, timezone: userTimezone, provider: 'google_calendar', status: 'confirmed' };
        const upsertRes = await upsertEventsPostPlanner([eventToUpsert]);
        if (!upsertRes.success) {
            localApiHelperLogger.warn(`${operationName}: Database event upsert failed.`, { userId, taskTitle, error: upsertRes.error });
            return { success: false, error: { message: 'Database event upsert failed for task breakdown.', details: upsertRes.error } };
        }
        if (email && name) {
            const emailRes = await emailTaskBreakDown(email, name, taskTitle, breakdownText);
            if (!emailRes.success) {
                localApiHelperLogger.warn(`${operationName}: Email sending failed.`, { userId, email, taskTitle, error: emailRes.error });
                return { success: false, error: { message: 'Email sending failed for task breakdown.', details: emailRes.error } };
            }
        }
        localApiHelperLogger.info(`${operationName}: Successfully broke down task.`, { userId, taskTitle });
        return { success: true };
    }
    catch (e) {
        localApiHelperLogger.error(`Unexpected error in ${operationName}:`, { userId, taskTitle, error: e.message, details: e });
        return { success: false, error: { message: `Unexpected error during ${operationName}.`, details: e.message } };
    }
};
export const howToTask = async (userId, clientType, userTimezone, taskTitle, isAllDay, startDate, endDate, email, name) => {
    const operationName = "howToTask";
    try {
        const openAIResult = await callOpenAI("You are an assistant that provides instructions on how to complete a task and schedules it.", `Provide instructions for task: "${taskTitle}". Schedule it from ${startDate} to ${endDate} (isAllDay: ${isAllDay}).`);
        if (!openAIResult.success || !openAIResult.content) {
            localApiHelperLogger.warn(`${operationName}: OpenAI call failed.`, { userId, taskTitle, error: openAIResult.error });
            return { success: false, error: { message: 'OpenAI call failed for how-to task.', details: openAIResult.error } };
        }
        const howToContent = openAIResult.content;
        const createEventRes = await createEventHelper(userId, clientType, userTimezone, `How to: ${taskTitle}`, howToContent, startDate, endDate, isAllDay);
        if (!createEventRes.success) {
            localApiHelperLogger.warn(`${operationName}: Google event creation failed.`, { userId, taskTitle, error: createEventRes.error });
            return { success: false, error: { message: 'Google event creation failed for how-to task.', details: createEventRes.error } };
        }
        const globalCal = await getGlobalCalendar(userId);
        if (!globalCal.success || !globalCal.data?.id) {
            localApiHelperLogger.warn(`${operationName}: getGlobalCalendar for DB ID failed.`, { userId, taskTitle, error: globalCal.error });
            return { success: false, error: { message: 'Failed to get global calendar ID for DB upsert (how-to).', details: globalCal.error } };
        }
        const eventToUpsert = { userId, calendarId: globalCal.data.id, gEventId: createEventRes.data.googleEventId, summary: `How to: ${taskTitle}`, description: howToContent, startDateTime: startDate, endDateTime: endDate, timezone: userTimezone, provider: 'google_calendar', status: 'confirmed' };
        const upsertRes = await upsertEventsPostPlanner([eventToUpsert]);
        if (!upsertRes.success) {
            localApiHelperLogger.warn(`${operationName}: Database event upsert failed.`, { userId, taskTitle, error: upsertRes.error });
            return { success: false, error: { message: 'Database event upsert failed for how-to task.', details: upsertRes.error } };
        }
        if (email && name) {
            const emailRes = await sendGenericTaskEmail(email, name, `Instructions for: ${taskTitle}`, howToContent);
            if (!emailRes.success) {
                localApiHelperLogger.warn(`${operationName}: Email sending failed.`, { userId, email, taskTitle, error: emailRes.error });
                return { success: false, error: { message: 'Email sending failed for how-to task.', details: emailRes.error } };
            }
        }
        localApiHelperLogger.info(`${operationName}: Successfully processed how-to task.`, { userId, taskTitle });
        return { success: true };
    }
    catch (e) {
        localApiHelperLogger.error(`Unexpected error in ${operationName}:`, { userId, taskTitle, error: e.message, details: e });
        return { success: false, error: { message: `Unexpected error during ${operationName}.`, details: e.message } };
    }
};
export const meetingRequest = async (userId, clientType, userTimezone, userDateContext, attendees, subject, promptVal, durationMinutes, shareAvailability, availabilityUserDateStart, availabilityUserDateEnd, emailTo, emailName, yesLink, noLink) => {
    const operationName = "meetingRequest";
    try {
        let availabilitySummary = "Not applicable.";
        if (shareAvailability) {
            if (!availabilityUserDateStart || !availabilityUserDateEnd)
                return { success: false, error: { message: "Availability start and end dates are required when shareAvailability is true." } }; // No logger needed, validation error
            const genAvailRes = await generateAvailability(userId, availabilityUserDateStart, availabilityUserDateEnd, userTimezone /*, clientType - clientType not used by generateAvailability directly */);
            if (!genAvailRes.success) {
                localApiHelperLogger.warn(`${operationName}: generateAvailability failed.`, { userId, subject, error: genAvailRes.error });
                return { success: false, error: { message: 'Failed to generate availability.', details: genAvailRes.error } };
            }
            if (!genAvailRes.data || genAvailRes.data.length === 0) {
                localApiHelperLogger.info(`${operationName}: No availability slots found.`, { userId, subject });
                return { success: false, error: { message: 'No availability slots found to share.' } };
            }
            const slotsByDate = _.groupBy(genAvailRes.data, slot => dayjs(slot.startDate).tz(userTimezone).format('YYYY-MM-DD'));
            let dailySummaries = [];
            for (const date in slotsByDate) {
                const slots = slotsByDate[date].map(slot => `${dayjs(slot.startDate).tz(userTimezone).format('h:mm A')} - ${dayjs(slot.endDate).tz(userTimezone).format('h:mm A')}`).join(', ');
                const dailySummaryRes = await callOpenAI("Summarize daily availability.", `Summarize these availability slots for ${date}: ${slots}`);
                if (!dailySummaryRes.success || !dailySummaryRes.content) {
                    localApiHelperLogger.warn(`${operationName}: OpenAI daily summary failed for date ${date}.`, { userId, subject, date, error: dailySummaryRes.error });
                    return { success: false, error: { message: `Failed to summarize availability for date ${date}.`, details: dailySummaryRes.error } };
                }
                dailySummaries.push(dailySummaryRes.content);
            }
            if (dailySummaries.length === 0) {
                localApiHelperLogger.info(`${operationName}: No availability slots after processing.`, { userId, subject });
                return { success: false, error: { message: 'No availability slots found after processing.' } };
            }
            const combinedSummaryRes = await callOpenAI("Combine daily availability summaries.", `Combine these daily availability summaries:\n${dailySummaries.join('\n')}`);
            if (!combinedSummaryRes.success || !combinedSummaryRes.content) {
                localApiHelperLogger.warn(`${operationName}: OpenAI combined summary failed.`, { userId, subject, error: combinedSummaryRes.error });
                return { success: false, error: { message: 'Failed to generate combined availability summary.', details: combinedSummaryRes.error } };
            }
            availabilitySummary = combinedSummaryRes.content;
        }
        const emailDraftPrompt = `Draft a meeting request email. Subject: ${subject} Attendees: ${attendees} User's request: ${promptVal} Meeting duration: ${durationMinutes} minutes. Contextual user date: ${userDateContext}. User's timezone: ${userTimezone}. ${shareAvailability ? `Include this availability: ${availabilitySummary}` : "Ask for their availability."} Polite, clear call to action. Placeholders for response links if applicable.`;
        const emailBodyRes = await callOpenAI("Draft a meeting request email.", emailDraftPrompt);
        if (!emailBodyRes.success || !emailBodyRes.content) {
            localApiHelperLogger.warn(`${operationName}: OpenAI email draft failed.`, { userId, subject, error: emailBodyRes.error });
            return { success: false, error: { message: 'Failed to draft meeting request email body.', details: emailBodyRes.error } };
        }
        if (emailTo && emailName && yesLink && noLink) {
            const sendEmailRes = await sendMeetingRequestTemplate(emailTo, emailName, subject, emailBodyRes.content, yesLink, noLink);
            if (!sendEmailRes.success) {
                localApiHelperLogger.warn(`${operationName}: sendMeetingRequestTemplate failed.`, { userId, emailTo, subject, error: sendEmailRes.error });
                return { success: false, error: { message: 'Failed to send meeting request email.', details: sendEmailRes.error } };
            }
        }
        else {
            localApiHelperLogger.info(`${operationName}: Email recipient details not provided, email not sent.`, { userId, subject, draftedBody: emailBodyRes.content });
        }
        localApiHelperLogger.info(`${operationName}: Successfully processed meeting request.`, { userId, subject, emailSent: !!(emailTo && emailName) });
        return { success: true };
    }
    catch (e) {
        localApiHelperLogger.error(`Unexpected error in ${operationName}:`, { userId, subject, error: e.message, details: e });
        return { success: false, error: { message: `Unexpected error during ${operationName}.`, details: e.message } };
    }
};
export const createDaySchedule = async (userId, clientType, userDate, userTimezone, prompt, isAllDay, email, name) => {
    const operationName = "createDaySchedule";
    try {
        const dayStart = dayjs.tz(userDate, userTimezone).startOf('day').toISOString();
        const dayEnd = dayjs.tz(userDate, userTimezone).endOf('day').toISOString();
        const existingEventsRes = await listEventsForUserGivenDates(userId, dayStart, dayEnd);
        if (!existingEventsRes.success) {
            localApiHelperLogger.warn(`${operationName}: listEventsForUserGivenDates failed.`, { userId, userDate, error: existingEventsRes.error });
            return { success: false, error: { message: 'Failed to list existing events for schedule context.', details: existingEventsRes.error } };
        }
        const existingEventsText = existingEventsRes.data.map(e => `${e.summary} from ${dayjs(e.startDateTime).tz(userTimezone).format('h:mm A')} to ${dayjs(e.endDateTime).tz(userTimezone).format('h:mm A')}`).join('\n') || "No existing events scheduled.";
        const openAIPrompt = `Given the user's request: "${prompt}", and their existing schedule for ${userDate} in ${userTimezone}:\n${existingEventsText}\n\nCreate a schedule of new tasks as a JSON array. Each task object should have "start_time" (e.g., "9:00 AM"), "end_time" (e.g., "10:30 AM"), "task" (summary), and optionally "description". Ensure new tasks do not overlap with existing events unless the prompt explicitly asks to replace or modify them. For an all-day schedule, the tasks should collectively represent the day's plan without specific times, just a list of tasks and descriptions. This is an ${isAllDay ? 'all-day' : 'itemized time'} schedule.`;
        const openAIResponse = await callOpenAI("You are a scheduling assistant.", openAIPrompt);
        if (!openAIResponse.success || !openAIResponse.content) {
            localApiHelperLogger.warn(`${operationName}: callOpenAI failed.`, { userId, userDate, error: openAIResponse.error });
            return { success: false, error: { message: 'Failed to generate schedule via OpenAI.', details: openAIResponse.error } };
        }
        let parsedTasks;
        try {
            parsedTasks = JSON.parse(openAIResponse.content);
        }
        catch (e) {
            localApiHelperLogger.error(`${operationName}: Failed to parse OpenAI response as JSON.`, { userId, userDate, error: e.message, rawResponse: openAIResponse.content, details: e });
            return { success: false, error: { message: 'Failed to parse schedule from OpenAI response as JSON.', details: e.message, rawResponse: openAIResponse.content } };
        }
        if (!Array.isArray(parsedTasks)) {
            localApiHelperLogger.warn(`${operationName}: OpenAI response is not a valid array.`, { userId, userDate, parsedResponse: parsedTasks });
            return { success: false, error: { message: 'OpenAI schedule response is not a valid array.', parsedResponse: parsedTasks } };
        }
        if (parsedTasks.length === 0) {
            localApiHelperLogger.info(`${operationName}: No new tasks parsed from OpenAI response.`, { userId, userDate });
            if (email && name) {
                const emailResult = await sendGenericTaskEmail(email, name, `Your Schedule for ${userDate}`, "No new tasks were scheduled based on your request and current calendar.");
                if (!emailResult.success) {
                    localApiHelperLogger.warn(`${operationName}: Failed to send no-tasks email.`, { userId, userDate, email, error: emailResult.error });
                    return { success: false, error: { message: 'Failed to send schedule update email (no new tasks).', details: emailResult.error } };
                }
            }
            return { success: true };
        }
        const globalCalendarResult = await getGlobalCalendar(userId);
        if (!globalCalendarResult.success || !globalCalendarResult.data?.primaryCalendarId || !globalCalendarResult.data?.id) {
            localApiHelperLogger.warn(`${operationName}: Failed to get global calendar.`, { userId, userDate, error: globalCalendarResult.error });
            return { success: false, error: { message: 'Failed to get global calendar for scheduling.', details: globalCalendarResult.error } };
        }
        const { primaryCalendarId: googleCalendarIdForEvents, id: dbCalendarId } = globalCalendarResult.data;
        const eventsToUpsert = [];
        if (isAllDay) {
            const allDayTaskSummary = `Day Schedule: ${prompt.substring(0, 50)}${prompt.length > 50 ? '...' : ''}`;
            const allDayTaskDescription = parsedTasks.map(task => `${task.task}${task.description ? `:\n${task.description}` : ''}`).join('\n\n---\n\n');
            const allDayStartDate = dayjs.tz(userDate, userTimezone).startOf('day').format('YYYY-MM-DD');
            const allDayEndDate = dayjs.tz(userDate, userTimezone).add(1, 'day').startOf('day').format('YYYY-MM-DD');
            const createEventRes = await createGoogleEvent(userId, googleCalendarIdForEvents, clientType, allDayTaskSummary, allDayStartDate, allDayEndDate, userTimezone, allDayTaskDescription);
            if (!createEventRes.success) {
                localApiHelperLogger.warn(`${operationName}: Failed to create all-day Google event.`, { userId, userDate, error: createEventRes.error });
                return { success: false, error: { message: 'Failed to create all-day Google Calendar event.', details: createEventRes.error } };
            }
            eventsToUpsert.push({ userId, calendarId: dbCalendarId, gEventId: createEventRes.data.googleEventId, summary: allDayTaskSummary, description: allDayTaskDescription, startDateTime: allDayStartDate, endDateTime: allDayEndDate, timezone: userTimezone, provider: 'google_calendar', status: 'confirmed' });
        }
        else {
            for (const task of parsedTasks) {
                const taskStart = dayjs.tz(`${userDate} ${task.start_time}`, 'YYYY-MM-DD h:mm A', userTimezone);
                const taskEnd = dayjs.tz(`${userDate} ${task.end_time}`, 'YYYY-MM-DD h:mm A', userTimezone);
                if (!taskStart.isValid() || !taskEnd.isValid()) {
                    localApiHelperLogger.warn(`${operationName}: Invalid time format for task "${task.task}"`, { userId, userDate, task });
                    return { success: false, error: { message: `Invalid time format for task "${task.task}". Please use HH:MM AM/PM.`, details: { task } } };
                }
                const startDateTime = taskStart.toISOString();
                const endDateTime = taskEnd.toISOString();
                const overlaps = existingEventsRes.data.some(existingEvent => dayjs(startDateTime).isBefore(dayjs(existingEvent.endDateTime)) && dayjs(endDateTime).isAfter(dayjs(existingEvent.startDateTime)));
                if (overlaps) {
                    localApiHelperLogger.info(`${operationName}: Task "${task.task}" overlaps. Skipping.`, { userId, userDate, task });
                    continue;
                }
                const createEventRes = await createGoogleEvent(userId, googleCalendarIdForEvents, clientType, task.task, startDateTime, endDateTime, userTimezone, task.description);
                if (!createEventRes.success) {
                    localApiHelperLogger.warn(`${operationName}: Failed to create Google event for task.`, { userId, userDate, task, error: createEventRes.error });
                    return { success: false, error: { message: `Failed to create Google Calendar event for task: "${task.task}".`, details: createEventRes.error } };
                }
                eventsToUpsert.push({ userId, calendarId: dbCalendarId, gEventId: createEventRes.data.googleEventId, summary: task.task, description: task.description, startDateTime, endDateTime, timezone: userTimezone, provider: 'google_calendar', status: 'confirmed' });
            }
        }
        if (eventsToUpsert.length === 0) {
            localApiHelperLogger.info(`${operationName}: No new non-overlapping tasks to schedule.`, { userId, userDate });
            if (email && name) {
                const emailBody = "Your day schedule was processed. After checking for overlaps with existing events, no new tasks were added to your calendar.";
                const emailResult = await sendGenericTaskEmail(email, name, `Your Schedule for ${userDate}`, emailBody);
                if (!emailResult.success) {
                    localApiHelperLogger.warn(`${operationName}: Failed to send no-new-tasks email.`, { userId, userDate, email, error: emailResult.error });
                    return { success: false, error: { message: 'Failed to send schedule update email (no new tasks after filtering).', details: emailResult.error } };
                }
            }
            return { success: true };
        }
        const upsertResult = await upsertEventsPostPlanner(eventsToUpsert);
        if (!upsertResult.success) {
            localApiHelperLogger.warn(`${operationName}: upsertEventsPostPlanner failed.`, { userId, userDate, error: upsertResult.error });
            return { success: false, error: { message: 'Failed to save scheduled events to database.', details: upsertResult.error } };
        }
        if (email && name) {
            const emailBodyContent = openAIResponse.content; // This is the JSON string of tasks. Consider formatting for email.
            const emailResult = await sendGenericTaskEmail(email, name, `Your Daily Schedule for ${userDate}`, emailBodyContent);
            if (!emailResult.success) {
                localApiHelperLogger.warn(`${operationName}: emailDailySchedule failed.`, { userId, userDate, email, error: emailResult.error });
                return { success: false, error: { message: 'Failed to send daily schedule email.', details: emailResult.error } };
            }
        }
        localApiHelperLogger.info(`${operationName}: Successfully created day schedule.`, { userId, userDate, tasksScheduled: eventsToUpsert.length });
        return { success: true };
    }
    catch (e) {
        localApiHelperLogger.error(`Unexpected error in ${operationName}:`, { userId, userDate, error: e.message, details: e });
        return { success: false, error: { message: `Unexpected error during ${operationName}.`, details: e.message } };
    }
};
// --- Availability Generation Functions (Refactored) ---
export const generateAvailableSlotsForDate = (date, // YYYY-MM-DD format for the target day
senderPreferences, // Contains work hours, slot duration, timezone
notAvailableSlotsInEventTimezone, // Existing busy slots for the user, in event's target timezone
receiverTimezone, // Timezone for which the slots should be presented
isFirstDay, // Is this the first day of the overall window?
isLastDay, // Is this the last day of the overall window?
windowStartTimeInReceiverTimezone, // HH:mm, only if isFirstDay is true
windowEndTimeInReceiverTimezone) => {
    const availableSlots = [];
    const senderTz = senderPreferences.timezone || 'UTC'; // Default to UTC if not specified
    const slotDuration = senderPreferences.slotDuration || 30;
    const bufferMinutes = senderPreferences.bufferBetweenMeetings || 0;
    // Parse sender's work hours in their timezone
    // Default to 9 AM - 5 PM if not specified
    const workStartHour = parseInt((senderPreferences.workHoursStartTime || '09:00').split(':')[0]);
    const workStartMinute = parseInt((senderPreferences.workHoursStartTime || '09:00').split(':')[1]);
    const workEndHour = parseInt((senderPreferences.workHoursEndTime || '17:00').split(':')[0]);
    const workEndMinute = parseInt((senderPreferences.workHoursEndTime || '17:00').split(':')[1]);
    let dayStart = dayjs.tz(date, senderTz).hour(workStartHour).minute(workStartMinute).second(0).millisecond(0);
    let dayEnd = dayjs.tz(date, senderTz).hour(workEndHour).minute(workEndMinute).second(0).millisecond(0);
    // Adjust start time if it's the first day of a specific window
    if (isFirstDay && windowStartTimeInReceiverTimezone) {
        const windowStart = dayjs.tz(`${date} ${windowStartTimeInReceiverTimezone}`, 'YYYY-MM-DD HH:mm', receiverTimezone).tz(senderTz);
        if (windowStart.isAfter(dayStart)) {
            dayStart = windowStart;
        }
    }
    // Adjust end time if it's the last day of a specific window
    if (isLastDay && windowEndTimeInReceiverTimezone) {
        const windowEnd = dayjs.tz(`${date} ${windowEndTimeInReceiverTimezone}`, 'YYYY-MM-DD HH:mm', receiverTimezone).tz(senderTz);
        if (windowEnd.isBefore(dayEnd)) {
            dayEnd = windowEnd;
        }
    }
    let currentSlotStart = dayStart;
    while (currentSlotStart.add(slotDuration, 'minutes').isBefore(dayEnd) || currentSlotStart.add(slotDuration, 'minutes').isSame(dayEnd)) {
        const currentSlotEnd = currentSlotStart.add(slotDuration, 'minutes');
        let isSlotAvailable = true;
        // Check against existing events (notAvailableSlotsInEventTimezone are already in receiver's timezone)
        // Convert current slot to receiver's timezone for comparison
        const currentSlotStartInReceiverTz = currentSlotStart.tz(receiverTimezone);
        const currentSlotEndInReceiverTz = currentSlotEnd.tz(receiverTimezone);
        for (const busySlot of notAvailableSlotsInEventTimezone) {
            const busyStart = dayjs(busySlot.startDate); // Assuming these are already Dayjs objects or ISO strings
            const busyEnd = dayjs(busySlot.endDate);
            // Check for overlap: (StartA < EndB) and (EndA > StartB)
            if (currentSlotStartInReceiverTz.isBefore(busyEnd) && currentSlotEndInReceiverTz.isAfter(busyStart)) {
                isSlotAvailable = false;
                break;
            }
        }
        if (isSlotAvailable) {
            // Store slots in UTC, but ensure they are presented based on receiverTimezone later if needed
            availableSlots.push({
                startDate: currentSlotStart.toISOString(), // Store in UTC
                endDate: currentSlotEnd.toISOString(), // Store in UTC
            });
        }
        currentSlotStart = currentSlotEnd.add(bufferMinutes, 'minutes');
    }
    return availableSlots;
};
export const generateAvailableSlotsforTimeWindow = (startDate, // YYYY-MM-DD
endDate, // YYYY-MM-DD
senderPreferences, notAvailableFromEvents, // All events for the user within a broader range
receiverTimezone, windowStartTimeInReceiverTimezone, // HH:mm for the first day
windowEndTimeInReceiverTimezone // HH:mm for the last day
) => {
    let allSlots = [];
    let currentDate = dayjs.tz(startDate, receiverTimezone).startOf('day');
    const finalEndDate = dayjs.tz(endDate, receiverTimezone).endOf('day');
    // Convert existing events to notAvailableSlots in the receiver's timezone for comparison
    const notAvailableSlotsInReceiverTz = notAvailableFromEvents.map(event => ({
        startDate: dayjs(event.startDateTime).tz(receiverTimezone).toISOString(), // Convert to receiver's TZ then to ISO
        endDate: dayjs(event.endDateTime).tz(receiverTimezone).toISOString()
    }));
    while (currentDate.isBefore(finalEndDate) || currentDate.isSame(finalEndDate, 'day')) {
        if (senderPreferences.workDays && !senderPreferences.workDays.includes(currentDate.day())) {
            currentDate = currentDate.add(1, 'day');
            continue; // Skip non-working days
        }
        const isFirstDay = currentDate.isSame(dayjs.tz(startDate, receiverTimezone).startOf('day'), 'day');
        const isLastDay = currentDate.isSame(finalEndDate.startOf('day'), 'day');
        const dailySlots = generateAvailableSlotsForDate(currentDate.format('YYYY-MM-DD'), senderPreferences, notAvailableSlotsInReceiverTz, // Pass existing events
        receiverTimezone, isFirstDay, isLastDay, isFirstDay ? windowStartTimeInReceiverTimezone : undefined, isLastDay ? windowEndTimeInReceiverTimezone : undefined);
        allSlots = allSlots.concat(dailySlots);
        currentDate = currentDate.add(1, 'day');
    }
    return { availableSlots: _.uniqWith(allSlots, _.isEqual) };
};
export const generateAvailability = async (userId, availabilityScanStartDate, // YYYY-MM-DD
availabilityScanEndDate, // YYYY-MM-DD
receiverGeneratedTimezone) => {
    const operationName = "generateAvailability";
    try {
        const prefsResult = await getUserPreferences(userId);
        if (!prefsResult.success) {
            localApiHelperLogger.warn(`${operationName}: getUserPreferences failed.`, { userId, error: prefsResult.error });
            return { success: false, error: { message: 'Failed to get user preferences for availability generation.', details: prefsResult.error } };
        }
        if (!prefsResult.data) {
            localApiHelperLogger.warn(`${operationName}: User preferences not found.`, { userId });
            return { success: false, error: { message: 'User preferences not found, cannot generate availability.' } };
        }
        const senderPreferences = prefsResult.data;
        // Fetch events for the user for the given date range to check for conflicts
        // The range for fetching events should cover the entire scan period in UTC to be safe.
        const scanStartUtc = dayjs.tz(availabilityScanStartDate, senderPreferences.timezone || receiverGeneratedTimezone).startOf('day').utc().toISOString();
        const scanEndUtc = dayjs.tz(availabilityScanEndDate, senderPreferences.timezone || receiverGeneratedTimezone).endOf('day').utc().toISOString();
        const eventsResult = await listEventsForUserGivenDates(userId, scanStartUtc, scanEndUtc);
        if (!eventsResult.success) {
            localApiHelperLogger.warn(`${operationName}: listEventsForUserGivenDates failed.`, { userId, scanStartUtc, scanEndUtc, error: eventsResult.error });
            return { success: false, error: { message: 'Failed to list existing events for availability generation.', details: eventsResult.error } };
        }
        const existingEvents = eventsResult.data; // These are already in UTC from Hasura (assuming timestamptz)
        // Assuming windowStartTime and windowEndTime are not used for this top-level call,
        // meaning we generate for full workdays within the date range.
        const availabilityResult = generateAvailableSlotsforTimeWindow(availabilityScanStartDate, availabilityScanEndDate, senderPreferences, existingEvents, receiverGeneratedTimezone // Slots should be generated considering this as the target display timezone context
        );
        localApiHelperLogger.info(`${operationName}: Successfully generated availability slots.`, { userId, slotsCount: availabilityResult.availableSlots.length });
        return { success: true, data: availabilityResult.availableSlots };
    }
    catch (e) {
        localApiHelperLogger.error(`Unexpected error in ${operationName}:`, { userId, error: e.message, details: e });
        return { success: false, error: { message: `Unexpected error during ${operationName}.`, details: e.message } };
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLWhlbHBlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImFwaS1oZWxwZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBQzVCLE9BQU8sR0FBRyxNQUFNLEtBQUssQ0FBQztBQUN0QixPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDMUIsT0FBTyxjQUFjLE1BQU0sdUJBQXVCLENBQUM7QUFDbkQsT0FBTyxTQUFTLE1BQU0sa0JBQWtCLENBQUM7QUFDekMsT0FBTyx1QkFBdUIsTUFBTSxnQ0FBZ0MsQ0FBQztBQUNyRSxPQUFPLGVBQWUsTUFBTSx3QkFBd0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLFlBQVksQ0FBQztBQUMxQyxPQUFPLEVBQUUsRUFBRSxJQUFJLE1BQU0sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNwQyxPQUFPLENBQUMsTUFBTSxRQUFRLENBQUM7QUFDdkIsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRWpELEtBQUssQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDeEIsS0FBSyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUM3QixLQUFLLENBQUMsTUFBTSxDQUFDLHVCQUF1QixDQUFDLENBQUM7QUFDdEMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQztBQTBCOUIsOEJBQThCO0FBQzlCLE1BQU0sTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLEVBQUUsTUFBTSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQztBQUVsRSwyRUFBMkU7QUFDM0UsT0FBTyxLQUFLLE1BQU0sYUFBYSxDQUFDLENBQUMscUJBQXFCO0FBQ3RELE9BQU8sT0FBTyxNQUFNLFNBQVMsQ0FBQyxDQUFDLGlCQUFpQjtBQUNoRCxPQUFPLE9BQU8sTUFBTSxTQUFT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LE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxFQUFFLE9BQU8sRUFBRSwyQkFBMkIsYUFBYSxHQUFHLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDO0lBQ2pILENBQUM7QUFDSCxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgT3BlbkFJIGZyb20gJ29wZW5haSc7XG5pbXBvcnQgZ290IGZyb20gJ2dvdCc7XG5pbXBvcnQgZGF5anMgZnJvbSAnZGF5anMnO1xuaW1wb3J0IHRpbWV6b25lUGx1Z2luIGZyb20gJ2RheWpzL3BsdWdpbi90aW1lem9uZSc7XG5pbXBvcnQgdXRjUGx1Z2luIGZyb20gJ2RheWpzL3BsdWdpbi91dGMnO1xuaW1wb3J0IGN1c3RvbVBhcnNlRm9ybWF0UGx1Z2luIGZyb20gJ2RheWpzL3BsdWdpbi9jdXN0b21QYXJzZUZvcm1hdCc7XG5pbXBvcnQgaXNCZXR3ZWVuUGx1Z2luIGZyb20gJ2RheWpzL3BsdWdpbi9pc0JldHdlZW4nO1xuaW1wb3J0IHsgZ29vZ2xlLCBBdXRoIH0gZnJvbSAnZ29vZ2xlYXBpcyc7XG5pbXBvcnQgeyB2NCBhcyB1dWlkdjQgfSBmcm9tICd1dWlkJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBzZW5kRW1haWwgfSBmcm9tICdAL191dGlscy9lbWFpbC9lbWFpbCc7XG5cbmRheWpzLmV4dGVuZCh1dGNQbHVnaW4pO1xuZGF5anMuZXh0ZW5kKHRpbWV6b25lUGx1Z2luKTtcbmRheWpzLmV4dGVuZChjdXN0b21QYXJzZUZvcm1hdFBsdWdpbik7XG5kYXlqcy5leHRlbmQoaXNCZXR3ZWVuUGx1Z2luKTtcblxuXG4vLyAtLS0gVHlwZXMgKENvbnNvbGlkYXRlZCkgLS0tXG5pbnRlcmZhY2UgU3VjY2Vzc1Jlc3BvbnNlVHlwZTxUPiB7IHN1Y2Nlc3M6IHRydWU7IGRhdGE6IFQ7IH1cbmludGVyZmFjZSBHZW5lcmljU3VjY2Vzc1Jlc3BvbnNlIHsgc3VjY2VzczogdHJ1ZTsgfVxuaW50ZXJmYWNlIEZhaWx1cmVSZXNwb25zZVR5cGUgeyBzdWNjZXNzOiBmYWxzZTsgZXJyb3I6IHsgbWVzc2FnZTogc3RyaW5nOyBkZXRhaWxzPzogYW55OyByYXdSZXNwb25zZT86IHN0cmluZzsgcGFyc2VkUmVzcG9uc2U/OiBhbnk7IH07IH1cbmludGVyZmFjZSBPcGVuQUlFcnJvclJlc3BvbnNlIHsgdHlwZTogJ09QRU5BSV9BUElfRVJST1InOyBzdGF0dXM6IG51bWJlcjsgZGF0YTogYW55OyBtZXNzYWdlOiBzdHJpbmc7IH1cbmludGVyZmFjZSBPcGVuQUlSZXF1ZXN0RXJyb3JSZXNwb25zZSB7IHR5cGU6ICdPUEVOQUlfUkVRVUVTVF9FUlJPUic7IG1lc3NhZ2U6IHN0cmluZzsgfVxuaW50ZXJmYWNlIE9wZW5BSVN1Y2Nlc3NSZXNwb25zZSB7IHN1Y2Nlc3M6IHRydWU7IGNvbnRlbnQ6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQ7IH1cbmludGVyZmFjZSBPcGVuQUlGYWlsdXJlUmVzcG9uc2UgeyBzdWNjZXNzOiBmYWxzZTsgZXJyb3I6IE9wZW5BSUVycm9yUmVzcG9uc2UgfCBPcGVuQUlSZXF1ZXN0RXJyb3JSZXNwb25zZTsgfVxudHlwZSBDYWxsT3BlbkFJUmVzcG9uc2UgPSBPcGVuQUlTdWNjZXNzUmVzcG9uc2UgfCBPcGVuQUlGYWlsdXJlUmVzcG9uc2U7XG5leHBvcnQgaW50ZXJmYWNlIENhbGVuZGFySW50ZWdyYXRpb25UeXBlIHsgaWQ6IHN0cmluZzsgdXNlcklkOiBzdHJpbmc7IGNsaWVudFR5cGU6ICdpb3MnIHwgJ2FuZHJvaWQnIHwgJ3dlYicgfCAnYXRvbWljLXdlYic7IHRva2VuOiBzdHJpbmcgfCBudWxsOyByZWZyZXNoVG9rZW46IHN0cmluZyB8IG51bGw7IGV4cGlyZXNBdDogc3RyaW5nIHwgbnVsbDsgcmVzb3VyY2U6IHN0cmluZzsgc3luY0VuYWJsZWQ/OiBib29sZWFuOyBwcmltYXJ5Q2FsZW5kYXJJZD86IHN0cmluZzsgfVxuZXhwb3J0IGludGVyZmFjZSBHb29nbGVUb2tlblJlc3BvbnNlVHlwZSB7IGFjY2Vzc190b2tlbjogc3RyaW5nOyBleHBpcmVzX2luOiBudW1iZXI7IHNjb3BlPzogc3RyaW5nOyB0b2tlbl90eXBlPzogc3RyaW5nOyBpZF90b2tlbj86IHN0cmluZzsgfVxuaW50ZXJmYWNlIENyZWF0ZUdvb2dsZUV2ZW50U3VjY2Vzc0RhdGEgeyBpZDogc3RyaW5nOyBnb29nbGVFdmVudElkOiBzdHJpbmc7IGdlbmVyYXRlZElkOiBzdHJpbmc7IGNhbGVuZGFySWQ6IHN0cmluZzsgZ2VuZXJhdGVkRXZlbnRJZD86IHN0cmluZzsgfVxudHlwZSBDcmVhdGVHb29nbGVFdmVudFJlc3BvbnNlID0gfCB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IENyZWF0ZUdvb2dsZUV2ZW50U3VjY2Vzc0RhdGEgfSB8IEZhaWx1cmVSZXNwb25zZVR5cGU7XG5leHBvcnQgaW50ZXJmYWNlIEV2ZW50VHlwZSB7IGlkOiBzdHJpbmc7IHVzZXJJZDogc3RyaW5nOyBjYWxlbmRhcklkOiBzdHJpbmc7IGdFdmVudElkPzogc3RyaW5nIHwgbnVsbDsgcHJvdmlkZXI/OiBzdHJpbmcgfCBudWxsOyBzdW1tYXJ5Pzogc3RyaW5nIHwgbnVsbDsgZGVzY3JpcHRpb24/OiBzdHJpbmcgfCBudWxsOyBzdGFydERhdGVUaW1lPzogc3RyaW5nIHwgbnVsbDsgZW5kRGF0ZVRpbWU/OiBzdHJpbmcgfCBudWxsOyB0aW1lem9uZT86IHN0cmluZyB8IG51bGw7IHN0YXR1cz86IHN0cmluZyB8IG51bGw7IGlzRGVsZXRlZD86IGJvb2xlYW4gfCBudWxsOyBwYXJlbnRFdmVudElkPzogc3RyaW5nIHwgbnVsbDsgdGFza0lkPzogc3RyaW5nIHwgbnVsbDsgcHJvamVjdElkPzogc3RyaW5nIHwgbnVsbDsgY3JlYXRlZEF0Pzogc3RyaW5nOyB1cGRhdGVkQXQ/OiBzdHJpbmc7IH1cbmV4cG9ydCBpbnRlcmZhY2UgR2xvYmFsQ2FsZW5kYXJUeXBlIGV4dGVuZHMgQ2FsZW5kYXJJbnRlZ3JhdGlvblR5cGUge31cbmV4cG9ydCBpbnRlcmZhY2UgVXNlclByZWZlcmVuY2VUeXBlIHsgaWQ6IHN0cmluZzsgdXNlcklkOiBzdHJpbmc7IHNvbWVQcmVmZXJlbmNlPzogc3RyaW5nOyB3b3JrSG91cnNTdGFydFRpbWU/OiBzdHJpbmc7IHdvcmtIb3Vyc0VuZFRpbWU/OiBzdHJpbmc7IHdvcmtEYXlzPzogbnVtYmVyW107IHNsb3REdXJhdGlvbj86IG51bWJlcjsgdGltZXpvbmU/OiBzdHJpbmc7IGJ1ZmZlckJldHdlZW5NZWV0aW5ncz86IG51bWJlcjsgfSAvLyBBZGRlZCBmaWVsZHMgZm9yIGF2YWlsYWJpbGl0eVxuaW50ZXJmYWNlIEV2ZW50SW5wdXQgZXh0ZW5kcyBQYXJ0aWFsPE9taXQ8RXZlbnRUeXBlLCAnaWQnIHwgJ2NyZWF0ZWRBdCcgfCAndXBkYXRlZEF0Jz4+IHsgaWQ/OiBzdHJpbmc7IHVzZXJJZDogc3RyaW5nOyBjYWxlbmRhcklkOiBzdHJpbmc7IHN1bW1hcnk6IHN0cmluZzsgc3RhcnREYXRlVGltZTogc3RyaW5nOyBlbmREYXRlVGltZTogc3RyaW5nOyB0aW1lem9uZTogc3RyaW5nOyB9XG5pbnRlcmZhY2UgVXBzZXJ0RXZlbnRzUmVzcG9uc2VEYXRhIHsgYWZmZWN0ZWRfcm93czogbnVtYmVyOyByZXR1cm5pbmc6IHsgaWQ6IHN0cmluZzsgW2tleTogc3RyaW5nXTogYW55IH1bXTsgfVxudHlwZSBVcHNlcnRFdmVudHNQb3N0UGxhbm5lclJlc3BvbnNlID0gfCBTdWNjZXNzUmVzcG9uc2VUeXBlPFVwc2VydEV2ZW50c1Jlc3BvbnNlRGF0YT4gfCBGYWlsdXJlUmVzcG9uc2VUeXBlO1xudHlwZSBFbWFpbFJlc3BvbnNlID0gR2VuZXJpY1N1Y2Nlc3NSZXNwb25zZSB8IEZhaWx1cmVSZXNwb25zZVR5cGU7XG5pbnRlcmZhY2UgQXZhaWxhYmlsaXR5U2xvdCB7IHN0YXJ0RGF0ZTogc3RyaW5nOyBlbmREYXRlOiBzdHJpbmc7IH0gLy8gSVNPIHN0cmluZ3MgaW4gVVRDXG5pbnRlcmZhY2UgUGFyc2VkU2NoZWR1bGVUYXNrIHsgc3RhcnRfdGltZTogc3RyaW5nOyBlbmRfdGltZTogc3RyaW5nOyB0YXNrOiBzdHJpbmc7IGRlc2NyaXB0aW9uPzogc3RyaW5nOyB9XG5cbi8vIC0tLSBPcGVuQUkgQ2xpZW50IFNldHVwIC0tLVxuY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7IGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVkgfSk7XG5cbi8vIC0tLSBIZWxwZXIgRnVuY3Rpb24gSW1wbGVtZW50YXRpb25zIChjb25kZW5zZWQsIGZyb20gcHJldmlvdXMgc3RlcHMpIC0tLVxuaW1wb3J0IHJldHJ5IGZyb20gJ2FzeW5jLXJldHJ5JzsgLy8gSW1wb3J0IGFzeW5jLXJldHJ5XG5pbXBvcnQgT3Bvc3N1bSBmcm9tICdvcG9zc3VtJzsgLy8gSW1wb3J0IG9wb3NzdW1cbmltcG9ydCB3aW5zdG9uIGZyb20gJ3dpbnN0b24nOyAvLyBJbXBvcnQgd2luc3RvblxuXG4vLyAtLS0gTG9nZ2VyIFNldHVwIGZvciBhcGktaGVscGVyLnRzIC0tLVxuLy8gVGhpcyBsb2NhbCBsb2dnZXIgd2lsbCBiZSB1c2VkIGZvciByZXNpbGllbmNlLXJlbGF0ZWQgZXZlbnRzIChyZXRyaWVzLCBjaXJjdWl0IGJyZWFrZXIgc3RhdGVzKVxuLy8gYW5kIGZvciBsb2dnaW5nIGVycm9ycyB3aXRoaW4gdGhpcyBoZWxwZXIgbW9kdWxlLlxuLy8gSXQncyBleHBlY3RlZCB0aGF0IE9wZW5UZWxlbWV0cnkncyBXaW5zdG9uSW5zdHJ1bWVudGF0aW9uIHdpbGwgcGF0Y2ggdGhpcyBpbnN0YW5jZVxuLy8gdG8gaW5jbHVkZSB0cmFjZV9pZCBhbmQgc3Bhbl9pZCB3aGVuIGFuIE9UZWwgY29udGV4dCBpcyBhY3RpdmUuXG5jb25zdCBzZXJ2aWNlTmFtZUZvckxvZ2dlciA9IHByb2Nlc3MuZW52Lk9URUxfU0VSVklDRV9OQU1FIHx8ICdmdW5jdGlvbnMtc2VydmljZSc7XG5jb25zdCBzZXJ2aWNlVmVyc2lvbkZvckxvZ2dlciA9IHByb2Nlc3MuZW52Lk9URUxfU0VSVklDRV9WRVJTSU9OIHx8ICcxLjAuMCc7XG5cbmNvbnN0IGxvY2FsQXBpSGVscGVyTG9nZ2VyID0gd2luc3Rvbi5jcmVhdGVMb2dnZXIoe1xuICBsZXZlbDogcHJvY2Vzcy5lbnYuTE9HX0xFVkVMIHx8ICdpbmZvJyxcbiAgZm9ybWF0OiB3aW5zdG9uLmZvcm1hdC5jb21iaW5lKFxuICAgIHdpbnN0b24uZm9ybWF0LnRpbWVzdGFtcCgpLFxuICAgIHdpbnN0b24uZm9ybWF0Lmpzb24oKSxcbiAgICB3aW5zdG9uLmZvcm1hdCgoaW5mbykgPT4geyAvLyBBZGQgc2VydmljZSBjb250ZXh0IHRvIGxvZ3MgZnJvbSB0aGlzIGhlbHBlclxuICAgICAgaW5mby5zZXJ2aWNlX25hbWUgPSBzZXJ2aWNlTmFtZUZvckxvZ2dlcjtcbiAgICAgIGluZm8udmVyc2lvbiA9IHNlcnZpY2VWZXJzaW9uRm9yTG9nZ2VyO1xuICAgICAgaW5mby5tb2R1bGUgPSAnZ3B0LWFwaS1oZWxwZXInOyAvLyBJZGVudGlmeSBsb2dzIGZyb20gdGhpcyBzcGVjaWZpYyBtb2R1bGVcbiAgICAgIHJldHVybiBpbmZvO1xuICAgIH0pKClcbiAgKSxcbiAgdHJhbnNwb3J0czogW1xuICAgIG5ldyB3aW5zdG9uLnRyYW5zcG9ydHMuQ29uc29sZSgpLFxuICBdLFxufSk7XG5cblxuLy8gU3RhbmRhcmQgcmV0cnkgY29uZmlndXJhdGlvbiBmb3IgZ290XG5jb25zdCBkZWZhdWx0R290UmV0cnlDb25maWcgPSB7XG4gIGxpbWl0OiAzLFxuICBtZXRob2RzOiBbJ0dFVCcsICdQT1NUJywgJ1BVVCcsICdIRUFEJywgJ0RFTEVURScsICdPUFRJT05TJywgJ1RSQUNFJ10sIC8vIFJldHJ5aW5nIFBPU1QvUFVUIGZvciBIYXN1cmEgYXNzdW1pbmcgaWRlbXBvdGVuY3kgb3IgYWNjZXB0YW5jZVxuICBzdGF0dXNDb2RlczogWzQwOCwgNDI5LCA1MDAsIDUwMiwgNTAzLCA1MDRdLFxuICBlcnJvckNvZGVzOiBbJ0VUSU1FRE9VVCcsICdFQ09OTlJFU0VUJywgJ0VBRERSSU5VU0UnLCAnRUNPTk5SRUZVU0VEJywgJ0VQSVBFJywgJ0VORVRVTlJFQUNIJywgJ0VBSV9BR0FJTiddLFxuICBjYWxjdWxhdGVEZWxheTogKHthdHRlbXB0Q291bnR9OiB7YXR0ZW1wdENvdW50OiBudW1iZXJ9KSA9PiB7XG4gICAgLy8gY29uc29sZS53YXJuKGBSZXRyeWluZyBnb3QgcmVxdWVzdCwgYXR0ZW1wdCAke2F0dGVtcHRDb3VudH1gKTsgLy8gUGxhY2Vob2xkZXIgZm9yIHByb3BlciBsb2dnZXJcbiAgICByZXR1cm4gTWF0aC5wb3coMiwgYXR0ZW1wdENvdW50IC0gMSkgKiA1MDAgKyBNYXRoLnJhbmRvbSgpICogMjAwOyAvLyBFeHBvbmVudGlhbCBiYWNrb2ZmIHdpdGggaml0dGVyXG4gIH1cbn07XG5cbi8vIC0tLSBDaXJjdWl0IEJyZWFrZXIgZm9yIEhhc3VyYSBjYWxscyB1c2luZyBnb3QgLS0tXG5jb25zdCBoYXN1cmFHb3RCcmVha2VyT3B0aW9ucyA9IHtcbiAgdGltZW91dDogZmFsc2UsIC8vIGdvdCBoYW5kbGVzIGl0cyBvd24gdGltZW91dHMgcGVyIGF0dGVtcHRcbiAgZXJyb3JUaHJlc2hvbGRQZXJjZW50YWdlOiA1MCxcbiAgcmVzZXRUaW1lb3V0OiAzMDAwMCwgLy8gMzAgc2Vjb25kc1xuICB2b2x1bWVUaHJlc2hvbGQ6IDEwLCAvLyBNaW5pbXVtIG51bWJlciBvZiByZXF1ZXN0cyBpbiBhIHJvbGxpbmcgd2luZG93IGJlZm9yZSBicmVha2VyIGNvbnNpZGVycyBzdGF0aXN0aWNzXG4gIG5hbWU6ICdIYXN1cmFHb3RCcmVha2VyJywgLy8gTmFtZSBmb3IgbG9nZ2luZy9pZGVudGlmaWNhdGlvblxufTtcblxuY29uc3QgaGFzdXJhR290QnJlYWtlciA9IG5ldyBPcG9zc3VtKGFzeW5jIChhY3Rpb246ICgpID0+IFByb21pc2U8YW55PikgPT4ge1xuICAvLyBUaGUgJ2FjdGlvbicgd2lsbCBiZSB0aGUgZ290LnBvc3QgY2FsbC5cbiAgLy8gT3Bvc3N1bSBleHBlY3RzIHRoZSBhY3Rpb24gdG8gYmUgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgYSBQcm9taXNlLlxuICByZXR1cm4gYWN0aW9uKCk7XG59LCBoYXN1cmFHb3RCcmVha2VyT3B0aW9ucyk7XG5cbi8vIEV2ZW50IGxpc3RlbmVycyBmb3IgdGhlIEhhc3VyYSBjaXJjdWl0IGJyZWFrZXJcbmhhc3VyYUdvdEJyZWFrZXIub24oJ29wZW4nLCAoKSA9PiB7XG4gIGxvY2FsQXBpSGVscGVyTG9nZ2VyLmVycm9yKGBDaXJjdWl0IEJyZWFrZXIgT3BlbmVkOiAke2hhc3VyYUdvdEJyZWFrZXIubmFtZX1gLCB7XG4gICAgY2lyY3VpdF9icmVha2VyX25hbWU6IGhhc3VyYUdvdEJyZWFrZXIubmFtZSxcbiAgICBldmVudDogJ29wZW4nLFxuICAgIG1lc3NhZ2U6IGBDaXJjdWl0IGJyZWFrZXIgJHtoYXN1cmFHb3RCcmVha2VyLm5hbWV9IGhhcyBvcGVuZWQuIENhbGxzIHdpbGwgYmUgcmVqZWN0ZWQgdGVtcG9yYXJpbHkuYCxcbiAgfSk7XG59KTtcblxuaGFzdXJhR290QnJlYWtlci5vbignY2xvc2UnLCAoKSA9PiB7XG4gIGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYENpcmN1aXQgQnJlYWtlciBDbG9zZWQ6ICR7aGFzdXJhR290QnJlYWtlci5uYW1lfWAsIHtcbiAgICBjaXJjdWl0X2JyZWFrZXJfbmFtZTogaGFzdXJhR290QnJlYWtlci5uYW1lLFxuICAgIGV2ZW50OiAnY2xvc2UnLFxuICAgIG1lc3NhZ2U6IGBDaXJjdWl0IGJyZWFrZXIgJHtoYXN1cmFHb3RCcmVha2VyLm5hbWV9IGhhcyBjbG9zZWQuIENhbGxzIGFyZSBub3cgZmxvd2luZyBub3JtYWxseS5gLFxuICB9KTtcbn0pO1xuXG5oYXN1cmFHb3RCcmVha2VyLm9uKCdoYWxmT3BlbicsICgpID0+IHtcbiAgbG9jYWxBcGlIZWxwZXJMb2dnZXIud2FybihgQ2lyY3VpdCBCcmVha2VyIEhhbGZPcGVuOiAke2hhc3VyYUdvdEJyZWFrZXIubmFtZX1gLCB7XG4gICAgY2lyY3VpdF9icmVha2VyX25hbWU6IGhhc3VyYUdvdEJyZWFrZXIubmFtZSxcbiAgICBldmVudDogJ2hhbGZPcGVuJyxcbiAgICBtZXNzYWdlOiBgQ2lyY3VpdCBicmVha2VyICR7aGFzdXJhR290QnJlYWtlci5uYW1lfSBpcyBub3cgaGFsZi1vcGVuLiBUZXN0IGNhbGxzIHdpbGwgYmUgYWxsb3dlZC5gLFxuICB9KTtcbn0pO1xuXG5oYXN1cmFHb3RCcmVha2VyLm9uKCdyZWplY3QnLCAoKSA9PiB7IC8vIEZpcmVkIHdoZW4gYSBjYWxsIGlzIHJlamVjdGVkIGJlY2F1c2UgdGhlIGNpcmN1aXQgaXMgb3BlblxuICBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGBDaXJjdWl0IEJyZWFrZXIgUmVqZWN0ZWQgQ2FsbDogJHtoYXN1cmFHb3RCcmVha2VyLm5hbWV9YCwge1xuICAgIGNpcmN1aXRfYnJlYWtlcl9uYW1lOiBoYXN1cmFHb3RCcmVha2VyLm5hbWUsXG4gICAgZXZlbnQ6ICdyZWplY3QnLFxuICAgIG1lc3NhZ2U6IGBDYWxsIHJlamVjdGVkIGJ5ICR7aGFzdXJhR290QnJlYWtlci5uYW1lfSBiZWNhdXNlIGNpcmN1aXQgaXMgb3Blbi5gLFxuICB9KTtcbn0pO1xuXG4vLyBPcG9zc3VtIGFsc28gaGFzICdzdWNjZXNzJyBhbmQgJ2ZhaWx1cmUnIGV2ZW50cyBmb3IgdGhlIHdyYXBwZWQgYWN0aW9uLFxuLy8gd2hpY2ggY291bGQgYmUgdXNlZCBmb3IgbW9yZSBkZXRhaWxlZCBsb2dnaW5nIGlmIG5lZWRlZCwgYnV0IG1pZ2h0IGJlIHZlcmJvc2UuXG4vLyBoYXN1cmFHb3RCcmVha2VyLm9uKCdmYWlsdXJlJywgKGVycm9yLCBleGVjdXRpb25UaW1lKSA9PiB7XG4vLyAgIGNvbnNvbGUuZXJyb3Ioe1xuLy8gICAgIGNpcmN1aXRfYnJlYWtlcl9uYW1lOiBoYXN1cmFHb3RCcmVha2VyLm5hbWUsXG4vLyAgICAgZXZlbnQ6ICdmYWlsdXJlJyxcbi8vICAgICBlcnJvcl9tZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuLy8gICAgIGV4ZWN1dGlvbl90aW1lX21zOiBleGVjdXRpb25UaW1lLFxuLy8gICB9LCBgQnJlYWtlciBhY3Rpb24gZmFpbGVkIGZvciAke2hhc3VyYUdvdEJyZWFrZXIubmFtZX1gKTtcbi8vIH0pO1xuXG4vLyAtLS0gQ2lyY3VpdCBCcmVha2VyIGZvciBPcGVuQUkgY2FsbHMgLS0tXG5jb25zdCBvcGVuQUlCcmVha2VyT3B0aW9ucyA9IHtcbiAgdGltZW91dDogZmFsc2UsIC8vIGFzeW5jLXJldHJ5IGFuZCBPcGVuQUkgU0RLIGhhbmRsZSBpbmRpdmlkdWFsIGF0dGVtcHQgdGltZW91dHNcbiAgZXJyb3JUaHJlc2hvbGRQZXJjZW50YWdlOiA1MCxcbiAgcmVzZXRUaW1lb3V0OiA2MDAwMCwgLy8gNjAgc2Vjb25kc1xuICB2b2x1bWVUaHJlc2hvbGQ6IDUsICAgLy8gTWluaW11bSByZXF1ZXN0cyBpbiByb2xsaW5nIHdpbmRvd1xuICBuYW1lOiAnT3BlbkFJQnJlYWtlcicsXG59O1xuXG5jb25zdCBvcGVuQUlCcmVha2VyID0gbmV3IE9wb3NzdW0oYXN5bmMgKFxuICBzeXN0ZW1NZXNzYWdlOiBzdHJpbmcsXG4gIHVzZXJNZXNzYWdlOiBzdHJpbmcsXG4gIGV4YW1wbGVJbnB1dD86IHN0cmluZyxcbiAgZXhhbXBsZU91dHB1dD86IHN0cmluZyxcbiAgbW9kZWw/OiBzdHJpbmdcbikgPT4ge1xuICAvLyBUaGlzIGlzIHRoZSBhY3Rpb24gb3Bvc3N1bSB3aWxsIGZpcmUsIHdoaWNoIGlzIG91ciBleGlzdGluZyByZXRyeSBsb2dpYyBmb3IgT3BlbkFJXG4gIGNvbnN0IG1lc3NhZ2VzOiBPcGVuQUkuQ2hhdC5Db21wbGV0aW9ucy5DaGF0Q29tcGxldGlvbk1lc3NhZ2VQYXJhbVtdID0gW3sgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6IHN5c3RlbU1lc3NhZ2UgfV07XG4gIGlmIChleGFtcGxlSW5wdXQgJiYgZXhhbXBsZU91dHB1dCkgeyBtZXNzYWdlcy5wdXNoKHsgcm9sZTogJ3VzZXInLCBjb250ZW50OiBleGFtcGxlSW5wdXQgfSk7IG1lc3NhZ2VzLnB1c2goeyByb2xlOiAnYXNzaXN0YW50JywgY29udGVudDogZXhhbXBsZU91dHB1dCB9KTsgfVxuICBtZXNzYWdlcy5wdXNoKHsgcm9sZTogJ3VzZXInLCBjb250ZW50OiB1c2VyTWVzc2FnZSB9KTtcbiAgY29uc3QgY2hvc2VuTW9kZWwgPSBtb2RlbCB8fCAnZ3B0LTMuNS10dXJiby0xMTA2JztcbiAgY29uc3Qgb3BlcmF0aW9uX25hbWVfaW5uZXIgPSAnT3BlbkFJQ2FsbF9BdHRlbXB0TG9naWMnOyAvLyBNb3JlIHNwZWNpZmljIG5hbWUgZm9yIGlubmVyIGxvZ2ljXG5cbiAgcmV0dXJuIGF3YWl0IHJldHJ5KFxuICAgIGFzeW5jIChiYWlsLCBhdHRlbXB0TnVtYmVyKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhgWyR7b3BlcmF0aW9uX25hbWVfaW5uZXJ9XSBBdHRlbXB0ICR7YXR0ZW1wdE51bWJlcn0gdG8gY2FsbCBPcGVuQUkuLi5gKTsgLy8gUGxhY2Vob2xkZXJcbiAgICAgICAgY29uc3QgY29tcGxldGlvbiA9IGF3YWl0IG9wZW5haS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgICAgICAgbW9kZWw6IGNob3Nlbk1vZGVsLFxuICAgICAgICAgIG1lc3NhZ2VzLFxuICAgICAgICAgIHRpbWVvdXQ6IDIwMDAwLCAvLyAyMHMgdGltZW91dCBwZXIgYXR0ZW1wdFxuICAgICAgICB9KTtcbiAgICAgICAgLy8gRXhwbGljaXRseSByZXR1cm4gc3VjY2VzcyBzdHJ1Y3R1cmUgZXhwZWN0ZWQgYnkgb3Bvc3N1bSdzIC5maXJlKCkgYW5kIG91dGVyIGZ1bmN0aW9uXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbnRlbnQ6IGNvbXBsZXRpb24/LmNob2ljZXM/LlswXT8ubWVzc2FnZT8uY29udGVudCB9O1xuICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zdCBsb2dDb250ZXh0UmV0cnk6IGFueSA9IHtcbiAgICAgICAgICBvcGVyYXRpb25fbmFtZTogYCR7b3BlcmF0aW9uX25hbWVfaW5uZXJ9X1JldHJ5YCwgLy8gS2VlcCB0aGlzIGRpc3RpbmN0XG4gICAgICAgICAgYXR0ZW1wdDogYXR0ZW1wdE51bWJlcixcbiAgICAgICAgICBlcnJvcl9tZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgIGVycm9yX3R5cGU6IGVycm9yLmNvbnN0cnVjdG9yLm5hbWUsXG4gICAgICAgIH07XG4gICAgICAgIGlmIChlcnJvci5yZXNwb25zZSAmJiBlcnJvci5yZXNwb25zZS5zdGF0dXMpIHtcbiAgICAgICAgICBsb2dDb250ZXh0UmV0cnkuZXJyb3Jfc3RhdHVzID0gZXJyb3IucmVzcG9uc2Uuc3RhdHVzO1xuICAgICAgICB9XG4gICAgICAgIC8vIGNvbnNvbGUud2FybihcIk9wZW5BSSBjYWxsIGF0dGVtcHQgZmFpbGVkXCIsIGxvZ0NvbnRleHRSZXRyeSk7IC8vIFBsYWNlaG9sZGVyXG5cbiAgICAgICAgaWYgKGVycm9yLnJlc3BvbnNlICYmIFs0MDAsIDQwMSwgNDAzLCA0MDRdLmluY2x1ZGVzKGVycm9yLnJlc3BvbnNlLnN0YXR1cykpIHtcbiAgICAgICAgICAvLyBjb25zb2xlLndhcm4oYFske29wZXJhdGlvbl9uYW1lX2lubmVyfV0gTm9uLXJldHJ5YWJsZSBPcGVuQUkgQVBJIGVycm9yIChzdGF0dXMgJHtlcnJvci5yZXNwb25zZS5zdGF0dXN9KS4gQmFpbGluZy5gKTsgLy8gUGxhY2Vob2xkZXJcbiAgICAgICAgICBiYWlsKGVycm9yKTsgLy8gU3RvcCByZXRyeWluZyBmb3IgdGhlc2UgY2xpZW50IGVycm9yc1xuICAgICAgICAgIHJldHVybjsgLy8gYmFpbCB3aWxsIHRocm93LCBzbyB0aGlzIHdvbid0IGJlIHJlYWNoZWQuXG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZXJyb3I7IC8vIFJlLXRocm93IG90aGVyIGVycm9ycyB0byB0cmlnZ2VyIHJldHJ5XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICByZXRyaWVzOiAzLCBmYWN0b3I6IDIsIG1pblRpbWVvdXQ6IDEwMDAsIG1heFRpbWVvdXQ6IDEwMDAwLFxuICAgICAgb25SZXRyeTogKGVycm9yLCBhdHRlbXB0TnVtYmVyKSA9PiB7IC8vIFRoaXMgb25SZXRyeSBpcyBmb3IgYXN5bmMtcmV0cnlcbiAgICAgICAgY29uc3QgbG9nQ29udGV4dE9uUmV0cnk6IGFueSA9IHtcbiAgICAgICAgICBvcGVyYXRpb25fbmFtZTogYCR7b3BlbkFJQnJlYWtlci5uYW1lfV9Bc3luY1JldHJ5X09uUmV0cnlgLCAvLyBEaXN0aW5ndWlzaCB0aGlzIGxvZ1xuICAgICAgICAgIGF0dGVtcHQ6IGF0dGVtcHROdW1iZXIsXG4gICAgICAgICAgZXJyb3JfbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICBlcnJvcl90eXBlOiBlcnJvci5jb25zdHJ1Y3Rvci5uYW1lLFxuICAgICAgICB9O1xuICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2UgJiYgZXJyb3IucmVzcG9uc2Uuc3RhdHVzKSB7XG4gICAgICAgICAgbG9nQ29udGV4dE9uUmV0cnkuZXJyb3Jfc3RhdHVzID0gZXJyb3IucmVzcG9uc2Uuc3RhdHVzO1xuICAgICAgICB9XG4gICAgICAgIGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oXCJSZXRyeWluZyBPcGVuQUkgY2FsbCAoYXN5bmMtcmV0cnkpXCIsIGxvZ0NvbnRleHRPblJldHJ5KTtcbiAgICAgIH0sXG4gICAgfVxuICApO1xufSwgb3BlbkFJQnJlYWtlck9wdGlvbnMpO1xuXG4vLyBFdmVudCBsaXN0ZW5lcnMgZm9yIHRoZSBPcGVuQUkgY2lyY3VpdCBicmVha2VyXG5vcGVuQUlCcmVha2VyLm9uKCdvcGVuJywgKCkgPT4ge1xuICBsb2NhbEFwaUhlbHBlckxvZ2dlci5lcnJvcihgQ0IgT3BlbmVkOiAke29wZW5BSUJyZWFrZXIubmFtZX1gLCB7IGNpcmN1aXRfYnJlYWtlcl9uYW1lOiBvcGVuQUlCcmVha2VyLm5hbWUsIGV2ZW50OiAnb3BlbicsIG1lc3NhZ2U6IGBDaXJjdWl0IGJyZWFrZXIgJHtvcGVuQUlCcmVha2VyLm5hbWV9IG9wZW5lZC5gIH0pO1xufSk7XG5vcGVuQUlCcmVha2VyLm9uKCdjbG9zZScsICgpID0+IHtcbiAgbG9jYWxBcGlIZWxwZXJMb2dnZXIud2FybihgQ0IgQ2xvc2VkOiAke29wZW5BSUJyZWFrZXIubmFtZX1gLCB7IGNpcmN1aXRfYnJlYWtlcl9uYW1lOiBvcGVuQUlCcmVha2VyLm5hbWUsIGV2ZW50OiAnY2xvc2UnLCBtZXNzYWdlOiBgQ2lyY3VpdCBicmVha2VyICR7b3BlbkFJQnJlYWtlci5uYW1lfSBjbG9zZWQuYCB9KTtcbn0pO1xub3BlbkFJQnJlYWtlci5vbignaGFsZk9wZW4nLCAoKSA9PiB7XG4gIGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYENCIEhhbGZPcGVuOiAke29wZW5BSUJyZWFrZXIubmFtZX1gLCB7IGNpcmN1aXRfYnJlYWtlcl9uYW1lOiBvcGVuQUlCcmVha2VyLm5hbWUsIGV2ZW50OiAnaGFsZk9wZW4nLCBtZXNzYWdlOiBgQ2lyY3VpdCBicmVha2VyICR7b3BlbkFJQnJlYWtlci5uYW1lfSBoYWxmLW9wZW4uYCB9KTtcbn0pO1xub3BlbkFJQnJlYWtlci5vbigncmVqZWN0JywgKCkgPT4ge1xuICBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGBDQiBSZWplY3RlZCBDYWxsOiAke29wZW5BSUJyZWFrZXIubmFtZX1gLCB7IGNpcmN1aXRfYnJlYWtlcl9uYW1lOiBvcGVuQUlCcmVha2VyLm5hbWUsIGV2ZW50OiAncmVqZWN0JywgbWVzc2FnZTogYENhbGwgcmVqZWN0ZWQgYnkgJHtvcGVuQUlCcmVha2VyLm5hbWV9IChjaXJjdWl0IG9wZW4pLmAgfSk7XG59KTtcblxuLy8gVGhpcyBpcyB0aGUgYWN0dWFsIGV4cG9ydGVkIGZ1bmN0aW9uIHRoYXQgdXNlcyB0aGUgY2lyY3VpdCBicmVha2VyLlxuZXhwb3J0IGNvbnN0IGNhbGxPcGVuQUkgPSBhc3luYyAoc3lzdGVtTWVzc2FnZTogc3RyaW5nLCB1c2VyTWVzc2FnZTogc3RyaW5nLCBleGFtcGxlSW5wdXQ/OiBzdHJpbmcsIGV4YW1wbGVPdXRwdXQ/OiBzdHJpbmcsIG1vZGVsPzogc3RyaW5nKTogUHJvbWlzZTxDYWxsT3BlbkFJUmVzcG9uc2U+ID0+IHtcbiAgY29uc3Qgb3BlcmF0aW9uX25hbWUgPSAnT3BlbkFJQ2FsbF9DaXJjdWl0V3JhcHBlZCc7IC8vIEZvciBvdXRlciBsb2dnaW5nIGNvbnRleHRcbiAgdHJ5IHtcbiAgICAvLyBQYXNzIHRoZSBvcmlnaW5hbCBhcmd1bWVudHMgdG8gdGhlIGJyZWFrZXIuZmlyZSgpIG1ldGhvZC5cbiAgICAvLyBPcG9zc3VtIHdpbGwgdGhlbiBwYXNzIHRoZXNlIHRvIHRoZSBhc3luYyBmdW5jdGlvbiBkZWZpbmVkIGluIGl0cyBjb25zdHJ1Y3Rvci5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBvcGVuQUlCcmVha2VyLmZpcmUoc3lzdGVtTWVzc2FnZSwgdXNlck1lc3NhZ2UsIGV4YW1wbGVJbnB1dCwgZXhhbXBsZU91dHB1dCwgbW9kZWwpO1xuICAgIC8vIFRoZSBhY3Rpb24gd3JhcHBlZCBieSBvcGVuQUlCcmVha2VyIGFscmVhZHkgcmV0dXJucyB0aGUge3N1Y2Nlc3M6IHRydWUvZmFsc2UsIC4uLn0gc3RydWN0dXJlIGZyb20gYXN5bmMtcmV0cnkncyByZXNvbHV0aW9uLlxuICAgIHJldHVybiByZXN1bHQgYXMgQ2FsbE9wZW5BSVJlc3BvbnNlO1xuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICAvLyBUaGlzIGNhdGNoIGJsb2NrIGhhbmRsZXMgZXJyb3JzIHByaW1hcmlseSBmcm9tIHRoZSBjaXJjdWl0IGJyZWFrZXIgaXRzZWxmIChlLmcuLCBFT1BFTkJSRUFLRVIpXG4gICAgLy8gb3IgaWYgdGhlIGFjdGlvbiBwYXNzZWQgdG8gb3Bvc3N1bSBoYWQgYW4gdW5oYW5kbGVkIHByb21pc2UgcmVqZWN0aW9uIE5PVCBjYXVnaHQgYnkgYXN5bmMtcmV0cnkncyAuY2F0Y2goKVxuICAgIC8vICh3aGljaCBzaG91bGRuJ3QgaGFwcGVuIHdpdGggdGhlIGN1cnJlbnQgc2V0dXAgYXMgYXN5bmMtcmV0cnkncyAuY2F0Y2goKSByZXR1cm5zIGEgdmFsdWUpLlxuXG4gICAgY29uc3QgZXJyb3JNZXNzYWdlUHJlZml4ID0gZS5jb2RlID09PSAnRU9QRU5CUkVBS0VSJ1xuICAgICAgPyBgQ2lyY3VpdCBicmVha2VyICR7b3BlbkFJQnJlYWtlci5uYW1lfSBpcyBvcGVuIGZvciBPcGVuQUkuYFxuICAgICAgOiBgQ2lyY3VpdCBicmVha2VyIGVycm9yIGZvciAke29wZXJhdGlvbl9uYW1lfS5gOyAvLyBEZWZhdWx0IGZvciB1bmV4cGVjdGVkIGVycm9ycyBmcm9tIGJyZWFrZXJcblxuICAgIGNvbnN0IGZpbmFsRXJyb3JDb250ZXh0OiBhbnkgPSB7XG4gICAgICAgIG9wZXJhdGlvbl9uYW1lOiBgJHtvcGVyYXRpb25fbmFtZX1fQnJlYWtlckZhaWx1cmVgLFxuICAgICAgICBjaXJjdWl0X2JyZWFrZXJfc3RhdHVzOiBlLmNvZGUgPT09ICdFT1BFTkJSRUFLRVInID8gJ09wZW4nIDogJ1Vua25vd25CcmVha2VyRXJyb3InLFxuICAgICAgICBlcnJvcl9tZXNzYWdlOiBlLm1lc3NhZ2UsXG4gICAgICAgIGVycm9yX3R5cGU6IGUuY29uc3RydWN0b3IubmFtZSxcbiAgICB9O1xuICAgIGxvY2FsQXBpSGVscGVyTG9nZ2VyLmVycm9yKFwiRXJyb3IgZnJvbSBPcGVuQUkgY2lyY3VpdCBicmVha2VyOlwiLCBmaW5hbEVycm9yQ29udGV4dCk7XG5cbiAgICBpZiAoZS5jb2RlID09PSAnRU9QRU5CUkVBS0VSJykge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgdHlwZTogJ0NJUkNVSVRfQlJFQUtFUl9PUEVOJywgbWVzc2FnZTogZXJyb3JNZXNzYWdlUHJlZml4LCBkZXRhaWxzOiBlLm1lc3NhZ2UgfSB9O1xuICAgIH1cbiAgICAvLyBGYWxsYmFjayBmb3Igb3RoZXIgdHlwZXMgb2YgZXJyb3JzIGNhdWdodCBieSB0aGUgYnJlYWtlcidzIC5maXJlKClcbiAgICAvLyBUaGVzZSBzaG91bGQgYmUgcmFyZSBpZiB0aGUgd3JhcHBlZCBhY3Rpb24gKHdpdGggYXN5bmMtcmV0cnkpIGNvcnJlY3RseSBmb3JtYXRzIGFsbCBpdHMgZXJyb3JzLlxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyB0eXBlOiAnT1BFTkFJX1JFUVVFU1RfRVJST1InLCBtZXNzYWdlOiBlcnJvck1lc3NhZ2VQcmVmaXgsIGRldGFpbHM6IGUubWVzc2FnZSB9IH07XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBnZXRDYWxlbmRhckludGVncmF0aW9uID0gYXN5bmMgKHVzZXJJZDogc3RyaW5nLCByZXNvdXJjZTogc3RyaW5nKTogUHJvbWlzZTxTdWNjZXNzUmVzcG9uc2VUeXBlPENhbGVuZGFySW50ZWdyYXRpb25UeXBlIHwgdW5kZWZpbmVkPiB8IEZhaWx1cmVSZXNwb25zZVR5cGU+ID0+IHtcbiAgY29uc3QgcXVlcnkgPSBgcXVlcnkgR2V0Q2FsZW5kYXJJbnRlZ3JhdGlvbigkdXNlcklkOiBTdHJpbmchLCAkcmVzb3VyY2U6IFN0cmluZyEpIHsgQ2FsZW5kYXJfSW50ZWdyYXRpb24od2hlcmU6IHt1c2VySWQ6IHtfZXE6ICR1c2VySWR9LCByZXNvdXJjZToge19lcTogJHJlc291cmNlfX0sIGxpbWl0OiAxKSB7IGlkIHVzZXJJZCBjbGllbnRUeXBlIHRva2VuIHJlZnJlc2hUb2tlbiBleHBpcmVzQXQgcmVzb3VyY2Ugc3luY0VuYWJsZWQgcHJpbWFyeUNhbGVuZGFySWQgfSB9YDtcbiAgY29uc3Qgb3BlcmF0aW9uX25hbWUgPSAnSGFzdXJhR2V0Q2FsZW5kYXJJbnRlZ3JhdGlvbic7XG4gIHRyeSB7XG4gICAgLy8gV3JhcCB0aGUgZ290IGNhbGwgd2l0aCB0aGUgY2lyY3VpdCBicmVha2VyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBoYXN1cmFHb3RCcmVha2VyLmZpcmUoKCkgPT4gZ290LnBvc3QocHJvY2Vzcy5lbnYuSEFTVVJBX0VORFBPSU5UX1VSTCB8fCAnJywge1xuICAgICAganNvbjogeyBxdWVyeSwgdmFyaWFibGVzOiB7IHVzZXJJZCwgcmVzb3VyY2UgfSB9LFxuICAgICAgaGVhZGVyczogeyAneC1oYXN1cmEtYWRtaW4tc2VjcmV0JzogcHJvY2Vzcy5lbnYuSEFTVVJBX0FETUlOX1NFQ1JFVCB8fCAnJyB9LFxuICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsXG4gICAgICB0aW1lb3V0OiB7IHJlcXVlc3Q6IDEwMDAwIH0sXG4gICAgICByZXRyeTogZGVmYXVsdEdvdFJldHJ5Q29uZmlnXG4gICAgfSkpO1xuICAgIGNvbnN0IGJvZHkgPSByZXNwb25zZS5ib2R5IGFzIGFueTsgLy8gcmVzcG9uc2UgZnJvbSBnb3QsIGJyZWFrZXIgcGFzc2VzIGl0IHRocm91Z2ggb24gc3VjY2Vzc1xuICAgIGlmIChib2R5LmVycm9ycykge1xuICAgICAgLyogY29uc29sZS5lcnJvcihgWyR7b3BlcmF0aW9uX25hbWV9XSBIYXN1cmEgQVBJIGVycm9yczpgLCBib2R5LmVycm9ycyk7ICovXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0hhc3VyYSBBUEkgZXJyb3IgZHVyaW5nIGdldENhbGVuZGFySW50ZWdyYXRpb24uJywgZGV0YWlsczogYm9keS5lcnJvcnMgfSB9O1xuICAgIH1cbiAgICBpZiAoIWJvZHkuZGF0YSB8fCAhYm9keS5kYXRhLmhhc093blByb3BlcnR5KCdDYWxlbmRhcl9JbnRlZ3JhdGlvbicpKSB7XG4gICAgICAvKiBjb25zb2xlLndhcm4oYFske29wZXJhdGlvbl9uYW1lfV0gVW5leHBlY3RlZCByZXNwb25zZSBzdHJ1Y3R1cmU6YCwgYm9keSk7ICovXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ1VuZXhwZWN0ZWQgcmVzcG9uc2Ugc3RydWN0dXJlIGR1cmluZyBnZXRDYWxlbmRhckludGVncmF0aW9uLicsIGRldGFpbHM6IGJvZHkgfSB9O1xuICAgIH1cbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBib2R5LmRhdGEuQ2FsZW5kYXJfSW50ZWdyYXRpb24/LlswXSB9O1xuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlLmNvZGUgPT09ICdFT1BFTkJSRUFLRVInID8gYENpcmN1aXQgYnJlYWtlciAke2hhc3VyYUdvdEJyZWFrZXIubmFtZX0gaXMgb3Blbi5gIDogYE5ldHdvcmsvcmVxdWVzdCBlcnJvciBkdXJpbmcgJHtvcGVyYXRpb25fbmFtZX0uYDtcbiAgICAvKiBjb25zb2xlLmVycm9yKGBbJHtvcGVyYXRpb25fbmFtZX1dIEVycm9yOiAke2Vycm9yTWVzc2FnZX1gLCBlLm1lc3NhZ2UpOyAqL1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiBlcnJvck1lc3NhZ2UsIGRldGFpbHM6IGUubWVzc2FnZSwgcmF3UmVzcG9uc2U6IGUucmVzcG9uc2U/LmJvZHksIGNvZGU6IGUuY29kZSB9IH07XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCByZWZyZXNoR29vZ2xlVG9rZW4gPSBhc3luYyAocmVmcmVzaFRva2VuVmFsOiBzdHJpbmcsIGNsaWVudFR5cGU6IENhbGVuZGFySW50ZWdyYXRpb25UeXBlWydjbGllbnRUeXBlJ10pOiBQcm9taXNlPFN1Y2Nlc3NSZXNwb25zZVR5cGU8R29vZ2xlVG9rZW5SZXNwb25zZVR5cGU+IHwgRmFpbHVyZVJlc3BvbnNlVHlwZT4gPT4ge1xuICBjb25zdCBjbGllbnRJZCA9IGNsaWVudFR5cGUgPT09ICd3ZWInID8gcHJvY2Vzcy5lbnYuR09PR0xFX0NMSUVOVF9JRF9XRUIgOiBwcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX0lEX0lPUztcbiAgY29uc3QgY2xpZW50U2VjcmV0ID0gY2xpZW50VHlwZSA9PT0gJ3dlYicgPyBwcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX1NFQ1JFVF9XRUIgOiBwcm9jZXNzLmVudi5HT09HTEVfQ0xJRU5UX1NFQ1JFVF9JT1M7XG4gIGNvbnN0IG9wZXJhdGlvbl9uYW1lID0gJ0dvb2dsZVJlZnJlc2hUb2tlbic7XG4gIGlmICghY2xpZW50SWQgfHwgIWNsaWVudFNlY3JldCkge1xuICAgIGNvbnN0IG1zZyA9IGBHb29nbGUgY2xpZW50IElEIG9yIHNlY3JldCBub3QgY29uZmlndXJlZCBmb3IgY2xpZW50VHlwZTogJHtjbGllbnRUeXBlfWA7XG4gICAgLyogY29uc29sZS5lcnJvcihgWyR7b3BlcmF0aW9uX25hbWV9XSAke21zZ31gKTsgKi9cbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogbXNnIH0gfTtcbiAgfVxuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ290LnBvc3QoJ2h0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuJywge1xuICAgICAgZm9ybTogeyBjbGllbnRfaWQ6IGNsaWVudElkLCBjbGllbnRfc2VjcmV0OiBjbGllbnRTZWNyZXQsIHJlZnJlc2hfdG9rZW46IHJlZnJlc2hUb2tlblZhbCwgZ3JhbnRfdHlwZTogJ3JlZnJlc2hfdG9rZW4nIH0sXG4gICAgICByZXNwb25zZVR5cGU6ICdqc29uJyxcbiAgICAgIHRpbWVvdXQ6IHsgcmVxdWVzdDogMTUwMDAgfSxcbiAgICAgIHJldHJ5OiB7IC8vIFNsaWdodGx5IGRpZmZlcmVudCByZXRyeSBmb3IgdG9rZW4gcmVmcmVzaCBpZiBuZWVkZWQsIG9yIHVzZSBkZWZhdWx0XG4gICAgICAgIGxpbWl0OiAyLFxuICAgICAgICBtZXRob2RzOiBbJ1BPU1QnXSxcbiAgICAgICAgc3RhdHVzQ29kZXM6IFs0MDgsIDQyOSwgNTAwLCA1MDIsIDUwMywgNTA0XSxcbiAgICAgICAgZXJyb3JDb2RlczogWydFVElNRURPVVQnLCAnRUNPTk5SRVNFVCcsICdFQUREUklOVVNFJywgJ0VDT05OUkVGVVNFRCcsICdFUElQRScsICdFTkVUVU5SRUFDSCcsICdFQUlfQUdBSU4nXSxcbiAgICAgICAgY2FsY3VsYXRlRGVsYXk6ICh7YXR0ZW1wdENvdW50fToge2F0dGVtcHRDb3VudDogbnVtYmVyfSkgPT4gTWF0aC5wb3coMiwgYXR0ZW1wdENvdW50IC0gMSkgKiAxMDAwICsgTWF0aC5yYW5kb20oKSAqIDMwMFxuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHJlc3BvbnNlLmJvZHkgYXMgR29vZ2xlVG9rZW5SZXNwb25zZVR5cGUgfTtcbiAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgLyogY29uc29sZS5lcnJvcihgWyR7b3BlcmF0aW9uX25hbWV9XSBFcnJvciByZWZyZXNoaW5nIEdvb2dsZSB0b2tlbjpgLCBlLm1lc3NhZ2UsIGUucmVzcG9uc2U/LmJvZHkpOyAqL1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnRmFpbGVkIHRvIHJlZnJlc2ggR29vZ2xlIHRva2VuOiAnICsgZS5tZXNzYWdlLCBkZXRhaWxzOiBlLnJlc3BvbnNlPy5ib2R5IH0gfTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IHVwZGF0ZUNhbGVuZGFySW50ZWdyYXRpb24gPSBhc3luYyAoaWQ6IHN0cmluZywgdG9rZW46IHN0cmluZyB8IG51bGwsIGV4cGlyZXNBdDogc3RyaW5nIHwgbnVsbCwgcmVmcmVzaFRva2VuVmFsPzogc3RyaW5nIHwgbnVsbCwgc3luY0VuYWJsZWQ/OiBib29sZWFuKTogUHJvbWlzZTxHZW5lcmljU3VjY2Vzc1Jlc3BvbnNlIHwgRmFpbHVyZVJlc3BvbnNlVHlwZT4gPT4ge1xuICBjb25zdCBvcGVyYXRpb25fbmFtZSA9ICdIYXN1cmFVcGRhdGVDYWxlbmRhckludGVncmF0aW9uJztcbiAgbGV0IHNldENsYXVzZSA9ICdfc2V0OiB7JztcbiAgaWYgKHRva2VuICE9PSB1bmRlZmluZWQpIHNldENsYXVzZSArPSBgdG9rZW46ICR0b2tlbiwgYDtcbiAgaWYgKGV4cGlyZXNBdCAhPT0gdW5kZWZpbmVkKSBzZXRDbGF1c2UgKz0gYGV4cGlyZXNBdDogJGV4cGlyZXNBdCwgYDtcbiAgaWYgKHJlZnJlc2hUb2tlblZhbCAhPT0gdW5kZWZpbmVkKSBzZXRDbGF1c2UgKz0gYHJlZnJlc2hUb2tlbjogJHJlZnJlc2hUb2tlbiwgYDtcbiAgaWYgKHR5cGVvZiBzeW5jRW5hYmxlZCA9PT0gJ2Jvb2xlYW4nKSBzZXRDbGF1c2UgKz0gYHN5bmNFbmFibGVkOiAkc3luY0VuYWJsZWQsIGA7XG4gIHNldENsYXVzZSArPSBgdXBkYXRlZEF0OiBcIm5vdygpXCIgfWA7XG5cbiAgY29uc3QgbXV0YXRpb24gPSBgbXV0YXRpb24gVXBkYXRlQ2FsZW5kYXJJbnRlZ3JhdGlvbigkaWQ6IHV1aWQhLCAke3Rva2VuICE9PSB1bmRlZmluZWQgPyAnJHRva2VuOiBTdHJpbmcsJyA6ICcnfSAke2V4cGlyZXNBdCAhPT0gdW5kZWZpbmVkID8gJyRleHBpcmVzQXQ6IHRpbWVzdGFtcHR6LCcgOiAnJ30gJHtyZWZyZXNoVG9rZW5WYWwgIT09IHVuZGVmaW5lZCA/ICckcmVmcmVzaFRva2VuOiBTdHJpbmcsJyA6ICcnfSAke3R5cGVvZiBzeW5jRW5hYmxlZCA9PT0gJ2Jvb2xlYW4nID8gJyRzeW5jRW5hYmxlZDogQm9vbGVhbiwnIDogJyd9KSB7IHVwZGF0ZV9DYWxlbmRhcl9JbnRlZ3JhdGlvbl9ieV9wayhwa19jb2x1bW5zOiB7aWQ6ICRpZH0sICR7c2V0Q2xhdXNlfSkgeyBpZCB9IH1gO1xuICBjb25zdCB2YXJpYWJsZXM6IGFueSA9IHsgaWQgfTtcbiAgaWYgKHRva2VuICE9PSB1bmRlZmluZWQpIHZhcmlhYmxlcy50b2tlbiA9IHRva2VuO1xuICBpZiAoZXhwaXJlc0F0ICE9PSB1bmRlZmluZWQpIHZhcmlhYmxlcy5leHBpcmVzQXQgPSBleHBpcmVzQXQ7XG4gIGlmIChyZWZyZXNoVG9rZW5WYWwgIT09IHVuZGVmaW5lZCkgdmFyaWFibGVzLnJlZnJlc2hUb2tlbiA9IHJlZnJlc2hUb2tlblZhbDtcbiAgaWYgKHR5cGVvZiBzeW5jRW5hYmxlZCA9PT0gJ2Jvb2xlYW4nKSB2YXJpYWJsZXMuc3luY0VuYWJsZWQgPSBzeW5jRW5hYmxlZDtcblxuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaGFzdXJhR290QnJlYWtlci5maXJlKCgpID0+IGdvdC5wb3N0KHByb2Nlc3MuZW52LkhBU1VSQV9FTkRQT0lOVF9VUkwgfHwgJycsIHtcbiAgICAgIGpzb246IHsgcXVlcnk6IG11dGF0aW9uLCB2YXJpYWJsZXMgfSxcbiAgICAgIGhlYWRlcnM6IHsgJ3gtaGFzdXJhLWFkbWluLXNlY3JldCc6IHByb2Nlc3MuZW52LkhBU1VSQV9BRE1JTl9TRUNSRVQgfHwgJycgfSxcbiAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLFxuICAgICAgdGltZW91dDogeyByZXF1ZXN0OiAxMDAwMCB9LFxuICAgICAgcmV0cnk6IGRlZmF1bHRHb3RSZXRyeUNvbmZpZ1xuICAgIH0pKTtcbiAgICBjb25zdCBib2R5ID0gcmVzcG9uc2UuYm9keSBhcyBhbnk7XG4gICAgaWYgKGJvZHkuZXJyb3JzKSB7IC8qIGNvbnNvbGUuZXJyb3IoYFske29wZXJhdGlvbl9uYW1lfV0gSGFzdXJhIGVycm9yczpgLCBib2R5LmVycm9ycyk7ICovIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnSGFzdXJhIEFQSSBlcnJvciBkdXJpbmcgdXBkYXRlQ2FsZW5kYXJJbnRlZ3JhdGlvbi4nLCBkZXRhaWxzOiBib2R5LmVycm9ycyB9IH07IH1cbiAgICBpZiAoIWJvZHkuZGF0YSB8fCAhYm9keS5kYXRhLnVwZGF0ZV9DYWxlbmRhcl9JbnRlZ3JhdGlvbl9ieV9waykgeyAvKiBjb25zb2xlLndhcm4oYFske29wZXJhdGlvbl9uYW1lfV0gVW5leHBlY3RlZCByZXNwb25zZTpgLCBib2R5KTsgKi8gcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdVbmV4cGVjdGVkIHJlc3BvbnNlIHN0cnVjdHVyZSBvciBJRCBub3QgZm91bmQgZHVyaW5nIHVwZGF0ZUNhbGVuZGFySW50ZWdyYXRpb24uJywgZGV0YWlsczogYm9keSB9IH07IH1cbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGUuY29kZSA9PT0gJ0VPUEVOQlJFQUtFUicgPyBgQ2lyY3VpdCBicmVha2VyICR7aGFzdXJhR290QnJlYWtlci5uYW1lfSBpcyBvcGVuLmAgOiBgTmV0d29yay9yZXF1ZXN0IGVycm9yIGR1cmluZyAke29wZXJhdGlvbl9uYW1lfS5gO1xuICAgIC8qIGNvbnNvbGUuZXJyb3IoYFske29wZXJhdGlvbl9uYW1lfV0gRXJyb3I6ICR7ZXJyb3JNZXNzYWdlfWAsIGUubWVzc2FnZSk7ICovXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6IGVycm9yTWVzc2FnZSwgZGV0YWlsczogZS5tZXNzYWdlLCByYXdSZXNwb25zZTogZS5yZXNwb25zZT8uYm9keSwgY29kZTogZS5jb2RlIH0gfTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGdldEdvb2dsZUFQSVRva2VuID0gYXN5bmMgKHVzZXJJZDogc3RyaW5nLCByZXNvdXJjZTogc3RyaW5nKTogUHJvbWlzZTx7c3VjY2VzczogdHJ1ZSwgdG9rZW46IHN0cmluZ30gfCBGYWlsdXJlUmVzcG9uc2VUeXBlPiA9PiB7IC8qIC4uLiAqL1xuICBjb25zdCBpUmVzdWx0ID0gYXdhaXQgZ2V0Q2FsZW5kYXJJbnRlZ3JhdGlvbih1c2VySWQsIHJlc291cmNlKTsgaWYgKCFpUmVzdWx0LnN1Y2Nlc3MpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGFjcXVpcmUgR29vZ2xlIEFQSSB0b2tlbjogQ291bGQgbm90IGdldCBjYWxlbmRhciBpbnRlZ3JhdGlvbicsIGRldGFpbHM6IGlSZXN1bHQuZXJyb3IgfSB9O1xuICBjb25zdCBpbnQgPSBpUmVzdWx0LmRhdGE7IGlmICghaW50KSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBhY3F1aXJlIEdvb2dsZSBBUEkgdG9rZW46IE5vIGNhbGVuZGFyIGludGVncmF0aW9uIGZvdW5kLicgfSB9O1xuICBpZiAoaW50LnRva2VuICYmIGludC5leHBpcmVzQXQgJiYgZGF5anMoaW50LmV4cGlyZXNBdCkuaXNBZnRlcihkYXlqcygpLmFkZCg1LCAnbWludXRlcycpKSkgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdG9rZW46IGludC50b2tlbiB9O1xuICBpZiAoIWludC5yZWZyZXNoVG9rZW4pIHsgLyogY29uc29sZS53YXJuKGBVc2VyICR7dXNlcklkfSByZXNvdXJjZSAke3Jlc291cmNlfSBuZWVkcyByZWZyZXNoIGJ1dCBubyByZWZyZXNoIHRva2VuLmApOyAqLyBpZiAoaW50LmlkICYmIGludC5zeW5jRW5hYmxlZCAhPT0gZmFsc2UpIGF3YWl0IHVwZGF0ZUNhbGVuZGFySW50ZWdyYXRpb24oaW50LmlkLCBudWxsLCBudWxsLCBudWxsLCBmYWxzZSkuY2F0Y2goZSA9PiBjb25zb2xlLndhcm4oXCJGYWlsZWQgdG8gZGlzYWJsZSBzeW5jOlwiLCBlLm1lc3NhZ2UpKTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdSZWZyZXNoIG5lZWRlZCBidXQgbm8gcmVmcmVzaCB0b2tlbiBhdmFpbGFibGUuJyB9IH07IH1cbiAgY29uc3QgclJlc3VsdCA9IGF3YWl0IHJlZnJlc2hHb29nbGVUb2tlbihpbnQucmVmcmVzaFRva2VuLCBpbnQuY2xpZW50VHlwZSk7IGlmICghclJlc3VsdC5zdWNjZXNzKSB7IGlmIChpbnQuaWQgJiYgaW50LnN5bmNFbmFibGVkICE9PSBmYWxzZSkgYXdhaXQgdXBkYXRlQ2FsZW5kYXJJbnRlZ3JhdGlvbihpbnQuaWQsIG51bGwsIG51bGwsIG51bGwsIGZhbHNlKS5jYXRjaChlID0+IGNvbnNvbGUud2FybihcIkZhaWxlZCB0byBkaXNhYmxlIHN5bmM6XCIsIGUubWVzc2FnZSkpOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ1Rva2VuIHJlZnJlc2ggZmFpbGVkJywgZGV0YWlsczogclJlc3VsdC5lcnJvciB9IH07IH1cbiAgY29uc3QgeyBhY2Nlc3NfdG9rZW4sIGV4cGlyZXNfaW4gfSA9IHJSZXN1bHQuZGF0YTsgY29uc3QgbmV3RXhwID0gZGF5anMoKS5hZGQoZXhwaXJlc19pbiwgJ3NlY29uZHMnKS50b0lTT1N0cmluZygpO1xuICBpZiAoIWludC5pZCkgeyAvKiBjb25zb2xlLmVycm9yKGBDcml0aWNhbDogSW50ZWdyYXRpb24gSUQgbWlzc2luZyBmb3IgdXNlciAke3VzZXJJZH0gcG9zdC1yZWZyZXNoLmApOyAqLyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0ludGVncmF0aW9uIElEIG1pc3NpbmcgcG9zdC1yZWZyZXNoLicgfX07IH1cbiAgY29uc3QgdVJlc3VsdCA9IGF3YWl0IHVwZGF0ZUNhbGVuZGFySW50ZWdyYXRpb24oaW50LmlkLCBhY2Nlc3NfdG9rZW4sIG5ld0V4cCwgaW50LnJlZnJlc2hUb2tlbiwgdHlwZW9mIGludC5zeW5jRW5hYmxlZCA9PT0gJ2Jvb2xlYW4nID8gaW50LnN5bmNFbmFibGVkIDogdHJ1ZSk7XG4gIGlmICghdVJlc3VsdC5zdWNjZXNzKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cGRhdGUgaW50ZWdyYXRpb24gd2l0aCBuZXcgdG9rZW4nLCBkZXRhaWxzOiB1UmVzdWx0LmVycm9yIH0gfTtcbiAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdG9rZW46IGFjY2Vzc190b2tlbiB9O1xufTtcbmV4cG9ydCBjb25zdCBjcmVhdGVHb29nbGVFdmVudCA9IGFzeW5jICh1c2VySWQ6IHN0cmluZywgY2FsZW5kYXJJZFZhbDogc3RyaW5nLCBjbGllbnRUeXBlVmFsOiBDYWxlbmRhckludGVncmF0aW9uVHlwZVsnY2xpZW50VHlwZSddLCBzdW1tYXJ5VmFsOiBzdHJpbmcsIHN0YXJ0RGF0ZVRpbWVWYWw6IHN0cmluZywgZW5kRGF0ZVRpbWVWYWw6IHN0cmluZywgdGltZXpvbmVWYWw6IHN0cmluZywgZGVzY3JpcHRpb25WYWw/OiBzdHJpbmcsIGF0dGVuZGVlc1ZhbD86IHsgZW1haWw6IHN0cmluZyB9W10sIGNvbmZlcmVuY2VTb2x1dGlvblZhbD86ICdldmVudEhhbmdvdXQnIHwgJ2hhbmdvdXRzTWVldCcgfCBudWxsKTogUHJvbWlzZTxDcmVhdGVHb29nbGVFdmVudFJlc3BvbnNlPiA9PiB7IC8qIC4uLiAqL1xuICBjb25zdCBvcGVyYXRpb25fbmFtZSA9IFwiR29vZ2xlQ3JlYXRlRXZlbnRcIjtcbiAgY29uc3QgdG9rZW5SZXN1bHQgPSBhd2FpdCBnZXRHb29nbGVBUElUb2tlbih1c2VySWQsICdnb29nbGVfY2FsZW5kYXInKTtcbiAgaWYgKCF0b2tlblJlc3VsdC5zdWNjZXNzKSB7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdUb2tlbiBhY3F1aXNpdGlvbiBmYWlsdXJlIGZvciBHb29nbGUgZXZlbnQuJywgZGV0YWlsczogdG9rZW5SZXN1bHQuZXJyb3IgfSB9O1xuICB9XG5cbiAgY29uc3Qgb0F1dGgyQ2xpZW50ID0gbmV3IEF1dGguT0F1dGgyQ2xpZW50KCk7XG4gIG9BdXRoMkNsaWVudC5zZXRDcmVkZW50aWFscyh7IGFjY2Vzc190b2tlbjogdG9rZW5SZXN1bHQudG9rZW4gfSk7XG4gIGNvbnN0IGNhbGVuZGFyID0gZ29vZ2xlLmNhbGVuZGFyKHsgdmVyc2lvbjogJ3YzJywgYXV0aDogb0F1dGgyQ2xpZW50IH0pO1xuICBjb25zdCBnZW5lcmF0ZWRJZCA9IHV1aWR2NCgpOyAvLyBGb3IgY29uZmVyZW5jZSByZXF1ZXN0IGlmIG5lZWRlZFxuXG4gIGNvbnN0IGV2ZW50OiBhbnkgPSB7IC8vIERlZmluZSB0aGUgZXZlbnQgYm9keSBmb3IgR29vZ2xlIENhbGVuZGFyIEFQSVxuICAgIHN1bW1hcnk6IHN1bW1hcnlWYWwsXG4gICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uVmFsLFxuICAgIHN0YXJ0OiB7IGRhdGVUaW1lOiBzdGFydERhdGVUaW1lVmFsLCB0aW1lWm9uZTogdGltZXpvbmVWYWwgfSxcbiAgICBlbmQ6IHsgZGF0ZVRpbWU6IGVuZERhdGVUaW1lVmFsLCB0aW1lWm9uZTogdGltZXpvbmVWYWwgfSxcbiAgICBhdHRlbmRlZXM6IGF0dGVuZGVlc1ZhbCxcbiAgICByZW1pbmRlcnM6IHsgdXNlRGVmYXVsdDogdHJ1ZSB9LFxuICB9O1xuXG4gIGlmIChjb25mZXJlbmNlU29sdXRpb25WYWwpIHtcbiAgICBldmVudC5jb25mZXJlbmNlRGF0YSA9IHtcbiAgICAgIGNyZWF0ZVJlcXVlc3Q6IHtcbiAgICAgICAgcmVxdWVzdElkOiBnZW5lcmF0ZWRJZCxcbiAgICAgICAgY29uZmVyZW5jZVNvbHV0aW9uS2V5OiB7IHR5cGU6IGNvbmZlcmVuY2VTb2x1dGlvblZhbCB9LFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgY29uc3Qgb3BlcmF0aW9uX25hbWVfZm9yX3JldHJ5ID0gXCJHb29nbGVDcmVhdGVFdmVudF9SZXRyeUF0dGVtcHRcIjtcblxuICB0cnkge1xuICAgIHJldHVybiBhd2FpdCByZXRyeShcbiAgICAgIGFzeW5jIChiYWlsLCBhdHRlbXB0TnVtYmVyKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coYFske29wZXJhdGlvbl9uYW1lX2Zvcl9yZXRyeX1dIEF0dGVtcHQgJHthdHRlbXB0TnVtYmVyfSB0byBpbnNlcnQgR29vZ2xlIGV2ZW50Li4uYCk7IC8vIFBsYWNlaG9sZGVyXG4gICAgICAgICAgY29uc3QgZ0V2ZW50ID0gYXdhaXQgY2FsZW5kYXIuZXZlbnRzLmluc2VydCh7XG4gICAgICAgICAgICBjYWxlbmRhcklkOiBjYWxlbmRhcklkVmFsLFxuICAgICAgICAgICAgcmVxdWVzdEJvZHk6IGV2ZW50LFxuICAgICAgICAgICAgY29uZmVyZW5jZURhdGFWZXJzaW9uOiBjb25mZXJlbmNlU29sdXRpb25WYWwgPyAxIDogMCxcbiAgICAgICAgICAgIC8vIEFkZCB0aW1lb3V0IHRvIHRoZSByZXF1ZXN0IG9wdGlvbnMgZm9yIGdvb2dsZWFwaXNcbiAgICAgICAgICB9LCB7IHRpbWVvdXQ6IDIwMDAwIH0pOyAvLyAyMCBzZWNvbmQgdGltZW91dCBwZXIgYXR0ZW1wdFxuXG4gICAgICAgICAgaWYgKCFnRXZlbnQuZGF0YS5pZCkge1xuICAgICAgICAgICAgLy8gVGhpcyBpcyBhbiB1bmV4cGVjdGVkIHN1Y2Nlc3MgcmVzcG9uc2UsIHNob3VsZCBub3QgcmV0cnkuXG4gICAgICAgICAgICBjb25zdCBlcnIgPSBuZXcgRXJyb3IoJ0dvb2dsZSBBUEkgZGlkIG5vdCByZXR1cm4gZXZlbnQgSUQgZGVzcGl0ZSBzdWNjZXNzIHN0YXR1cy4nKTtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUuZXJyb3IoYFske29wZXJhdGlvbl9uYW1lX2Zvcl9yZXRyeX1dIE5vbi1yZXRyeWFibGUgZXJyb3I6YCwgZXJyLm1lc3NhZ2UpOyAvLyBQbGFjZWhvbGRlclxuICAgICAgICAgICAgYmFpbChlcnIpO1xuICAgICAgICAgICAgcmV0dXJuOyAvLyBTaG91bGQgbm90IGJlIHJlYWNoZWRcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgZ0V2ZW50SWQgPSBnRXZlbnQuZGF0YS5pZDtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgaWQ6IGAke2dFdmVudElkfSMke2NhbGVuZGFySWRWYWx9YCxcbiAgICAgICAgICAgICAgZ29vZ2xlRXZlbnRJZDogZ0V2ZW50SWQsXG4gICAgICAgICAgICAgIGdlbmVyYXRlZElkLCAvLyBUaGlzIHdhcyBmb3IgY29uZmVyZW5jZSwgbWlnaHQgYmUgY29uZnVzaW5nIGhlcmVcbiAgICAgICAgICAgICAgY2FsZW5kYXJJZDogY2FsZW5kYXJJZFZhbCxcbiAgICAgICAgICAgICAgZ2VuZXJhdGVkRXZlbnRJZDogZ2VuZXJhdGVkSWQuc3BsaXQoJ18nKT8uWzBdIC8vIEFsc28gZm9yIGNvbmZlcmVuY2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICAgICAgICAvLyBjb25zb2xlLmVycm9yKGBbJHtvcGVyYXRpb25fbmFtZV9mb3JfcmV0cnl9XSBFcnJvciBvbiBhdHRlbXB0ICR7YXR0ZW1wdE51bWJlcn06YCwgZS5tZXNzYWdlLCBlLmNvZGUsIGUuZXJyb3JzKTsgLy8gUGxhY2Vob2xkZXJcbiAgICAgICAgICAvLyBDaGVjayBmb3IgR29vZ2xlIEFQSSBzcGVjaWZpYyBlcnJvciByZWFzb25zIGFuZCBIVFRQIHN0YXR1cyBjb2Rlc1xuICAgICAgICAgIGNvbnN0IGh0dHBTdGF0dXNDb2RlID0gZS5jb2RlOyAvLyBnb29nbGVhcGlzIGVycm9yIG9mdGVuIGhhcyBIVFRQIHN0YXR1cyBjb2RlIGluIGBlLmNvZGVgXG4gICAgICAgICAgY29uc3QgZ29vZ2xlRXJyb3JSZWFzb24gPSBlLmVycm9ycyAmJiBlLmVycm9yc1swXSA/IGUuZXJyb3JzWzBdLnJlYXNvbiA6IG51bGw7XG5cbiAgICAgICAgICBpZiAoaHR0cFN0YXR1c0NvZGUgPT09IDQwMCB8fCBodHRwU3RhdHVzQ29kZSA9PT0gNDAxIHx8IGh0dHBTdGF0dXNDb2RlID09PSA0MDQgfHxcbiAgICAgICAgICAgICAgKGh0dHBTdGF0dXNDb2RlID09PSA0MDMgJiYgZ29vZ2xlRXJyb3JSZWFzb24gIT09ICdyYXRlTGltaXRFeGNlZWRlZCcgJiYgZ29vZ2xlRXJyb3JSZWFzb24gIT09ICd1c2VyUmF0ZUxpbWl0RXhjZWVkZWQnKSkge1xuICAgICAgICAgICAgLy8gY29uc29sZS53YXJuKGBbJHtvcGVyYXRpb25fbmFtZV9mb3JfcmV0cnl9XSBOb24tcmV0cnlhYmxlIEdvb2dsZSBBUEkgZXJyb3IgKHN0YXR1cyAke2h0dHBTdGF0dXNDb2RlfSwgcmVhc29uICR7Z29vZ2xlRXJyb3JSZWFzb259KS4gQmFpbGluZy5gKTsgLy8gUGxhY2Vob2xkZXJcbiAgICAgICAgICAgIGJhaWwoZSk7IC8vIFN0b3AgcmV0cnlpbmcgZm9yIHRoZXNlIGNsaWVudCBlcnJvcnNcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gRm9yIG90aGVyIGVycm9ycyAoZS5nLiwgNXh4LCByYXRlTGltaXRFeGNlZWRlZCwgbmV0d29yayBpc3N1ZXMpLCByZS10aHJvdyB0byB0cmlnZ2VyIHJldHJ5XG4gICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgcmV0cmllczogMyxcbiAgICAgICAgZmFjdG9yOiAyLFxuICAgICAgICBtaW5UaW1lb3V0OiAxMDAwLFxuICAgICAgICBtYXhUaW1lb3V0OiAxMDAwMCxcbiAgICAgICAgb25SZXRyeTogKGVycm9yLCBhdHRlbXB0TnVtYmVyKSA9PiB7XG4gICAgICAgICAgY29uc3QgbG9nQ29udGV4dDogYW55ID0ge1xuICAgICAgICAgICAgb3BlcmF0aW9uX25hbWU6IGAke29wZXJhdGlvbl9uYW1lfV9vblJldHJ5YCwgLy8gb3BlcmF0aW9uX25hbWUgaXMgZnJvbSBvdXRlciBzY29wZVxuICAgICAgICAgICAgYXR0ZW1wdDogYXR0ZW1wdE51bWJlcixcbiAgICAgICAgICAgIGVycm9yX21lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgICBlcnJvcl9jb2RlOiBlcnJvci5jb2RlLCAvLyBIVFRQIHN0YXR1cyBjb2RlXG4gICAgICAgICAgICBlcnJvcl9yZWFzb246IGVycm9yLmVycm9ycyAmJiBlcnJvci5lcnJvcnNbMF0gPyBlcnJvci5lcnJvcnNbMF0ucmVhc29uIDogbnVsbCxcbiAgICAgICAgICB9O1xuICAgICAgICAgIGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oXCJSZXRyeWluZyBHb29nbGUgZXZlbnQgY3JlYXRpb25cIiwgbG9nQ29udGV4dCk7XG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKTtcbiAgfSBjYXRjaCAoZTogYW55KSB7IC8vIENhdGNoIGZpbmFsIGVycm9yIGZyb20gYXN5bmMtcmV0cnkgKGFsbCByZXRyaWVzIGZhaWxlZCBvciBiYWlsZWQpXG4gICAgY29uc3QgZmluYWxFcnJvckNvbnRleHQ6IGFueSA9IHtcbiAgICAgIG9wZXJhdGlvbl9uYW1lOiBgJHtvcGVyYXRpb25fbmFtZX1fRmluYWxGYWlsdXJlYCxcbiAgICAgIGVycm9yX21lc3NhZ2U6IGUubWVzc2FnZSxcbiAgICAgIGVycm9yX2NvZGU6IGUuY29kZSxcbiAgICAgIGVycm9yX3JlYXNvbjogZS5lcnJvcnMgJiYgZS5lcnJvcnNbMF0gPyBlLmVycm9yc1swXS5yZWFzb24gOiBudWxsLFxuICAgICAgd2FzX2JhaWxlZDogZS5iYWlsLCAvLyBDaGVjayBpZiBlcnJvciBoYXMgJ2JhaWwnIHByb3BlcnR5IGlmIGFzeW5jLXJldHJ5IGFkZHMgaXRcbiAgICB9O1xuICAgIC8vIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY3JlYXRlIEdvb2dsZSBldmVudCBhZnRlciByZXRyaWVzIG9yIGJhaWxcIiwgZmluYWxFcnJvckNvbnRleHQpOyAvLyBQbGFjZWhvbGRlclxuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiBgR29vZ2xlIENhbGVuZGFyIEFQSSBlcnJvciBkdXJpbmcgZXZlbnQgY3JlYXRpb246ICR7ZS5tZXNzYWdlfWAsIGRldGFpbHM6IGUucmVzcG9uc2U/LmRhdGEgfHwgZS5lcnJvcnMgfHwgZSB9IH07XG4gIH1cbn07XG5cbiAgY29uc3QgdW5pcXVlRXZlbnRzID0gXy51bmlxQnkoZXZlbnRzLmZpbHRlcihlID0+IGUpLCAnaWQnKTsgaWYgKHVuaXF1ZUV2ZW50cy5sZW5ndGggPT09IDApIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHsgYWZmZWN0ZWRfcm93czogMCwgcmV0dXJuaW5nOiBbXSB9IH07XG4gIGNvbnN0IG9iamVjdHMgPSB1bmlxdWVFdmVudHMubWFwKGV2ZW50ID0+ICh7IC4uLmV2ZW50LCBwcm92aWRlcjogZXZlbnQucHJvdmlkZXIgfHwgJ2dvb2dsZV9jYWxlbmRhcicsIHN0YXR1czogZXZlbnQuc3RhdHVzIHx8ICdjb25maXJtZWQnIH0pKTtcbiAgY29uc3QgbXV0YXRpb24gPSBgbXV0YXRpb24gVXBzZXJ0RXZlbnRzKCRvYmplY3RzOiBbRXZlbnRfaW5zZXJ0X2lucHV0IV0hKSB7IGluc2VydF9FdmVudChvYmplY3RzOiAkb2JqZWN0cywgb25fY29uZmxpY3Q6IHsgY29uc3RyYWludDogRXZlbnRfcGtleSwgdXBkYXRlX2NvbHVtbnM6IFtzdW1tYXJ5LCBkZXNjcmlwdGlvbiwgc3RhcnREYXRlVGltZSwgZW5kRGF0ZVRpbWUsIHRpbWV6b25lLCBnRXZlbnRJZCwgcHJvdmlkZXIsIHVwZGF0ZWRBdCwgdGFza0lkLCBwcm9qZWN0SWQsIHN0YXR1cywgcGFyZW50RXZlbnRJZF0gfSkgeyBhZmZlY3RlZF9yb3dzIHJldHVybmluZyB7IGlkIH0gfSB9YDtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGhhc3VyYUdvdEJyZWFrZXIuZmlyZSgoKSA9PiBnb3QucG9zdChwcm9jZXNzLmVudi5IQVNVUkFfRU5EUE9JTlRfVVJMIHx8ICcnLCB7XG4gICAgICBqc29uOiB7IHF1ZXJ5OiBtdXRhdGlvbiwgdmFyaWFibGVzOiB7IG9iamVjdHMgfSB9LFxuICAgICAgaGVhZGVyczogeyAneC1oYXN1cmEtYWRtaW4tc2VjcmV0JzogcHJvY2Vzcy5lbnYuSEFTVVJBX0FETUlOX1NFQ1JFVCB8fCAnJyB9LFxuICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsXG4gICAgICB0aW1lb3V0OiB7IHJlcXVlc3Q6IDE1MDAwIH0sIC8vIExvbmdlciB0aW1lb3V0IGZvciBwb3RlbnRpYWxseSBsYXJnZSB1cHNlcnRzXG4gICAgICByZXRyeTogZGVmYXVsdEdvdFJldHJ5Q29uZmlnXG4gICAgfSkpO1xuICAgIGNvbnN0IGJvZHkgPSByZXNwb25zZS5ib2R5IGFzIGFueTtcbiAgICBpZiAoYm9keS5lcnJvcnMpIHsgLyogbG9jYWxBcGlIZWxwZXJMb2dnZXIuZXJyb3IoYFske29wZXJhdGlvbl9uYW1lfV0gSGFzdXJhIGVycm9yczpgLCB7ZGV0YWlsczogYm9keS5lcnJvcnN9KTsgKi8gcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdIYXN1cmEgQVBJIGVycm9yIGR1cmluZyBldmVudCB1cHNlcnQuJywgZGV0YWlsczogYm9keS5lcnJvcnMgfSB9OyB9XG4gICAgaWYgKCFib2R5LmRhdGEgfHwgIWJvZHkuZGF0YS5pbnNlcnRfRXZlbnQpIHsgLyogbG9jYWxBcGlIZWxwZXJMb2dnZXIud2FybihgWyR7b3BlcmF0aW9uX25hbWV9XSBVbmV4cGVjdGVkIEhhc3VyYSByZXNwb25zZTpgLCB7Ym9keX0pOyAqLyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ1VuZXhwZWN0ZWQgSGFzdXJhIHJlc3BvbnNlIGR1cmluZyBldmVudCB1cHNlcnQuJywgZGV0YWlsczogYm9keSB9IH07IH1cbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBib2R5LmRhdGEuaW5zZXJ0X0V2ZW50IH07XG4gIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGUuY29kZSA9PT0gJ0VPUEVOQlJFQUtFUicgPyBgQ2lyY3VpdCBicmVha2VyICR7aGFzdXJhR290QnJlYWtlci5uYW1lfSBpcyBvcGVuLmAgOiBgTmV0d29yay9yZXF1ZXN0IGVycm9yIGR1cmluZyAke29wZXJhdGlvbl9uYW1lfS5gO1xuICAgIC8qIGxvY2FsQXBpSGVscGVyTG9nZ2VyLmVycm9yKGBbJHtvcGVyYXRpb25fbmFtZX1dIEVycm9yOiAke2Vycm9yTWVzc2FnZX1gLCB7ZXJyb3JfbWVzc2FnZTogZS5tZXNzYWdlLCBlcnJvcl9jb2RlOiBlLmNvZGUsIHJhd19yZXNwb25zZTogZS5yZXNwb25zZT8uYm9keX0pOyAqL1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiBlcnJvck1lc3NhZ2UsIGRldGFpbHM6IGUubWVzc2FnZSwgcmF3UmVzcG9uc2U6IGUucmVzcG9uc2U/LmJvZHksIGNvZGU6IGUuY29kZSB9IH07XG4gIH1cbn07XG5leHBvcnQgY29uc3QgZ2V0R2xvYmFsQ2FsZW5kYXIgPSBhc3luYyAodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFN1Y2Nlc3NSZXNwb25zZVR5cGU8R2xvYmFsQ2FsZW5kYXJUeXBlIHwgdW5kZWZpbmVkPiB8IEZhaWx1cmVSZXNwb25zZVR5cGU+ID0+IHtcbiAgY29uc3Qgb3BlcmF0aW9uX25hbWUgPSAnSGFzdXJhR2V0R2xvYmFsQ2FsZW5kYXInO1xuICBjb25zdCBxdWVyeSA9IGBxdWVyeSBHZXRHbG9iYWxDYWxlbmRhcigkdXNlcklkOiBTdHJpbmchKSB7IENhbGVuZGFyKHdoZXJlOiB7dXNlcklkOiB7X2VxOiAkdXNlcklkfSwgdHlwZToge19lcTogXCJnbG9iYWxcIn19LCBsaW1pdDogMSkgeyBpZCB1c2VySWQgcHJpbWFyeUNhbGVuZGFySWQgfSB9YDtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGhhc3VyYUdvdEJyZWFrZXIuZmlyZSgoKSA9PiBnb3QucG9zdChwcm9jZXNzLmVudi5IQVNVUkFfRU5EUE9JTlRfVVJMIHx8ICcnLCB7XG4gICAgICBqc29uOiB7IHF1ZXJ5LCB2YXJpYWJsZXM6IHsgdXNlcklkIH0gfSxcbiAgICAgIGhlYWRlcnM6IHsgJ3gtaGFzdXJhLWFkbWluLXNlY3JldCc6IHByb2Nlc3MuZW52LkhBU1VSQV9BRE1JTl9TRUNSRVQgfHwgJycgfSxcbiAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLFxuICAgICAgdGltZW91dDogeyByZXF1ZXN0OiAxMDAwMCB9LFxuICAgICAgcmV0cnk6IGRlZmF1bHRHb3RSZXRyeUNvbmZpZ1xuICAgIH0pKTtcbiAgICBjb25zdCBib2R5ID0gcmVzcG9uc2UuYm9keSBhcyBhbnk7XG4gICAgaWYgKGJvZHkuZXJyb3JzKSB7IC8qIGxvY2FsQXBpSGVscGVyTG9nZ2VyLmVycm9yKGBbJHtvcGVyYXRpb25fbmFtZX1dIEhhc3VyYSBlcnJvcnM6YCwge2RldGFpbHM6IGJvZHkuZXJyb3JzfSk7ICovIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnSGFzdXJhIEFQSSBlcnJvciBkdXJpbmcgZ2V0R2xvYmFsQ2FsZW5kYXIuJywgZGV0YWlsczogYm9keS5lcnJvcnMgfSB9OyB9XG4gICAgaWYgKCFib2R5LmRhdGEgfHwgIWJvZHkuZGF0YS5oYXNPd25Qcm9wZXJ0eSgnQ2FsZW5kYXInKSkgeyAvKiBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGBbJHtvcGVyYXRpb25fbmFtZX1dIFVuZXhwZWN0ZWQgcmVzcG9uc2U6YCwge2JvZHl9KTsgKi8gcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdVbmV4cGVjdGVkIHJlc3BvbnNlIHN0cnVjdHVyZSBkdXJpbmcgZ2V0R2xvYmFsQ2FsZW5kYXIuJywgZGV0YWlsczogYm9keSB9IH07IH1cbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBib2R5LmRhdGEuQ2FsZW5kYXI/LlswXSB9O1xuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlLmNvZGUgPT09ICdFT1BFTkJSRUFLRVInID8gYENpcmN1aXQgYnJlYWtlciAke2hhc3VyYUdvdEJyZWFrZXIubmFtZX0gaXMgb3Blbi5gIDogYE5ldHdvcmsvcmVxdWVzdCBlcnJvciBkdXJpbmcgJHtvcGVyYXRpb25fbmFtZX0uYDtcbiAgICAvKiBsb2NhbEFwaUhlbHBlckxvZ2dlci5lcnJvcihgWyR7b3BlcmF0aW9uX25hbWV9XSBFcnJvcjogJHtlcnJvck1lc3NhZ2V9YCwge2Vycm9yX21lc3NhZ2U6IGUubWVzc2FnZSwgZXJyb3JfY29kZTogZS5jb2RlLCByYXdfcmVzcG9uc2U6IGUucmVzcG9uc2U/LmJvZHl9KTsgKi9cbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogZXJyb3JNZXNzYWdlLCBkZXRhaWxzOiBlLm1lc3NhZ2UsIHJhd1Jlc3BvbnNlOiBlLnJlc3BvbnNlPy5ib2R5LCBjb2RlOiBlLmNvZGUgfSB9O1xuICB9XG59O1xuZXhwb3J0IGNvbnN0IGxpc3RFdmVudHNGb3JEYXRlID0gYXN5bmMgKHVzZXJJZDogc3RyaW5nLCBzdGFydERhdGU6IHN0cmluZywgZW5kRGF0ZTogc3RyaW5nLCB0aW1lem9uZVBhcmFtOiBzdHJpbmcpOiBQcm9taXNlPFN1Y2Nlc3NSZXNwb25zZVR5cGU8RXZlbnRUeXBlW10+IHwgRmFpbHVyZVJlc3BvbnNlVHlwZT4gPT4ge1xuICBjb25zdCBvcGVyYXRpb25fbmFtZSA9ICdIYXN1cmFMaXN0RXZlbnRzRm9yRGF0ZSc7XG4gIGNvbnN0IHF1ZXJ5ID0gYHF1ZXJ5IExpc3RFdmVudHNGb3JEYXRlKCR1c2VySWQ6IFN0cmluZyEsICRzdGFydERhdGU6IHRpbWVzdGFtcHR6ISwgJGVuZERhdGU6IHRpbWVzdGFtcHR6ISkgeyBFdmVudCh3aGVyZToge3VzZXJJZDoge19lcTogJHVzZXJJZH0sIHN0YXJ0RGF0ZVRpbWU6IHtfZ3RlOiAkc3RhcnREYXRlfSwgZW5kRGF0ZVRpbWU6IHtfbHRlOiAkZW5kRGF0ZX0sIF9vcjogW3tpc0RlbGV0ZWQ6IHtfaXNfbnVsbDogdHJ1ZX19LCB7aXNEZWxldGVkOiB7X2VxOiBmYWxzZX19XX0sIG9yZGVyX2J5OiB7c3RhcnREYXRlVGltZTogYXNjfSkgeyBpZCB1c2VySWQgc3VtbWFyeSBzdGFydERhdGVUaW1lIGVuZERhdGVUaW1lIHRpbWV6b25lIH0gfWA7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBoYXN1cmFHb3RCcmVha2VyLmZpcmUoKCkgPT4gZ290LnBvc3QocHJvY2Vzcy5lbnYuSEFTVVJBX0VORFBPSU5UX1VSTCB8fCAnJywge1xuICAgICAganNvbjogeyBxdWVyeSwgdmFyaWFibGVzOiB7IHVzZXJJZCwgc3RhcnREYXRlLCBlbmREYXRlIH0gfSxcbiAgICAgIGhlYWRlcnM6IHsgJ3gtaGFzdXJhLWFkbWluLXNlY3JldCc6IHByb2Nlc3MuZW52LkhBU1VSQV9BRE1JTl9TRUNSRVQgfHwgJycgfSxcbiAgICAgIHJlc3BvbnNlVHlwZTogJ2pzb24nLFxuICAgICAgdGltZW91dDogeyByZXF1ZXN0OiAxMDAwMCB9LFxuICAgICAgcmV0cnk6IGRlZmF1bHRHb3RSZXRyeUNvbmZpZ1xuICAgIH0pKTtcbiAgICBjb25zdCBib2R5ID0gcmVzcG9uc2UuYm9keSBhcyBhbnk7XG4gICAgaWYgKGJvZHkuZXJyb3JzKSB7IC8qIGxvY2FsQXBpSGVscGVyTG9nZ2VyLmVycm9yKGBbJHtvcGVyYXRpb25fbmFtZX1dIEhhc3VyYSBlcnJvcnM6YCwge2RldGFpbHM6IGJvZHkuZXJyb3JzfSk7ICovIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnSGFzdXJhIEFQSSBlcnJvciBkdXJpbmcgbGlzdEV2ZW50c0ZvckRhdGUuJywgZGV0YWlsczogYm9keS5lcnJvcnMgfSB9OyB9XG4gICAgaWYgKCFib2R5LmRhdGEgfHwgIWJvZHkuZGF0YS5oYXNPd25Qcm9wZXJ0eSgnRXZlbnQnKSkgeyAvKiBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGBbJHtvcGVyYXRpb25fbmFtZX1dIFVuZXhwZWN0ZWQgcmVzcG9uc2U6YCwge2JvZHl9KTsgKi8gcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdVbmV4cGVjdGVkIHJlc3BvbnNlIHN0cnVjdHVyZSBkdXJpbmcgbGlzdEV2ZW50c0ZvckRhdGUuJywgZGV0YWlsczogYm9keSB9IH07IH1cbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBib2R5LmRhdGEuRXZlbnQgfHwgW10gfTtcbiAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZS5jb2RlID09PSAnRU9QRU5CUkVBS0VSJyA/IGBDaXJjdWl0IGJyZWFrZXIgJHtoYXN1cmFHb3RCcmVha2VyLm5hbWV9IGlzIG9wZW4uYCA6IGBOZXR3b3JrL3JlcXVlc3QgZXJyb3IgZHVyaW5nICR7b3BlcmF0aW9uX25hbWV9LmA7XG4gICAgLyogbG9jYWxBcGlIZWxwZXJMb2dnZXIuZXJyb3IoYFske29wZXJhdGlvbl9uYW1lfV0gRXJyb3I6ICR7ZXJyb3JNZXNzYWdlfWAsIHtlcnJvcl9tZXNzYWdlOiBlLm1lc3NhZ2UsIGVycm9yX2NvZGU6IGUuY29kZSwgcmF3X3Jlc3BvbnNlOiBlLnJlc3BvbnNlPy5ib2R5fSk7ICovXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6IGVycm9yTWVzc2FnZSwgZGV0YWlsczogZS5tZXNzYWdlLCByYXdSZXNwb25zZTogZS5yZXNwb25zZT8uYm9keSwgY29kZTogZS5jb2RlIH0gfTtcbiAgfVxufTtcbmV4cG9ydCBjb25zdCBsaXN0RXZlbnRzRm9yVXNlckdpdmVuRGF0ZXMgPSBhc3luYyAodXNlcklkOiBzdHJpbmcsIHNlbmRlclN0YXJ0RGF0ZTogc3RyaW5nLCBzZW5kZXJFbmREYXRlOiBzdHJpbmcpOiBQcm9taXNlPFN1Y2Nlc3NSZXNwb25zZVR5cGU8RXZlbnRUeXBlW10+IHwgRmFpbHVyZVJlc3BvbnNlVHlwZT4gPT4ge1xuICBjb25zdCBvcGVyYXRpb25fbmFtZSA9ICdIYXN1cmFMaXN0RXZlbnRzRm9yVXNlckdpdmVuRGF0ZXMnO1xuICBjb25zdCBxdWVyeSA9IGBxdWVyeSBMaXN0RXZlbnRzRm9yVXNlckdpdmVuRGF0ZXMoJHVzZXJJZDogU3RyaW5nISwgJHN0YXJ0RGF0ZTogdGltZXN0YW1wdHohLCAkZW5kRGF0ZTogdGltZXN0YW1wdHohKSB7IEV2ZW50KHdoZXJlOiB7dXNlcklkOiB7X2VxOiAkdXNlcklkfSwgc3RhcnREYXRlVGltZToge19ndGU6ICRzdGFydERhdGV9LCBlbmREYXRlVGltZToge19sdGU6ICRlbmREYXRlfSwgX29yOiBbe2lzRGVsZXRlZDoge19pc19udWxsOiB0cnVlfX0sIHtpc0RlbGV0ZWQ6IHtfZXE6IGZhbHNlfX1dfSwgb3JkZXJfYnk6IHtzdGFydERhdGVUaW1lOiBhc2N9KSB7IGlkIHVzZXJJZCBzdW1tYXJ5IHN0YXJ0RGF0ZVRpbWUgZW5kRGF0ZVRpbWUgdGltZXpvbmUgfSB9YDtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGhhc3VyYUdvdEJyZWFrZXIuZmlyZSgoKSA9PiBnb3QucG9zdChwcm9jZXNzLmVudi5IQVNVUkFfRU5EUE9JTlRfVVJMIHx8ICcnLCB7XG4gICAgICBqc29uOiB7IHF1ZXJ5LCB2YXJpYWJsZXM6IHsgdXNlcklkLCBzdGFydERhdGU6IHNlbmRlclN0YXJ0RGF0ZSwgZW5kRGF0ZTogc2VuZGVyRW5kRGF0ZSB9IH0sXG4gICAgICBoZWFkZXJzOiB7ICd4LWhhc3VyYS1hZG1pbi1zZWNyZXQnOiBwcm9jZXNzLmVudi5IQVNVUkFfQURNSU5fU0VDUkVUIHx8ICcnIH0sXG4gICAgICByZXNwb25zZVR5cGU6ICdqc29uJyxcbiAgICAgIHRpbWVvdXQ6IHsgcmVxdWVzdDogMTAwMDAgfSxcbiAgICAgIHJldHJ5OiBkZWZhdWx0R290UmV0cnlDb25maWdcbiAgICB9KSk7XG4gICAgY29uc3QgYm9keSA9IHJlc3BvbnNlLmJvZHkgYXMgYW55O1xuICAgIGlmIChib2R5LmVycm9ycykgeyAvKiBsb2NhbEFwaUhlbHBlckxvZ2dlci5lcnJvcihgWyR7b3BlcmF0aW9uX25hbWV9XSBIYXN1cmEgZXJyb3JzOmAsIHtkZXRhaWxzOiBib2R5LmVycm9yc30pOyAqLyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0hhc3VyYSBBUEkgZXJyb3IgZHVyaW5nIGxpc3RFdmVudHNGb3JVc2VyR2l2ZW5EYXRlcy4nLCBkZXRhaWxzOiBib2R5LmVycm9ycyB9IH07IH1cbiAgICBpZiAoIWJvZHkuZGF0YSB8fCAhYm9keS5kYXRhLmhhc093blByb3BlcnR5KCdFdmVudCcpKSB7IC8qIGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYFske29wZXJhdGlvbl9uYW1lfV0gVW5leHBlY3RlZCByZXNwb25zZTpgLCB7Ym9keX0pOyAqLyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ1VuZXhwZWN0ZWQgcmVzcG9uc2Ugc3RydWN0dXJlIGR1cmluZyBsaXN0RXZlbnRzRm9yVXNlckdpdmVuRGF0ZXMuJywgZGV0YWlsczogYm9keSB9IH07IH1cbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBib2R5LmRhdGEuRXZlbnQgfHwgW10gfTtcbiAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZS5jb2RlID09PSAnRU9QRU5CUkVBS0VSJyA/IGBDaXJjdWl0IGJyZWFrZXIgJHtoYXN1cmFHb3RCcmVha2VyLm5hbWV9IGlzIG9wZW4uYCA6IGBOZXR3b3JrL3JlcXVlc3QgZXJyb3IgZHVyaW5nICR7b3BlcmF0aW9uX25hbWV9LmA7XG4gICAgLyogbG9jYWxBcGlIZWxwZXJMb2dnZXIuZXJyb3IoYFske29wZXJhdGlvbl9uYW1lfV0gRXJyb3I6ICR7ZXJyb3JNZXNzYWdlfWAsIHtlcnJvcl9tZXNzYWdlOiBlLm1lc3NhZ2UsIGVycm9yX2NvZGU6IGUuY29kZSwgcmF3X3Jlc3BvbnNlOiBlLnJlc3BvbnNlPy5ib2R5fSk7ICovXG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6IGVycm9yTWVzc2FnZSwgZGV0YWlsczogZS5tZXNzYWdlLCByYXdSZXNwb25zZTogZS5yZXNwb25zZT8uYm9keSwgY29kZTogZS5jb2RlIH0gfTtcbiAgfVxufTtcbmV4cG9ydCBjb25zdCBnZXRVc2VyUHJlZmVyZW5jZXMgPSBhc3luYyAodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFN1Y2Nlc3NSZXNwb25zZVR5cGU8VXNlclByZWZlcmVuY2VUeXBlIHwgdW5kZWZpbmVkPiB8IEZhaWx1cmVSZXNwb25zZVR5cGU+ID0+IHtcbiAgY29uc3Qgb3BlcmF0aW9uX25hbWUgPSAnSGFzdXJhR2V0VXNlclByZWZlcmVuY2VzJztcbiAgY29uc3QgcXVlcnkgPSBgcXVlcnkgR2V0VXNlclByZWZlcmVuY2VzKCR1c2VySWQ6IFN0cmluZyEpIHsgVXNlcl9QcmVmZXJlbmNlcyh3aGVyZToge3VzZXJJZDoge19lcTogJHVzZXJJZH19LCBsaW1pdDogMSkgeyBpZCB1c2VySWQgc29tZVByZWZlcmVuY2Ugd29ya0hvdXJzU3RhcnRUaW1lIHdvcmtIb3Vyc0VuZFRpbWUgd29ya0RheXMgc2xvdER1cmF0aW9uIHRpbWV6b25lIGJ1ZmZlckJldHdlZW5NZWV0aW5ncyB9IH1gOyAvLyBBZGRlZCBtb3JlIGZpZWxkc1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaGFzdXJhR290QnJlYWtlci5maXJlKCgpID0+IGdvdC5wb3N0KHByb2Nlc3MuZW52LkhBU1VSQV9FTkRQT0lOVF9VUkwgfHwgJycsIHtcbiAgICAgIGpzb246IHsgcXVlcnksIHZhcmlhYmxlczogeyB1c2VySWQgfSB9LFxuICAgICAgaGVhZGVyczogeyAneC1oYXN1cmEtYWRtaW4tc2VjcmV0JzogcHJvY2Vzcy5lbnYuSEFTVVJBX0FETUlOX1NFQ1JFVCB8fCAnJyB9LFxuICAgICAgcmVzcG9uc2VUeXBlOiAnanNvbicsXG4gICAgICB0aW1lb3V0OiB7IHJlcXVlc3Q6IDEwMDAwIH0sXG4gICAgICByZXRyeTogZGVmYXVsdEdvdFJldHJ5Q29uZmlnXG4gICAgfSkpO1xuICAgIGNvbnN0IGJvZHkgPSByZXNwb25zZS5ib2R5IGFzIGFueTtcbiAgICBpZiAoYm9keS5lcnJvcnMpIHsgLyogbG9jYWxBcGlIZWxwZXJMb2dnZXIuZXJyb3IoYFske29wZXJhdGlvbl9uYW1lfV0gSGFzdXJhIGVycm9yczpgLCB7ZGV0YWlsczogYm9keS5lcnJvcnN9KTsgKi8gcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdIYXN1cmEgQVBJIGVycm9yIGR1cmluZyBnZXRVc2VyUHJlZmVyZW5jZXMuJywgZGV0YWlsczogYm9keS5lcnJvcnMgfSB9OyB9XG4gICAgaWYgKCFib2R5LmRhdGEgfHwgIWJvZHkuZGF0YS5oYXNPd25Qcm9wZXJ0eSgnVXNlcl9QcmVmZXJlbmNlcycpKSB7IC8qIGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYFske29wZXJhdGlvbl9uYW1lfV0gVW5leHBlY3RlZCByZXNwb25zZTpgLCB7Ym9keX0pOyAqLyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ1VuZXhwZWN0ZWQgcmVzcG9uc2Ugc3RydWN0dXJlIGR1cmluZyBnZXRVc2VyUHJlZmVyZW5jZXMuJywgZGV0YWlsczogYm9keSB9IH07IH1cbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBib2R5LmRhdGEuVXNlcl9QcmVmZXJlbmNlcz8uWzBdIH07XG4gIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGUuY29kZSA9PT0gJ0VPUEVOQlJFQUtFUicgPyBgQ2lyY3VpdCBicmVha2VyICR7aGFzdXJhR290QnJlYWtlci5uYW1lfSBpcyBvcGVuLmAgOiBgTmV0d29yay9yZXF1ZXN0IGVycm9yIGR1cmluZyAke29wZXJhdGlvbl9uYW1lfS5gO1xuICAgIC8qIGxvY2FsQXBpSGVscGVyTG9nZ2VyLmVycm9yKGBbJHtvcGVyYXRpb25fbmFtZX1dIEVycm9yOiAke2Vycm9yTWVzc2FnZX1gLCB7ZXJyb3JfbWVzc2FnZTogZS5tZXNzYWdlLCBlcnJvcl9jb2RlOiBlLmNvZGUsIHJhd19yZXNwb25zZTogZS5yZXNwb25zZT8uYm9keX0pOyAqL1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiBlcnJvck1lc3NhZ2UsIGRldGFpbHM6IGUubWVzc2FnZSwgcmF3UmVzcG9uc2U6IGUucmVzcG9uc2U/LmJvZHksIGNvZGU6IGUuY29kZSB9IH07XG4gIH1cbn07XG5leHBvcnQgY29uc3Qgc2VuZEFnZW5kYUVtYWlsID0gYXN5bmMgKHRvOiBzdHJpbmcsIG5hbWU6IHN0cmluZywgdGl0bGU6IHN0cmluZywgYm9keTogc3RyaW5nKTogUHJvbWlzZTxFbWFpbFJlc3BvbnNlPiA9PiB7IC8qIC4uLiAqL1xuICAvLyBOb3RlOiBzZW5kRW1haWwgaXRzZWxmIG5lZWRzIHJldHJ5IGxvZ2ljIGlmIGl0IG1ha2VzIG5ldHdvcmsgY2FsbHMuIEZvciBub3csIHRoaXMgd3JhcHBlciBkb2Vzbid0IGFkZCByZXRyaWVzLlxuICBjb25zdCBvcGVyYXRpb25fbmFtZSA9IFwiU2VuZEFnZW5kYUVtYWlsXCI7XG4gIHRyeSB7IGF3YWl0IHNlbmRFbWFpbCh7IHRlbXBsYXRlOiAnYWdlbmRhJywgbG9jYWxzOiB7IG5hbWUsIHRpdGxlLCBib2R5LCB0byB9LCBzdWJqZWN0OiBgWW91ciBNZWV0aW5nIEFnZW5kYTogJHt0aXRsZX1gLCB0byB9KTsgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9OyB9XG4gIGNhdGNoIChlOiBhbnkpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIuZXJyb3IoYEVycm9yIHNlbmRpbmcgYWdlbmRhIGVtYWlsIHRvICR7dG99OmAsIHsgZXJyb3I6IGUubWVzc2FnZSwgZGV0YWlsczogZSB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gc2VuZCBhZ2VuZGEgZW1haWwuJywgZGV0YWlsczogZS5tZXNzYWdlIH0gfTsgfVxufTtcbmV4cG9ydCBjb25zdCBzZW5kU3VtbWFyeUVtYWlsID0gYXN5bmMgKHRvOiBzdHJpbmcsIG5hbWU6IHN0cmluZywgdGl0bGU6IHN0cmluZywgc3VtbWFyeTogc3RyaW5nKTogUHJvbWlzZTxFbWFpbFJlc3BvbnNlPiA9PiB7IC8qIC4uLiAqL1xuICB0cnkgeyBhd2FpdCBzZW5kRW1haWwoeyB0ZW1wbGF0ZTogJ3N1bW1hcnknLCBsb2NhbHM6IHsgbmFtZSwgdGl0bGUsIHN1bW1hcnksIHRvIH0sIHN1YmplY3Q6IGBZb3VyIE1lZXRpbmcgU3VtbWFyeTogJHt0aXRsZX1gLCB0byB9KTsgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9OyB9XG4gIGNhdGNoIChlOiBhbnkpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIuZXJyb3IoYEVycm9yIHNlbmRpbmcgc3VtbWFyeSBlbWFpbCB0byAke3RvfTpgLCB7IGVycm9yOiBlLm1lc3NhZ2UsIGRldGFpbHM6IGUgfSk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnRmFpbGVkIHRvIHNlbmQgc3VtbWFyeSBlbWFpbC4nLCBkZXRhaWxzOiBlLm1lc3NhZ2UgfSB9OyB9XG59O1xuZXhwb3J0IGNvbnN0IGVtYWlsVGFza0JyZWFrRG93biA9IGFzeW5jICh0bzogc3RyaW5nLCBuYW1lOiBzdHJpbmcsIHRpdGxlOiBzdHJpbmcsIHRhc2tzOiBzdHJpbmcpOiBQcm9taXNlPEVtYWlsUmVzcG9uc2U+ID0+IHsgLyogLi4uICovXG4gIHRyeSB7IGF3YWl0IHNlbmRFbWFpbCh7IHRlbXBsYXRlOiAndGFza19icmVha2Rvd24nLCBsb2NhbHM6IHsgbmFtZSwgdGl0bGUsIHRhc2tzLCB0byB9LCBzdWJqZWN0OiBgWW91ciBUYXNrIEJyZWFrZG93biBmb3I6ICR7dGl0bGV9YCwgdG8gfSk7IHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTsgfVxuICBjYXRjaCAoZTogYW55KSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLmVycm9yKGBFcnJvciBzZW5kaW5nIHRhc2sgYnJlYWtkb3duIGVtYWlsIHRvICR7dG99OmAsIHsgZXJyb3I6IGUubWVzc2FnZSwgZGV0YWlsczogZSB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gc2VuZCB0YXNrIGJyZWFrZG93biBlbWFpbC4nLCBkZXRhaWxzOiBlLm1lc3NhZ2UgfSB9OyB9XG59O1xuZXhwb3J0IGNvbnN0IHNlbmRHZW5lcmljVGFza0VtYWlsID0gYXN5bmMgKHRvOiBzdHJpbmcsIG5hbWU6IHN0cmluZywgdGl0bGU6IHN0cmluZywgYm9keTogc3RyaW5nKTogUHJvbWlzZTxFbWFpbFJlc3BvbnNlPiA9PiB7IC8qIC4uLiAqL1xuICB0cnkgeyBhd2FpdCBzZW5kRW1haWwoeyB0ZW1wbGF0ZTogJ2dlbmVyaWNfdGFzaycsIGxvY2FsczogeyBuYW1lLCB0aXRsZSwgYm9keSwgdG8gfSwgc3ViamVjdDogdGl0bGUsIHRvIH0pOyByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07IH1cbiAgY2F0Y2ggKGU6IGFueSkgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci5lcnJvcihgRXJyb3Igc2VuZGluZyBnZW5lcmljIHRhc2sgZW1haWwgdG8gJHt0b306YCwgeyBlcnJvcjogZS5tZXNzYWdlLCBkZXRhaWxzOiBlIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBzZW5kIGdlbmVyaWMgdGFzayBlbWFpbC4nLCBkZXRhaWxzOiBlLm1lc3NhZ2UgfSB9OyB9XG59O1xuZXhwb3J0IGNvbnN0IHNlbmRNZWV0aW5nUmVxdWVzdFRlbXBsYXRlID0gYXN5bmMgKHRvOiBzdHJpbmcsIG5hbWU6IHN0cmluZywgdGl0bGU6IHN0cmluZywgYm9keTogc3RyaW5nLCB5ZXNMaW5rOiBzdHJpbmcsIG5vTGluazogc3RyaW5nKTogUHJvbWlzZTxFbWFpbFJlc3BvbnNlPiA9PiB7IC8qIC4uLiAqL1xuICB0cnkgeyBhd2FpdCBzZW5kRW1haWwoeyB0ZW1wbGF0ZTogJ21lZXRpbmdfcmVxdWVzdCcsIGxvY2FsczogeyBuYW1lLCB0aXRsZSwgYm9keSwgeWVzTGluaywgbm9MaW5rLCB0byB9LCBzdWJqZWN0OiBgTWVldGluZyBSZXF1ZXN0OiAke3RpdGxlfWAsIHRvIH0pOyByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07IH1cbiAgY2F0Y2ggKGU6IGFueSkgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci5lcnJvcihgRXJyb3Igc2VuZGluZyBtZWV0aW5nIHJlcXVlc3QgZW1haWwgdG8gJHt0b306YCwgeyBlcnJvcjogZS5tZXNzYWdlLCBkZXRhaWxzOiBlIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBzZW5kIG1lZXRpbmcgcmVxdWVzdCBlbWFpbC4nLCBkZXRhaWxzOiBlLm1lc3NhZ2UgfSB9OyB9XG59O1xuZXhwb3J0IGNvbnN0IGNyZWF0ZUFnZW5kYSA9IGFzeW5jICh1c2VySWQ6IHN0cmluZywgY2xpZW50VHlwZTogQ2FsZW5kYXJJbnRlZ3JhdGlvblR5cGVbJ2NsaWVudFR5cGUnXSwgdXNlclRpbWV6b25lOiBzdHJpbmcsIHVzZXJEYXRlOiBzdHJpbmcsIHByb21wdFZhbDogc3RyaW5nLCBlbWFpbD86IHN0cmluZywgbmFtZVZhbD86IHN0cmluZyk6IFByb21pc2U8R2VuZXJpY1N1Y2Nlc3NSZXNwb25zZSB8IEZhaWx1cmVSZXNwb25zZVR5cGU+ID0+IHsgLyogLi4uICovXG4gIGNvbnN0IG9wZXJhdGlvbk5hbWUgPSBcImNyZWF0ZUFnZW5kYVwiO1xuICB0cnkge1xuICAgIGNvbnN0IG9wZW5BSVJlcyA9IGF3YWl0IGNhbGxPcGVuQUkoYENyZWF0ZSBhZ2VuZGEgZm9yICR7dXNlckRhdGV9IGluICR7dXNlclRpbWV6b25lfS5gLCBwcm9tcHRWYWwpO1xuICAgIGlmICghb3BlbkFJUmVzLnN1Y2Nlc3MgfHwgIW9wZW5BSVJlcy5jb250ZW50KSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYCR7b3BlcmF0aW9uTmFtZX06IE9wZW5BSSBjYWxsIGZhaWxlZCBvciBubyBjb250ZW50LmAsIHsgdXNlcklkLCBlcnJvcjogb3BlbkFJUmVzLmVycm9yIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBjcmVhdGUgYWdlbmRhIGR1ZSB0byBPcGVuQUkgY2FsbCBmYWlsZWQgb3Igbm8gY29udGVudC4nLCBkZXRhaWxzOiBvcGVuQUlSZXMuZXJyb3IgfSB9OyB9XG4gICAgY29uc3QgYWdlbmRhU3VtID0gXCJHZW5lcmF0ZWQgQWdlbmRhIEV2ZW50XCI7IGNvbnN0IGFnZW5kYURlc2MgPSBvcGVuQUlSZXMuY29udGVudDtcbiAgICBjb25zdCBnQ2FsUmVzID0gYXdhaXQgZ2V0R2xvYmFsQ2FsZW5kYXIodXNlcklkKTtcbiAgICBpZiAoIWdDYWxSZXMuc3VjY2VzcyB8fCAhZ0NhbFJlcy5kYXRhPy5wcmltYXJ5Q2FsZW5kYXJJZCkgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGAke29wZXJhdGlvbk5hbWV9OiBHbG9iYWxDYWxlbmRhciByZXRyaWV2YWwgZmFpbGVkLmAsIHsgdXNlcklkLCBlcnJvcjogZ0NhbFJlcy5lcnJvciB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gY3JlYXRlIGFnZW5kYSBkdWUgdG8gZ2xvYmFsIGNhbGVuZGFyIHJldHJpZXZhbCBmYWlsdXJlLicsIGRldGFpbHM6IGdDYWxSZXMuZXJyb3IgfSB9OyB9XG4gICAgY29uc3Qgc3RhcnREVCA9IGRheWpzLnR6KGAke3VzZXJEYXRlfVQwOTowMDowMGAsIHVzZXJUaW1lem9uZSkudG9JU09TdHJpbmcoKTsgY29uc3QgZW5kRFQgPSBkYXlqcy50eihgJHt1c2VyRGF0ZX1UMTA6MDA6MDBgLCB1c2VyVGltZXpvbmUpLnRvSVNPU3RyaW5nKCk7XG4gICAgY29uc3QgY3JlYXRlR0V2ZW50UmVzID0gYXdhaXQgY3JlYXRlR29vZ2xlRXZlbnQodXNlcklkLCBnQ2FsUmVzLmRhdGEucHJpbWFyeUNhbGVuZGFySWQsIGNsaWVudFR5cGUsIGFnZW5kYVN1bSwgc3RhcnREVCwgZW5kRFQsIHVzZXJUaW1lem9uZSwgYWdlbmRhRGVzYyk7XG4gIGlmICghY3JlYXRlR0V2ZW50UmVzLnN1Y2Nlc3MpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIud2FybihgJHtvcGVyYXRpb25OYW1lfTogR29vZ2xlIGV2ZW50IGNyZWF0aW9uIGZhaWxlZC5gLCB7IHVzZXJJZCwgZXJyb3I6IGNyZWF0ZUdFdmVudFJlcy5lcnJvciB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gY3JlYXRlIGFnZW5kYSBkdWUgdG8gR29vZ2xlIGV2ZW50IGNyZWF0aW9uIGZhaWx1cmUuJywgZGV0YWlsczogY3JlYXRlR0V2ZW50UmVzLmVycm9yIH0gfTsgfVxuICAgIGNvbnN0IGV2ZW50VG9VcHNlcnQ6IEV2ZW50SW5wdXQgPSB7IHVzZXJJZCwgY2FsZW5kYXJJZDogZ0NhbFJlcy5kYXRhLmlkLCBnRXZlbnRJZDogY3JlYXRlR0V2ZW50UmVzLmRhdGEuZ29vZ2xlRXZlbnRJZCwgc3VtbWFyeTogYWdlbmRhU3VtLCBkZXNjcmlwdGlvbjogYWdlbmRhRGVzYywgc3RhcnREYXRlVGltZTogc3RhcnREVCwgZW5kRGF0ZVRpbWU6IGVuZERULCB0aW1lem9uZTogdXNlclRpbWV6b25lLCBwcm92aWRlcjogJ2dvb2dsZV9jYWxlbmRhcicsIHN0YXR1czogJ2NvbmZpcm1lZCcgfTtcbiAgICBjb25zdCB1cHNlcnRSZXMgPSBhd2FpdCB1cHNlcnRFdmVudHNQb3N0UGxhbm5lcihbZXZlbnRUb1Vwc2VydF0pO1xuICBpZiAoIXVwc2VydFJlcy5zdWNjZXNzKSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYCR7b3BlcmF0aW9uTmFtZX06IERhdGFiYXNlIGV2ZW50IHVwc2VydCBmYWlsZWQuYCwgeyB1c2VySWQsIGVycm9yOiB1cHNlcnRSZXMuZXJyb3IgfSk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0ZSBhZ2VuZGEgZHVlIHRvIGRhdGFiYXNlIGV2ZW50IHVwc2VydCBmYWlsdXJlLicsIGRldGFpbHM6IHVwc2VydFJlcy5lcnJvciB9IH07IH1cbiAgICBpZiAoZW1haWwgJiYgbmFtZVZhbCkge1xuICAgICAgY29uc3QgZW1haWxSZXMgPSBhd2FpdCBzZW5kQWdlbmRhRW1haWwoZW1haWwsIG5hbWVWYWwsIFwiWW91ciBHZW5lcmF0ZWQgQWdlbmRhXCIsIGFnZW5kYURlc2MpO1xuICAgICAgaWYgKCFlbWFpbFJlcy5zdWNjZXNzKSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYCR7b3BlcmF0aW9uTmFtZX06IEVtYWlsIHNlbmRpbmcgZmFpbGVkLmAsIHsgdXNlcklkLCBlbWFpbCwgZXJyb3I6IGVtYWlsUmVzLmVycm9yIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBjcmVhdGUgYWdlbmRhIGR1ZSB0byBlbWFpbCBzZW5kaW5nIGZhaWx1cmUuJywgZGV0YWlsczogZW1haWxSZXMuZXJyb3IgfSB9OyB9XG4gICAgfVxuICAgIGxvY2FsQXBpSGVscGVyTG9nZ2VyLmluZm8oYCR7b3BlcmF0aW9uTmFtZX06IFN1Y2Nlc3NmdWxseSBjcmVhdGVkIGFnZW5kYS5gLCB7IHVzZXJJZCB9KTtcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gIH0gY2F0Y2ggKGU6IGFueSkgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci5lcnJvcihgVW5leHBlY3RlZCBlcnJvciBpbiAke29wZXJhdGlvbk5hbWV9OmAsIHsgdXNlcklkLCBlcnJvcjogZS5tZXNzYWdlLCBkZXRhaWxzOiBlIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogYFVuZXhwZWN0ZWQgZXJyb3IgZHVyaW5nICR7b3BlcmF0aW9uTmFtZX0uYCwgZGV0YWlsczogZS5tZXNzYWdlIH0gfTsgfVxufTtcbmV4cG9ydCBjb25zdCBjcmVhdGVTdW1tYXJ5T2ZUaW1lUGVyaW9kID0gYXN5bmMgKHVzZXJJZDogc3RyaW5nLCBzdGFydERhdGU6IHN0cmluZywgZW5kRGF0ZTogc3RyaW5nLCB0aW1lem9uZTogc3RyaW5nLCBlbWFpbD86IHN0cmluZywgbmFtZT86IHN0cmluZyk6IFByb21pc2U8U3VjY2Vzc1Jlc3BvbnNlVHlwZTxzdHJpbmc+IHwgRmFpbHVyZVJlc3BvbnNlVHlwZT4gPT4geyAvKiAuLi4gKi9cbiAgY29uc3Qgb3BlcmF0aW9uTmFtZSA9IFwiY3JlYXRlU3VtbWFyeU9mVGltZVBlcmlvZFwiO1xuICB0cnkge1xuICAgIGNvbnN0IGV2ZW50c1Jlc3VsdCA9IGF3YWl0IGxpc3RFdmVudHNGb3JEYXRlKHVzZXJJZCwgc3RhcnREYXRlLCBlbmREYXRlLCB0aW1lem9uZSk7XG4gICAgaWYgKCFldmVudHNSZXN1bHQuc3VjY2VzcykgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGAke29wZXJhdGlvbk5hbWV9OiBsaXN0RXZlbnRzRm9yRGF0ZSBmYWlsZWQuYCwgeyB1c2VySWQsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSwgZXJyb3I6IGV2ZW50c1Jlc3VsdC5lcnJvciB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gY3JlYXRlIHN1bW1hcnkgZHVlIHRvIGV2ZW50IGxpc3RpbmcgZmFpbHVyZS4nLCBkZXRhaWxzOiBldmVudHNSZXN1bHQuZXJyb3IgfSB9OyB9XG4gICAgaWYgKCFldmVudHNSZXN1bHQuZGF0YSB8fCBldmVudHNSZXN1bHQuZGF0YS5sZW5ndGggPT09IDApIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIuaW5mbyhgJHtvcGVyYXRpb25OYW1lfTogTm8gZXZlbnRzIGZvdW5kIHRvIHN1bW1hcml6ZS5gLCB7IHVzZXJJZCwgc3RhcnREYXRlLCBlbmREYXRlIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ05vIGV2ZW50cyBmb3VuZCB0byBzdW1tYXJpemUuJyB9IH07IH1cbiAgICBjb25zdCBldmVudHNUZXh0ID0gZXZlbnRzUmVzdWx0LmRhdGEubWFwKGV2ZW50ID0+IGAke2V2ZW50LnN1bW1hcnl9IChmcm9tICR7ZXZlbnQuc3RhcnREYXRlVGltZX0gdG8gJHtldmVudC5lbmREYXRlVGltZX0pYCkuam9pbignXFxuJyk7XG4gICAgY29uc3QgcHJvbXB0ID0gYFN1bW1hcml6ZSB0aGUgZm9sbG93aW5nIGV2ZW50cyB0aGF0IG9jY3VycmVkIGJldHdlZW4gJHtzdGFydERhdGV9IGFuZCAke2VuZERhdGV9OlxcbiR7ZXZlbnRzVGV4dH1gO1xuICAgIGNvbnN0IG9wZW5BSVJlc3VsdCA9IGF3YWl0IGNhbGxPcGVuQUkoXCJZb3UgYXJlIGFuIGFzc2lzdGFudCB0aGF0IHN1bW1hcml6ZXMgYSBsaXN0IG9mIGNhbGVuZGFyIGV2ZW50cy5cIiwgcHJvbXB0KTtcbiAgICBpZiAoIW9wZW5BSVJlc3VsdC5zdWNjZXNzIHx8ICFvcGVuQUlSZXN1bHQuY29udGVudCkgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGAke29wZXJhdGlvbk5hbWV9OiBjYWxsT3BlbkFJIGZhaWxlZC5gLCB7IHVzZXJJZCwgZXJyb3I6IG9wZW5BSVJlc3VsdC5lcnJvciB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gY3JlYXRlIHN1bW1hcnkgZHVlIHRvIE9wZW5BSSBjYWxsIGZhaWx1cmUuJywgZGV0YWlsczogb3BlbkFJUmVzdWx0LmVycm9yIH0gfTsgfVxuICAgIGNvbnN0IHN1bW1hcnlUZXh0ID0gb3BlbkFJUmVzdWx0LmNvbnRlbnQ7XG4gICAgaWYgKGVtYWlsICYmIG5hbWUpIHtcbiAgICAgIGNvbnN0IGVtYWlsUmVzdWx0ID0gYXdhaXQgc2VuZFN1bW1hcnlFbWFpbChlbWFpbCwgbmFtZSwgYFN1bW1hcnkgZm9yICR7c3RhcnREYXRlfSB0byAke2VuZERhdGV9YCwgc3VtbWFyeVRleHQpO1xuICAgICAgaWYgKCFlbWFpbFJlc3VsdC5zdWNjZXNzKSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYCR7b3BlcmF0aW9uTmFtZX06IHNlbmRTdW1tYXJ5RW1haWwgZmFpbGVkLmAsIHsgdXNlcklkLCBlbWFpbCwgZXJyb3I6IGVtYWlsUmVzdWx0LmVycm9yIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBzZW5kIHN1bW1hcnkgZW1haWwuJywgZGV0YWlsczogZW1haWxSZXN1bHQuZXJyb3IgfSB9OyB9XG4gICAgfVxuICAgIGxvY2FsQXBpSGVscGVyTG9nZ2VyLmluZm8oYCR7b3BlcmF0aW9uTmFtZX06IFN1Y2Nlc3NmdWxseSBjcmVhdGVkIHN1bW1hcnkuYCwgeyB1c2VySWQsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSB9KTtcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBzdW1tYXJ5VGV4dCB9O1xuICB9IGNhdGNoIChlOiBhbnkpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIuZXJyb3IoYFVuZXhwZWN0ZWQgZXJyb3IgaW4gJHtvcGVyYXRpb25OYW1lfTpgLCB7IHVzZXJJZCwgZXJyb3I6IGUubWVzc2FnZSwgZGV0YWlsczogZSB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6IGBVbmV4cGVjdGVkIGVycm9yIGR1cmluZyAke29wZXJhdGlvbk5hbWV9LmAsIGRldGFpbHM6IGUubWVzc2FnZSB9IH07IH1cbn07XG5jb25zdCBjcmVhdGVFdmVudEhlbHBlciA9IGFzeW5jICh1c2VySWQ6IHN0cmluZywgY2xpZW50VHlwZTogQ2FsZW5kYXJJbnRlZ3JhdGlvblR5cGVbJ2NsaWVudFR5cGUnXSwgdXNlclRpbWV6b25lOiBzdHJpbmcsIGV2ZW50U3VtbWFyeTogc3RyaW5nLCBldmVudERlc2NyaXB0aW9uOiBzdHJpbmcgfCB1bmRlZmluZWQsIHN0YXJ0RGF0ZVRpbWU6IHN0cmluZywgZW5kRGF0ZVRpbWU6IHN0cmluZywgaXNBbGxEYXk6IGJvb2xlYW4pOiBQcm9taXNlPENyZWF0ZUdvb2dsZUV2ZW50UmVzcG9uc2U+ID0+IHsgLyogLi4uICovXG4gICAgY29uc3Qgb3BlcmF0aW9uTmFtZSA9IFwiY3JlYXRlRXZlbnRIZWxwZXJcIjtcbiAgICBjb25zdCBnbG9iYWxDYWxSZXN1bHQgPSBhd2FpdCBnZXRHbG9iYWxDYWxlbmRhcih1c2VySWQpO1xuICAgIGlmICghZ2xvYmFsQ2FsUmVzdWx0LnN1Y2Nlc3MgfHwgIWdsb2JhbENhbFJlc3VsdC5kYXRhPy5wcmltYXJ5Q2FsZW5kYXJJZCkgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGAke29wZXJhdGlvbk5hbWV9OiBHbG9iYWxDYWxlbmRhciByZXRyaWV2YWwgZmFpbGVkLmAsIHsgdXNlcklkLCBlcnJvcjogZ2xvYmFsQ2FsUmVzdWx0LmVycm9yIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0dsb2JhbCBjYWxlbmRhciByZXRyaWV2YWwgZmFpbGVkIGZvciBldmVudCBjcmVhdGlvbi4nLCBkZXRhaWxzOiBnbG9iYWxDYWxSZXN1bHQuZXJyb3IgfSB9OyB9XG4gICAgY29uc3QgY2FsZW5kYXJJZFRvVXNlID0gZ2xvYmFsQ2FsUmVzdWx0LmRhdGEucHJpbWFyeUNhbGVuZGFySWQ7XG4gICAgbGV0IGV2ZW50U3RhcnREVCA9IHN0YXJ0RGF0ZVRpbWU7IGxldCBldmVudEVuZERUID0gZW5kRGF0ZVRpbWU7XG4gICAgaWYoaXNBbGxEYXkpIHsgZXZlbnRTdGFydERUID0gZGF5anMoc3RhcnREYXRlVGltZSkuZm9ybWF0KCdZWVlZLU1NLUREJyk7IGV2ZW50RW5kRFQgPSBkYXlqcyhlbmREYXRlVGltZSkuYWRkKDEsICdkYXknKS5mb3JtYXQoJ1lZWVktTU0tREQnKTsgfVxuICAgIHJldHVybiBjcmVhdGVHb29nbGVFdmVudCh1c2VySWQsIGNhbGVuZGFySWRUb1VzZSwgY2xpZW50VHlwZSwgZXZlbnRTdW1tYXJ5LCBldmVudFN0YXJ0RFQsIGV2ZW50RW5kRFQsIHVzZXJUaW1lem9uZSwgZXZlbnREZXNjcmlwdGlvbik7XG59O1xuZXhwb3J0IGNvbnN0IGJyZWFrRG93blRhc2sgPSBhc3luYyAodXNlcklkOiBzdHJpbmcsIGNsaWVudFR5cGU6IENhbGVuZGFySW50ZWdyYXRpb25UeXBlWydjbGllbnRUeXBlJ10sIHVzZXJUaW1lem9uZTogc3RyaW5nLCB0YXNrVGl0bGU6IHN0cmluZywgdGFza0Rlc2NyaXB0aW9uOiBzdHJpbmcsIGlzQWxsRGF5OiBib29sZWFuLCBzdGFydERhdGU6IHN0cmluZywgZW5kRGF0ZTogc3RyaW5nLCBlbWFpbD86IHN0cmluZywgbmFtZT86IHN0cmluZyk6IFByb21pc2U8R2VuZXJpY1N1Y2Nlc3NSZXNwb25zZSB8IEZhaWx1cmVSZXNwb25zZVR5cGU+ID0+IHsgLyogLi4uICovXG4gIGNvbnN0IG9wZXJhdGlvbk5hbWUgPSBcImJyZWFrRG93blRhc2tcIjtcbiAgdHJ5IHtcbiAgICBjb25zdCBvcGVuQUlSZXN1bHQgPSBhd2FpdCBjYWxsT3BlbkFJKFwiWW91IGFyZSBhbiBhc3Npc3RhbnQgdGhhdCBicmVha3MgZG93biBhIHRhc2sgaW50byBzbWFsbGVyIHN1Yi1ldmVudHMgZm9yIGEgY2FsZW5kYXIuXCIsIGBCcmVhayBkb3duIHRoZSB0YXNrOiBcIiR7dGFza1RpdGxlfVwiIChEZXNjcmlwdGlvbjogJHt0YXNrRGVzY3JpcHRpb259KSBpbnRvIHNtYWxsZXIgY2FsZW5kYXIgZXZlbnRzLiBNYWluIHRhc2sgaXMgZnJvbSAke3N0YXJ0RGF0ZX0gdG8gJHtlbmREYXRlfSAoaXNBbGxEYXk6ICR7aXNBbGxEYXl9KS5gKTtcbiAgICBpZiAoIW9wZW5BSVJlc3VsdC5zdWNjZXNzIHx8ICFvcGVuQUlSZXN1bHQuY29udGVudCkgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGAke29wZXJhdGlvbk5hbWV9OiBPcGVuQUkgY2FsbCBmYWlsZWQuYCwgeyB1c2VySWQsIHRhc2tUaXRsZSwgZXJyb3I6IG9wZW5BSVJlc3VsdC5lcnJvciB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdPcGVuQUkgY2FsbCBmYWlsZWQgZHVyaW5nIHRhc2sgYnJlYWtkb3duLicsIGRldGFpbHM6IG9wZW5BSVJlc3VsdC5lcnJvciB9IH07IH1cbiAgICBjb25zdCBicmVha2Rvd25UZXh0ID0gb3BlbkFJUmVzdWx0LmNvbnRlbnQ7XG4gICAgY29uc3QgY3JlYXRlRXZlbnRSZXMgPSBhd2FpdCBjcmVhdGVFdmVudEhlbHBlcih1c2VySWQsIGNsaWVudFR5cGUsIHVzZXJUaW1lem9uZSwgdGFza1RpdGxlLCBicmVha2Rvd25UZXh0LCBzdGFydERhdGUsIGVuZERhdGUsIGlzQWxsRGF5KTtcbiAgICBpZiAoIWNyZWF0ZUV2ZW50UmVzLnN1Y2Nlc3MpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIud2FybihgJHtvcGVyYXRpb25OYW1lfTogR29vZ2xlIGV2ZW50IGNyZWF0aW9uIGZhaWxlZC5gLCB7IHVzZXJJZCwgdGFza1RpdGxlLCBlcnJvcjogY3JlYXRlRXZlbnRSZXMuZXJyb3IgfSk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnR29vZ2xlIGV2ZW50IGNyZWF0aW9uIGZhaWxlZCBmb3IgdGFzayBicmVha2Rvd24uJywgZGV0YWlsczogY3JlYXRlRXZlbnRSZXMuZXJyb3IgfSB9OyB9XG4gICAgY29uc3QgZ2xvYmFsQ2FsID0gYXdhaXQgZ2V0R2xvYmFsQ2FsZW5kYXIodXNlcklkKTsgaWYoIWdsb2JhbENhbC5zdWNjZXNzIHx8ICFnbG9iYWxDYWwuZGF0YT8uaWQpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIud2FybihgJHtvcGVyYXRpb25OYW1lfTogZ2V0R2xvYmFsQ2FsZW5kYXIgZm9yIERCIElEIGZhaWxlZC5gLCB7IHVzZXJJZCwgdGFza1RpdGxlLCBlcnJvcjogZ2xvYmFsQ2FsLmVycm9yIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBnZXQgZ2xvYmFsIGNhbGVuZGFyIElEIGZvciBEQiB1cHNlcnQuJywgZGV0YWlsczogZ2xvYmFsQ2FsLmVycm9yIH0gfTsgfVxuICAgIGNvbnN0IGV2ZW50VG9VcHNlcnQ6IEV2ZW50SW5wdXQgPSB7IHVzZXJJZCwgY2FsZW5kYXJJZDogZ2xvYmFsQ2FsLmRhdGEuaWQsIGdFdmVudElkOiBjcmVhdGVFdmVudFJlcy5kYXRhLmdvb2dsZUV2ZW50SWQsIHN1bW1hcnk6IHRhc2tUaXRsZSwgZGVzY3JpcHRpb246IGJyZWFrZG93blRleHQsIHN0YXJ0RGF0ZVRpbWU6IHN0YXJ0RGF0ZSwgZW5kRGF0ZVRpbWU6IGVuZERhdGUsIHRpbWV6b25lOiB1c2VyVGltZXpvbmUsIHByb3ZpZGVyOiAnZ29vZ2xlX2NhbGVuZGFyJywgc3RhdHVzOiAnY29uZmlybWVkJyB9O1xuICAgIGNvbnN0IHVwc2VydFJlcyA9IGF3YWl0IHVwc2VydEV2ZW50c1Bvc3RQbGFubmVyKFtldmVudFRvVXBzZXJ0XSk7XG4gICAgaWYgKCF1cHNlcnRSZXMuc3VjY2VzcykgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGAke29wZXJhdGlvbk5hbWV9OiBEYXRhYmFzZSBldmVudCB1cHNlcnQgZmFpbGVkLmAsIHsgdXNlcklkLCB0YXNrVGl0bGUsIGVycm9yOiB1cHNlcnRSZXMuZXJyb3IgfSk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnRGF0YWJhc2UgZXZlbnQgdXBzZXJ0IGZhaWxlZCBmb3IgdGFzayBicmVha2Rvd24uJywgZGV0YWlsczogdXBzZXJ0UmVzLmVycm9yIH0gfTsgfVxuICAgIGlmIChlbWFpbCAmJiBuYW1lKSB7XG4gICAgICBjb25zdCBlbWFpbFJlcyA9IGF3YWl0IGVtYWlsVGFza0JyZWFrRG93bihlbWFpbCwgbmFtZSwgdGFza1RpdGxlLCBicmVha2Rvd25UZXh0KTtcbiAgICAgIGlmICghZW1haWxSZXMuc3VjY2VzcykgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGAke29wZXJhdGlvbk5hbWV9OiBFbWFpbCBzZW5kaW5nIGZhaWxlZC5gLCB7IHVzZXJJZCwgZW1haWwsIHRhc2tUaXRsZSwgZXJyb3I6IGVtYWlsUmVzLmVycm9yIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0VtYWlsIHNlbmRpbmcgZmFpbGVkIGZvciB0YXNrIGJyZWFrZG93bi4nLCBkZXRhaWxzOiBlbWFpbFJlcy5lcnJvciB9IH07IH1cbiAgICB9XG4gICAgbG9jYWxBcGlIZWxwZXJMb2dnZXIuaW5mbyhgJHtvcGVyYXRpb25OYW1lfTogU3VjY2Vzc2Z1bGx5IGJyb2tlIGRvd24gdGFzay5gLCB7IHVzZXJJZCwgdGFza1RpdGxlIH0pO1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgfSBjYXRjaCAoZTogYW55KSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLmVycm9yKGBVbmV4cGVjdGVkIGVycm9yIGluICR7b3BlcmF0aW9uTmFtZX06YCwgeyB1c2VySWQsIHRhc2tUaXRsZSwgZXJyb3I6IGUubWVzc2FnZSwgZGV0YWlsczogZSB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6IGBVbmV4cGVjdGVkIGVycm9yIGR1cmluZyAke29wZXJhdGlvbk5hbWV9LmAsIGRldGFpbHM6IGUubWVzc2FnZSB9IH07IH1cbn07XG5leHBvcnQgY29uc3QgaG93VG9UYXNrID0gYXN5bmMgKHVzZXJJZDogc3RyaW5nLCBjbGllbnRUeXBlOiBDYWxlbmRhckludGVncmF0aW9uVHlwZVsnY2xpZW50VHlwZSddLCB1c2VyVGltZXpvbmU6IHN0cmluZywgdGFza1RpdGxlOiBzdHJpbmcsIGlzQWxsRGF5OiBib29sZWFuLCBzdGFydERhdGU6IHN0cmluZywgZW5kRGF0ZTogc3RyaW5nLCBlbWFpbD86IHN0cmluZywgbmFtZT86IHN0cmluZyk6IFByb21pc2U8R2VuZXJpY1N1Y2Nlc3NSZXNwb25zZSB8IEZhaWx1cmVSZXNwb25zZVR5cGU+ID0+IHsgLyogLi4uICovXG4gIGNvbnN0IG9wZXJhdGlvbk5hbWUgPSBcImhvd1RvVGFza1wiO1xuICB0cnkge1xuICAgIGNvbnN0IG9wZW5BSVJlc3VsdCA9IGF3YWl0IGNhbGxPcGVuQUkoXCJZb3UgYXJlIGFuIGFzc2lzdGFudCB0aGF0IHByb3ZpZGVzIGluc3RydWN0aW9ucyBvbiBob3cgdG8gY29tcGxldGUgYSB0YXNrIGFuZCBzY2hlZHVsZXMgaXQuXCIsIGBQcm92aWRlIGluc3RydWN0aW9ucyBmb3IgdGFzazogXCIke3Rhc2tUaXRsZX1cIi4gU2NoZWR1bGUgaXQgZnJvbSAke3N0YXJ0RGF0ZX0gdG8gJHtlbmREYXRlfSAoaXNBbGxEYXk6ICR7aXNBbGxEYXl9KS5gKTtcbiAgICBpZiAoIW9wZW5BSVJlc3VsdC5zdWNjZXNzIHx8ICFvcGVuQUlSZXN1bHQuY29udGVudCkgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGAke29wZXJhdGlvbk5hbWV9OiBPcGVuQUkgY2FsbCBmYWlsZWQuYCwgeyB1c2VySWQsIHRhc2tUaXRsZSwgZXJyb3I6IG9wZW5BSVJlc3VsdC5lcnJvciB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdPcGVuQUkgY2FsbCBmYWlsZWQgZm9yIGhvdy10byB0YXNrLicsIGRldGFpbHM6IG9wZW5BSVJlc3VsdC5lcnJvciB9IH07IH1cbiAgICBjb25zdCBob3dUb0NvbnRlbnQgPSBvcGVuQUlSZXN1bHQuY29udGVudDtcbiAgICBjb25zdCBjcmVhdGVFdmVudFJlcyA9IGF3YWl0IGNyZWF0ZUV2ZW50SGVscGVyKHVzZXJJZCwgY2xpZW50VHlwZSwgdXNlclRpbWV6b25lLCBgSG93IHRvOiAke3Rhc2tUaXRsZX1gLCBob3dUb0NvbnRlbnQsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSwgaXNBbGxEYXkpO1xuICAgIGlmICghY3JlYXRlRXZlbnRSZXMuc3VjY2VzcykgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGAke29wZXJhdGlvbk5hbWV9OiBHb29nbGUgZXZlbnQgY3JlYXRpb24gZmFpbGVkLmAsIHsgdXNlcklkLCB0YXNrVGl0bGUsIGVycm9yOiBjcmVhdGVFdmVudFJlcy5lcnJvciB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdHb29nbGUgZXZlbnQgY3JlYXRpb24gZmFpbGVkIGZvciBob3ctdG8gdGFzay4nLCBkZXRhaWxzOiBjcmVhdGVFdmVudFJlcy5lcnJvciB9IH07IH1cbiAgICBjb25zdCBnbG9iYWxDYWwgPSBhd2FpdCBnZXRHbG9iYWxDYWxlbmRhcih1c2VySWQpOyBpZighZ2xvYmFsQ2FsLnN1Y2Nlc3MgfHwgIWdsb2JhbENhbC5kYXRhPy5pZCkgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGAke29wZXJhdGlvbk5hbWV9OiBnZXRHbG9iYWxDYWxlbmRhciBmb3IgREIgSUQgZmFpbGVkLmAsIHsgdXNlcklkLCB0YXNrVGl0bGUsIGVycm9yOiBnbG9iYWxDYWwuZXJyb3IgfSk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGdldCBnbG9iYWwgY2FsZW5kYXIgSUQgZm9yIERCIHVwc2VydCAoaG93LXRvKS4nLCBkZXRhaWxzOiBnbG9iYWxDYWwuZXJyb3IgfSB9OyB9XG4gICAgY29uc3QgZXZlbnRUb1Vwc2VydDogRXZlbnRJbnB1dCA9IHsgdXNlcklkLCBjYWxlbmRhcklkOiBnbG9iYWxDYWwuZGF0YS5pZCwgZ0V2ZW50SWQ6IGNyZWF0ZUV2ZW50UmVzLmRhdGEuZ29vZ2xlRXZlbnRJZCwgc3VtbWFyeTogYEhvdyB0bzogJHt0YXNrVGl0bGV9YCwgZGVzY3JpcHRpb246IGhvd1RvQ29udGVudCwgc3RhcnREYXRlVGltZTogc3RhcnREYXRlLCBlbmREYXRlVGltZTogZW5kRGF0ZSwgdGltZXpvbmU6IHVzZXJUaW1lem9uZSwgcHJvdmlkZXI6ICdnb29nbGVfY2FsZW5kYXInLCBzdGF0dXM6ICdjb25maXJtZWQnIH07XG4gICAgY29uc3QgdXBzZXJ0UmVzID0gYXdhaXQgdXBzZXJ0RXZlbnRzUG9zdFBsYW5uZXIoW2V2ZW50VG9VcHNlcnRdKTtcbiAgICBpZiAoIXVwc2VydFJlcy5zdWNjZXNzKSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYCR7b3BlcmF0aW9uTmFtZX06IERhdGFiYXNlIGV2ZW50IHVwc2VydCBmYWlsZWQuYCwgeyB1c2VySWQsIHRhc2tUaXRsZSwgZXJyb3I6IHVwc2VydFJlcy5lcnJvciB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdEYXRhYmFzZSBldmVudCB1cHNlcnQgZmFpbGVkIGZvciBob3ctdG8gdGFzay4nLCBkZXRhaWxzOiB1cHNlcnRSZXMuZXJyb3IgfSB9OyB9XG4gICAgaWYgKGVtYWlsICYmIG5hbWUpIHtcbiAgICAgIGNvbnN0IGVtYWlsUmVzID0gYXdhaXQgc2VuZEdlbmVyaWNUYXNrRW1haWwoZW1haWwsIG5hbWUsIGBJbnN0cnVjdGlvbnMgZm9yOiAke3Rhc2tUaXRsZX1gLCBob3dUb0NvbnRlbnQpO1xuICAgICAgaWYgKCFlbWFpbFJlcy5zdWNjZXNzKSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYCR7b3BlcmF0aW9uTmFtZX06IEVtYWlsIHNlbmRpbmcgZmFpbGVkLmAsIHsgdXNlcklkLCBlbWFpbCwgdGFza1RpdGxlLCBlcnJvcjogZW1haWxSZXMuZXJyb3IgfSk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnRW1haWwgc2VuZGluZyBmYWlsZWQgZm9yIGhvdy10byB0YXNrLicsIGRldGFpbHM6IGVtYWlsUmVzLmVycm9yIH0gfTsgfVxuICAgIH1cbiAgICBsb2NhbEFwaUhlbHBlckxvZ2dlci5pbmZvKGAke29wZXJhdGlvbk5hbWV9OiBTdWNjZXNzZnVsbHkgcHJvY2Vzc2VkIGhvdy10byB0YXNrLmAsIHsgdXNlcklkLCB0YXNrVGl0bGUgfSk7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICB9IGNhdGNoIChlOiBhbnkpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIuZXJyb3IoYFVuZXhwZWN0ZWQgZXJyb3IgaW4gJHtvcGVyYXRpb25OYW1lfTpgLCB7IHVzZXJJZCwgdGFza1RpdGxlLCBlcnJvcjogZS5tZXNzYWdlLCBkZXRhaWxzOiBlIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogYFVuZXhwZWN0ZWQgZXJyb3IgZHVyaW5nICR7b3BlcmF0aW9uTmFtZX0uYCwgZGV0YWlsczogZS5tZXNzYWdlIH0gfTsgfVxufTtcbmV4cG9ydCBjb25zdCBtZWV0aW5nUmVxdWVzdCA9IGFzeW5jICh1c2VySWQ6IHN0cmluZywgY2xpZW50VHlwZTogQ2FsZW5kYXJJbnRlZ3JhdGlvblR5cGVbJ2NsaWVudFR5cGUnXSwgdXNlclRpbWV6b25lOiBzdHJpbmcsIHVzZXJEYXRlQ29udGV4dDogc3RyaW5nLCBhdHRlbmRlZXM6IHN0cmluZywgc3ViamVjdDogc3RyaW5nLCBwcm9tcHRWYWw6IHN0cmluZywgZHVyYXRpb25NaW51dGVzOiBudW1iZXIsIHNoYXJlQXZhaWxhYmlsaXR5OiBib29sZWFuLCBhdmFpbGFiaWxpdHlVc2VyRGF0ZVN0YXJ0Pzogc3RyaW5nLCBhdmFpbGFiaWxpdHlVc2VyRGF0ZUVuZD86IHN0cmluZywgZW1haWxUbz86IHN0cmluZywgZW1haWxOYW1lPzogc3RyaW5nLCB5ZXNMaW5rPzogc3RyaW5nLCBub0xpbms/OiBzdHJpbmcpOiBQcm9taXNlPEdlbmVyaWNTdWNjZXNzUmVzcG9uc2UgfCBGYWlsdXJlUmVzcG9uc2VUeXBlPiA9PiB7IC8qIC4uLiAqL1xuICAgIGNvbnN0IG9wZXJhdGlvbk5hbWUgPSBcIm1lZXRpbmdSZXF1ZXN0XCI7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IGF2YWlsYWJpbGl0eVN1bW1hcnkgPSBcIk5vdCBhcHBsaWNhYmxlLlwiO1xuICAgICAgICBpZiAoc2hhcmVBdmFpbGFiaWxpdHkpIHtcbiAgICAgICAgICAgIGlmICghYXZhaWxhYmlsaXR5VXNlckRhdGVTdGFydCB8fCAhYXZhaWxhYmlsaXR5VXNlckRhdGVFbmQpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiBcIkF2YWlsYWJpbGl0eSBzdGFydCBhbmQgZW5kIGRhdGVzIGFyZSByZXF1aXJlZCB3aGVuIHNoYXJlQXZhaWxhYmlsaXR5IGlzIHRydWUuXCIgfSB9OyAvLyBObyBsb2dnZXIgbmVlZGVkLCB2YWxpZGF0aW9uIGVycm9yXG4gICAgICAgICAgICBjb25zdCBnZW5BdmFpbFJlcyA9IGF3YWl0IGdlbmVyYXRlQXZhaWxhYmlsaXR5KHVzZXJJZCwgYXZhaWxhYmlsaXR5VXNlckRhdGVTdGFydCwgYXZhaWxhYmlsaXR5VXNlckRhdGVFbmQsIHVzZXJUaW1lem9uZSAvKiwgY2xpZW50VHlwZSAtIGNsaWVudFR5cGUgbm90IHVzZWQgYnkgZ2VuZXJhdGVBdmFpbGFiaWxpdHkgZGlyZWN0bHkgKi8pO1xuICAgICAgICAgICAgaWYgKCFnZW5BdmFpbFJlcy5zdWNjZXNzKSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYCR7b3BlcmF0aW9uTmFtZX06IGdlbmVyYXRlQXZhaWxhYmlsaXR5IGZhaWxlZC5gLCB7IHVzZXJJZCwgc3ViamVjdCwgZXJyb3I6IGdlbkF2YWlsUmVzLmVycm9yIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBnZW5lcmF0ZSBhdmFpbGFiaWxpdHkuJywgZGV0YWlsczogZ2VuQXZhaWxSZXMuZXJyb3IgfSB9OyB9XG4gICAgICAgICAgICBpZiAoIWdlbkF2YWlsUmVzLmRhdGEgfHwgZ2VuQXZhaWxSZXMuZGF0YS5sZW5ndGggPT09IDApIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIuaW5mbyhgJHtvcGVyYXRpb25OYW1lfTogTm8gYXZhaWxhYmlsaXR5IHNsb3RzIGZvdW5kLmAsIHsgdXNlcklkLCBzdWJqZWN0IH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ05vIGF2YWlsYWJpbGl0eSBzbG90cyBmb3VuZCB0byBzaGFyZS4nIH0gfTsgfVxuICAgICAgICAgICAgY29uc3Qgc2xvdHNCeURhdGUgPSBfLmdyb3VwQnkoZ2VuQXZhaWxSZXMuZGF0YSwgc2xvdCA9PiBkYXlqcyhzbG90LnN0YXJ0RGF0ZSkudHoodXNlclRpbWV6b25lKS5mb3JtYXQoJ1lZWVktTU0tREQnKSk7XG4gICAgICAgICAgICBsZXQgZGFpbHlTdW1tYXJpZXM6IHN0cmluZ1tdID0gW107XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGRhdGUgaW4gc2xvdHNCeURhdGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzbG90cyA9IHNsb3RzQnlEYXRlW2RhdGVdLm1hcChzbG90ID0+IGAke2RheWpzKHNsb3Quc3RhcnREYXRlKS50eih1c2VyVGltZXpvbmUpLmZvcm1hdCgnaDptbSBBJyl9IC0gJHtkYXlqcyhzbG90LmVuZERhdGUpLnR6KHVzZXJUaW1lem9uZSkuZm9ybWF0KCdoOm1tIEEnKX1gKS5qb2luKCcsICcpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRhaWx5U3VtbWFyeVJlcyA9IGF3YWl0IGNhbGxPcGVuQUkoXCJTdW1tYXJpemUgZGFpbHkgYXZhaWxhYmlsaXR5LlwiLCBgU3VtbWFyaXplIHRoZXNlIGF2YWlsYWJpbGl0eSBzbG90cyBmb3IgJHtkYXRlfTogJHtzbG90c31gKTtcbiAgICAgICAgICAgICAgICBpZiAoIWRhaWx5U3VtbWFyeVJlcy5zdWNjZXNzIHx8ICFkYWlseVN1bW1hcnlSZXMuY29udGVudCkgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGAke29wZXJhdGlvbk5hbWV9OiBPcGVuQUkgZGFpbHkgc3VtbWFyeSBmYWlsZWQgZm9yIGRhdGUgJHtkYXRlfS5gLCB7IHVzZXJJZCwgc3ViamVjdCwgZGF0ZSwgZXJyb3I6IGRhaWx5U3VtbWFyeVJlcy5lcnJvciB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6IGBGYWlsZWQgdG8gc3VtbWFyaXplIGF2YWlsYWJpbGl0eSBmb3IgZGF0ZSAke2RhdGV9LmAsIGRldGFpbHM6IGRhaWx5U3VtbWFyeVJlcy5lcnJvciB9IH07IH1cbiAgICAgICAgICAgICAgICBkYWlseVN1bW1hcmllcy5wdXNoKGRhaWx5U3VtbWFyeVJlcy5jb250ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChkYWlseVN1bW1hcmllcy5sZW5ndGggPT09IDApIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIuaW5mbyhgJHtvcGVyYXRpb25OYW1lfTogTm8gYXZhaWxhYmlsaXR5IHNsb3RzIGFmdGVyIHByb2Nlc3NpbmcuYCwgeyB1c2VySWQsIHN1YmplY3QgfSk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnTm8gYXZhaWxhYmlsaXR5IHNsb3RzIGZvdW5kIGFmdGVyIHByb2Nlc3NpbmcuJyB9IH07IH1cbiAgICAgICAgICAgIGNvbnN0IGNvbWJpbmVkU3VtbWFyeVJlcyA9IGF3YWl0IGNhbGxPcGVuQUkoXCJDb21iaW5lIGRhaWx5IGF2YWlsYWJpbGl0eSBzdW1tYXJpZXMuXCIsIGBDb21iaW5lIHRoZXNlIGRhaWx5IGF2YWlsYWJpbGl0eSBzdW1tYXJpZXM6XFxuJHtkYWlseVN1bW1hcmllcy5qb2luKCdcXG4nKX1gKTtcbiAgICAgICAgICAgIGlmICghY29tYmluZWRTdW1tYXJ5UmVzLnN1Y2Nlc3MgfHwgIWNvbWJpbmVkU3VtbWFyeVJlcy5jb250ZW50KSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYCR7b3BlcmF0aW9uTmFtZX06IE9wZW5BSSBjb21iaW5lZCBzdW1tYXJ5IGZhaWxlZC5gLCB7IHVzZXJJZCwgc3ViamVjdCwgZXJyb3I6IGNvbWJpbmVkU3VtbWFyeVJlcy5lcnJvciB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gZ2VuZXJhdGUgY29tYmluZWQgYXZhaWxhYmlsaXR5IHN1bW1hcnkuJywgZGV0YWlsczogY29tYmluZWRTdW1tYXJ5UmVzLmVycm9yIH0gfTsgfVxuICAgICAgICAgICAgYXZhaWxhYmlsaXR5U3VtbWFyeSA9IGNvbWJpbmVkU3VtbWFyeVJlcy5jb250ZW50O1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGVtYWlsRHJhZnRQcm9tcHQgPSBgRHJhZnQgYSBtZWV0aW5nIHJlcXVlc3QgZW1haWwuIFN1YmplY3Q6ICR7c3ViamVjdH0gQXR0ZW5kZWVzOiAke2F0dGVuZGVlc30gVXNlcidzIHJlcXVlc3Q6ICR7cHJvbXB0VmFsfSBNZWV0aW5nIGR1cmF0aW9uOiAke2R1cmF0aW9uTWludXRlc30gbWludXRlcy4gQ29udGV4dHVhbCB1c2VyIGRhdGU6ICR7dXNlckRhdGVDb250ZXh0fS4gVXNlcidzIHRpbWV6b25lOiAke3VzZXJUaW1lem9uZX0uICR7c2hhcmVBdmFpbGFiaWxpdHkgPyBgSW5jbHVkZSB0aGlzIGF2YWlsYWJpbGl0eTogJHthdmFpbGFiaWxpdHlTdW1tYXJ5fWAgOiBcIkFzayBmb3IgdGhlaXIgYXZhaWxhYmlsaXR5LlwifSBQb2xpdGUsIGNsZWFyIGNhbGwgdG8gYWN0aW9uLiBQbGFjZWhvbGRlcnMgZm9yIHJlc3BvbnNlIGxpbmtzIGlmIGFwcGxpY2FibGUuYDtcbiAgICAgICAgY29uc3QgZW1haWxCb2R5UmVzID0gYXdhaXQgY2FsbE9wZW5BSShcIkRyYWZ0IGEgbWVldGluZyByZXF1ZXN0IGVtYWlsLlwiLCBlbWFpbERyYWZ0UHJvbXB0KTtcbiAgICAgICAgaWYgKCFlbWFpbEJvZHlSZXMuc3VjY2VzcyB8fCAhZW1haWxCb2R5UmVzLmNvbnRlbnQpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIud2FybihgJHtvcGVyYXRpb25OYW1lfTogT3BlbkFJIGVtYWlsIGRyYWZ0IGZhaWxlZC5gLCB7IHVzZXJJZCwgc3ViamVjdCwgZXJyb3I6IGVtYWlsQm9keVJlcy5lcnJvciB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gZHJhZnQgbWVldGluZyByZXF1ZXN0IGVtYWlsIGJvZHkuJywgZGV0YWlsczogZW1haWxCb2R5UmVzLmVycm9yIH0gfTsgfVxuICAgICAgICBpZiAoZW1haWxUbyAmJiBlbWFpbE5hbWUgJiYgeWVzTGluayAmJiBub0xpbmspIHtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRFbWFpbFJlcyA9IGF3YWl0IHNlbmRNZWV0aW5nUmVxdWVzdFRlbXBsYXRlKGVtYWlsVG8sIGVtYWlsTmFtZSwgc3ViamVjdCwgZW1haWxCb2R5UmVzLmNvbnRlbnQsIHllc0xpbmssIG5vTGluayk7XG4gICAgICAgICAgICBpZiAoIXNlbmRFbWFpbFJlcy5zdWNjZXNzKSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYCR7b3BlcmF0aW9uTmFtZX06IHNlbmRNZWV0aW5nUmVxdWVzdFRlbXBsYXRlIGZhaWxlZC5gLCB7IHVzZXJJZCwgZW1haWxUbywgc3ViamVjdCwgZXJyb3I6IHNlbmRFbWFpbFJlcy5lcnJvciB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gc2VuZCBtZWV0aW5nIHJlcXVlc3QgZW1haWwuJywgZGV0YWlsczogc2VuZEVtYWlsUmVzLmVycm9yIH0gfTsgfVxuICAgICAgICB9IGVsc2UgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci5pbmZvKGAke29wZXJhdGlvbk5hbWV9OiBFbWFpbCByZWNpcGllbnQgZGV0YWlscyBub3QgcHJvdmlkZWQsIGVtYWlsIG5vdCBzZW50LmAsIHsgdXNlcklkLCBzdWJqZWN0LCBkcmFmdGVkQm9keTogZW1haWxCb2R5UmVzLmNvbnRlbnQgfSk7IH1cbiAgICAgICAgbG9jYWxBcGlIZWxwZXJMb2dnZXIuaW5mbyhgJHtvcGVyYXRpb25OYW1lfTogU3VjY2Vzc2Z1bGx5IHByb2Nlc3NlZCBtZWV0aW5nIHJlcXVlc3QuYCwgeyB1c2VySWQsIHN1YmplY3QsIGVtYWlsU2VudDogISEoZW1haWxUbyAmJiBlbWFpbE5hbWUpIH0pO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZTogYW55KSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLmVycm9yKGBVbmV4cGVjdGVkIGVycm9yIGluICR7b3BlcmF0aW9uTmFtZX06YCwgeyB1c2VySWQsIHN1YmplY3QsIGVycm9yOiBlLm1lc3NhZ2UsIGRldGFpbHM6IGUgfSk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiBgVW5leHBlY3RlZCBlcnJvciBkdXJpbmcgJHtvcGVyYXRpb25OYW1lfS5gLCBkZXRhaWxzOiBlLm1lc3NhZ2UgfSB9OyB9XG59O1xuZXhwb3J0IGNvbnN0IGNyZWF0ZURheVNjaGVkdWxlID0gYXN5bmMgKCB1c2VySWQ6IHN0cmluZywgY2xpZW50VHlwZTogQ2FsZW5kYXJJbnRlZ3JhdGlvblR5cGVbJ2NsaWVudFR5cGUnXSwgdXNlckRhdGU6IHN0cmluZywgdXNlclRpbWV6b25lOiBzdHJpbmcsIHByb21wdDogc3RyaW5nLCBpc0FsbERheTogYm9vbGVhbiwgZW1haWw/OiBzdHJpbmcsIG5hbWU/OiBzdHJpbmcgKTogUHJvbWlzZTxHZW5lcmljU3VjY2Vzc1Jlc3BvbnNlIHwgRmFpbHVyZVJlc3BvbnNlVHlwZT4gPT4geyAvKiAuLi4gKi9cbiAgY29uc3Qgb3BlcmF0aW9uTmFtZSA9IFwiY3JlYXRlRGF5U2NoZWR1bGVcIjtcbiAgdHJ5IHtcbiAgICBjb25zdCBkYXlTdGFydCA9IGRheWpzLnR6KHVzZXJEYXRlLCB1c2VyVGltZXpvbmUpLnN0YXJ0T2YoJ2RheScpLnRvSVNPU3RyaW5nKCk7IGNvbnN0IGRheUVuZCA9IGRheWpzLnR6KHVzZXJEYXRlLCB1c2VyVGltZXpvbmUpLmVuZE9mKCdkYXknKS50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IGV4aXN0aW5nRXZlbnRzUmVzID0gYXdhaXQgbGlzdEV2ZW50c0ZvclVzZXJHaXZlbkRhdGVzKHVzZXJJZCwgZGF5U3RhcnQsIGRheUVuZCk7XG4gICAgaWYgKCFleGlzdGluZ0V2ZW50c1Jlcy5zdWNjZXNzKSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYCR7b3BlcmF0aW9uTmFtZX06IGxpc3RFdmVudHNGb3JVc2VyR2l2ZW5EYXRlcyBmYWlsZWQuYCwgeyB1c2VySWQsIHVzZXJEYXRlLCBlcnJvcjogZXhpc3RpbmdFdmVudHNSZXMuZXJyb3IgfSk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGxpc3QgZXhpc3RpbmcgZXZlbnRzIGZvciBzY2hlZHVsZSBjb250ZXh0LicsIGRldGFpbHM6IGV4aXN0aW5nRXZlbnRzUmVzLmVycm9yIH0gfTsgfVxuICAgIGNvbnN0IGV4aXN0aW5nRXZlbnRzVGV4dCA9IGV4aXN0aW5nRXZlbnRzUmVzLmRhdGEubWFwKGUgPT4gYCR7ZS5zdW1tYXJ5fSBmcm9tICR7ZGF5anMoZS5zdGFydERhdGVUaW1lKS50eih1c2VyVGltZXpvbmUpLmZvcm1hdCgnaDptbSBBJyl9IHRvICR7ZGF5anMoZS5lbmREYXRlVGltZSkudHoodXNlclRpbWV6b25lKS5mb3JtYXQoJ2g6bW0gQScpfWApLmpvaW4oJ1xcbicpIHx8IFwiTm8gZXhpc3RpbmcgZXZlbnRzIHNjaGVkdWxlZC5cIjtcbiAgICBjb25zdCBvcGVuQUlQcm9tcHQgPSBgR2l2ZW4gdGhlIHVzZXIncyByZXF1ZXN0OiBcIiR7cHJvbXB0fVwiLCBhbmQgdGhlaXIgZXhpc3Rpbmcgc2NoZWR1bGUgZm9yICR7dXNlckRhdGV9IGluICR7dXNlclRpbWV6b25lfTpcXG4ke2V4aXN0aW5nRXZlbnRzVGV4dH1cXG5cXG5DcmVhdGUgYSBzY2hlZHVsZSBvZiBuZXcgdGFza3MgYXMgYSBKU09OIGFycmF5LiBFYWNoIHRhc2sgb2JqZWN0IHNob3VsZCBoYXZlIFwic3RhcnRfdGltZVwiIChlLmcuLCBcIjk6MDAgQU1cIiksIFwiZW5kX3RpbWVcIiAoZS5nLiwgXCIxMDozMCBBTVwiKSwgXCJ0YXNrXCIgKHN1bW1hcnkpLCBhbmQgb3B0aW9uYWxseSBcImRlc2NyaXB0aW9uXCIuIEVuc3VyZSBuZXcgdGFza3MgZG8gbm90IG92ZXJsYXAgd2l0aCBleGlzdGluZyBldmVudHMgdW5sZXNzIHRoZSBwcm9tcHQgZXhwbGljaXRseSBhc2tzIHRvIHJlcGxhY2Ugb3IgbW9kaWZ5IHRoZW0uIEZvciBhbiBhbGwtZGF5IHNjaGVkdWxlLCB0aGUgdGFza3Mgc2hvdWxkIGNvbGxlY3RpdmVseSByZXByZXNlbnQgdGhlIGRheSdzIHBsYW4gd2l0aG91dCBzcGVjaWZpYyB0aW1lcywganVzdCBhIGxpc3Qgb2YgdGFza3MgYW5kIGRlc2NyaXB0aW9ucy4gVGhpcyBpcyBhbiAke2lzQWxsRGF5ID8gJ2FsbC1kYXknIDogJ2l0ZW1pemVkIHRpbWUnfSBzY2hlZHVsZS5gO1xuICAgIGNvbnN0IG9wZW5BSVJlc3BvbnNlID0gYXdhaXQgY2FsbE9wZW5BSShcIllvdSBhcmUgYSBzY2hlZHVsaW5nIGFzc2lzdGFudC5cIiwgb3BlbkFJUHJvbXB0KTtcbiAgICBpZiAoIW9wZW5BSVJlc3BvbnNlLnN1Y2Nlc3MgfHwgIW9wZW5BSVJlc3BvbnNlLmNvbnRlbnQpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIud2FybihgJHtvcGVyYXRpb25OYW1lfTogY2FsbE9wZW5BSSBmYWlsZWQuYCwgeyB1c2VySWQsIHVzZXJEYXRlLCBlcnJvcjogb3BlbkFJUmVzcG9uc2UuZXJyb3IgfSk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGdlbmVyYXRlIHNjaGVkdWxlIHZpYSBPcGVuQUkuJywgZGV0YWlsczogb3BlbkFJUmVzcG9uc2UuZXJyb3IgfSB9OyB9XG4gICAgbGV0IHBhcnNlZFRhc2tzOiBQYXJzZWRTY2hlZHVsZVRhc2tbXTtcbiAgICB0cnkgeyBwYXJzZWRUYXNrcyA9IEpTT04ucGFyc2Uob3BlbkFJUmVzcG9uc2UuY29udGVudCk7IH1cbiAgICBjYXRjaCAoZTogYW55KSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLmVycm9yKGAke29wZXJhdGlvbk5hbWV9OiBGYWlsZWQgdG8gcGFyc2UgT3BlbkFJIHJlc3BvbnNlIGFzIEpTT04uYCwgeyB1c2VySWQsIHVzZXJEYXRlLCBlcnJvcjogZS5tZXNzYWdlLCByYXdSZXNwb25zZTogb3BlbkFJUmVzcG9uc2UuY29udGVudCwgZGV0YWlsczogZSB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gcGFyc2Ugc2NoZWR1bGUgZnJvbSBPcGVuQUkgcmVzcG9uc2UgYXMgSlNPTi4nLCBkZXRhaWxzOiBlLm1lc3NhZ2UsIHJhd1Jlc3BvbnNlOiBvcGVuQUlSZXNwb25zZS5jb250ZW50IH0gfTsgfVxuICAgIGlmICghQXJyYXkuaXNBcnJheShwYXJzZWRUYXNrcykpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIud2FybihgJHtvcGVyYXRpb25OYW1lfTogT3BlbkFJIHJlc3BvbnNlIGlzIG5vdCBhIHZhbGlkIGFycmF5LmAsIHsgdXNlcklkLCB1c2VyRGF0ZSwgcGFyc2VkUmVzcG9uc2U6IHBhcnNlZFRhc2tzIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ09wZW5BSSBzY2hlZHVsZSByZXNwb25zZSBpcyBub3QgYSB2YWxpZCBhcnJheS4nLCBwYXJzZWRSZXNwb25zZTogcGFyc2VkVGFza3MgfSB9OyB9XG4gICAgaWYgKHBhcnNlZFRhc2tzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgbG9jYWxBcGlIZWxwZXJMb2dnZXIuaW5mbyhgJHtvcGVyYXRpb25OYW1lfTogTm8gbmV3IHRhc2tzIHBhcnNlZCBmcm9tIE9wZW5BSSByZXNwb25zZS5gLCB7IHVzZXJJZCwgdXNlckRhdGUgfSk7XG4gICAgICBpZiAoZW1haWwgJiYgbmFtZSkgeyBjb25zdCBlbWFpbFJlc3VsdCA9IGF3YWl0IHNlbmRHZW5lcmljVGFza0VtYWlsKGVtYWlsLCBuYW1lLCBgWW91ciBTY2hlZHVsZSBmb3IgJHt1c2VyRGF0ZX1gLCBcIk5vIG5ldyB0YXNrcyB3ZXJlIHNjaGVkdWxlZCBiYXNlZCBvbiB5b3VyIHJlcXVlc3QgYW5kIGN1cnJlbnQgY2FsZW5kYXIuXCIpOyBpZiAoIWVtYWlsUmVzdWx0LnN1Y2Nlc3MpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIud2FybihgJHtvcGVyYXRpb25OYW1lfTogRmFpbGVkIHRvIHNlbmQgbm8tdGFza3MgZW1haWwuYCwgeyB1c2VySWQsIHVzZXJEYXRlLCBlbWFpbCwgZXJyb3I6IGVtYWlsUmVzdWx0LmVycm9yIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBzZW5kIHNjaGVkdWxlIHVwZGF0ZSBlbWFpbCAobm8gbmV3IHRhc2tzKS4nLCBkZXRhaWxzOiBlbWFpbFJlc3VsdC5lcnJvciB9IH07IH0gfVxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH1cbiAgICBjb25zdCBnbG9iYWxDYWxlbmRhclJlc3VsdCA9IGF3YWl0IGdldEdsb2JhbENhbGVuZGFyKHVzZXJJZCk7XG4gICAgaWYgKCFnbG9iYWxDYWxlbmRhclJlc3VsdC5zdWNjZXNzIHx8ICFnbG9iYWxDYWxlbmRhclJlc3VsdC5kYXRhPy5wcmltYXJ5Q2FsZW5kYXJJZCB8fCAhZ2xvYmFsQ2FsZW5kYXJSZXN1bHQuZGF0YT8uaWQpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIud2FybihgJHtvcGVyYXRpb25OYW1lfTogRmFpbGVkIHRvIGdldCBnbG9iYWwgY2FsZW5kYXIuYCwgeyB1c2VySWQsIHVzZXJEYXRlLCBlcnJvcjogZ2xvYmFsQ2FsZW5kYXJSZXN1bHQuZXJyb3IgfSk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGdldCBnbG9iYWwgY2FsZW5kYXIgZm9yIHNjaGVkdWxpbmcuJywgZGV0YWlsczogZ2xvYmFsQ2FsZW5kYXJSZXN1bHQuZXJyb3IgfSB9OyB9XG4gICAgY29uc3QgeyBwcmltYXJ5Q2FsZW5kYXJJZDogZ29vZ2xlQ2FsZW5kYXJJZEZvckV2ZW50cywgaWQ6IGRiQ2FsZW5kYXJJZCB9ID0gZ2xvYmFsQ2FsZW5kYXJSZXN1bHQuZGF0YTtcbiAgICBjb25zdCBldmVudHNUb1Vwc2VydDogRXZlbnRJbnB1dFtdID0gW107XG4gICAgaWYgKGlzQWxsRGF5KSB7XG4gICAgICBjb25zdCBhbGxEYXlUYXNrU3VtbWFyeSA9IGBEYXkgU2NoZWR1bGU6ICR7cHJvbXB0LnN1YnN0cmluZygwLCA1MCl9JHtwcm9tcHQubGVuZ3RoID4gNTAgPyAnLi4uJyA6ICcnfWA7IGNvbnN0IGFsbERheVRhc2tEZXNjcmlwdGlvbiA9IHBhcnNlZFRhc2tzLm1hcCh0YXNrID0+IGAke3Rhc2sudGFza30ke3Rhc2suZGVzY3JpcHRpb24gPyBgOlxcbiR7dGFzay5kZXNjcmlwdGlvbn1gIDogJyd9YCkuam9pbignXFxuXFxuLS0tXFxuXFxuJyk7XG4gICAgICBjb25zdCBhbGxEYXlTdGFydERhdGUgPSBkYXlqcy50eih1c2VyRGF0ZSwgdXNlclRpbWV6b25lKS5zdGFydE9mKCdkYXknKS5mb3JtYXQoJ1lZWVktTU0tREQnKTsgY29uc3QgYWxsRGF5RW5kRGF0ZSA9IGRheWpzLnR6KHVzZXJEYXRlLCB1c2VyVGltZXpvbmUpLmFkZCgxLCAnZGF5Jykuc3RhcnRPZignZGF5JykuZm9ybWF0KCdZWVlZLU1NLUREJyk7XG4gICAgICBjb25zdCBjcmVhdGVFdmVudFJlcyA9IGF3YWl0IGNyZWF0ZUdvb2dsZUV2ZW50KHVzZXJJZCwgZ29vZ2xlQ2FsZW5kYXJJZEZvckV2ZW50cywgY2xpZW50VHlwZSwgYWxsRGF5VGFza1N1bW1hcnksIGFsbERheVN0YXJ0RGF0ZSwgYWxsRGF5RW5kRGF0ZSwgdXNlclRpbWV6b25lLCBhbGxEYXlUYXNrRGVzY3JpcHRpb24pO1xuICAgICAgaWYgKCFjcmVhdGVFdmVudFJlcy5zdWNjZXNzKSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYCR7b3BlcmF0aW9uTmFtZX06IEZhaWxlZCB0byBjcmVhdGUgYWxsLWRheSBHb29nbGUgZXZlbnQuYCwgeyB1c2VySWQsIHVzZXJEYXRlLCBlcnJvcjogY3JlYXRlRXZlbnRSZXMuZXJyb3IgfSk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0ZSBhbGwtZGF5IEdvb2dsZSBDYWxlbmRhciBldmVudC4nLCBkZXRhaWxzOiBjcmVhdGVFdmVudFJlcy5lcnJvciB9IH07IH1cbiAgICAgIGV2ZW50c1RvVXBzZXJ0LnB1c2goeyB1c2VySWQsIGNhbGVuZGFySWQ6IGRiQ2FsZW5kYXJJZCwgZ0V2ZW50SWQ6IGNyZWF0ZUV2ZW50UmVzLmRhdGEuZ29vZ2xlRXZlbnRJZCwgc3VtbWFyeTogYWxsRGF5VGFza1N1bW1hcnksIGRlc2NyaXB0aW9uOiBhbGxEYXlUYXNrRGVzY3JpcHRpb24sIHN0YXJ0RGF0ZVRpbWU6IGFsbERheVN0YXJ0RGF0ZSwgZW5kRGF0ZVRpbWU6IGFsbERheUVuZERhdGUsIHRpbWV6b25lOiB1c2VyVGltZXpvbmUsIHByb3ZpZGVyOiAnZ29vZ2xlX2NhbGVuZGFyJywgc3RhdHVzOiAnY29uZmlybWVkJyB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgZm9yIChjb25zdCB0YXNrIG9mIHBhcnNlZFRhc2tzKSB7XG4gICAgICAgIGNvbnN0IHRhc2tTdGFydCA9IGRheWpzLnR6KGAke3VzZXJEYXRlfSAke3Rhc2suc3RhcnRfdGltZX1gLCAnWVlZWS1NTS1ERCBoOm1tIEEnLCB1c2VyVGltZXpvbmUpOyBjb25zdCB0YXNrRW5kID0gZGF5anMudHooYCR7dXNlckRhdGV9ICR7dGFzay5lbmRfdGltZX1gLCAnWVlZWS1NTS1ERCBoOm1tIEEnLCB1c2VyVGltZXpvbmUpO1xuICAgICAgICBpZiAoIXRhc2tTdGFydC5pc1ZhbGlkKCkgfHwgIXRhc2tFbmQuaXNWYWxpZCgpKSB7IGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYCR7b3BlcmF0aW9uTmFtZX06IEludmFsaWQgdGltZSBmb3JtYXQgZm9yIHRhc2sgXCIke3Rhc2sudGFza31cImAsIHsgdXNlcklkLCB1c2VyRGF0ZSwgdGFzayB9KTsgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6IGBJbnZhbGlkIHRpbWUgZm9ybWF0IGZvciB0YXNrIFwiJHt0YXNrLnRhc2t9XCIuIFBsZWFzZSB1c2UgSEg6TU0gQU0vUE0uYCwgZGV0YWlsczogeyB0YXNrIH0gfX07IH1cbiAgICAgICAgY29uc3Qgc3RhcnREYXRlVGltZSA9IHRhc2tTdGFydC50b0lTT1N0cmluZygpOyBjb25zdCBlbmREYXRlVGltZSA9IHRhc2tFbmQudG9JU09TdHJpbmcoKTtcbiAgICAgICAgY29uc3Qgb3ZlcmxhcHMgPSBleGlzdGluZ0V2ZW50c1Jlcy5kYXRhLnNvbWUoZXhpc3RpbmdFdmVudCA9PiBkYXlqcyhzdGFydERhdGVUaW1lKS5pc0JlZm9yZShkYXlqcyhleGlzdGluZ0V2ZW50LmVuZERhdGVUaW1lKSkgJiYgZGF5anMoZW5kRGF0ZVRpbWUpLmlzQWZ0ZXIoZGF5anMoZXhpc3RpbmdFdmVudC5zdGFydERhdGVUaW1lKSkpO1xuICAgICAgICBpZiAob3ZlcmxhcHMpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIuaW5mbyhgJHtvcGVyYXRpb25OYW1lfTogVGFzayBcIiR7dGFzay50YXNrfVwiIG92ZXJsYXBzLiBTa2lwcGluZy5gLCB7IHVzZXJJZCwgdXNlckRhdGUsIHRhc2sgfSk7IGNvbnRpbnVlOyB9XG4gICAgICAgIGNvbnN0IGNyZWF0ZUV2ZW50UmVzID0gYXdhaXQgY3JlYXRlR29vZ2xlRXZlbnQodXNlcklkLCBnb29nbGVDYWxlbmRhcklkRm9yRXZlbnRzLCBjbGllbnRUeXBlLCB0YXNrLnRhc2ssIHN0YXJ0RGF0ZVRpbWUsIGVuZERhdGVUaW1lLCB1c2VyVGltZXpvbmUsIHRhc2suZGVzY3JpcHRpb24pO1xuICAgICAgICBpZiAoIWNyZWF0ZUV2ZW50UmVzLnN1Y2Nlc3MpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIud2FybihgJHtvcGVyYXRpb25OYW1lfTogRmFpbGVkIHRvIGNyZWF0ZSBHb29nbGUgZXZlbnQgZm9yIHRhc2suYCwgeyB1c2VySWQsIHVzZXJEYXRlLCB0YXNrLCBlcnJvcjogY3JlYXRlRXZlbnRSZXMuZXJyb3IgfSk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiBgRmFpbGVkIHRvIGNyZWF0ZSBHb29nbGUgQ2FsZW5kYXIgZXZlbnQgZm9yIHRhc2s6IFwiJHt0YXNrLnRhc2t9XCIuYCwgZGV0YWlsczogY3JlYXRlRXZlbnRSZXMuZXJyb3IgfSB9OyB9XG4gICAgICAgIGV2ZW50c1RvVXBzZXJ0LnB1c2goeyB1c2VySWQsIGNhbGVuZGFySWQ6IGRiQ2FsZW5kYXJJZCwgZ0V2ZW50SWQ6IGNyZWF0ZUV2ZW50UmVzLmRhdGEuZ29vZ2xlRXZlbnRJZCwgc3VtbWFyeTogdGFzay50YXNrLCBkZXNjcmlwdGlvbjogdGFzay5kZXNjcmlwdGlvbiwgc3RhcnREYXRlVGltZSwgZW5kRGF0ZVRpbWUsIHRpbWV6b25lOiB1c2VyVGltZXpvbmUsIHByb3ZpZGVyOiAnZ29vZ2xlX2NhbGVuZGFyJywgc3RhdHVzOiAnY29uZmlybWVkJyB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGV2ZW50c1RvVXBzZXJ0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBsb2NhbEFwaUhlbHBlckxvZ2dlci5pbmZvKGAke29wZXJhdGlvbk5hbWV9OiBObyBuZXcgbm9uLW92ZXJsYXBwaW5nIHRhc2tzIHRvIHNjaGVkdWxlLmAsIHsgdXNlcklkLCB1c2VyRGF0ZSB9KTtcbiAgICAgICAgaWYgKGVtYWlsICYmIG5hbWUpIHsgY29uc3QgZW1haWxCb2R5ID0gXCJZb3VyIGRheSBzY2hlZHVsZSB3YXMgcHJvY2Vzc2VkLiBBZnRlciBjaGVja2luZyBmb3Igb3ZlcmxhcHMgd2l0aCBleGlzdGluZyBldmVudHMsIG5vIG5ldyB0YXNrcyB3ZXJlIGFkZGVkIHRvIHlvdXIgY2FsZW5kYXIuXCI7IGNvbnN0IGVtYWlsUmVzdWx0ID0gYXdhaXQgc2VuZEdlbmVyaWNUYXNrRW1haWwoZW1haWwsIG5hbWUsIGBZb3VyIFNjaGVkdWxlIGZvciAke3VzZXJEYXRlfWAsIGVtYWlsQm9keSk7IGlmICghZW1haWxSZXN1bHQuc3VjY2VzcykgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGAke29wZXJhdGlvbk5hbWV9OiBGYWlsZWQgdG8gc2VuZCBuby1uZXctdGFza3MgZW1haWwuYCwgeyB1c2VySWQsIHVzZXJEYXRlLCBlbWFpbCwgZXJyb3I6IGVtYWlsUmVzdWx0LmVycm9yIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBzZW5kIHNjaGVkdWxlIHVwZGF0ZSBlbWFpbCAobm8gbmV3IHRhc2tzIGFmdGVyIGZpbHRlcmluZykuJywgZGV0YWlsczogZW1haWxSZXN1bHQuZXJyb3IgfSB9OyB9IH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH1cbiAgICBjb25zdCB1cHNlcnRSZXN1bHQgPSBhd2FpdCB1cHNlcnRFdmVudHNQb3N0UGxhbm5lcihldmVudHNUb1Vwc2VydCk7XG4gICAgaWYgKCF1cHNlcnRSZXN1bHQuc3VjY2VzcykgeyBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGAke29wZXJhdGlvbk5hbWV9OiB1cHNlcnRFdmVudHNQb3N0UGxhbm5lciBmYWlsZWQuYCwgeyB1c2VySWQsIHVzZXJEYXRlLCBlcnJvcjogdXBzZXJ0UmVzdWx0LmVycm9yIH0pOyByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBzYXZlIHNjaGVkdWxlZCBldmVudHMgdG8gZGF0YWJhc2UuJywgZGV0YWlsczogdXBzZXJ0UmVzdWx0LmVycm9yIH0gfTsgfVxuICAgIGlmIChlbWFpbCAmJiBuYW1lKSB7XG4gICAgICBjb25zdCBlbWFpbEJvZHlDb250ZW50ID0gb3BlbkFJUmVzcG9uc2UuY29udGVudDsgLy8gVGhpcyBpcyB0aGUgSlNPTiBzdHJpbmcgb2YgdGFza3MuIENvbnNpZGVyIGZvcm1hdHRpbmcgZm9yIGVtYWlsLlxuICAgICAgY29uc3QgZW1haWxSZXN1bHQgPSBhd2FpdCBzZW5kR2VuZXJpY1Rhc2tFbWFpbChlbWFpbCwgbmFtZSwgYFlvdXIgRGFpbHkgU2NoZWR1bGUgZm9yICR7dXNlckRhdGV9YCwgZW1haWxCb2R5Q29udGVudCk7XG4gICAgICBpZiAoIWVtYWlsUmVzdWx0LnN1Y2Nlc3MpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIud2FybihgJHtvcGVyYXRpb25OYW1lfTogZW1haWxEYWlseVNjaGVkdWxlIGZhaWxlZC5gLCB7IHVzZXJJZCwgdXNlckRhdGUsIGVtYWlsLCBlcnJvcjogZW1haWxSZXN1bHQuZXJyb3IgfSk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiAnRmFpbGVkIHRvIHNlbmQgZGFpbHkgc2NoZWR1bGUgZW1haWwuJywgZGV0YWlsczogZW1haWxSZXN1bHQuZXJyb3IgfSB9OyB9XG4gICAgfVxuICAgIGxvY2FsQXBpSGVscGVyTG9nZ2VyLmluZm8oYCR7b3BlcmF0aW9uTmFtZX06IFN1Y2Nlc3NmdWxseSBjcmVhdGVkIGRheSBzY2hlZHVsZS5gLCB7IHVzZXJJZCwgdXNlckRhdGUsIHRhc2tzU2NoZWR1bGVkOiBldmVudHNUb1Vwc2VydC5sZW5ndGggfSk7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICB9IGNhdGNoIChlOiBhbnkpIHsgbG9jYWxBcGlIZWxwZXJMb2dnZXIuZXJyb3IoYFVuZXhwZWN0ZWQgZXJyb3IgaW4gJHtvcGVyYXRpb25OYW1lfTpgLCB7IHVzZXJJZCwgdXNlckRhdGUsIGVycm9yOiBlLm1lc3NhZ2UsIGRldGFpbHM6IGUgfSk7IHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiBgVW5leHBlY3RlZCBlcnJvciBkdXJpbmcgJHtvcGVyYXRpb25OYW1lfS5gLCBkZXRhaWxzOiBlLm1lc3NhZ2UgfSB9OyB9XG59O1xuXG4vLyAtLS0gQXZhaWxhYmlsaXR5IEdlbmVyYXRpb24gRnVuY3Rpb25zIChSZWZhY3RvcmVkKSAtLS1cbmV4cG9ydCBjb25zdCBnZW5lcmF0ZUF2YWlsYWJsZVNsb3RzRm9yRGF0ZSA9IChcbiAgZGF0ZTogc3RyaW5nLCAvLyBZWVlZLU1NLUREIGZvcm1hdCBmb3IgdGhlIHRhcmdldCBkYXlcbiAgc2VuZGVyUHJlZmVyZW5jZXM6IFVzZXJQcmVmZXJlbmNlVHlwZSwgLy8gQ29udGFpbnMgd29yayBob3Vycywgc2xvdCBkdXJhdGlvbiwgdGltZXpvbmVcbiAgbm90QXZhaWxhYmxlU2xvdHNJbkV2ZW50VGltZXpvbmU6IEF2YWlsYWJpbGl0eVNsb3RbXSwgLy8gRXhpc3RpbmcgYnVzeSBzbG90cyBmb3IgdGhlIHVzZXIsIGluIGV2ZW50J3MgdGFyZ2V0IHRpbWV6b25lXG4gIHJlY2VpdmVyVGltZXpvbmU6IHN0cmluZywgLy8gVGltZXpvbmUgZm9yIHdoaWNoIHRoZSBzbG90cyBzaG91bGQgYmUgcHJlc2VudGVkXG4gIGlzRmlyc3REYXk6IGJvb2xlYW4sIC8vIElzIHRoaXMgdGhlIGZpcnN0IGRheSBvZiB0aGUgb3ZlcmFsbCB3aW5kb3c/XG4gIGlzTGFzdERheTogYm9vbGVhbiwgLy8gSXMgdGhpcyB0aGUgbGFzdCBkYXkgb2YgdGhlIG92ZXJhbGwgd2luZG93P1xuICB3aW5kb3dTdGFydFRpbWVJblJlY2VpdmVyVGltZXpvbmU/OiBzdHJpbmcsIC8vIEhIOm1tLCBvbmx5IGlmIGlzRmlyc3REYXkgaXMgdHJ1ZVxuICB3aW5kb3dFbmRUaW1lSW5SZWNlaXZlclRpbWV6b25lPzogc3RyaW5nLCAgIC8vIEhIOm1tLCBvbmx5IGlmIGlzTGFzdERheSBpcyB0cnVlXG4pOiBBdmFpbGFiaWxpdHlTbG90W10gPT4ge1xuICBjb25zdCBhdmFpbGFibGVTbG90czogQXZhaWxhYmlsaXR5U2xvdFtdID0gW107XG4gIGNvbnN0IHNlbmRlclR6ID0gc2VuZGVyUHJlZmVyZW5jZXMudGltZXpvbmUgfHwgJ1VUQyc7IC8vIERlZmF1bHQgdG8gVVRDIGlmIG5vdCBzcGVjaWZpZWRcbiAgY29uc3Qgc2xvdER1cmF0aW9uID0gc2VuZGVyUHJlZmVyZW5jZXMuc2xvdER1cmF0aW9uIHx8IDMwO1xuICBjb25zdCBidWZmZXJNaW51dGVzID0gc2VuZGVyUHJlZmVyZW5jZXMuYnVmZmVyQmV0d2Vlbk1lZXRpbmdzIHx8IDA7XG5cbiAgLy8gUGFyc2Ugc2VuZGVyJ3Mgd29yayBob3VycyBpbiB0aGVpciB0aW1lem9uZVxuICAvLyBEZWZhdWx0IHRvIDkgQU0gLSA1IFBNIGlmIG5vdCBzcGVjaWZpZWRcbiAgY29uc3Qgd29ya1N0YXJ0SG91ciA9IHBhcnNlSW50KChzZW5kZXJQcmVmZXJlbmNlcy53b3JrSG91cnNTdGFydFRpbWUgfHwgJzA5OjAwJykuc3BsaXQoJzonKVswXSk7XG4gIGNvbnN0IHdvcmtTdGFydE1pbnV0ZSA9IHBhcnNlSW50KChzZW5kZXJQcmVmZXJlbmNlcy53b3JrSG91cnNTdGFydFRpbWUgfHwgJzA5OjAwJykuc3BsaXQoJzonKVsxXSk7XG4gIGNvbnN0IHdvcmtFbmRIb3VyID0gcGFyc2VJbnQoKHNlbmRlclByZWZlcmVuY2VzLndvcmtIb3Vyc0VuZFRpbWUgfHwgJzE3OjAwJykuc3BsaXQoJzonKVswXSk7XG4gIGNvbnN0IHdvcmtFbmRNaW51dGUgPSBwYXJzZUludCgoc2VuZGVyUHJlZmVyZW5jZXMud29ya0hvdXJzRW5kVGltZSB8fCAnMTc6MDAnKS5zcGxpdCgnOicpWzFdKTtcblxuICBsZXQgZGF5U3RhcnQgPSBkYXlqcy50eihkYXRlLCBzZW5kZXJUeikuaG91cih3b3JrU3RhcnRIb3VyKS5taW51dGUod29ya1N0YXJ0TWludXRlKS5zZWNvbmQoMCkubWlsbGlzZWNvbmQoMCk7XG4gIGxldCBkYXlFbmQgPSBkYXlqcy50eihkYXRlLCBzZW5kZXJUeikuaG91cih3b3JrRW5kSG91cikubWludXRlKHdvcmtFbmRNaW51dGUpLnNlY29uZCgwKS5taWxsaXNlY29uZCgwKTtcblxuICAvLyBBZGp1c3Qgc3RhcnQgdGltZSBpZiBpdCdzIHRoZSBmaXJzdCBkYXkgb2YgYSBzcGVjaWZpYyB3aW5kb3dcbiAgaWYgKGlzRmlyc3REYXkgJiYgd2luZG93U3RhcnRUaW1lSW5SZWNlaXZlclRpbWV6b25lKSB7XG4gICAgY29uc3Qgd2luZG93U3RhcnQgPSBkYXlqcy50eihgJHtkYXRlfSAke3dpbmRvd1N0YXJ0VGltZUluUmVjZWl2ZXJUaW1lem9uZX1gLCAnWVlZWS1NTS1ERCBISDptbScsIHJlY2VpdmVyVGltZXpvbmUpLnR6KHNlbmRlclR6KTtcbiAgICBpZiAod2luZG93U3RhcnQuaXNBZnRlcihkYXlTdGFydCkpIHtcbiAgICAgIGRheVN0YXJ0ID0gd2luZG93U3RhcnQ7XG4gICAgfVxuICB9XG5cbiAgLy8gQWRqdXN0IGVuZCB0aW1lIGlmIGl0J3MgdGhlIGxhc3QgZGF5IG9mIGEgc3BlY2lmaWMgd2luZG93XG4gIGlmIChpc0xhc3REYXkgJiYgd2luZG93RW5kVGltZUluUmVjZWl2ZXJUaW1lem9uZSkge1xuICAgIGNvbnN0IHdpbmRvd0VuZCA9IGRheWpzLnR6KGAke2RhdGV9ICR7d2luZG93RW5kVGltZUluUmVjZWl2ZXJUaW1lem9uZX1gLCAnWVlZWS1NTS1ERCBISDptbScsIHJlY2VpdmVyVGltZXpvbmUpLnR6KHNlbmRlclR6KTtcbiAgICBpZiAod2luZG93RW5kLmlzQmVmb3JlKGRheUVuZCkpIHtcbiAgICAgIGRheUVuZCA9IHdpbmRvd0VuZDtcbiAgICB9XG4gIH1cblxuICBsZXQgY3VycmVudFNsb3RTdGFydCA9IGRheVN0YXJ0O1xuXG4gIHdoaWxlIChjdXJyZW50U2xvdFN0YXJ0LmFkZChzbG90RHVyYXRpb24sICdtaW51dGVzJykuaXNCZWZvcmUoZGF5RW5kKSB8fCBjdXJyZW50U2xvdFN0YXJ0LmFkZChzbG90RHVyYXRpb24sICdtaW51dGVzJykuaXNTYW1lKGRheUVuZCkpIHtcbiAgICBjb25zdCBjdXJyZW50U2xvdEVuZCA9IGN1cnJlbnRTbG90U3RhcnQuYWRkKHNsb3REdXJhdGlvbiwgJ21pbnV0ZXMnKTtcbiAgICBsZXQgaXNTbG90QXZhaWxhYmxlID0gdHJ1ZTtcblxuICAgIC8vIENoZWNrIGFnYWluc3QgZXhpc3RpbmcgZXZlbnRzIChub3RBdmFpbGFibGVTbG90c0luRXZlbnRUaW1lem9uZSBhcmUgYWxyZWFkeSBpbiByZWNlaXZlcidzIHRpbWV6b25lKVxuICAgIC8vIENvbnZlcnQgY3VycmVudCBzbG90IHRvIHJlY2VpdmVyJ3MgdGltZXpvbmUgZm9yIGNvbXBhcmlzb25cbiAgICBjb25zdCBjdXJyZW50U2xvdFN0YXJ0SW5SZWNlaXZlclR6ID0gY3VycmVudFNsb3RTdGFydC50eihyZWNlaXZlclRpbWV6b25lKTtcbiAgICBjb25zdCBjdXJyZW50U2xvdEVuZEluUmVjZWl2ZXJUeiA9IGN1cnJlbnRTbG90RW5kLnR6KHJlY2VpdmVyVGltZXpvbmUpO1xuXG4gICAgZm9yIChjb25zdCBidXN5U2xvdCBvZiBub3RBdmFpbGFibGVTbG90c0luRXZlbnRUaW1lem9uZSkge1xuICAgICAgY29uc3QgYnVzeVN0YXJ0ID0gZGF5anMoYnVzeVNsb3Quc3RhcnREYXRlKTsgLy8gQXNzdW1pbmcgdGhlc2UgYXJlIGFscmVhZHkgRGF5anMgb2JqZWN0cyBvciBJU08gc3RyaW5nc1xuICAgICAgY29uc3QgYnVzeUVuZCA9IGRheWpzKGJ1c3lTbG90LmVuZERhdGUpO1xuICAgICAgLy8gQ2hlY2sgZm9yIG92ZXJsYXA6IChTdGFydEEgPCBFbmRCKSBhbmQgKEVuZEEgPiBTdGFydEIpXG4gICAgICBpZiAoY3VycmVudFNsb3RTdGFydEluUmVjZWl2ZXJUei5pc0JlZm9yZShidXN5RW5kKSAmJiBjdXJyZW50U2xvdEVuZEluUmVjZWl2ZXJUei5pc0FmdGVyKGJ1c3lTdGFydCkpIHtcbiAgICAgICAgaXNTbG90QXZhaWxhYmxlID0gZmFsc2U7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChpc1Nsb3RBdmFpbGFibGUpIHtcbiAgICAgIC8vIFN0b3JlIHNsb3RzIGluIFVUQywgYnV0IGVuc3VyZSB0aGV5IGFyZSBwcmVzZW50ZWQgYmFzZWQgb24gcmVjZWl2ZXJUaW1lem9uZSBsYXRlciBpZiBuZWVkZWRcbiAgICAgIGF2YWlsYWJsZVNsb3RzLnB1c2goe1xuICAgICAgICBzdGFydERhdGU6IGN1cnJlbnRTbG90U3RhcnQudG9JU09TdHJpbmcoKSwgLy8gU3RvcmUgaW4gVVRDXG4gICAgICAgIGVuZERhdGU6IGN1cnJlbnRTbG90RW5kLnRvSVNPU3RyaW5nKCksICAgLy8gU3RvcmUgaW4gVVRDXG4gICAgICB9KTtcbiAgICB9XG4gICAgY3VycmVudFNsb3RTdGFydCA9IGN1cnJlbnRTbG90RW5kLmFkZChidWZmZXJNaW51dGVzLCAnbWludXRlcycpO1xuICB9XG4gIHJldHVybiBhdmFpbGFibGVTbG90cztcbn07XG5cbmV4cG9ydCBjb25zdCBnZW5lcmF0ZUF2YWlsYWJsZVNsb3RzZm9yVGltZVdpbmRvdyA9IChcbiAgc3RhcnREYXRlOiBzdHJpbmcsIC8vIFlZWVktTU0tRERcbiAgZW5kRGF0ZTogc3RyaW5nLCAgIC8vIFlZWVktTU0tRERcbiAgc2VuZGVyUHJlZmVyZW5jZXM6IFVzZXJQcmVmZXJlbmNlVHlwZSxcbiAgbm90QXZhaWxhYmxlRnJvbUV2ZW50czogRXZlbnRUeXBlW10sIC8vIEFsbCBldmVudHMgZm9yIHRoZSB1c2VyIHdpdGhpbiBhIGJyb2FkZXIgcmFuZ2VcbiAgcmVjZWl2ZXJUaW1lem9uZTogc3RyaW5nLFxuICB3aW5kb3dTdGFydFRpbWVJblJlY2VpdmVyVGltZXpvbmU/OiBzdHJpbmcsIC8vIEhIOm1tIGZvciB0aGUgZmlyc3QgZGF5XG4gIHdpbmRvd0VuZFRpbWVJblJlY2VpdmVyVGltZXpvbmU/OiBzdHJpbmcgICAgLy8gSEg6bW0gZm9yIHRoZSBsYXN0IGRheVxuKTogeyBhdmFpbGFibGVTbG90czogQXZhaWxhYmlsaXR5U2xvdFtdIH0gPT4ge1xuICBsZXQgYWxsU2xvdHM6IEF2YWlsYWJpbGl0eVNsb3RbXSA9IFtdO1xuICBsZXQgY3VycmVudERhdGUgPSBkYXlqcy50eihzdGFydERhdGUsIHJlY2VpdmVyVGltZXpvbmUpLnN0YXJ0T2YoJ2RheScpO1xuICBjb25zdCBmaW5hbEVuZERhdGUgPSBkYXlqcy50eihlbmREYXRlLCByZWNlaXZlclRpbWV6b25lKS5lbmRPZignZGF5Jyk7XG5cbiAgLy8gQ29udmVydCBleGlzdGluZyBldmVudHMgdG8gbm90QXZhaWxhYmxlU2xvdHMgaW4gdGhlIHJlY2VpdmVyJ3MgdGltZXpvbmUgZm9yIGNvbXBhcmlzb25cbiAgY29uc3Qgbm90QXZhaWxhYmxlU2xvdHNJblJlY2VpdmVyVHogPSBub3RBdmFpbGFibGVGcm9tRXZlbnRzLm1hcChldmVudCA9PiAoe1xuICAgIHN0YXJ0RGF0ZTogZGF5anMoZXZlbnQuc3RhcnREYXRlVGltZSkudHoocmVjZWl2ZXJUaW1lem9uZSkudG9JU09TdHJpbmcoKSwgLy8gQ29udmVydCB0byByZWNlaXZlcidzIFRaIHRoZW4gdG8gSVNPXG4gICAgZW5kRGF0ZTogZGF5anMoZXZlbnQuZW5kRGF0ZVRpbWUpLnR6KHJlY2VpdmVyVGltZXpvbmUpLnRvSVNPU3RyaW5nKClcbiAgfSkpO1xuXG5cbiAgd2hpbGUgKGN1cnJlbnREYXRlLmlzQmVmb3JlKGZpbmFsRW5kRGF0ZSkgfHwgY3VycmVudERhdGUuaXNTYW1lKGZpbmFsRW5kRGF0ZSwgJ2RheScpKSB7XG4gICAgaWYgKHNlbmRlclByZWZlcmVuY2VzLndvcmtEYXlzICYmICFzZW5kZXJQcmVmZXJlbmNlcy53b3JrRGF5cy5pbmNsdWRlcyhjdXJyZW50RGF0ZS5kYXkoKSkpIHtcbiAgICAgIGN1cnJlbnREYXRlID0gY3VycmVudERhdGUuYWRkKDEsICdkYXknKTtcbiAgICAgIGNvbnRpbnVlOyAvLyBTa2lwIG5vbi13b3JraW5nIGRheXNcbiAgICB9XG5cbiAgICBjb25zdCBpc0ZpcnN0RGF5ID0gY3VycmVudERhdGUuaXNTYW1lKGRheWpzLnR6KHN0YXJ0RGF0ZSwgcmVjZWl2ZXJUaW1lem9uZSkuc3RhcnRPZignZGF5JyksICdkYXknKTtcbiAgICBjb25zdCBpc0xhc3REYXkgPSBjdXJyZW50RGF0ZS5pc1NhbWUoZmluYWxFbmREYXRlLnN0YXJ0T2YoJ2RheScpLCAnZGF5Jyk7XG5cbiAgICBjb25zdCBkYWlseVNsb3RzID0gZ2VuZXJhdGVBdmFpbGFibGVTbG90c0ZvckRhdGUoXG4gICAgICBjdXJyZW50RGF0ZS5mb3JtYXQoJ1lZWVktTU0tREQnKSxcbiAgICAgIHNlbmRlclByZWZlcmVuY2VzLFxuICAgICAgbm90QXZhaWxhYmxlU2xvdHNJblJlY2VpdmVyVHosIC8vIFBhc3MgZXhpc3RpbmcgZXZlbnRzXG4gICAgICByZWNlaXZlclRpbWV6b25lLFxuICAgICAgaXNGaXJzdERheSxcbiAgICAgIGlzTGFzdERheSxcbiAgICAgIGlzRmlyc3REYXkgPyB3aW5kb3dTdGFydFRpbWVJblJlY2VpdmVyVGltZXpvbmUgOiB1bmRlZmluZWQsXG4gICAgICBpc0xhc3REYXkgPyB3aW5kb3dFbmRUaW1lSW5SZWNlaXZlclRpbWV6b25lIDogdW5kZWZpbmVkXG4gICAgKTtcbiAgICBhbGxTbG90cyA9IGFsbFNsb3RzLmNvbmNhdChkYWlseVNsb3RzKTtcbiAgICBjdXJyZW50RGF0ZSA9IGN1cnJlbnREYXRlLmFkZCgxLCAnZGF5Jyk7XG4gIH1cbiAgcmV0dXJuIHsgYXZhaWxhYmxlU2xvdHM6IF8udW5pcVdpdGgoYWxsU2xvdHMsIF8uaXNFcXVhbCkgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZW5lcmF0ZUF2YWlsYWJpbGl0eSA9IGFzeW5jIChcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICBhdmFpbGFiaWxpdHlTY2FuU3RhcnREYXRlOiBzdHJpbmcsIC8vIFlZWVktTU0tRERcbiAgICBhdmFpbGFiaWxpdHlTY2FuRW5kRGF0ZTogc3RyaW5nLCAgIC8vIFlZWVktTU0tRERcbiAgICByZWNlaXZlckdlbmVyYXRlZFRpbWV6b25lOiBzdHJpbmcsIC8vIFRhcmdldCB0aW1lem9uZSBmb3IgdGhlIHNsb3RzXG4gICAgLy8gY2xpZW50VHlwZSBpcyBub3QgZGlyZWN0bHkgdXNlZCBoZXJlIGJ1dCBtaWdodCBiZSB1c2VkIGJ5IGxpc3RFdmVudHMgaWYgaXQgd2VyZSBtb3JlIGNvbXBsZXhcbik6IFByb21pc2U8U3VjY2Vzc1Jlc3BvbnNlVHlwZTxBdmFpbGFiaWxpdHlTbG90W10+IHwgRmFpbHVyZVJlc3BvbnNlVHlwZT4gPT4ge1xuICBjb25zdCBvcGVyYXRpb25OYW1lID0gXCJnZW5lcmF0ZUF2YWlsYWJpbGl0eVwiO1xuICB0cnkge1xuICAgIGNvbnN0IHByZWZzUmVzdWx0ID0gYXdhaXQgZ2V0VXNlclByZWZlcmVuY2VzKHVzZXJJZCk7XG4gICAgaWYgKCFwcmVmc1Jlc3VsdC5zdWNjZXNzKSB7XG4gICAgICBsb2NhbEFwaUhlbHBlckxvZ2dlci53YXJuKGAke29wZXJhdGlvbk5hbWV9OiBnZXRVc2VyUHJlZmVyZW5jZXMgZmFpbGVkLmAsIHsgdXNlcklkLCBlcnJvcjogcHJlZnNSZXN1bHQuZXJyb3IgfSk7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBnZXQgdXNlciBwcmVmZXJlbmNlcyBmb3IgYXZhaWxhYmlsaXR5IGdlbmVyYXRpb24uJywgZGV0YWlsczogcHJlZnNSZXN1bHQuZXJyb3IgfSB9O1xuICAgIH1cbiAgICBpZiAoIXByZWZzUmVzdWx0LmRhdGEpIHtcbiAgICAgIGxvY2FsQXBpSGVscGVyTG9nZ2VyLndhcm4oYCR7b3BlcmF0aW9uTmFtZX06IFVzZXIgcHJlZmVyZW5jZXMgbm90IGZvdW5kLmAsIHsgdXNlcklkIH0pO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdVc2VyIHByZWZlcmVuY2VzIG5vdCBmb3VuZCwgY2Fubm90IGdlbmVyYXRlIGF2YWlsYWJpbGl0eS4nIH0gfTtcbiAgICB9XG4gICAgY29uc3Qgc2VuZGVyUHJlZmVyZW5jZXMgPSBwcmVmc1Jlc3VsdC5kYXRhO1xuXG4gICAgLy8gRmV0Y2ggZXZlbnRzIGZvciB0aGUgdXNlciBmb3IgdGhlIGdpdmVuIGRhdGUgcmFuZ2UgdG8gY2hlY2sgZm9yIGNvbmZsaWN0c1xuICAgIC8vIFRoZSByYW5nZSBmb3IgZmV0Y2hpbmcgZXZlbnRzIHNob3VsZCBjb3ZlciB0aGUgZW50aXJlIHNjYW4gcGVyaW9kIGluIFVUQyB0byBiZSBzYWZlLlxuICAgIGNvbnN0IHNjYW5TdGFydFV0YyA9IGRheWpzLnR6KGF2YWlsYWJpbGl0eVNjYW5TdGFydERhdGUsIHNlbmRlclByZWZlcmVuY2VzLnRpbWV6b25lIHx8IHJlY2VpdmVyR2VuZXJhdGVkVGltZXpvbmUpLnN0YXJ0T2YoJ2RheScpLnV0YygpLnRvSVNPU3RyaW5nKCk7XG4gICAgY29uc3Qgc2NhbkVuZFV0YyA9IGRheWpzLnR6KGF2YWlsYWJpbGl0eVNjYW5FbmREYXRlLCBzZW5kZXJQcmVmZXJlbmNlcy50aW1lem9uZSB8fCByZWNlaXZlckdlbmVyYXRlZFRpbWV6b25lKS5lbmRPZignZGF5JykudXRjKCkudG9JU09TdHJpbmcoKTtcblxuICAgIGNvbnN0IGV2ZW50c1Jlc3VsdCA9IGF3YWl0IGxpc3RFdmVudHNGb3JVc2VyR2l2ZW5EYXRlcyh1c2VySWQsIHNjYW5TdGFydFV0Yywgc2NhbkVuZFV0Yyk7XG4gICAgaWYgKCFldmVudHNSZXN1bHQuc3VjY2Vzcykge1xuICAgICAgbG9jYWxBcGlIZWxwZXJMb2dnZXIud2FybihgJHtvcGVyYXRpb25OYW1lfTogbGlzdEV2ZW50c0ZvclVzZXJHaXZlbkRhdGVzIGZhaWxlZC5gLCB7IHVzZXJJZCwgc2NhblN0YXJ0VXRjLCBzY2FuRW5kVXRjLCBlcnJvcjogZXZlbnRzUmVzdWx0LmVycm9yIH0pO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiB7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gbGlzdCBleGlzdGluZyBldmVudHMgZm9yIGF2YWlsYWJpbGl0eSBnZW5lcmF0aW9uLicsIGRldGFpbHM6IGV2ZW50c1Jlc3VsdC5lcnJvciB9IH07XG4gICAgfVxuICAgIGNvbnN0IGV4aXN0aW5nRXZlbnRzID0gZXZlbnRzUmVzdWx0LmRhdGE7IC8vIFRoZXNlIGFyZSBhbHJlYWR5IGluIFVUQyBmcm9tIEhhc3VyYSAoYXNzdW1pbmcgdGltZXN0YW1wdHopXG5cbiAgICAvLyBBc3N1bWluZyB3aW5kb3dTdGFydFRpbWUgYW5kIHdpbmRvd0VuZFRpbWUgYXJlIG5vdCB1c2VkIGZvciB0aGlzIHRvcC1sZXZlbCBjYWxsLFxuICAgIC8vIG1lYW5pbmcgd2UgZ2VuZXJhdGUgZm9yIGZ1bGwgd29ya2RheXMgd2l0aGluIHRoZSBkYXRlIHJhbmdlLlxuICAgIGNvbnN0IGF2YWlsYWJpbGl0eVJlc3VsdCA9IGdlbmVyYXRlQXZhaWxhYmxlU2xvdHNmb3JUaW1lV2luZG93KFxuICAgICAgYXZhaWxhYmlsaXR5U2NhblN0YXJ0RGF0ZSxcbiAgICAgIGF2YWlsYWJpbGl0eVNjYW5FbmREYXRlLFxuICAgICAgc2VuZGVyUHJlZmVyZW5jZXMsXG4gICAgICBleGlzdGluZ0V2ZW50cyxcbiAgICAgIHJlY2VpdmVyR2VuZXJhdGVkVGltZXpvbmUgLy8gU2xvdHMgc2hvdWxkIGJlIGdlbmVyYXRlZCBjb25zaWRlcmluZyB0aGlzIGFzIHRoZSB0YXJnZXQgZGlzcGxheSB0aW1lem9uZSBjb250ZXh0XG4gICAgKTtcbiAgICBsb2NhbEFwaUhlbHBlckxvZ2dlci5pbmZvKGAke29wZXJhdGlvbk5hbWV9OiBTdWNjZXNzZnVsbHkgZ2VuZXJhdGVkIGF2YWlsYWJpbGl0eSBzbG90cy5gLCB7IHVzZXJJZCwgc2xvdHNDb3VudDogYXZhaWxhYmlsaXR5UmVzdWx0LmF2YWlsYWJsZVNsb3RzLmxlbmd0aCB9KTtcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBhdmFpbGFiaWxpdHlSZXN1bHQuYXZhaWxhYmxlU2xvdHMgfTtcblxuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICBsb2NhbEFwaUhlbHBlckxvZ2dlci5lcnJvcihgVW5leHBlY3RlZCBlcnJvciBpbiAke29wZXJhdGlvbk5hbWV9OmAsIHsgdXNlcklkLCBlcnJvcjogZS5tZXNzYWdlLCBkZXRhaWxzOiBlIH0pO1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogeyBtZXNzYWdlOiBgVW5leHBlY3RlZCBlcnJvciBkdXJpbmcgJHtvcGVyYXRpb25OYW1lfS5gLCBkZXRhaWxzOiBlLm1lc3NhZ2UgfSB9O1xuICB9XG59O1xuIl19