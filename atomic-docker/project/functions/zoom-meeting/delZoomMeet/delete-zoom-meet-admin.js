import { deleteZoomMeeting, getZoomAPIToken, } from '@zoom_meeting/_libs/api-helper';
const publisher = async (req, res) => {
    try {
        const eventItem = req.body;
        // validate
        if (!eventItem?.meetingId) {
            return res.status(400).json({
                message: 'no meetingId present',
                event: eventItem,
            });
        }
        if (!eventItem?.userId) {
            return res.status(400).json({
                message: 'no userId',
                event: eventItem,
            });
        }
        const zoomToken = await getZoomAPIToken(eventItem?.userId);
        await deleteZoomMeeting(zoomToken, eventItem?.meetingId, eventItem?.scheduleForReminder, eventItem?.cancelMeetingReminder);
        res.status(202).json('del zoom meeting successfully');
    }
    catch (e) {
        console.log(e, ' unable to process message');
        res.status(400).json({
            message: `error processing queue mesages: message: ${e?.message}, code: ${e?.statusCode}`,
            event: e,
        });
    }
};
export default publisher;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVsZXRlLXpvb20tbWVldC1hZG1pbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImRlbGV0ZS16b29tLW1lZXQtYWRtaW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUNMLGlCQUFpQixFQUNqQixlQUFlLEdBQ2hCLE1BQU0sZ0NBQWdDLENBQUM7QUFHeEMsTUFBTSxTQUFTLEdBQUcsS0FBSyxFQUFFLEdBQVksRUFBRSxHQUFhLEVBQUUsRUFBRTtJQUN0RCxJQUFJLENBQUM7UUFDSCxNQUFNLFNBQVMsR0FBNkIsR0FBRyxDQUFDLElBQUksQ0FBQztRQUVyRCxXQUFXO1FBQ1gsSUFBSSxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsQ0FBQztZQUMxQixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUMxQixPQUFPLEVBQUUsc0JBQXNCO2dCQUMvQixLQUFLLEVBQUUsU0FBUzthQUNqQixDQUFDLENBQUM7UUFDTCxDQUFDO1FBRUQsSUFBSSxDQUFDLFNBQVMsRUFBRSxNQUFNLEVBQUUsQ0FBQztZQUN2QixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUMxQixPQUFPLEVBQUUsV0FBVztnQkFDcEIsS0FBSyxFQUFFLFNBQVM7YUFDakIsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUVELE1BQU0sU0FBUyxHQUFHLE1BQU0sZUFBZSxDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUUzRCxNQUFNLGlCQUFpQixDQUNyQixTQUFTLEVBQ1QsU0FBUyxFQUFFLFNBQVMsRUFDcEIsU0FBUyxFQUFFLG1CQUFtQixFQUM5QixTQUFTLEVBQUUscUJBQXFCLENBQ2pDLENBQUM7UUFFRixHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1FBQ1gsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsNEJBQTRCLENBQUMsQ0FBQztRQUU3QyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUNuQixPQUFPLEVBQUUsNENBQTRDLENBQUMsRUFBRSxPQUFPLFdBQVcsQ0FBQyxFQUFFLFVBQVUsRUFBRTtZQUN6RixLQUFLLEVBQUUsQ0FBQztTQUNULENBQUMsQ0FBQztJQUNMLENBQUM7QUFDSCxDQUFDLENBQUM7QUFFRixlQUFlLFNBQVMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlcXVlc3QsIFJlc3BvbnNlIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQge1xuICBkZWxldGVab29tTWVldGluZyxcbiAgZ2V0Wm9vbUFQSVRva2VuLFxufSBmcm9tICdAem9vbV9tZWV0aW5nL19saWJzL2FwaS1oZWxwZXInO1xuaW1wb3J0IHsgRGVsZXRlWm9vbU1lZXRPYmplY3RUeXBlIH0gZnJvbSAnQHpvb21fbWVldGluZy9fbGlicy90eXBlcyc7XG5cbmNvbnN0IHB1Ymxpc2hlciA9IGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBldmVudEl0ZW06IERlbGV0ZVpvb21NZWV0T2JqZWN0VHlwZSA9IHJlcS5ib2R5O1xuXG4gICAgLy8gdmFsaWRhdGVcbiAgICBpZiAoIWV2ZW50SXRlbT8ubWVldGluZ0lkKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnbm8gbWVldGluZ0lkIHByZXNlbnQnLFxuICAgICAgICBldmVudDogZXZlbnRJdGVtLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKCFldmVudEl0ZW0/LnVzZXJJZCkge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ25vIHVzZXJJZCcsXG4gICAgICAgIGV2ZW50OiBldmVudEl0ZW0sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zdCB6b29tVG9rZW4gPSBhd2FpdCBnZXRab29tQVBJVG9rZW4oZXZlbnRJdGVtPy51c2VySWQpO1xuXG4gICAgYXdhaXQgZGVsZXRlWm9vbU1lZXRpbmcoXG4gICAgICB6b29tVG9rZW4sXG4gICAgICBldmVudEl0ZW0/Lm1lZXRpbmdJZCxcbiAgICAgIGV2ZW50SXRlbT8uc2NoZWR1bGVGb3JSZW1pbmRlcixcbiAgICAgIGV2ZW50SXRlbT8uY2FuY2VsTWVldGluZ1JlbWluZGVyXG4gICAgKTtcblxuICAgIHJlcy5zdGF0dXMoMjAyKS5qc29uKCdkZWwgem9vbSBtZWV0aW5nIHN1Y2Nlc3NmdWxseScpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5sb2coZSwgJyB1bmFibGUgdG8gcHJvY2VzcyBtZXNzYWdlJyk7XG5cbiAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICBtZXNzYWdlOiBgZXJyb3IgcHJvY2Vzc2luZyBxdWV1ZSBtZXNhZ2VzOiBtZXNzYWdlOiAke2U/Lm1lc3NhZ2V9LCBjb2RlOiAke2U/LnN0YXR1c0NvZGV9YCxcbiAgICAgIGV2ZW50OiBlLFxuICAgIH0pO1xuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBwdWJsaXNoZXI7XG4iXX0=