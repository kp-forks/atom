import { PutObjectCommand, S3Client } from '@aws-sdk/client-s3';
import { optaPlanWeekly, getUserPreferences, convertMeetingPlusTypeToEventPlusType, formatEventTypeToPlannerEvent, generateBreakEventsForDate, generateEventPartsLite, generateTimeSlotsLiteForInternalAttendee, generateUserPlannerRequestBody, generateWorkTimesForInternalAttendee, getGlobalCalendar, modifyEventPartsForMultiplePostBufferTime, modifyEventPartsForMultiplePreBufferTime, processEventsForOptaPlannerForExternalAttendees, setPreferredTimeForUnModifiableEvent, tagEventsForDailyOrWeeklyTask, validateEventDates, } from '@features_apply/_libs/api-helper';
import { bucketName, onOptaPlanCalendarAdminCallBackUrl, optaplannerDuration, } from '@features_apply/_libs/constants';
import { dayjs } from '@features_apply/_libs/date-utils';
import _ from 'lodash';
import { v4 as uuid } from 'uuid';
const s3Client = new S3Client({
    credentials: {
        accessKeyId: process.env.S3_ACCESS_KEY,
        secretAccessKey: process.env.S3_SECRET_KEY,
    },
    endpoint: process.env.S3_ENDPOINT,
    forcePathStyle: true,
});
export const processEventsForOptaPlannerForMainHost = async (mainHostId, allHostEvents, windowStartDate, windowEndDate, hostTimezone, oldHostEvents, newHostBufferTimes) => {
    try {
        const newBufferTimeArray = [];
        for (const newHostBufferTime of newHostBufferTimes) {
            if (newHostBufferTime?.beforeEvent?.id) {
                console.log(newHostBufferTime?.beforeEvent, ' newTimeBlocking?.beforeEvent');
                newBufferTimeArray.push(newHostBufferTime.beforeEvent);
            }
            if (newHostBufferTime?.afterEvent?.id) {
                console.log(newHostBufferTime?.afterEvent, ' newTimeBlocking?.afterEvent');
                newBufferTimeArray.push(newHostBufferTime.afterEvent);
            }
        }
        const modifiedAllHostEvents = _.cloneDeep(allHostEvents);
        if (newBufferTimeArray?.length > 0) {
            modifiedAllHostEvents.push(...newBufferTimeArray);
        }
        const userPreferences = await getUserPreferences(mainHostId);
        const globalPrimaryCalendar = await getGlobalCalendar(mainHostId);
        const diffDays = dayjs(windowEndDate.slice(0, 19)).diff(dayjs(windowStartDate.slice(0, 19)), 'day');
        const modifiedAllEventsWithBreaks = [];
        const startDatesForEachDay = [];
        for (let i = 0; i <= diffDays; i++) {
            startDatesForEachDay.push(dayjs(windowStartDate.slice(0, 19))
                .tz(hostTimezone, true)
                .add(i, 'day')
                .format());
        }
        let parentBreaks = [];
        const breaks = await generateBreakEventsForDate(userPreferences, mainHostId, windowStartDate, windowEndDate, hostTimezone, globalPrimaryCalendar?.id);
        breaks.forEach((b) => console.log(b, ' generatedBreaks'));
        if (breaks?.length > 0) {
            const allEventsWithDuplicateFreeBreaks = _.differenceBy(modifiedAllHostEvents, breaks, 'id');
            modifiedAllEventsWithBreaks.push(...allEventsWithDuplicateFreeBreaks);
            modifiedAllEventsWithBreaks.push(...breaks);
            parentBreaks.push(...breaks);
        }
        else {
            modifiedAllEventsWithBreaks.push(...modifiedAllHostEvents);
        }
        const workTimes = generateWorkTimesForInternalAttendee(mainHostId, mainHostId, userPreferences, hostTimezone, hostTimezone);
        const timeslots = [];
        for (let i = 0; i < startDatesForEachDay.length; i++) {
            if (i === 0) {
                const timeslotsForDay = await generateTimeSlotsLiteForInternalAttendee(startDatesForEachDay?.[i], mainHostId, userPreferences, hostTimezone, hostTimezone, true);
                timeslots.push(...timeslotsForDay);
                continue;
            }
            const timeslotsForDay = await generateTimeSlotsLiteForInternalAttendee(startDatesForEachDay?.[i], mainHostId, userPreferences, hostTimezone, hostTimezone, false);
            timeslots.push(...timeslotsForDay);
        }
        console.log(timeslots, ' timeslots');
        const filteredAllEvents = _.uniqBy(modifiedAllEventsWithBreaks.filter((e) => validateEventDates(e, userPreferences)), 'id');
        let eventParts = [];
        const eventPartMinisAccumulated = [];
        for (const event of filteredAllEvents) {
            const eventPartMinis = generateEventPartsLite(event, mainHostId);
            eventPartMinisAccumulated.push(...eventPartMinis);
        }
        const modifiedEventPartMinisPreBuffer = modifyEventPartsForMultiplePreBufferTime(eventPartMinisAccumulated);
        const modifiedEventPartMinisPreAndPostBuffer = modifyEventPartsForMultiplePostBufferTime(modifiedEventPartMinisPreBuffer);
        const formattedEventParts = modifiedEventPartMinisPreAndPostBuffer.map((e) => formatEventTypeToPlannerEvent(e, userPreferences, workTimes, hostTimezone));
        if (formattedEventParts?.length > 0) {
            eventParts.push(...formattedEventParts);
        }
        if (eventParts?.length > 0) {
            eventParts.forEach((e) => console.log(e, ' eventParts after formatting'));
            const newEventPartsWithPreferredTimeSet = eventParts.map((e) => setPreferredTimeForUnModifiableEvent(e, allHostEvents.find((f) => f.id === e.eventId)?.timezone));
            newEventPartsWithPreferredTimeSet.forEach((e) => console.log(e, ' newEventPartsWithPreferredTimeSet'));
            const newEventParts = await tagEventsForDailyOrWeeklyTask(newEventPartsWithPreferredTimeSet);
            newEventParts.forEach((e) => console.log(e, ' newEventParts after tagEventsForDailyOrWeeklyTask'));
            const userPlannerRequestBody = generateUserPlannerRequestBody(userPreferences, userPreferences.userId, workTimes, mainHostId);
            console.log(userPlannerRequestBody, ' userPlannerRequestBody');
            const modifiedNewEventParts = newEventParts.map((eventPart) => {
                const oldEvent = filteredAllEvents.find((event) => event.id === eventPart.eventId);
                return {
                    groupId: eventPart?.groupId,
                    eventId: eventPart?.eventId,
                    part: eventPart?.part,
                    lastPart: eventPart?.lastPart,
                    meetingPart: eventPart?.meetingPart,
                    meetingLastPart: eventPart?.meetingLastPart,
                    meetingId: eventPart?.meetingId,
                    hostId: mainHostId,
                    startDate: dayjs(eventPart?.startDate.slice(0, 19))
                        .tz(oldEvent.timezone, true)
                        .format(),
                    endDate: dayjs(eventPart?.endDate.slice(0, 19))
                        .tz(oldEvent.timezone, true)
                        .format(),
                    userId: eventPart?.userId,
                    user: eventPart?.user,
                    priority: eventPart?.priority,
                    isPreEvent: eventPart?.isPreEvent,
                    isPostEvent: eventPart?.isPostEvent,
                    positiveImpactScore: eventPart?.positiveImpactScore,
                    negativeImpactScore: eventPart?.negativeImpactScore,
                    modifiable: eventPart?.modifiable,
                    isMeeting: eventPart?.isMeeting,
                    isExternalMeeting: eventPart?.isExternalMeeting,
                    isExternalMeetingModifiable: eventPart?.isExternalMeetingModifiable,
                    isMeetingModifiable: eventPart?.isMeetingModifiable,
                    dailyTaskList: eventPart?.dailyTaskList,
                    weeklyTaskList: eventPart?.weeklyTaskList,
                    gap: eventPart?.gap,
                    totalWorkingHours: eventPart?.totalWorkingHours,
                    hardDeadline: eventPart?.hardDeadline,
                    softDeadline: eventPart?.softDeadline,
                    forEventId: eventPart?.forEventId,
                    positiveImpactDayOfWeek: eventPart?.positiveImpactDayOfWeek,
                    positiveImpactTime: eventPart?.positiveImpactTime,
                    negativeImpactDayOfWeek: eventPart?.negativeImpactDayOfWeek,
                    negativeImpactTime: eventPart?.negativeImpactTime,
                    preferredDayOfWeek: eventPart?.preferredDayOfWeek,
                    preferredTime: eventPart?.preferredTime,
                    preferredStartTimeRange: eventPart?.preferredStartTimeRange,
                    preferredEndTimeRange: eventPart?.preferredEndTimeRange,
                    event: eventPart?.event,
                };
            });
            return modifiedNewEventParts?.length > 0
                ? {
                    userId: mainHostId,
                    hostId: mainHostId,
                    eventParts: modifiedNewEventParts,
                    allEvents: filteredAllEvents,
                    breaks: parentBreaks,
                    oldEvents: oldHostEvents,
                    timeslots,
                    userPlannerRequestBody,
                }
                : null;
        }
    }
    catch (e) {
        console.log(e, ' unable to process events for optaplanner for host attendee');
    }
};
export const processEventsForOptaPlannerForInternalAttendees = async (mainHostId, allEvents, windowStartDate, windowEndDate, hostTimezone, internalAttendees, oldEvents, oldMeetingEvents, newMeetingEvents, newHostBufferTimes) => {
    try {
        const newBufferTimeArray = [];
        for (const newHostBufferTime of newHostBufferTimes) {
            if (newHostBufferTime?.beforeEvent?.id) {
                console.log(newHostBufferTime?.beforeEvent, ' newTimeBlocking?.beforeEvent');
                newBufferTimeArray.push(newHostBufferTime.beforeEvent);
            }
            if (newHostBufferTime?.afterEvent?.id) {
                console.log(newHostBufferTime?.afterEvent, ' newTimeBlocking?.afterEvent');
                newBufferTimeArray.push(newHostBufferTime.afterEvent);
            }
        }
        oldMeetingEvents?.forEach((o) => console.log(o, ' oldMeetingEvents'));
        internalAttendees?.forEach((i) => console.log(i, ' internalAttendees inside processEventsForOptaPlannerForInternalAttendees'));
        const filteredOldMeetingEvents = oldMeetingEvents
            ?.map((m) => {
            const foundIndex = allEvents?.findIndex((a) => a?.id === m?.id);
            if (foundIndex > -1) {
                return null;
            }
            return m;
        })
            ?.filter((e) => !!e);
        filteredOldMeetingEvents?.forEach((e) => console.log(e, ' filteredOldMeetingEvents'));
        const modifiedAllEvents = _.cloneDeep(allEvents)?.filter((e) => {
            if (filteredOldMeetingEvents?.[0]?.id) {
                const foundIndex = filteredOldMeetingEvents?.findIndex((m) => m?.id === e?.id);
                if (foundIndex > -1) {
                    return false;
                }
                return true;
            }
            return true;
        });
        if (filteredOldMeetingEvents?.[0]?.id) {
            modifiedAllEvents.push(...filteredOldMeetingEvents?.map((a) => convertMeetingPlusTypeToEventPlusType(a)));
        }
        if (newBufferTimeArray?.length > 0) {
            modifiedAllEvents.push(...newBufferTimeArray);
        }
        if (newMeetingEvents?.length > 0) {
            modifiedAllEvents.push(...newMeetingEvents?.map((m) => convertMeetingPlusTypeToEventPlusType(m)));
        }
        modifiedAllEvents?.forEach((e) => console.log(e, ' modifiedAllEvents'));
        const unfilteredUserPreferences = [];
        for (const internalAttendee of internalAttendees) {
            const userPreference = await getUserPreferences(internalAttendee?.userId);
            unfilteredUserPreferences.push(userPreference);
        }
        const userPreferences = _.uniqWith(unfilteredUserPreferences, _.isEqual);
        const unfilteredGlobalPrimaryCalendars = [];
        for (const internalAttendee of internalAttendees) {
            const globalPrimaryCalendar = await getGlobalCalendar(internalAttendee?.userId);
            unfilteredGlobalPrimaryCalendars.push(globalPrimaryCalendar);
        }
        const globalPrimaryCalendars = _.uniqWith(unfilteredGlobalPrimaryCalendars, _.isEqual);
        globalPrimaryCalendars?.forEach((c) => console.log(c, ' globalPrimaryCalendars'));
        const modifiedAllEventsWithBreaks = [];
        let parentBreaks = [];
        for (const userPreference of userPreferences) {
            const globalPrimaryCalendar = globalPrimaryCalendars?.find((g) => g?.userId === userPreference?.userId);
            if (!globalPrimaryCalendar) {
                throw new Error('no global primary calendar found');
            }
            const userId = userPreference?.userId;
            const breaks = await generateBreakEventsForDate(userPreference, userId, windowStartDate, windowEndDate, hostTimezone, globalPrimaryCalendar?.id);
            breaks.forEach((b) => console.log(b, ' generatedBreaks'));
            if (breaks?.length > 0) {
                const allEventsWithDuplicateFreeBreaks = _.differenceBy(modifiedAllEvents, breaks, 'id');
                modifiedAllEventsWithBreaks.push(...allEventsWithDuplicateFreeBreaks?.filter((e) => e?.userId === userId));
                modifiedAllEventsWithBreaks.push(...breaks);
                parentBreaks.push(...breaks);
            }
            else {
                modifiedAllEventsWithBreaks.push(...modifiedAllEvents?.filter((e) => e?.userId === userId));
            }
        }
        modifiedAllEventsWithBreaks?.forEach((m) => console.log(m, ' modifiedAllEventsWithBreaks'));
        const diffDays = dayjs(windowEndDate.slice(0, 19)).diff(dayjs(windowStartDate.slice(0, 19)), 'day');
        console.log(diffDays, windowEndDate, windowStartDate, ' diffDays, windowEndDate, windowStartDate');
        const startDatesForEachDay = [];
        for (let i = 0; i <= diffDays; i++) {
            startDatesForEachDay.push(dayjs(windowStartDate.slice(0, 19))
                .tz(hostTimezone, true)
                .add(i, 'day')
                .format());
        }
        console.log(startDatesForEachDay, ' startDatesForEachDay');
        const unfilteredWorkTimes = [];
        for (const internalAttendee of internalAttendees) {
            const userPreference = userPreferences.find((u) => u.userId === internalAttendee.userId);
            const attendeeTimezone = internalAttendee?.timezone;
            const workTimesForAttendee = generateWorkTimesForInternalAttendee(mainHostId, internalAttendee.userId, userPreference, hostTimezone, attendeeTimezone);
            unfilteredWorkTimes.push(...workTimesForAttendee);
        }
        console.log(unfilteredWorkTimes, 'unfilteredWorkTimes');
        const workTimes = _.uniqWith(unfilteredWorkTimes, _.isEqual);
        const unfilteredTimeslots = [];
        const timeslots = [];
        for (let i = 0; i < startDatesForEachDay.length; i++) {
            if (i === 0) {
                for (const internalAttendee of internalAttendees) {
                    const userPreference = userPreferences.find((u) => u.userId === internalAttendee.userId);
                    const timeslotsForDay = await generateTimeSlotsLiteForInternalAttendee(startDatesForEachDay?.[i], mainHostId, userPreference, hostTimezone, internalAttendee?.timezone, true);
                    unfilteredTimeslots.push(...timeslotsForDay);
                }
                continue;
            }
            for (const internalAttendee of internalAttendees) {
                const userPreference = userPreferences.find((u) => u.userId === internalAttendee.userId);
                const timeslotsForDay = await generateTimeSlotsLiteForInternalAttendee(startDatesForEachDay?.[i], mainHostId, userPreference, hostTimezone, internalAttendee?.timezone, false);
                unfilteredTimeslots.push(...timeslotsForDay);
            }
        }
        timeslots.push(..._.uniqWith(unfilteredTimeslots, _.isEqual));
        console.log(timeslots, ' timeslots');
        const unfilteredAllEvents = [];
        for (const internalAttendee of internalAttendees) {
            const userPreference = userPreferences.find((u) => u.userId === internalAttendee.userId);
            const modifiedAllEventsWithBreaksWithUser = modifiedAllEventsWithBreaks.filter((e) => e.userId === internalAttendee.userId);
            const events = modifiedAllEventsWithBreaksWithUser.filter((e) => validateEventDates(e, userPreference));
            unfilteredAllEvents.push(...events);
        }
        unfilteredAllEvents?.forEach((e) => console.log(e, ' unfilteredAllEvents'));
        const filteredAllEvents = _.uniqBy(unfilteredAllEvents, 'id');
        filteredAllEvents?.forEach((e) => console.log(e, ' filteredAllEvents'));
        let eventParts = [];
        const eventPartMinisAccumulated = [];
        for (const event of filteredAllEvents) {
            const eventPartMinis = generateEventPartsLite(event, mainHostId);
            eventPartMinisAccumulated.push(...eventPartMinis);
        }
        eventPartMinisAccumulated?.forEach((e) => console.log(e, ' eventPartMinisAccumulated'));
        const modifiedEventPartMinisPreBuffer = modifyEventPartsForMultiplePreBufferTime(eventPartMinisAccumulated);
        const modifiedEventPartMinisPreAndPostBuffer = modifyEventPartsForMultiplePostBufferTime(modifiedEventPartMinisPreBuffer);
        modifiedEventPartMinisPreAndPostBuffer?.forEach((e) => console.log(e, ' modifiedEventPartMinisPreAndPostBuffer'));
        const formattedEventParts = [];
        for (const userPreference of userPreferences) {
            const formattedEventPartsForUser = modifiedEventPartMinisPreAndPostBuffer
                ?.filter((e) => e?.userId === userPreference?.userId)
                ?.map((e) => formatEventTypeToPlannerEvent(e, userPreference, workTimes, hostTimezone));
            formattedEventPartsForUser?.forEach((e) => console.log(e, ' formattedEventPartsForUser'));
            formattedEventParts.push(...formattedEventPartsForUser);
        }
        formattedEventParts?.forEach((e) => console.log(e, ' formattedEventParts'));
        if (formattedEventParts.length > 0) {
            eventParts.push(..._.uniqWith(formattedEventParts, _.isEqual));
        }
        if (eventParts.length > 0) {
            eventParts.forEach((e) => console.log(e, ' eventParts after formatting'));
            const newEventPartsWithPreferredTimeSet = eventParts.map((e) => setPreferredTimeForUnModifiableEvent(e, allEvents.find((f) => f.id === e.eventId)?.timezone));
            newEventPartsWithPreferredTimeSet.forEach((e) => console.log(e, ' newEventPartsWithPreferredTimeSet'));
            const newEventParts = await tagEventsForDailyOrWeeklyTask(newEventPartsWithPreferredTimeSet);
            newEventParts.forEach((e) => console.log(e, ' newEventParts after tagEventsForDailyOrWeeklyTask'));
            const unfilteredUserList = [];
            for (const userPreference of userPreferences) {
                const userPlannerRequestBody = generateUserPlannerRequestBody(userPreference, userPreference?.userId, workTimes, mainHostId);
                console.log(userPlannerRequestBody, ' userPlannerRequestBody');
                unfilteredUserList.push(userPlannerRequestBody);
            }
            const userList = _.uniqWith(unfilteredUserList, _.isEqual);
            const modifiedNewEventParts = newEventParts.map((eventPart) => {
                const oldEvent = filteredAllEvents.find((event) => event.id === eventPart.eventId);
                return {
                    groupId: eventPart?.groupId,
                    eventId: eventPart?.eventId,
                    part: eventPart?.part,
                    lastPart: eventPart?.lastPart,
                    meetingPart: eventPart?.meetingPart,
                    meetingLastPart: eventPart?.meetingLastPart,
                    meetingId: eventPart?.meetingId,
                    hostId: mainHostId,
                    startDate: dayjs(eventPart?.startDate.slice(0, 19))
                        .tz(oldEvent.timezone, true)
                        .tz(hostTimezone)
                        .format(),
                    endDate: dayjs(eventPart?.endDate.slice(0, 19))
                        .tz(oldEvent.timezone, true)
                        .tz(hostTimezone)
                        .format(),
                    userId: eventPart?.userId,
                    user: eventPart?.user,
                    priority: eventPart?.priority,
                    isPreEvent: eventPart?.isPreEvent,
                    isPostEvent: eventPart?.isPostEvent,
                    positiveImpactScore: eventPart?.positiveImpactScore,
                    negativeImpactScore: eventPart?.negativeImpactScore,
                    modifiable: eventPart?.modifiable,
                    isMeeting: eventPart?.isMeeting,
                    isExternalMeeting: eventPart?.isExternalMeeting,
                    isExternalMeetingModifiable: eventPart?.isExternalMeetingModifiable,
                    isMeetingModifiable: eventPart?.isMeetingModifiable,
                    dailyTaskList: eventPart?.dailyTaskList,
                    weeklyTaskList: eventPart?.weeklyTaskList,
                    gap: eventPart?.gap,
                    totalWorkingHours: eventPart?.totalWorkingHours,
                    hardDeadline: eventPart?.hardDeadline,
                    softDeadline: eventPart?.softDeadline,
                    forEventId: eventPart?.forEventId,
                    positiveImpactDayOfWeek: eventPart?.positiveImpactDayOfWeek,
                    positiveImpactTime: eventPart?.positiveImpactTime,
                    negativeImpactDayOfWeek: eventPart?.negativeImpactDayOfWeek,
                    negativeImpactTime: eventPart?.negativeImpactTime,
                    preferredDayOfWeek: eventPart?.preferredDayOfWeek,
                    preferredTime: eventPart?.preferredTime,
                    preferredStartTimeRange: eventPart?.preferredStartTimeRange,
                    preferredEndTimeRange: eventPart?.preferredEndTimeRange,
                    event: eventPart?.event,
                };
            });
            modifiedNewEventParts?.forEach((e) => console.log(e, ' modifiedNewEventParts'));
            return modifiedNewEventParts?.length > 0
                ? {
                    userIds: internalAttendees.map((a) => a.userId),
                    hostId: mainHostId,
                    eventParts: modifiedNewEventParts,
                    allEvents: filteredAllEvents,
                    breaks: parentBreaks,
                    oldEvents,
                    timeslots,
                    userList,
                }
                : null;
        }
    }
    catch (e) {
        console.log(e, ' unable to process events for optaplanner for each attendee');
    }
};
export const processEventsForOptaPlanner = async (mainHostId, internalAttendees, meetingEventPlus, newMeetingEventPlus, allEvents, windowStartDate, windowEndDate, hostTimezone, oldEvents, externalAttendees, meetingAssistEvents, newHostReminders, newHostBufferTimes) => {
    try {
        console.log(windowStartDate, windowEndDate, ' windowStartDate, windowEndDate inside processEventsForOptaPlanner');
        const newInternalMeetingEventsPlus = newMeetingEventPlus
            ?.map((e) => {
            const foundIndex = externalAttendees?.findIndex((a) => a?.userId === e?.userId);
            if (foundIndex > -1) {
                return null;
            }
            return e;
        })
            ?.filter((e) => e !== null);
        const newExternalMeetingEventsPlus = newMeetingEventPlus
            ?.map((e) => {
            const foundIndex = externalAttendees?.findIndex((a) => a?.userId === e?.userId);
            if (foundIndex > -1) {
                return e;
            }
            return null;
        })
            ?.filter((e) => e !== null);
        const allHostEvents = allEvents.filter((e) => e.userId === mainHostId);
        const oldHostEvents = oldEvents.filter((e) => e?.userId === mainHostId);
        const hostIsInternalAttendee = internalAttendees.some((ia) => ia?.userId === mainHostId);
        let returnValuesFromInternalAttendees = {};
        let returnValuesFromHost = {};
        console.log(hostIsInternalAttendee, ' hostIsInternalAttendee');
        if (hostIsInternalAttendee) {
            returnValuesFromInternalAttendees =
                await processEventsForOptaPlannerForInternalAttendees(mainHostId, allEvents, windowStartDate, windowEndDate, hostTimezone, internalAttendees, oldEvents, meetingEventPlus, newInternalMeetingEventsPlus, newHostBufferTimes);
        }
        else {
            returnValuesFromHost = await processEventsForOptaPlannerForMainHost(mainHostId, allHostEvents, windowStartDate, windowEndDate, hostTimezone, oldHostEvents, newHostBufferTimes);
        }
        console.log(returnValuesFromInternalAttendees, ' returnValuesFromInternalAttendees');
        const externalMeetingEventPlus = meetingEventPlus
            .map((e) => {
            const foundIndex = externalAttendees.findIndex((a) => a?.userId === e?.userId);
            if (foundIndex > -1) {
                return e;
            }
            return null;
        })
            ?.filter((e) => e !== null);
        const returnValuesFromExternalAttendees = externalAttendees?.length > 0
            ? await processEventsForOptaPlannerForExternalAttendees(externalAttendees?.map((a) => a.userId), mainHostId, meetingAssistEvents, windowStartDate, windowEndDate, hostTimezone, externalAttendees, externalMeetingEventPlus, newExternalMeetingEventsPlus)
            : null;
        const eventParts = [];
        const allEventsForPlanner = [];
        const breaks = [];
        const oldEventsForPlanner = [];
        const oldAttendeeEvents = [];
        const unfilteredTimeslots = [];
        const unfilteredUserList = [];
        if (returnValuesFromHost
            ?.eventParts?.length > 0) {
            eventParts.push(...returnValuesFromHost
                ?.eventParts);
        }
        if (returnValuesFromHost
            ?.allEvents?.length > 0) {
            allEventsForPlanner.push(...returnValuesFromHost
                ?.allEvents);
        }
        if (returnValuesFromHost?.breaks
            ?.length > 0) {
            breaks.push(...returnValuesFromHost
                ?.breaks);
        }
        if (returnValuesFromHost
            ?.oldEvents?.length > 0) {
            oldEventsForPlanner.push(...returnValuesFromHost
                ?.oldEvents);
        }
        if (returnValuesFromHost
            ?.timeslots?.length > 0) {
            unfilteredTimeslots.push(...returnValuesFromHost
                ?.timeslots);
        }
        if (returnValuesFromHost
            ?.userPlannerRequestBody?.id) {
            unfilteredUserList.push(returnValuesFromHost
                ?.userPlannerRequestBody);
        }
        if (returnValuesFromInternalAttendees?.userList?.[0]?.id) {
            unfilteredUserList.push(...returnValuesFromInternalAttendees?.userList);
        }
        returnValuesFromInternalAttendees?.eventParts?.forEach((e) => console.log(e, ' (returnValuesFromInternalAttendees as ReturnBodyForAttendeeForOptaplannerPrepType)?.eventParts'));
        if (returnValuesFromInternalAttendees?.eventParts?.length > 0) {
            eventParts.push(...returnValuesFromInternalAttendees?.eventParts);
        }
        if (returnValuesFromInternalAttendees?.allEvents?.length > 0) {
            allEventsForPlanner.push(...returnValuesFromInternalAttendees?.allEvents);
        }
        returnValuesFromInternalAttendees?.breaks?.forEach((e) => console.log(e, ' (returnValuesFromInternalAttendees as ReturnBodyForAttendeeForOptaplannerPrepType)?.breaks'));
        if (returnValuesFromInternalAttendees?.breaks?.length > 0) {
            breaks.push(...returnValuesFromInternalAttendees?.breaks);
        }
        if (returnValuesFromInternalAttendees?.oldEvents?.length > 0) {
            oldEventsForPlanner.push(...returnValuesFromInternalAttendees?.oldEvents);
        }
        if (returnValuesFromInternalAttendees?.timeslots?.length > 0) {
            unfilteredTimeslots.push(...returnValuesFromInternalAttendees?.timeslots);
        }
        if (returnValuesFromExternalAttendees?.eventParts?.length > 0) {
            eventParts.push(...returnValuesFromExternalAttendees?.eventParts);
        }
        if (returnValuesFromExternalAttendees?.allEvents?.length > 0) {
            allEventsForPlanner.push(...returnValuesFromExternalAttendees?.allEvents);
        }
        if (returnValuesFromExternalAttendees?.oldAttendeeEvents?.length > 0) {
            oldAttendeeEvents.push(...returnValuesFromExternalAttendees?.oldAttendeeEvents);
        }
        if (returnValuesFromExternalAttendees?.timeslots?.length > 0) {
            unfilteredTimeslots.push(...returnValuesFromExternalAttendees?.timeslots);
        }
        if (returnValuesFromExternalAttendees?.userList?.length > 0) {
            unfilteredUserList.push(...returnValuesFromExternalAttendees?.userList);
        }
        console.log(oldEvents, ' oldEvents before saving to s3');
        const duplicateFreeEventParts = _.uniqWith(eventParts, _.isEqual);
        const duplicateFreeAllEvents = _.uniqWith(allEventsForPlanner, _.isEqual);
        const duplicateFreeBreaks = _.uniqWith(breaks, _.isEqual);
        const duplicateFreeOldEvents = _.uniqWith(oldEvents, _.isEqual);
        const duplicateFreeOldAttendeeEvents = _.uniqWith(oldAttendeeEvents, _.isEqual);
        const duplicateFreeTimeslots = _.uniqWith(unfilteredTimeslots, _.isEqual);
        const singletonId = uuid();
        console.log(eventParts, ' eventParts before validation');
        console.log(duplicateFreeEventParts, ' duplicateFreeEventParts before validation');
        console.log(duplicateFreeAllEvents, ' duplicateFreeAllEvents');
        console.log(duplicateFreeOldEvents, ' duplicateFreeOldEvents');
        console.log(duplicateFreeTimeslots, ' duplicateFreeTimeslots');
        if (!duplicateFreeEventParts || duplicateFreeEventParts?.length === 0) {
            throw new Error('Event Parts length is 0 or do not exist');
        }
        if (!duplicateFreeTimeslots || !(duplicateFreeTimeslots?.length > 0)) {
            throw new Error(' duplicateFreeTimeslots is empty');
        }
        if (!unfilteredUserList || !(unfilteredUserList?.length > 0)) {
            throw new Error('unfilteredUserList is empty');
        }
        duplicateFreeTimeslots?.forEach((d) => console.log(d, ' duplicateFreeTimeslots'));
        unfilteredUserList?.forEach((u) => console.log(u, ' unfilteredUserList'));
        newHostBufferTimes?.forEach((b) => console.log(b.beforeEvent, b.afterEvent, ' b.beforeEvent b.afterEvent '));
        const params = {
            Body: JSON.stringify({
                singletonId,
                hostId: mainHostId,
                eventParts: duplicateFreeEventParts,
                allEvents: duplicateFreeAllEvents,
                breaks: duplicateFreeBreaks,
                oldEvents: duplicateFreeOldEvents,
                oldAttendeeEvents: duplicateFreeOldAttendeeEvents,
                newHostBufferTimes: newHostBufferTimes,
                newHostReminders: newHostReminders,
                hostTimezone,
            }),
            Bucket: bucketName,
            Key: `${mainHostId}/${singletonId}.json`,
            ContentType: 'application/json',
        };
        const s3Command = new PutObjectCommand(params);
        const s3Response = await s3Client.send(s3Command);
        console.log(s3Response, ' s3Response');
        await optaPlanWeekly(duplicateFreeTimeslots, unfilteredUserList, duplicateFreeEventParts, singletonId, mainHostId, `${mainHostId}/${singletonId}.json`, optaplannerDuration, onOptaPlanCalendarAdminCallBackUrl);
        console.log('optaplanner request sent');
    }
    catch (e) {
        console.log(e, ' unable to process events for optaplanner');
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLWhlbHBlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImFwaS1oZWxwZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGdCQUFnQixFQUFFLFFBQVEsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ2hFLE9BQU8sRUFDTCxjQUFjLEVBQ2Qsa0JBQWtCLEVBQ2xCLHFDQUFxQyxFQUNyQyw2QkFBNkIsRUFDN0IsMEJBQTBCLEVBQzFCLHNCQUFzQixFQUN0Qix3Q0FBd0MsRUFDeEMsOEJBQThCLEVBQzlCLG9DQUFvQyxFQUNwQyxpQkFBaUIsRUFDakIseUNBQXlDLEVBQ3pDLHdDQUF3QyxFQUN4QywrQ0FBK0MsRUFDL0Msb0NBQW9DLEVBQ3BDLDZCQUE2QixFQUM3QixrQkFBa0IsR0FDbkIsTUFBTSxrQ0FBa0MsQ0FBQztBQUMxQyxPQUFPLEVBQ0wsVUFBVSxFQUNWLGtDQUFrQyxFQUNsQyxtQkFBbUIsR0FDcEIsTUFBTSxpQ0FBaUMsQ0FBQztBQUN6QyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFtQnpELE9BQU8sQ0FBQyxNQUFNLFFBQVEsQ0FBQztBQUN2QixPQUFPLEVBQUUsRUFBRSxJQUFJLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUVsQyxNQUFNLFFBQVEsR0FBRyxJQUFJLFFBQVEsQ0FBQztJQUM1QixXQUFXLEVBQUU7UUFDWCxXQUFXLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhO1FBQ3RDLGVBQWUsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWE7S0FDM0M7SUFDRCxRQUFRLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXO0lBQ2pDLGNBQWMsRUFBRSxJQUFJO0NBQ3JCLENBQUMsQ0FBQztBQUVILE1BQU0sQ0FBQyxNQUFNLHNDQUFzQyxHQUFHLEtBQUssRUFDekQsVUFBa0IsRUFDbEIsYUFBOEIsRUFDOUIsZUFBdUIsRUFDdkIsYUFBcUIsRUFDckIsWUFBb0IsRUFDcEIsYUFBOEIsRUFDOUIsa0JBQTJDLEVBQ08sRUFBRTtJQUNwRCxJQUFJLENBQUM7UUFDSCxNQUFNLGtCQUFrQixHQUFvQixFQUFFLENBQUM7UUFFL0MsS0FBSyxNQUFNLGlCQUFpQixJQUFJLGtCQUFrQixFQUFFLENBQUM7WUFDbkQsSUFBSSxpQkFBaUIsRUFBRSxXQUFXLEVBQUUsRUFBRSxFQUFFLENBQUM7Z0JBQ3ZDLE9BQU8sQ0FBQyxHQUFHLENBQ1QsaUJBQWlCLEVBQUUsV0FBVyxFQUM5QiwrQkFBK0IsQ0FDaEMsQ0FBQztnQkFDRixrQkFBa0IsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDekQsQ0FBQztZQUVELElBQUksaUJBQWlCLEVBQUUsVUFBVSxFQUFFLEVBQUUsRUFBRSxDQUFDO2dCQUN0QyxPQUFPLENBQUMsR0FBRyxDQUNULGlCQUFpQixFQUFFLFVBQVUsRUFDN0IsOEJBQThCLENBQy9CLENBQUM7Z0JBQ0Ysa0JBQWtCLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ3hELENBQUM7UUFDSCxDQUFDO1FBRUQsTUFBTSxxQkFBcUIsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBRXpELElBQUksa0JBQWtCLEVBQUUsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ25DLHFCQUFxQixDQUFDLElBQUksQ0FBQyxHQUFHLGtCQUFrQixDQUFDLENBQUM7UUFDcEQsQ0FBQztRQUVELE1BQU0sZUFBZSxHQUFHLE1BQU0sa0JBQWtCLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFN0QsTUFBTSxxQkFBcUIsR0FBRyxNQUFNLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRWxFLE1BQU0sUUFBUSxHQUFHLEtBQUssQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDckQsS0FBSyxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQ25DLEtBQUssQ0FDTixDQUFDO1FBRUYsTUFBTSwyQkFBMkIsR0FBb0IsRUFBRSxDQUFDO1FBRXhELE1BQU0sb0JBQW9CLEdBQUcsRUFBRSxDQUFDO1FBRWhDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxRQUFRLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNuQyxvQkFBb0IsQ0FBQyxJQUFJLENBQ3ZCLEtBQUssQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztpQkFDaEMsRUFBRSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUM7aUJBQ3RCLEdBQUcsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDO2lCQUNiLE1BQU0sRUFBRSxDQUNaLENBQUM7UUFDSixDQUFDO1FBRUQsSUFBSSxZQUFZLEdBQW9CLEVBQUUsQ0FBQztRQUV2QyxNQUFNLE1BQU0sR0FBRyxNQUFNLDBCQUEwQixDQUM3QyxlQUFlLEVBQ2YsVUFBVSxFQUNWLGVBQWUsRUFDZixhQUFhLEVBQ2IsWUFBWSxFQUNaLHFCQUFxQixFQUFFLEVBQUUsQ0FDMUIsQ0FBQztRQUVGLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLGtCQUFrQixDQUFDLENBQUMsQ0FBQztRQUUxRCxJQUFJLE1BQU0sRUFBRSxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDdkIsTUFBTSxnQ0FBZ0MsR0FBRyxDQUFDLENBQUMsWUFBWSxDQUNyRCxxQkFBcUIsRUFDckIsTUFBTSxFQUNOLElBQUksQ0FDTCxDQUFDO1lBQ0YsMkJBQTJCLENBQUMsSUFBSSxDQUFDLEdBQUcsZ0NBQWdDLENBQUMsQ0FBQztZQUN0RSwyQkFBMkIsQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQztZQUM1QyxZQUFZLENBQUMsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLENBQUM7UUFDL0IsQ0FBQzthQUFNLENBQUM7WUFDTiwyQkFBMkIsQ0FBQyxJQUFJLENBQUMsR0FBRyxxQkFBcUIsQ0FBQyxDQUFDO1FBQzdELENBQUM7UUFFRCxNQUFNLFNBQVMsR0FBRyxvQ0FBb0MsQ0FDcEQsVUFBVSxFQUNWLFVBQVUsRUFDVixlQUFlLEVBQ2YsWUFBWSxFQUNaLFlBQVksQ0FDYixDQUFDO1FBQ0YsTUFBTSxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBRXJCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxvQkFBb0IsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNyRCxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztnQkFDWixNQUFNLGVBQWUsR0FBRyxNQUFNLHdDQUF3QyxDQUNwRSxvQkFBb0IsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUN6QixVQUFVLEVBQ1YsZUFBZSxFQUNmLFlBQVksRUFDWixZQUFZLEVBQ1osSUFBSSxDQUNMLENBQUM7Z0JBQ0YsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLGVBQWUsQ0FBQyxDQUFDO2dCQUNuQyxTQUFTO1lBQ1gsQ0FBQztZQUNELE1BQU0sZUFBZSxHQUFHLE1BQU0sd0NBQXdDLENBQ3BFLG9CQUFvQixFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQ3pCLFVBQVUsRUFDVixlQUFlLEVBQ2YsWUFBWSxFQUNaLFlBQVksRUFDWixLQUFLLENBQ04sQ0FBQztZQUNGLFNBQVMsQ0FBQyxJQUFJLENBQUMsR0FBRyxlQUFlLENBQUMsQ0FBQztRQUNyQyxDQUFDO1FBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFFckMsTUFBTSxpQkFBaUIsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUNoQywyQkFBMkIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUN2QyxrQkFBa0IsQ0FBQyxDQUFDLEVBQUUsZUFBZSxDQUFDLENBQ3ZDLEVBQ0QsSUFBSSxDQUNMLENBQUM7UUFDRixJQUFJLFVBQVUsR0FBc0MsRUFBRSxDQUFDO1FBRXZELE1BQU0seUJBQXlCLEdBQUcsRUFBRSxDQUFDO1FBQ3JDLEtBQUssTUFBTSxLQUFLLElBQUksaUJBQWlCLEVBQUUsQ0FBQztZQUN0QyxNQUFNLGNBQWMsR0FBRyxzQkFBc0IsQ0FBQyxLQUFLLEVBQUUsVUFBVSxDQUFDLENBQUM7WUFDakUseUJBQXlCLENBQUMsSUFBSSxDQUFDLEdBQUcsY0FBYyxDQUFDLENBQUM7UUFDcEQsQ0FBQztRQUVELE1BQU0sK0JBQStCLEdBQ25DLHdDQUF3QyxDQUFDLHlCQUF5QixDQUFDLENBQUM7UUFDdEUsTUFBTSxzQ0FBc0MsR0FDMUMseUNBQXlDLENBQ3ZDLCtCQUErQixDQUNoQyxDQUFDO1FBQ0osTUFBTSxtQkFBbUIsR0FDdkIsc0NBQXNDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FDL0MsNkJBQTZCLENBQzNCLENBQUMsRUFDRCxlQUFlLEVBQ2YsU0FBUyxFQUNULFlBQVksQ0FDYixDQUNGLENBQUM7UUFDSixJQUFJLG1CQUFtQixFQUFFLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUNwQyxVQUFVLENBQUMsSUFBSSxDQUFDLEdBQUcsbUJBQW1CLENBQUMsQ0FBQztRQUMxQyxDQUFDO1FBRUQsSUFBSSxVQUFVLEVBQUUsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQzNCLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLDhCQUE4QixDQUFDLENBQUMsQ0FBQztZQUMxRSxNQUFNLGlDQUFpQyxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUM3RCxvQ0FBb0MsQ0FDbEMsQ0FBQyxFQUNELGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLFFBQVEsQ0FDeEQsQ0FDRixDQUFDO1lBQ0YsaUNBQWlDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FDOUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsb0NBQW9DLENBQUMsQ0FDckQsQ0FBQztZQUNGLE1BQU0sYUFBYSxHQUFHLE1BQU0sNkJBQTZCLENBQ3ZELGlDQUFpQyxDQUNsQyxDQUFDO1lBQ0YsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQzFCLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLG9EQUFvRCxDQUFDLENBQ3JFLENBQUM7WUFDRixNQUFNLHNCQUFzQixHQUFHLDhCQUE4QixDQUMzRCxlQUFlLEVBQ2YsZUFBZSxDQUFDLE1BQU0sRUFDdEIsU0FBUyxFQUNULFVBQVUsQ0FDWCxDQUFDO1lBQ0YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsRUFBRSx5QkFBeUIsQ0FBQyxDQUFDO1lBRS9ELE1BQU0scUJBQXFCLEdBQ3pCLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxTQUFTLEVBQUUsRUFBRTtnQkFDOUIsTUFBTSxRQUFRLEdBQUcsaUJBQWlCLENBQUMsSUFBSSxDQUNyQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsS0FBSyxTQUFTLENBQUMsT0FBTyxDQUMxQyxDQUFDO2dCQUNGLE9BQU87b0JBQ0wsT0FBTyxFQUFFLFNBQVMsRUFBRSxPQUFPO29CQUMzQixPQUFPLEVBQUUsU0FBUyxFQUFFLE9BQU87b0JBQzNCLElBQUksRUFBRSxTQUFTLEVBQUUsSUFBSTtvQkFDckIsUUFBUSxFQUFFLFNBQVMsRUFBRSxRQUFRO29CQUM3QixXQUFXLEVBQUUsU0FBUyxFQUFFLFdBQVc7b0JBQ25DLGVBQWUsRUFBRSxTQUFTLEVBQUUsZUFBZTtvQkFDM0MsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTO29CQUMvQixNQUFNLEVBQUUsVUFBVTtvQkFDbEIsU0FBUyxFQUFFLEtBQUssQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7eUJBQ2hELEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQzt5QkFDM0IsTUFBTSxFQUFFO29CQUNYLE9BQU8sRUFBRSxLQUFLLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO3lCQUM1QyxFQUFFLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUM7eUJBQzNCLE1BQU0sRUFBRTtvQkFDWCxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU07b0JBQ3pCLElBQUksRUFBRSxTQUFTLEVBQUUsSUFBSTtvQkFDckIsUUFBUSxFQUFFLFNBQVMsRUFBRSxRQUFRO29CQUM3QixVQUFVLEVBQUUsU0FBUyxFQUFFLFVBQVU7b0JBQ2pDLFdBQVcsRUFBRSxTQUFTLEVBQUUsV0FBVztvQkFDbkMsbUJBQW1CLEVBQUUsU0FBUyxFQUFFLG1CQUFtQjtvQkFDbkQsbUJBQW1CLEVBQUUsU0FBUyxFQUFFLG1CQUFtQjtvQkFDbkQsVUFBVSxFQUFFLFNBQVMsRUFBRSxVQUFVO29CQUNqQyxTQUFTLEVBQUUsU0FBUyxFQUFFLFNBQVM7b0JBQy9CLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxpQkFBaUI7b0JBQy9DLDJCQUEyQixFQUFFLFNBQVMsRUFBRSwyQkFBMkI7b0JBQ25FLG1CQUFtQixFQUFFLFNBQVMsRUFBRSxtQkFBbUI7b0JBQ25ELGFBQWEsRUFBRSxTQUFTLEVBQUUsYUFBYTtvQkFDdkMsY0FBYyxFQUFFLFNBQVMsRUFBRSxjQUFjO29CQUN6QyxHQUFHLEVBQUUsU0FBUyxFQUFFLEdBQUc7b0JBQ25CLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxpQkFBaUI7b0JBQy9DLFlBQVksRUFBRSxTQUFTLEVBQUUsWUFBWTtvQkFDckMsWUFBWSxFQUFFLFNBQVMsRUFBRSxZQUFZO29CQUNyQyxVQUFVLEVBQUUsU0FBUyxFQUFFLFVBQVU7b0JBQ2pDLHVCQUF1QixFQUFFLFNBQVMsRUFBRSx1QkFBdUI7b0JBQzNELGtCQUFrQixFQUFFLFNBQVMsRUFBRSxrQkFBa0I7b0JBQ2pELHVCQUF1QixFQUFFLFNBQVMsRUFBRSx1QkFBdUI7b0JBQzNELGtCQUFrQixFQUFFLFNBQVMsRUFBRSxrQkFBa0I7b0JBQ2pELGtCQUFrQixFQUFFLFNBQVMsRUFBRSxrQkFBa0I7b0JBQ2pELGFBQWEsRUFBRSxTQUFTLEVBQUUsYUFBYTtvQkFDdkMsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLHVCQUF1QjtvQkFDM0QscUJBQXFCLEVBQUUsU0FBUyxFQUFFLHFCQUFxQjtvQkFDdkQsS0FBSyxFQUFFLFNBQVMsRUFBRSxLQUFLO2lCQUN4QixDQUFDO1lBQ0osQ0FBQyxDQUFDLENBQUM7WUFFTCxPQUFPLHFCQUFxQixFQUFFLE1BQU0sR0FBRyxDQUFDO2dCQUN0QyxDQUFDLENBQUM7b0JBQ0UsTUFBTSxFQUFFLFVBQVU7b0JBQ2xCLE1BQU0sRUFBRSxVQUFVO29CQUNsQixVQUFVLEVBQUUscUJBQXFCO29CQUNqQyxTQUFTLEVBQUUsaUJBQWlCO29CQUM1QixNQUFNLEVBQUUsWUFBWTtvQkFDcEIsU0FBUyxFQUFFLGFBQWE7b0JBQ3hCLFNBQVM7b0JBQ1Qsc0JBQXNCO2lCQUN2QjtnQkFDSCxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQ1gsQ0FBQztJQUNILENBQUM7SUFBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1FBQ1gsT0FBTyxDQUFDLEdBQUcsQ0FDVCxDQUFDLEVBQ0QsNkRBQTZELENBQzlELENBQUM7SUFDSixDQUFDO0FBQ0gsQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0sK0NBQStDLEdBQUcsS0FBSyxFQUNsRSxVQUFrQixFQUNsQixTQUEwQixFQUMxQixlQUF1QixFQUN2QixhQUFxQixFQUNyQixZQUFvQixFQUNwQixpQkFBOEMsRUFDOUMsU0FBMEIsRUFDMUIsZ0JBQXlDLEVBQ3pDLGdCQUF5QyxFQUN6QyxrQkFBMkMsRUFDVyxFQUFFO0lBQ3hELElBQUksQ0FBQztRQUNILE1BQU0sa0JBQWtCLEdBQW9CLEVBQUUsQ0FBQztRQUUvQyxLQUFLLE1BQU0saUJBQWlCLElBQUksa0JBQWtCLEVBQUUsQ0FBQztZQUNuRCxJQUFJLGlCQUFpQixFQUFFLFdBQVcsRUFBRSxFQUFFLEVBQUUsQ0FBQztnQkFDdkMsT0FBTyxDQUFDLEdBQUcsQ0FDVCxpQkFBaUIsRUFBRSxXQUFXLEVBQzlCLCtCQUErQixDQUNoQyxDQUFDO2dCQUNGLGtCQUFrQixDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUN6RCxDQUFDO1lBRUQsSUFBSSxpQkFBaUIsRUFBRSxVQUFVLEVBQUUsRUFBRSxFQUFFLENBQUM7Z0JBQ3RDLE9BQU8sQ0FBQyxHQUFHLENBQ1QsaUJBQWlCLEVBQUUsVUFBVSxFQUM3Qiw4QkFBOEIsQ0FDL0IsQ0FBQztnQkFDRixrQkFBa0IsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDeEQsQ0FBQztRQUNILENBQUM7UUFFRCxnQkFBZ0IsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLG1CQUFtQixDQUFDLENBQUMsQ0FBQztRQUN0RSxpQkFBaUIsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUMvQixPQUFPLENBQUMsR0FBRyxDQUNULENBQUMsRUFDRCwyRUFBMkUsQ0FDNUUsQ0FDRixDQUFDO1FBQ0YsTUFBTSx3QkFBd0IsR0FBRyxnQkFBZ0I7WUFDL0MsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtZQUNWLE1BQU0sVUFBVSxHQUFHLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRWhFLElBQUksVUFBVSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUM7Z0JBQ3BCLE9BQU8sSUFBSSxDQUFDO1lBQ2QsQ0FBQztZQUNELE9BQU8sQ0FBQyxDQUFDO1FBQ1gsQ0FBQyxDQUFDO1lBQ0YsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUV2Qix3QkFBd0IsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUN0QyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSwyQkFBMkIsQ0FBQyxDQUM1QyxDQUFDO1FBQ0YsTUFBTSxpQkFBaUIsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFO1lBQzdELElBQUksd0JBQXdCLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQztnQkFDdEMsTUFBTSxVQUFVLEdBQUcsd0JBQXdCLEVBQUUsU0FBUyxDQUNwRCxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUN2QixDQUFDO2dCQUNGLElBQUksVUFBVSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUM7b0JBQ3BCLE9BQU8sS0FBSyxDQUFDO2dCQUNmLENBQUM7Z0JBQ0QsT0FBTyxJQUFJLENBQUM7WUFDZCxDQUFDO1lBQ0QsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksd0JBQXdCLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQztZQUN0QyxpQkFBaUIsQ0FBQyxJQUFJLENBQ3BCLEdBQUcsd0JBQXdCLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FDckMscUNBQXFDLENBQUMsQ0FBQyxDQUFDLENBQ3pDLENBQ0YsQ0FBQztRQUNKLENBQUM7UUFFRCxJQUFJLGtCQUFrQixFQUFFLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUNuQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsR0FBRyxrQkFBa0IsQ0FBQyxDQUFDO1FBQ2hELENBQUM7UUFFRCxJQUFJLGdCQUFnQixFQUFFLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUNqQyxpQkFBaUIsQ0FBQyxJQUFJLENBQ3BCLEdBQUcsZ0JBQWdCLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FDN0IscUNBQXFDLENBQUMsQ0FBQyxDQUFDLENBQ3pDLENBQ0YsQ0FBQztRQUNKLENBQUM7UUFFRCxpQkFBaUIsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLG9CQUFvQixDQUFDLENBQUMsQ0FBQztRQUV4RSxNQUFNLHlCQUF5QixHQUF5QixFQUFFLENBQUM7UUFDM0QsS0FBSyxNQUFNLGdCQUFnQixJQUFJLGlCQUFpQixFQUFFLENBQUM7WUFDakQsTUFBTSxjQUFjLEdBQUcsTUFBTSxrQkFBa0IsQ0FBQyxnQkFBZ0IsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUMxRSx5QkFBeUIsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDakQsQ0FBQztRQUVELE1BQU0sZUFBZSxHQUF5QixDQUFDLENBQUMsUUFBUSxDQUN0RCx5QkFBeUIsRUFDekIsQ0FBQyxDQUFDLE9BQU8sQ0FDVixDQUFDO1FBRUYsTUFBTSxnQ0FBZ0MsR0FBbUIsRUFBRSxDQUFDO1FBRTVELEtBQUssTUFBTSxnQkFBZ0IsSUFBSSxpQkFBaUIsRUFBRSxDQUFDO1lBQ2pELE1BQU0scUJBQXFCLEdBQUcsTUFBTSxpQkFBaUIsQ0FDbkQsZ0JBQWdCLEVBQUUsTUFBTSxDQUN6QixDQUFDO1lBQ0YsZ0NBQWdDLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDL0QsQ0FBQztRQUVELE1BQU0sc0JBQXNCLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FDdkMsZ0NBQWdDLEVBQ2hDLENBQUMsQ0FBQyxPQUFPLENBQ1YsQ0FBQztRQUVGLHNCQUFzQixFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQ3BDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLHlCQUF5QixDQUFDLENBQzFDLENBQUM7UUFFRixNQUFNLDJCQUEyQixHQUFvQixFQUFFLENBQUM7UUFFeEQsSUFBSSxZQUFZLEdBQW9CLEVBQUUsQ0FBQztRQUN2QyxLQUFLLE1BQU0sY0FBYyxJQUFJLGVBQWUsRUFBRSxDQUFDO1lBQzdDLE1BQU0scUJBQXFCLEdBQUcsc0JBQXNCLEVBQUUsSUFBSSxDQUN4RCxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sS0FBSyxjQUFjLEVBQUUsTUFBTSxDQUM1QyxDQUFDO1lBQ0YsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7Z0JBQzNCLE1BQU0sSUFBSSxLQUFLLENBQUMsa0NBQWtDLENBQUMsQ0FBQztZQUN0RCxDQUFDO1lBQ0QsTUFBTSxNQUFNLEdBQUcsY0FBYyxFQUFFLE1BQU0sQ0FBQztZQUV0QyxNQUFNLE1BQU0sR0FBRyxNQUFNLDBCQUEwQixDQUM3QyxjQUFjLEVBQ2QsTUFBTSxFQUNOLGVBQWUsRUFDZixhQUFhLEVBQ2IsWUFBWSxFQUNaLHFCQUFxQixFQUFFLEVBQUUsQ0FDMUIsQ0FBQztZQUVGLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLGtCQUFrQixDQUFDLENBQUMsQ0FBQztZQUUxRCxJQUFJLE1BQU0sRUFBRSxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ3ZCLE1BQU0sZ0NBQWdDLEdBQUcsQ0FBQyxDQUFDLFlBQVksQ0FDckQsaUJBQWlCLEVBQ2pCLE1BQU0sRUFDTixJQUFJLENBQ0wsQ0FBQztnQkFDRiwyQkFBMkIsQ0FBQyxJQUFJLENBQzlCLEdBQUcsZ0NBQWdDLEVBQUUsTUFBTSxDQUN6QyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLE1BQU0sS0FBSyxNQUFNLENBQzVCLENBQ0YsQ0FBQztnQkFDRiwyQkFBMkIsQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQztnQkFDNUMsWUFBWSxDQUFDLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDO1lBQy9CLENBQUM7aUJBQU0sQ0FBQztnQkFDTiwyQkFBMkIsQ0FBQyxJQUFJLENBQzlCLEdBQUcsaUJBQWlCLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxLQUFLLE1BQU0sQ0FBQyxDQUMxRCxDQUFDO1lBQ0osQ0FBQztRQUNILENBQUM7UUFFRCwyQkFBMkIsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUN6QyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSw4QkFBOEIsQ0FBQyxDQUMvQyxDQUFDO1FBRUYsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUNyRCxLQUFLLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFDbkMsS0FBSyxDQUNOLENBQUM7UUFDRixPQUFPLENBQUMsR0FBRyxDQUNULFFBQVEsRUFDUixhQUFhLEVBQ2IsZUFBZSxFQUNmLDJDQUEyQyxDQUM1QyxDQUFDO1FBQ0YsTUFBTSxvQkFBb0IsR0FBRyxFQUFFLENBQUM7UUFFaEMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxJQUFJLFFBQVEsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ25DLG9CQUFvQixDQUFDLElBQUksQ0FDdkIsS0FBSyxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO2lCQUNoQyxFQUFFLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQztpQkFDdEIsR0FBRyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUM7aUJBQ2IsTUFBTSxFQUFFLENBQ1osQ0FBQztRQUNKLENBQUM7UUFFRCxPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixFQUFFLHVCQUF1QixDQUFDLENBQUM7UUFFM0QsTUFBTSxtQkFBbUIsR0FBbUIsRUFBRSxDQUFDO1FBQy9DLEtBQUssTUFBTSxnQkFBZ0IsSUFBSSxpQkFBaUIsRUFBRSxDQUFDO1lBQ2pELE1BQU0sY0FBYyxHQUFHLGVBQWUsQ0FBQyxJQUFJLENBQ3pDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxLQUFLLGdCQUFnQixDQUFDLE1BQU0sQ0FDNUMsQ0FBQztZQUNGLE1BQU0sZ0JBQWdCLEdBQUcsZ0JBQWdCLEVBQUUsUUFBUSxDQUFDO1lBQ3BELE1BQU0sb0JBQW9CLEdBQUcsb0NBQW9DLENBQy9ELFVBQVUsRUFDVixnQkFBZ0IsQ0FBQyxNQUFNLEVBQ3ZCLGNBQWMsRUFDZCxZQUFZLEVBQ1osZ0JBQWdCLENBQ2pCLENBQUM7WUFDRixtQkFBbUIsQ0FBQyxJQUFJLENBQUMsR0FBRyxvQkFBb0IsQ0FBQyxDQUFDO1FBQ3BELENBQUM7UUFFRCxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQixFQUFFLHFCQUFxQixDQUFDLENBQUM7UUFDeEQsTUFBTSxTQUFTLEdBQW1CLENBQUMsQ0FBQyxRQUFRLENBQzFDLG1CQUFtQixFQUNuQixDQUFDLENBQUMsT0FBTyxDQUNWLENBQUM7UUFFRixNQUFNLG1CQUFtQixHQUFHLEVBQUUsQ0FBQztRQUMvQixNQUFNLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFFckIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLG9CQUFvQixDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ3JELElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUNaLEtBQUssTUFBTSxnQkFBZ0IsSUFBSSxpQkFBaUIsRUFBRSxDQUFDO29CQUNqRCxNQUFNLGNBQWMsR0FBRyxlQUFlLENBQUMsSUFBSSxDQUN6QyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBSyxnQkFBZ0IsQ0FBQyxNQUFNLENBQzVDLENBQUM7b0JBQ0YsTUFBTSxlQUFlLEdBQ25CLE1BQU0sd0NBQXdDLENBQzVDLG9CQUFvQixFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQ3pCLFVBQVUsRUFDVixjQUFjLEVBQ2QsWUFBWSxFQUNaLGdCQUFnQixFQUFFLFFBQVEsRUFDMUIsSUFBSSxDQUNMLENBQUM7b0JBQ0osbUJBQW1CLENBQUMsSUFBSSxDQUFDLEdBQUcsZUFBZSxDQUFDLENBQUM7Z0JBQy9DLENBQUM7Z0JBQ0QsU0FBUztZQUNYLENBQUM7WUFDRCxLQUFLLE1BQU0sZ0JBQWdCLElBQUksaUJBQWlCLEVBQUUsQ0FBQztnQkFDakQsTUFBTSxjQUFjLEdBQUcsZUFBZSxDQUFDLElBQUksQ0FDekMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQUssZ0JBQWdCLENBQUMsTUFBTSxDQUM1QyxDQUFDO2dCQUNGLE1BQU0sZUFBZSxHQUFHLE1BQU0sd0NBQXdDLENBQ3BFLG9CQUFvQixFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQ3pCLFVBQVUsRUFDVixjQUFjLEVBQ2QsWUFBWSxFQUNaLGdCQUFnQixFQUFFLFFBQVEsRUFDMUIsS0FBSyxDQUNOLENBQUM7Z0JBQ0YsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEdBQUcsZUFBZSxDQUFDLENBQUM7WUFDL0MsQ0FBQztRQUNILENBQUM7UUFFRCxTQUFTLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUM5RCxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsQ0FBQztRQUVyQyxNQUFNLG1CQUFtQixHQUFvQixFQUFFLENBQUM7UUFDaEQsS0FBSyxNQUFNLGdCQUFnQixJQUFJLGlCQUFpQixFQUFFLENBQUM7WUFDakQsTUFBTSxjQUFjLEdBQUcsZUFBZSxDQUFDLElBQUksQ0FDekMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLEtBQUssZ0JBQWdCLENBQUMsTUFBTSxDQUM1QyxDQUFDO1lBQ0YsTUFBTSxtQ0FBbUMsR0FDdkMsMkJBQTJCLENBQUMsTUFBTSxDQUNoQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBSyxnQkFBZ0IsQ0FBQyxNQUFNLENBQzVDLENBQUM7WUFDSixNQUFNLE1BQU0sR0FBRyxtQ0FBbUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUM5RCxrQkFBa0IsQ0FBQyxDQUFDLEVBQUUsY0FBYyxDQUFDLENBQ3RDLENBQUM7WUFDRixtQkFBbUIsQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQztRQUN0QyxDQUFDO1FBQ0QsbUJBQW1CLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxzQkFBc0IsQ0FBQyxDQUFDLENBQUM7UUFFNUUsTUFBTSxpQkFBaUIsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDLG1CQUFtQixFQUFFLElBQUksQ0FBQyxDQUFDO1FBRTlELGlCQUFpQixFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsb0JBQW9CLENBQUMsQ0FBQyxDQUFDO1FBRXhFLElBQUksVUFBVSxHQUFzQyxFQUFFLENBQUM7UUFFdkQsTUFBTSx5QkFBeUIsR0FBRyxFQUFFLENBQUM7UUFDckMsS0FBSyxNQUFNLEtBQUssSUFBSSxpQkFBaUIsRUFBRSxDQUFDO1lBQ3RDLE1BQU0sY0FBYyxHQUFHLHNCQUFzQixDQUFDLEtBQUssRUFBRSxVQUFVLENBQUMsQ0FBQztZQUNqRSx5QkFBeUIsQ0FBQyxJQUFJLENBQUMsR0FBRyxjQUFjLENBQUMsQ0FBQztRQUNwRCxDQUFDO1FBRUQseUJBQXlCLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FDdkMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsNEJBQTRCLENBQUMsQ0FDN0MsQ0FBQztRQUNGLE1BQU0sK0JBQStCLEdBQ25DLHdDQUF3QyxDQUFDLHlCQUF5QixDQUFDLENBQUM7UUFDdEUsTUFBTSxzQ0FBc0MsR0FDMUMseUNBQXlDLENBQ3ZDLCtCQUErQixDQUNoQyxDQUFDO1FBRUosc0NBQXNDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FDcEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUseUNBQXlDLENBQUMsQ0FDMUQsQ0FBQztRQUVGLE1BQU0sbUJBQW1CLEdBQXNDLEVBQUUsQ0FBQztRQUNsRSxLQUFLLE1BQU0sY0FBYyxJQUFJLGVBQWUsRUFBRSxDQUFDO1lBQzdDLE1BQU0sMEJBQTBCLEdBQzlCLHNDQUFzQztnQkFDcEMsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEtBQUssY0FBYyxFQUFFLE1BQU0sQ0FBQztnQkFDckQsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUNWLDZCQUE2QixDQUMzQixDQUFDLEVBQ0QsY0FBYyxFQUNkLFNBQVMsRUFDVCxZQUFZLENBQ2IsQ0FDRixDQUFDO1lBRU4sMEJBQTBCLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FDeEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsNkJBQTZCLENBQUMsQ0FDOUMsQ0FBQztZQUVGLG1CQUFtQixDQUFDLElBQUksQ0FBQyxHQUFHLDBCQUEwQixDQUFDLENBQUM7UUFDMUQsQ0FBQztRQUVELG1CQUFtQixFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsc0JBQXNCLENBQUMsQ0FBQyxDQUFDO1FBRTVFLElBQUksbUJBQW1CLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ25DLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ2pFLENBQUM7UUFFRCxJQUFJLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDMUIsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsOEJBQThCLENBQUMsQ0FBQyxDQUFDO1lBQzFFLE1BQU0saUNBQWlDLEdBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQzdELG9DQUFvQyxDQUNsQyxDQUFDLEVBQ0QsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsUUFBUSxDQUNwRCxDQUNGLENBQUM7WUFDRixpQ0FBaUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUM5QyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxvQ0FBb0MsQ0FBQyxDQUNyRCxDQUFDO1lBQ0YsTUFBTSxhQUFhLEdBQUcsTUFBTSw2QkFBNkIsQ0FDdkQsaUNBQWlDLENBQ2xDLENBQUM7WUFDRixhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FDMUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsb0RBQW9ELENBQUMsQ0FDckUsQ0FBQztZQUNGLE1BQU0sa0JBQWtCLEdBQWlDLEVBQUUsQ0FBQztZQUM1RCxLQUFLLE1BQU0sY0FBYyxJQUFJLGVBQWUsRUFBRSxDQUFDO2dCQUM3QyxNQUFNLHNCQUFzQixHQUFHLDhCQUE4QixDQUMzRCxjQUFjLEVBQ2QsY0FBYyxFQUFFLE1BQU0sRUFDdEIsU0FBUyxFQUNULFVBQVUsQ0FDWCxDQUFDO2dCQUNGLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLEVBQUUseUJBQXlCLENBQUMsQ0FBQztnQkFDL0Qsa0JBQWtCLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7WUFDbEQsQ0FBQztZQUVELE1BQU0sUUFBUSxHQUFpQyxDQUFDLENBQUMsUUFBUSxDQUN2RCxrQkFBa0IsRUFDbEIsQ0FBQyxDQUFDLE9BQU8sQ0FDVixDQUFDO1lBRUYsTUFBTSxxQkFBcUIsR0FDekIsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFNBQVMsRUFBRSxFQUFFO2dCQUM5QixNQUFNLFFBQVEsR0FBRyxpQkFBaUIsQ0FBQyxJQUFJLENBQ3JDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxLQUFLLFNBQVMsQ0FBQyxPQUFPLENBQzFDLENBQUM7Z0JBQ0YsT0FBTztvQkFDTCxPQUFPLEVBQUUsU0FBUyxFQUFFLE9BQU87b0JBQzNCLE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTztvQkFDM0IsSUFBSSxFQUFFLFNBQVMsRUFBRSxJQUFJO29CQUNyQixRQUFRLEVBQUUsU0FBUyxFQUFFLFFBQVE7b0JBQzdCLFdBQVcsRUFBRSxTQUFTLEVBQUUsV0FBVztvQkFDbkMsZUFBZSxFQUFFLFNBQVMsRUFBRSxlQUFlO29CQUMzQyxTQUFTLEVBQUUsU0FBUyxFQUFFLFNBQVM7b0JBQy9CLE1BQU0sRUFBRSxVQUFVO29CQUNsQixTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQzt5QkFDaEQsRUFBRSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDO3lCQUMzQixFQUFFLENBQUMsWUFBWSxDQUFDO3lCQUNoQixNQUFNLEVBQUU7b0JBQ1gsT0FBTyxFQUFFLEtBQUssQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7eUJBQzVDLEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQzt5QkFDM0IsRUFBRSxDQUFDLFlBQVksQ0FBQzt5QkFDaEIsTUFBTSxFQUFFO29CQUNYLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTTtvQkFDekIsSUFBSSxFQUFFLFNBQVMsRUFBRSxJQUFJO29CQUNyQixRQUFRLEVBQUUsU0FBUyxFQUFFLFFBQVE7b0JBQzdCLFVBQVUsRUFBRSxTQUFTLEVBQUUsVUFBVTtvQkFDakMsV0FBVyxFQUFFLFNBQVMsRUFBRSxXQUFXO29CQUNuQyxtQkFBbUIsRUFBRSxTQUFTLEVBQUUsbUJBQW1CO29CQUNuRCxtQkFBbUIsRUFBRSxTQUFTLEVBQUUsbUJBQW1CO29CQUNuRCxVQUFVLEVBQUUsU0FBUyxFQUFFLFVBQVU7b0JBQ2pDLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FBUztvQkFDL0IsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLGlCQUFpQjtvQkFDL0MsMkJBQTJCLEVBQUUsU0FBUyxFQUFFLDJCQUEyQjtvQkFDbkUsbUJBQW1CLEVBQUUsU0FBUyxFQUFFLG1CQUFtQjtvQkFDbkQsYUFBYSxFQUFFLFNBQVMsRUFBRSxhQUFhO29CQUN2QyxjQUFjLEVBQUUsU0FBUyxFQUFFLGNBQWM7b0JBQ3pDLEdBQUcsRUFBRSxTQUFTLEVBQUUsR0FBRztvQkFDbkIsaUJBQWlCLEVBQUUsU0FBUyxFQUFFLGlCQUFpQjtvQkFDL0MsWUFBWSxFQUFFLFNBQVMsRUFBRSxZQUFZO29CQUNyQyxZQUFZLEVBQUUsU0FBUyxFQUFFLFlBQVk7b0JBQ3JDLFVBQVUsRUFBRSxTQUFTLEVBQUUsVUFBVTtvQkFDakMsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLHVCQUF1QjtvQkFDM0Qsa0JBQWtCLEVBQUUsU0FBUyxFQUFFLGtCQUFrQjtvQkFDakQsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLHVCQUF1QjtvQkFDM0Qsa0JBQWtCLEVBQUUsU0FBUyxFQUFFLGtCQUFrQjtvQkFDakQsa0JBQWtCLEVBQUUsU0FBUyxFQUFFLGtCQUFrQjtvQkFDakQsYUFBYSxFQUFFLFNBQVMsRUFBRSxhQUFhO29CQUN2Qyx1QkFBdUIsRUFBRSxTQUFTLEVBQUUsdUJBQXVCO29CQUMzRCxxQkFBcUIsRUFBRSxTQUFTLEVBQUUscUJBQXFCO29CQUN2RCxLQUFLLEVBQUUsU0FBUyxFQUFFLEtBQUs7aUJBQ3hCLENBQUM7WUFDSixDQUFDLENBQUMsQ0FBQztZQUVMLHFCQUFxQixFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQ25DLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLHdCQUF3QixDQUFDLENBQ3pDLENBQUM7WUFFRixPQUFPLHFCQUFxQixFQUFFLE1BQU0sR0FBRyxDQUFDO2dCQUN0QyxDQUFDLENBQUM7b0JBQ0UsT0FBTyxFQUFFLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztvQkFDL0MsTUFBTSxFQUFFLFVBQVU7b0JBQ2xCLFVBQVUsRUFBRSxxQkFBcUI7b0JBQ2pDLFNBQVMsRUFBRSxpQkFBaUI7b0JBQzVCLE1BQU0sRUFBRSxZQUFZO29CQUNwQixTQUFTO29CQUNULFNBQVM7b0JBQ1QsUUFBUTtpQkFDVDtnQkFDSCxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQ1gsQ0FBQztJQUNILENBQUM7SUFBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1FBQ1gsT0FBTyxDQUFDLEdBQUcsQ0FDVCxDQUFDLEVBQ0QsNkRBQTZELENBQzlELENBQUM7SUFDSixDQUFDO0FBQ0gsQ0FBQyxDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0sMkJBQTJCLEdBQUcsS0FBSyxFQUM5QyxVQUFrQixFQUNsQixpQkFBOEMsRUFDOUMsZ0JBQXdDLEVBQ3hDLG1CQUEyQyxFQUMzQyxTQUEwQixFQUMxQixlQUF1QixFQUN2QixhQUFxQixFQUNyQixZQUFvQixFQUNwQixTQUEwQixFQUMxQixpQkFBK0MsRUFDL0MsbUJBQThDLEVBQzlDLGdCQUEwQyxFQUMxQyxrQkFBMkMsRUFDM0MsRUFBRTtJQUNGLElBQUksQ0FBQztRQUNILE9BQU8sQ0FBQyxHQUFHLENBQ1QsZUFBZSxFQUNmLGFBQWEsRUFDYixvRUFBb0UsQ0FDckUsQ0FBQztRQUVGLE1BQU0sNEJBQTRCLEdBQUcsbUJBQW1CO1lBQ3RELEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDVixNQUFNLFVBQVUsR0FBRyxpQkFBaUIsRUFBRSxTQUFTLENBQzdDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxLQUFLLENBQUMsRUFBRSxNQUFNLENBQy9CLENBQUM7WUFFRixJQUFJLFVBQVUsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDO2dCQUNwQixPQUFPLElBQUksQ0FBQztZQUNkLENBQUM7WUFDRCxPQUFPLENBQUMsQ0FBQztRQUNYLENBQUMsQ0FBQztZQUNGLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUM7UUFFOUIsTUFBTSw0QkFBNEIsR0FBRyxtQkFBbUI7WUFDdEQsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRTtZQUNWLE1BQU0sVUFBVSxHQUFHLGlCQUFpQixFQUFFLFNBQVMsQ0FDN0MsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEtBQUssQ0FBQyxFQUFFLE1BQU0sQ0FDL0IsQ0FBQztZQUVGLElBQUksVUFBVSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUM7Z0JBQ3BCLE9BQU8sQ0FBQyxDQUFDO1lBQ1gsQ0FBQztZQUNELE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQyxDQUFDO1lBQ0YsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQztRQUU5QixNQUFNLGFBQWEsR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxLQUFLLFVBQVUsQ0FBQyxDQUFDO1FBRXZFLE1BQU0sYUFBYSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxNQUFNLEtBQUssVUFBVSxDQUFDLENBQUM7UUFFeEUsTUFBTSxzQkFBc0IsR0FBRyxpQkFBaUIsQ0FBQyxJQUFJLENBQ25ELENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsTUFBTSxLQUFLLFVBQVUsQ0FDbEMsQ0FBQztRQUVGLElBQUksaUNBQWlDLEdBRTVCLEVBQUUsQ0FBQztRQUNaLElBQUksb0JBQW9CLEdBQWlELEVBQUUsQ0FBQztRQUU1RSxPQUFPLENBQUMsR0FBRyxDQUFDLHNCQUFzQixFQUFFLHlCQUF5QixDQUFDLENBQUM7UUFFL0QsSUFBSSxzQkFBc0IsRUFBRSxDQUFDO1lBQzNCLGlDQUFpQztnQkFDL0IsTUFBTSwrQ0FBK0MsQ0FDbkQsVUFBVSxFQUNWLFNBQVMsRUFDVCxlQUFlLEVBQ2YsYUFBYSxFQUNiLFlBQVksRUFDWixpQkFBaUIsRUFDakIsU0FBUyxFQUNULGdCQUFnQixFQUNoQiw0QkFBNEIsRUFDNUIsa0JBQWtCLENBQ25CLENBQUM7UUFDTixDQUFDO2FBQU0sQ0FBQztZQUNOLG9CQUFvQixHQUFHLE1BQU0sc0NBQXNDLENBQ2pFLFVBQVUsRUFDVixhQUFhLEVBQ2IsZUFBZSxFQUNmLGFBQWEsRUFDYixZQUFZLEVBQ1osYUFBYSxFQUNiLGtCQUFrQixDQUNuQixDQUFDO1FBQ0osQ0FBQztRQUVELE9BQU8sQ0FBQyxHQUFHLENBQ1QsaUNBQWlDLEVBQ2pDLG9DQUFvQyxDQUNyQyxDQUFDO1FBQ0YsTUFBTSx3QkFBd0IsR0FBRyxnQkFBZ0I7YUFDOUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUU7WUFDVCxNQUFNLFVBQVUsR0FBRyxpQkFBaUIsQ0FBQyxTQUFTLENBQzVDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsTUFBTSxLQUFLLENBQUMsRUFBRSxNQUFNLENBQy9CLENBQUM7WUFDRixJQUFJLFVBQVUsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDO2dCQUNwQixPQUFPLENBQUMsQ0FBQztZQUNYLENBQUM7WUFDRCxPQUFPLElBQUksQ0FBQztRQUNkLENBQUMsQ0FBQztZQUNGLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUM7UUFFOUIsTUFBTSxpQ0FBaUMsR0FDckMsaUJBQWlCLEVBQUUsTUFBTSxHQUFHLENBQUM7WUFDM0IsQ0FBQyxDQUFDLE1BQU0sK0NBQStDLENBQ25ELGlCQUFpQixFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUN2QyxVQUFVLEVBQ1YsbUJBQW1CLEVBQ25CLGVBQWUsRUFDZixhQUFhLEVBQ2IsWUFBWSxFQUNaLGlCQUFpQixFQUNqQix3QkFBd0IsRUFDeEIsNEJBQTRCLENBQzdCO1lBQ0gsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUVYLE1BQU0sVUFBVSxHQUFzQyxFQUFFLENBQUM7UUFDekQsTUFBTSxtQkFBbUIsR0FBb0IsRUFBRSxDQUFDO1FBQ2hELE1BQU0sTUFBTSxHQUFvQixFQUFFLENBQUM7UUFDbkMsTUFBTSxtQkFBbUIsR0FBb0IsRUFBRSxDQUFDO1FBQ2hELE1BQU0saUJBQWlCLEdBQTZCLEVBQUUsQ0FBQztRQUN2RCxNQUFNLG1CQUFtQixHQUFtQixFQUFFLENBQUM7UUFDL0MsTUFBTSxrQkFBa0IsR0FBaUMsRUFBRSxDQUFDO1FBRTVELElBQ0csb0JBQWdFO1lBQy9ELEVBQUUsVUFBVSxFQUFFLE1BQU0sR0FBRyxDQUFDLEVBQzFCLENBQUM7WUFDRCxVQUFVLENBQUMsSUFBSSxDQUNiLEdBQUksb0JBQWdFO2dCQUNsRSxFQUFFLFVBQVUsQ0FDZixDQUFDO1FBQ0osQ0FBQztRQUVELElBQ0csb0JBQWdFO1lBQy9ELEVBQUUsU0FBUyxFQUFFLE1BQU0sR0FBRyxDQUFDLEVBQ3pCLENBQUM7WUFDRCxtQkFBbUIsQ0FBQyxJQUFJLENBQ3RCLEdBQUksb0JBQWdFO2dCQUNsRSxFQUFFLFNBQVMsQ0FDZCxDQUFDO1FBQ0osQ0FBQztRQUVELElBQ0csb0JBQWdFLEVBQUUsTUFBTTtZQUN2RSxFQUFFLE1BQU0sR0FBRyxDQUFDLEVBQ2QsQ0FBQztZQUNELE1BQU0sQ0FBQyxJQUFJLENBQ1QsR0FBSSxvQkFBZ0U7Z0JBQ2xFLEVBQUUsTUFBTSxDQUNYLENBQUM7UUFDSixDQUFDO1FBRUQsSUFDRyxvQkFBZ0U7WUFDL0QsRUFBRSxTQUFTLEVBQUUsTUFBTSxHQUFHLENBQUMsRUFDekIsQ0FBQztZQUNELG1CQUFtQixDQUFDLElBQUksQ0FDdEIsR0FBSSxvQkFBZ0U7Z0JBQ2xFLEVBQUUsU0FBUyxDQUNkLENBQUM7UUFDSixDQUFDO1FBRUQsSUFDRyxvQkFBZ0U7WUFDL0QsRUFBRSxTQUFTLEVBQUUsTUFBTSxHQUFHLENBQUMsRUFDekIsQ0FBQztZQUNELG1CQUFtQixDQUFDLElBQUksQ0FDdEIsR0FBSSxvQkFBZ0U7Z0JBQ2xFLEVBQUUsU0FBUyxDQUNkLENBQUM7UUFDSixDQUFDO1FBRUQsSUFDRyxvQkFBZ0U7WUFDL0QsRUFBRSxzQkFBc0IsRUFBRSxFQUFFLEVBQzlCLENBQUM7WUFDRCxrQkFBa0IsQ0FBQyxJQUFJLENBQ3BCLG9CQUFnRTtnQkFDL0QsRUFBRSxzQkFBc0IsQ0FDM0IsQ0FBQztRQUNKLENBQUM7UUFFRCxJQUVJLGlDQUNELEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUNwQixDQUFDO1lBQ0Qsa0JBQWtCLENBQUMsSUFBSSxDQUNyQixHQUNFLGlDQUNELEVBQUUsUUFBUSxDQUNaLENBQUM7UUFDSixDQUFDO1FBR0MsaUNBQ0QsRUFBRSxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FDM0IsT0FBTyxDQUFDLEdBQUcsQ0FDVCxDQUFDLEVBQ0QsaUdBQWlHLENBQ2xHLENBQ0YsQ0FBQztRQUVGLElBRUksaUNBQ0QsRUFBRSxVQUFVLEVBQUUsTUFBTSxHQUFHLENBQUMsRUFDekIsQ0FBQztZQUNELFVBQVUsQ0FBQyxJQUFJLENBQ2IsR0FDRSxpQ0FDRCxFQUFFLFVBQVUsQ0FDZCxDQUFDO1FBQ0osQ0FBQztRQUVELElBRUksaUNBQ0QsRUFBRSxTQUFTLEVBQUUsTUFBTSxHQUFHLENBQUMsRUFDeEIsQ0FBQztZQUNELG1CQUFtQixDQUFDLElBQUksQ0FDdEIsR0FDRSxpQ0FDRCxFQUFFLFNBQVMsQ0FDYixDQUFDO1FBQ0osQ0FBQztRQUdDLGlDQUNELEVBQUUsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQ3ZCLE9BQU8sQ0FBQyxHQUFHLENBQ1QsQ0FBQyxFQUNELDZGQUE2RixDQUM5RixDQUNGLENBQUM7UUFFRixJQUVJLGlDQUNELEVBQUUsTUFBTSxFQUFFLE1BQU0sR0FBRyxDQUFDLEVBQ3JCLENBQUM7WUFDRCxNQUFNLENBQUMsSUFBSSxDQUNULEdBQ0UsaUNBQ0QsRUFBRSxNQUFNLENBQ1YsQ0FBQztRQUNKLENBQUM7UUFFRCxJQUVJLGlDQUNELEVBQUUsU0FBUyxFQUFFLE1BQU0sR0FBRyxDQUFDLEVBQ3hCLENBQUM7WUFDRCxtQkFBbUIsQ0FBQyxJQUFJLENBQ3RCLEdBQ0UsaUNBQ0QsRUFBRSxTQUFTLENBQ2IsQ0FBQztRQUNKLENBQUM7UUFFRCxJQUVJLGlDQUNELEVBQUUsU0FBUyxFQUFFLE1BQU0sR0FBRyxDQUFDLEVBQ3hCLENBQUM7WUFDRCxtQkFBbUIsQ0FBQyxJQUFJLENBQ3RCLEdBQ0UsaUNBQ0QsRUFBRSxTQUFTLENBQ2IsQ0FBQztRQUNKLENBQUM7UUFFRCxJQUFJLGlDQUFpQyxFQUFFLFVBQVUsRUFBRSxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDOUQsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLGlDQUFpQyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQ3BFLENBQUM7UUFFRCxJQUFJLGlDQUFpQyxFQUFFLFNBQVMsRUFBRSxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDN0QsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEdBQUcsaUNBQWlDLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDNUUsQ0FBQztRQUVELElBQUksaUNBQWlDLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1lBQ3JFLGlCQUFpQixDQUFDLElBQUksQ0FDcEIsR0FBRyxpQ0FBaUMsRUFBRSxpQkFBaUIsQ0FDeEQsQ0FBQztRQUNKLENBQUM7UUFFRCxJQUFJLGlDQUFpQyxFQUFFLFNBQVMsRUFBRSxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDN0QsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEdBQUcsaUNBQWlDLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDNUUsQ0FBQztRQUVELElBQUksaUNBQWlDLEVBQUUsUUFBUSxFQUFFLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUM1RCxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsR0FBRyxpQ0FBaUMsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUMxRSxDQUFDO1FBRUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsZ0NBQWdDLENBQUMsQ0FBQztRQUV6RCxNQUFNLHVCQUF1QixHQUMzQixDQUFDLENBQUMsUUFBUSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDcEMsTUFBTSxzQkFBc0IsR0FBRyxDQUFDLENBQUMsUUFBUSxDQUFDLG1CQUFtQixFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMxRSxNQUFNLG1CQUFtQixHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMxRCxNQUFNLHNCQUFzQixHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNoRSxNQUFNLDhCQUE4QixHQUFHLENBQUMsQ0FBQyxRQUFRLENBQy9DLGlCQUFpQixFQUNqQixDQUFDLENBQUMsT0FBTyxDQUNWLENBQUM7UUFDRixNQUFNLHNCQUFzQixHQUFtQixDQUFDLENBQUMsUUFBUSxDQUN2RCxtQkFBbUIsRUFDbkIsQ0FBQyxDQUFDLE9BQU8sQ0FDVixDQUFDO1FBQ0YsTUFBTSxXQUFXLEdBQUcsSUFBSSxFQUFFLENBQUM7UUFFM0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsK0JBQStCLENBQUMsQ0FBQztRQUN6RCxPQUFPLENBQUMsR0FBRyxDQUNULHVCQUF1QixFQUN2Qiw0Q0FBNEMsQ0FDN0MsQ0FBQztRQUNGLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLEVBQUUseUJBQXlCLENBQUMsQ0FBQztRQUMvRCxPQUFPLENBQUMsR0FBRyxDQUFDLHNCQUFzQixFQUFFLHlCQUF5QixDQUFDLENBQUM7UUFDL0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsRUFBRSx5QkFBeUIsQ0FBQyxDQUFDO1FBQy9ELElBQUksQ0FBQyx1QkFBdUIsSUFBSSx1QkFBdUIsRUFBRSxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDdEUsTUFBTSxJQUFJLEtBQUssQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFDO1FBQzdELENBQUM7UUFFRCxJQUFJLENBQUMsc0JBQXNCLElBQUksQ0FBQyxDQUFDLHNCQUFzQixFQUFFLE1BQU0sR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ3JFLE1BQU0sSUFBSSxLQUFLLENBQUMsa0NBQWtDLENBQUMsQ0FBQztRQUN0RCxDQUFDO1FBRUQsSUFBSSxDQUFDLGtCQUFrQixJQUFJLENBQUMsQ0FBQyxrQkFBa0IsRUFBRSxNQUFNLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUM3RCxNQUFNLElBQUksS0FBSyxDQUFDLDZCQUE2QixDQUFDLENBQUM7UUFDakQsQ0FBQztRQUVELHNCQUFzQixFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQ3BDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLHlCQUF5QixDQUFDLENBQzFDLENBQUM7UUFDRixrQkFBa0IsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLHFCQUFxQixDQUFDLENBQUMsQ0FBQztRQUMxRSxrQkFBa0IsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUNoQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLFVBQVUsRUFBRSw4QkFBOEIsQ0FBQyxDQUN6RSxDQUFDO1FBRUYsTUFBTSxNQUFNLEdBQUc7WUFDYixJQUFJLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQztnQkFDbkIsV0FBVztnQkFDWCxNQUFNLEVBQUUsVUFBVTtnQkFDbEIsVUFBVSxFQUFFLHVCQUF1QjtnQkFDbkMsU0FBUyxFQUFFLHNCQUFzQjtnQkFDakMsTUFBTSxFQUFFLG1CQUFtQjtnQkFDM0IsU0FBUyxFQUFFLHNCQUFzQjtnQkFDakMsaUJBQWlCLEVBQUUsOEJBQThCO2dCQUNqRCxrQkFBa0IsRUFBRSxrQkFBa0I7Z0JBQ3RDLGdCQUFnQixFQUFFLGdCQUFnQjtnQkFDbEMsWUFBWTthQUNiLENBQUM7WUFDRixNQUFNLEVBQUUsVUFBVTtZQUNsQixHQUFHLEVBQUUsR0FBRyxVQUFVLElBQUksV0FBVyxPQUFPO1lBQ3hDLFdBQVcsRUFBRSxrQkFBa0I7U0FDaEMsQ0FBQztRQUVGLE1BQU0sU0FBUyxHQUFHLElBQUksZ0JBQWdCLENBQUMsTUFBTSxDQUFDLENBQUM7UUFFL0MsTUFBTSxVQUFVLEdBQUcsTUFBTSxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRWxELE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLGFBQWEsQ0FBQyxDQUFDO1FBRXZDLE1BQU0sY0FBYyxDQUNsQixzQkFBc0IsRUFDdEIsa0JBQWtCLEVBQ2xCLHVCQUF1QixFQUN2QixXQUFXLEVBQ1gsVUFBVSxFQUNWLEdBQUcsVUFBVSxJQUFJLFdBQVcsT0FBTyxFQUNuQyxtQkFBbUIsRUFDbkIsa0NBQWtDLENBQ25DLENBQUM7UUFFRixPQUFPLENBQUMsR0FBRyxDQUFDLDBCQUEwQixDQUFDLENBQUM7SUFDMUMsQ0FBQztJQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDWCxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSwyQ0FBMkMsQ0FBQyxDQUFDO0lBQzlELENBQUM7QUFDSCxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQdXRPYmplY3RDb21tYW5kLCBTM0NsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1zMyc7XG5pbXBvcnQge1xuICBvcHRhUGxhbldlZWtseSxcbiAgZ2V0VXNlclByZWZlcmVuY2VzLFxuICBjb252ZXJ0TWVldGluZ1BsdXNUeXBlVG9FdmVudFBsdXNUeXBlLFxuICBmb3JtYXRFdmVudFR5cGVUb1BsYW5uZXJFdmVudCxcbiAgZ2VuZXJhdGVCcmVha0V2ZW50c0ZvckRhdGUsXG4gIGdlbmVyYXRlRXZlbnRQYXJ0c0xpdGUsXG4gIGdlbmVyYXRlVGltZVNsb3RzTGl0ZUZvckludGVybmFsQXR0ZW5kZWUsXG4gIGdlbmVyYXRlVXNlclBsYW5uZXJSZXF1ZXN0Qm9keSxcbiAgZ2VuZXJhdGVXb3JrVGltZXNGb3JJbnRlcm5hbEF0dGVuZGVlLFxuICBnZXRHbG9iYWxDYWxlbmRhcixcbiAgbW9kaWZ5RXZlbnRQYXJ0c0Zvck11bHRpcGxlUG9zdEJ1ZmZlclRpbWUsXG4gIG1vZGlmeUV2ZW50UGFydHNGb3JNdWx0aXBsZVByZUJ1ZmZlclRpbWUsXG4gIHByb2Nlc3NFdmVudHNGb3JPcHRhUGxhbm5lckZvckV4dGVybmFsQXR0ZW5kZWVzLFxuICBzZXRQcmVmZXJyZWRUaW1lRm9yVW5Nb2RpZmlhYmxlRXZlbnQsXG4gIHRhZ0V2ZW50c0ZvckRhaWx5T3JXZWVrbHlUYXNrLFxuICB2YWxpZGF0ZUV2ZW50RGF0ZXMsXG59IGZyb20gJ0BmZWF0dXJlc19hcHBseS9fbGlicy9hcGktaGVscGVyJztcbmltcG9ydCB7XG4gIGJ1Y2tldE5hbWUsXG4gIG9uT3B0YVBsYW5DYWxlbmRhckFkbWluQ2FsbEJhY2tVcmwsXG4gIG9wdGFwbGFubmVyRHVyYXRpb24sXG59IGZyb20gJ0BmZWF0dXJlc19hcHBseS9fbGlicy9jb25zdGFudHMnO1xuaW1wb3J0IHsgZGF5anMgfSBmcm9tICdAZmVhdHVyZXNfYXBwbHkvX2xpYnMvZGF0ZS11dGlscyc7XG5pbXBvcnQge1xuICBNZWV0aW5nQXNzaXN0QXR0ZW5kZWVUeXBlLFxuICBFdmVudE1lZXRpbmdQbHVzVHlwZSxcbiAgRXZlbnRQbHVzVHlwZSxcbiAgTWVldGluZ0Fzc2lzdEV2ZW50VHlwZSxcbiAgUmVtaW5kZXJzRm9yRXZlbnRUeXBlLFxuICBCdWZmZXJUaW1lT2JqZWN0VHlwZSxcbiAgUmV0dXJuQm9keUZvckF0dGVuZGVlRm9yT3B0YXBsYW5uZXJQcmVwVHlwZSxcbiAgUmV0dXJuQm9keUZvckhvc3RGb3JPcHRhcGxhbm5lclByZXBUeXBlLFxuICBSZXR1cm5Cb2R5Rm9yRXh0ZXJuYWxBdHRlbmRlZUZvck9wdGFwbGFubmVyUHJlcFR5cGUsXG4gIEV2ZW50UGFydFBsYW5uZXJSZXF1ZXN0Qm9keVR5cGUsXG4gIFRpbWVTbG90VHlwZSxcbiAgVXNlclBsYW5uZXJSZXF1ZXN0Qm9keVR5cGUsXG4gIENhbGVuZGFyVHlwZSxcbiAgVXNlclByZWZlcmVuY2VUeXBlLFxuICBXb3JrVGltZVR5cGUsXG59IGZyb20gJ0BmZWF0dXJlc19hcHBseS9fbGlicy90eXBlcyc7XG5cbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyB2NCBhcyB1dWlkIH0gZnJvbSAndXVpZCc7XG5cbmNvbnN0IHMzQ2xpZW50ID0gbmV3IFMzQ2xpZW50KHtcbiAgY3JlZGVudGlhbHM6IHtcbiAgICBhY2Nlc3NLZXlJZDogcHJvY2Vzcy5lbnYuUzNfQUNDRVNTX0tFWSxcbiAgICBzZWNyZXRBY2Nlc3NLZXk6IHByb2Nlc3MuZW52LlMzX1NFQ1JFVF9LRVksXG4gIH0sXG4gIGVuZHBvaW50OiBwcm9jZXNzLmVudi5TM19FTkRQT0lOVCxcbiAgZm9yY2VQYXRoU3R5bGU6IHRydWUsXG59KTtcblxuZXhwb3J0IGNvbnN0IHByb2Nlc3NFdmVudHNGb3JPcHRhUGxhbm5lckZvck1haW5Ib3N0ID0gYXN5bmMgKFxuICBtYWluSG9zdElkOiBzdHJpbmcsXG4gIGFsbEhvc3RFdmVudHM6IEV2ZW50UGx1c1R5cGVbXSxcbiAgd2luZG93U3RhcnREYXRlOiBzdHJpbmcsXG4gIHdpbmRvd0VuZERhdGU6IHN0cmluZyxcbiAgaG9zdFRpbWV6b25lOiBzdHJpbmcsXG4gIG9sZEhvc3RFdmVudHM6IEV2ZW50UGx1c1R5cGVbXSxcbiAgbmV3SG9zdEJ1ZmZlclRpbWVzPzogQnVmZmVyVGltZU9iamVjdFR5cGVbXVxuKTogUHJvbWlzZTxSZXR1cm5Cb2R5Rm9ySG9zdEZvck9wdGFwbGFubmVyUHJlcFR5cGU+ID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBuZXdCdWZmZXJUaW1lQXJyYXk6IEV2ZW50UGx1c1R5cGVbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBuZXdIb3N0QnVmZmVyVGltZSBvZiBuZXdIb3N0QnVmZmVyVGltZXMpIHtcbiAgICAgIGlmIChuZXdIb3N0QnVmZmVyVGltZT8uYmVmb3JlRXZlbnQ/LmlkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgIG5ld0hvc3RCdWZmZXJUaW1lPy5iZWZvcmVFdmVudCxcbiAgICAgICAgICAnIG5ld1RpbWVCbG9ja2luZz8uYmVmb3JlRXZlbnQnXG4gICAgICAgICk7XG4gICAgICAgIG5ld0J1ZmZlclRpbWVBcnJheS5wdXNoKG5ld0hvc3RCdWZmZXJUaW1lLmJlZm9yZUV2ZW50KTtcbiAgICAgIH1cblxuICAgICAgaWYgKG5ld0hvc3RCdWZmZXJUaW1lPy5hZnRlckV2ZW50Py5pZCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBuZXdIb3N0QnVmZmVyVGltZT8uYWZ0ZXJFdmVudCxcbiAgICAgICAgICAnIG5ld1RpbWVCbG9ja2luZz8uYWZ0ZXJFdmVudCdcbiAgICAgICAgKTtcbiAgICAgICAgbmV3QnVmZmVyVGltZUFycmF5LnB1c2gobmV3SG9zdEJ1ZmZlclRpbWUuYWZ0ZXJFdmVudCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgbW9kaWZpZWRBbGxIb3N0RXZlbnRzID0gXy5jbG9uZURlZXAoYWxsSG9zdEV2ZW50cyk7XG5cbiAgICBpZiAobmV3QnVmZmVyVGltZUFycmF5Py5sZW5ndGggPiAwKSB7XG4gICAgICBtb2RpZmllZEFsbEhvc3RFdmVudHMucHVzaCguLi5uZXdCdWZmZXJUaW1lQXJyYXkpO1xuICAgIH1cblxuICAgIGNvbnN0IHVzZXJQcmVmZXJlbmNlcyA9IGF3YWl0IGdldFVzZXJQcmVmZXJlbmNlcyhtYWluSG9zdElkKTtcblxuICAgIGNvbnN0IGdsb2JhbFByaW1hcnlDYWxlbmRhciA9IGF3YWl0IGdldEdsb2JhbENhbGVuZGFyKG1haW5Ib3N0SWQpO1xuXG4gICAgY29uc3QgZGlmZkRheXMgPSBkYXlqcyh3aW5kb3dFbmREYXRlLnNsaWNlKDAsIDE5KSkuZGlmZihcbiAgICAgIGRheWpzKHdpbmRvd1N0YXJ0RGF0ZS5zbGljZSgwLCAxOSkpLFxuICAgICAgJ2RheSdcbiAgICApO1xuXG4gICAgY29uc3QgbW9kaWZpZWRBbGxFdmVudHNXaXRoQnJlYWtzOiBFdmVudFBsdXNUeXBlW10gPSBbXTtcblxuICAgIGNvbnN0IHN0YXJ0RGF0ZXNGb3JFYWNoRGF5ID0gW107XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBkaWZmRGF5czsgaSsrKSB7XG4gICAgICBzdGFydERhdGVzRm9yRWFjaERheS5wdXNoKFxuICAgICAgICBkYXlqcyh3aW5kb3dTdGFydERhdGUuc2xpY2UoMCwgMTkpKVxuICAgICAgICAgIC50eihob3N0VGltZXpvbmUsIHRydWUpXG4gICAgICAgICAgLmFkZChpLCAnZGF5JylcbiAgICAgICAgICAuZm9ybWF0KClcbiAgICAgICk7XG4gICAgfVxuXG4gICAgbGV0IHBhcmVudEJyZWFrczogRXZlbnRQbHVzVHlwZVtdID0gW107XG5cbiAgICBjb25zdCBicmVha3MgPSBhd2FpdCBnZW5lcmF0ZUJyZWFrRXZlbnRzRm9yRGF0ZShcbiAgICAgIHVzZXJQcmVmZXJlbmNlcyxcbiAgICAgIG1haW5Ib3N0SWQsXG4gICAgICB3aW5kb3dTdGFydERhdGUsXG4gICAgICB3aW5kb3dFbmREYXRlLFxuICAgICAgaG9zdFRpbWV6b25lLFxuICAgICAgZ2xvYmFsUHJpbWFyeUNhbGVuZGFyPy5pZFxuICAgICk7XG5cbiAgICBicmVha3MuZm9yRWFjaCgoYikgPT4gY29uc29sZS5sb2coYiwgJyBnZW5lcmF0ZWRCcmVha3MnKSk7XG5cbiAgICBpZiAoYnJlYWtzPy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBhbGxFdmVudHNXaXRoRHVwbGljYXRlRnJlZUJyZWFrcyA9IF8uZGlmZmVyZW5jZUJ5KFxuICAgICAgICBtb2RpZmllZEFsbEhvc3RFdmVudHMsXG4gICAgICAgIGJyZWFrcyxcbiAgICAgICAgJ2lkJ1xuICAgICAgKTtcbiAgICAgIG1vZGlmaWVkQWxsRXZlbnRzV2l0aEJyZWFrcy5wdXNoKC4uLmFsbEV2ZW50c1dpdGhEdXBsaWNhdGVGcmVlQnJlYWtzKTtcbiAgICAgIG1vZGlmaWVkQWxsRXZlbnRzV2l0aEJyZWFrcy5wdXNoKC4uLmJyZWFrcyk7XG4gICAgICBwYXJlbnRCcmVha3MucHVzaCguLi5icmVha3MpO1xuICAgIH0gZWxzZSB7XG4gICAgICBtb2RpZmllZEFsbEV2ZW50c1dpdGhCcmVha3MucHVzaCguLi5tb2RpZmllZEFsbEhvc3RFdmVudHMpO1xuICAgIH1cblxuICAgIGNvbnN0IHdvcmtUaW1lcyA9IGdlbmVyYXRlV29ya1RpbWVzRm9ySW50ZXJuYWxBdHRlbmRlZShcbiAgICAgIG1haW5Ib3N0SWQsXG4gICAgICBtYWluSG9zdElkLFxuICAgICAgdXNlclByZWZlcmVuY2VzLFxuICAgICAgaG9zdFRpbWV6b25lLFxuICAgICAgaG9zdFRpbWV6b25lXG4gICAgKTtcbiAgICBjb25zdCB0aW1lc2xvdHMgPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RhcnREYXRlc0ZvckVhY2hEYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChpID09PSAwKSB7XG4gICAgICAgIGNvbnN0IHRpbWVzbG90c0ZvckRheSA9IGF3YWl0IGdlbmVyYXRlVGltZVNsb3RzTGl0ZUZvckludGVybmFsQXR0ZW5kZWUoXG4gICAgICAgICAgc3RhcnREYXRlc0ZvckVhY2hEYXk/LltpXSxcbiAgICAgICAgICBtYWluSG9zdElkLFxuICAgICAgICAgIHVzZXJQcmVmZXJlbmNlcyxcbiAgICAgICAgICBob3N0VGltZXpvbmUsXG4gICAgICAgICAgaG9zdFRpbWV6b25lLFxuICAgICAgICAgIHRydWVcbiAgICAgICAgKTtcbiAgICAgICAgdGltZXNsb3RzLnB1c2goLi4udGltZXNsb3RzRm9yRGF5KTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjb25zdCB0aW1lc2xvdHNGb3JEYXkgPSBhd2FpdCBnZW5lcmF0ZVRpbWVTbG90c0xpdGVGb3JJbnRlcm5hbEF0dGVuZGVlKFxuICAgICAgICBzdGFydERhdGVzRm9yRWFjaERheT8uW2ldLFxuICAgICAgICBtYWluSG9zdElkLFxuICAgICAgICB1c2VyUHJlZmVyZW5jZXMsXG4gICAgICAgIGhvc3RUaW1lem9uZSxcbiAgICAgICAgaG9zdFRpbWV6b25lLFxuICAgICAgICBmYWxzZVxuICAgICAgKTtcbiAgICAgIHRpbWVzbG90cy5wdXNoKC4uLnRpbWVzbG90c0ZvckRheSk7XG4gICAgfVxuICAgIGNvbnNvbGUubG9nKHRpbWVzbG90cywgJyB0aW1lc2xvdHMnKTtcblxuICAgIGNvbnN0IGZpbHRlcmVkQWxsRXZlbnRzID0gXy51bmlxQnkoXG4gICAgICBtb2RpZmllZEFsbEV2ZW50c1dpdGhCcmVha3MuZmlsdGVyKChlKSA9PlxuICAgICAgICB2YWxpZGF0ZUV2ZW50RGF0ZXMoZSwgdXNlclByZWZlcmVuY2VzKVxuICAgICAgKSxcbiAgICAgICdpZCdcbiAgICApO1xuICAgIGxldCBldmVudFBhcnRzOiBFdmVudFBhcnRQbGFubmVyUmVxdWVzdEJvZHlUeXBlW10gPSBbXTtcblxuICAgIGNvbnN0IGV2ZW50UGFydE1pbmlzQWNjdW11bGF0ZWQgPSBbXTtcbiAgICBmb3IgKGNvbnN0IGV2ZW50IG9mIGZpbHRlcmVkQWxsRXZlbnRzKSB7XG4gICAgICBjb25zdCBldmVudFBhcnRNaW5pcyA9IGdlbmVyYXRlRXZlbnRQYXJ0c0xpdGUoZXZlbnQsIG1haW5Ib3N0SWQpO1xuICAgICAgZXZlbnRQYXJ0TWluaXNBY2N1bXVsYXRlZC5wdXNoKC4uLmV2ZW50UGFydE1pbmlzKTtcbiAgICB9XG5cbiAgICBjb25zdCBtb2RpZmllZEV2ZW50UGFydE1pbmlzUHJlQnVmZmVyID1cbiAgICAgIG1vZGlmeUV2ZW50UGFydHNGb3JNdWx0aXBsZVByZUJ1ZmZlclRpbWUoZXZlbnRQYXJ0TWluaXNBY2N1bXVsYXRlZCk7XG4gICAgY29uc3QgbW9kaWZpZWRFdmVudFBhcnRNaW5pc1ByZUFuZFBvc3RCdWZmZXIgPVxuICAgICAgbW9kaWZ5RXZlbnRQYXJ0c0Zvck11bHRpcGxlUG9zdEJ1ZmZlclRpbWUoXG4gICAgICAgIG1vZGlmaWVkRXZlbnRQYXJ0TWluaXNQcmVCdWZmZXJcbiAgICAgICk7XG4gICAgY29uc3QgZm9ybWF0dGVkRXZlbnRQYXJ0czogRXZlbnRQYXJ0UGxhbm5lclJlcXVlc3RCb2R5VHlwZVtdID1cbiAgICAgIG1vZGlmaWVkRXZlbnRQYXJ0TWluaXNQcmVBbmRQb3N0QnVmZmVyLm1hcCgoZSkgPT5cbiAgICAgICAgZm9ybWF0RXZlbnRUeXBlVG9QbGFubmVyRXZlbnQoXG4gICAgICAgICAgZSxcbiAgICAgICAgICB1c2VyUHJlZmVyZW5jZXMsXG4gICAgICAgICAgd29ya1RpbWVzLFxuICAgICAgICAgIGhvc3RUaW1lem9uZVxuICAgICAgICApXG4gICAgICApO1xuICAgIGlmIChmb3JtYXR0ZWRFdmVudFBhcnRzPy5sZW5ndGggPiAwKSB7XG4gICAgICBldmVudFBhcnRzLnB1c2goLi4uZm9ybWF0dGVkRXZlbnRQYXJ0cyk7XG4gICAgfVxuXG4gICAgaWYgKGV2ZW50UGFydHM/Lmxlbmd0aCA+IDApIHtcbiAgICAgIGV2ZW50UGFydHMuZm9yRWFjaCgoZSkgPT4gY29uc29sZS5sb2coZSwgJyBldmVudFBhcnRzIGFmdGVyIGZvcm1hdHRpbmcnKSk7XG4gICAgICBjb25zdCBuZXdFdmVudFBhcnRzV2l0aFByZWZlcnJlZFRpbWVTZXQgPSBldmVudFBhcnRzLm1hcCgoZSkgPT5cbiAgICAgICAgc2V0UHJlZmVycmVkVGltZUZvclVuTW9kaWZpYWJsZUV2ZW50KFxuICAgICAgICAgIGUsXG4gICAgICAgICAgYWxsSG9zdEV2ZW50cy5maW5kKChmKSA9PiBmLmlkID09PSBlLmV2ZW50SWQpPy50aW1lem9uZVxuICAgICAgICApXG4gICAgICApO1xuICAgICAgbmV3RXZlbnRQYXJ0c1dpdGhQcmVmZXJyZWRUaW1lU2V0LmZvckVhY2goKGUpID0+XG4gICAgICAgIGNvbnNvbGUubG9nKGUsICcgbmV3RXZlbnRQYXJ0c1dpdGhQcmVmZXJyZWRUaW1lU2V0JylcbiAgICAgICk7XG4gICAgICBjb25zdCBuZXdFdmVudFBhcnRzID0gYXdhaXQgdGFnRXZlbnRzRm9yRGFpbHlPcldlZWtseVRhc2soXG4gICAgICAgIG5ld0V2ZW50UGFydHNXaXRoUHJlZmVycmVkVGltZVNldFxuICAgICAgKTtcbiAgICAgIG5ld0V2ZW50UGFydHMuZm9yRWFjaCgoZSkgPT5cbiAgICAgICAgY29uc29sZS5sb2coZSwgJyBuZXdFdmVudFBhcnRzIGFmdGVyIHRhZ0V2ZW50c0ZvckRhaWx5T3JXZWVrbHlUYXNrJylcbiAgICAgICk7XG4gICAgICBjb25zdCB1c2VyUGxhbm5lclJlcXVlc3RCb2R5ID0gZ2VuZXJhdGVVc2VyUGxhbm5lclJlcXVlc3RCb2R5KFxuICAgICAgICB1c2VyUHJlZmVyZW5jZXMsXG4gICAgICAgIHVzZXJQcmVmZXJlbmNlcy51c2VySWQsXG4gICAgICAgIHdvcmtUaW1lcyxcbiAgICAgICAgbWFpbkhvc3RJZFxuICAgICAgKTtcbiAgICAgIGNvbnNvbGUubG9nKHVzZXJQbGFubmVyUmVxdWVzdEJvZHksICcgdXNlclBsYW5uZXJSZXF1ZXN0Qm9keScpO1xuXG4gICAgICBjb25zdCBtb2RpZmllZE5ld0V2ZW50UGFydHM6IEV2ZW50UGFydFBsYW5uZXJSZXF1ZXN0Qm9keVR5cGVbXSA9XG4gICAgICAgIG5ld0V2ZW50UGFydHMubWFwKChldmVudFBhcnQpID0+IHtcbiAgICAgICAgICBjb25zdCBvbGRFdmVudCA9IGZpbHRlcmVkQWxsRXZlbnRzLmZpbmQoXG4gICAgICAgICAgICAoZXZlbnQpID0+IGV2ZW50LmlkID09PSBldmVudFBhcnQuZXZlbnRJZFxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGdyb3VwSWQ6IGV2ZW50UGFydD8uZ3JvdXBJZCxcbiAgICAgICAgICAgIGV2ZW50SWQ6IGV2ZW50UGFydD8uZXZlbnRJZCxcbiAgICAgICAgICAgIHBhcnQ6IGV2ZW50UGFydD8ucGFydCxcbiAgICAgICAgICAgIGxhc3RQYXJ0OiBldmVudFBhcnQ/Lmxhc3RQYXJ0LFxuICAgICAgICAgICAgbWVldGluZ1BhcnQ6IGV2ZW50UGFydD8ubWVldGluZ1BhcnQsXG4gICAgICAgICAgICBtZWV0aW5nTGFzdFBhcnQ6IGV2ZW50UGFydD8ubWVldGluZ0xhc3RQYXJ0LFxuICAgICAgICAgICAgbWVldGluZ0lkOiBldmVudFBhcnQ/Lm1lZXRpbmdJZCxcbiAgICAgICAgICAgIGhvc3RJZDogbWFpbkhvc3RJZCxcbiAgICAgICAgICAgIHN0YXJ0RGF0ZTogZGF5anMoZXZlbnRQYXJ0Py5zdGFydERhdGUuc2xpY2UoMCwgMTkpKVxuICAgICAgICAgICAgICAudHoob2xkRXZlbnQudGltZXpvbmUsIHRydWUpXG4gICAgICAgICAgICAgIC5mb3JtYXQoKSxcbiAgICAgICAgICAgIGVuZERhdGU6IGRheWpzKGV2ZW50UGFydD8uZW5kRGF0ZS5zbGljZSgwLCAxOSkpXG4gICAgICAgICAgICAgIC50eihvbGRFdmVudC50aW1lem9uZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgLmZvcm1hdCgpLFxuICAgICAgICAgICAgdXNlcklkOiBldmVudFBhcnQ/LnVzZXJJZCxcbiAgICAgICAgICAgIHVzZXI6IGV2ZW50UGFydD8udXNlcixcbiAgICAgICAgICAgIHByaW9yaXR5OiBldmVudFBhcnQ/LnByaW9yaXR5LFxuICAgICAgICAgICAgaXNQcmVFdmVudDogZXZlbnRQYXJ0Py5pc1ByZUV2ZW50LFxuICAgICAgICAgICAgaXNQb3N0RXZlbnQ6IGV2ZW50UGFydD8uaXNQb3N0RXZlbnQsXG4gICAgICAgICAgICBwb3NpdGl2ZUltcGFjdFNjb3JlOiBldmVudFBhcnQ/LnBvc2l0aXZlSW1wYWN0U2NvcmUsXG4gICAgICAgICAgICBuZWdhdGl2ZUltcGFjdFNjb3JlOiBldmVudFBhcnQ/Lm5lZ2F0aXZlSW1wYWN0U2NvcmUsXG4gICAgICAgICAgICBtb2RpZmlhYmxlOiBldmVudFBhcnQ/Lm1vZGlmaWFibGUsXG4gICAgICAgICAgICBpc01lZXRpbmc6IGV2ZW50UGFydD8uaXNNZWV0aW5nLFxuICAgICAgICAgICAgaXNFeHRlcm5hbE1lZXRpbmc6IGV2ZW50UGFydD8uaXNFeHRlcm5hbE1lZXRpbmcsXG4gICAgICAgICAgICBpc0V4dGVybmFsTWVldGluZ01vZGlmaWFibGU6IGV2ZW50UGFydD8uaXNFeHRlcm5hbE1lZXRpbmdNb2RpZmlhYmxlLFxuICAgICAgICAgICAgaXNNZWV0aW5nTW9kaWZpYWJsZTogZXZlbnRQYXJ0Py5pc01lZXRpbmdNb2RpZmlhYmxlLFxuICAgICAgICAgICAgZGFpbHlUYXNrTGlzdDogZXZlbnRQYXJ0Py5kYWlseVRhc2tMaXN0LFxuICAgICAgICAgICAgd2Vla2x5VGFza0xpc3Q6IGV2ZW50UGFydD8ud2Vla2x5VGFza0xpc3QsXG4gICAgICAgICAgICBnYXA6IGV2ZW50UGFydD8uZ2FwLFxuICAgICAgICAgICAgdG90YWxXb3JraW5nSG91cnM6IGV2ZW50UGFydD8udG90YWxXb3JraW5nSG91cnMsXG4gICAgICAgICAgICBoYXJkRGVhZGxpbmU6IGV2ZW50UGFydD8uaGFyZERlYWRsaW5lLFxuICAgICAgICAgICAgc29mdERlYWRsaW5lOiBldmVudFBhcnQ/LnNvZnREZWFkbGluZSxcbiAgICAgICAgICAgIGZvckV2ZW50SWQ6IGV2ZW50UGFydD8uZm9yRXZlbnRJZCxcbiAgICAgICAgICAgIHBvc2l0aXZlSW1wYWN0RGF5T2ZXZWVrOiBldmVudFBhcnQ/LnBvc2l0aXZlSW1wYWN0RGF5T2ZXZWVrLFxuICAgICAgICAgICAgcG9zaXRpdmVJbXBhY3RUaW1lOiBldmVudFBhcnQ/LnBvc2l0aXZlSW1wYWN0VGltZSxcbiAgICAgICAgICAgIG5lZ2F0aXZlSW1wYWN0RGF5T2ZXZWVrOiBldmVudFBhcnQ/Lm5lZ2F0aXZlSW1wYWN0RGF5T2ZXZWVrLFxuICAgICAgICAgICAgbmVnYXRpdmVJbXBhY3RUaW1lOiBldmVudFBhcnQ/Lm5lZ2F0aXZlSW1wYWN0VGltZSxcbiAgICAgICAgICAgIHByZWZlcnJlZERheU9mV2VlazogZXZlbnRQYXJ0Py5wcmVmZXJyZWREYXlPZldlZWssXG4gICAgICAgICAgICBwcmVmZXJyZWRUaW1lOiBldmVudFBhcnQ/LnByZWZlcnJlZFRpbWUsXG4gICAgICAgICAgICBwcmVmZXJyZWRTdGFydFRpbWVSYW5nZTogZXZlbnRQYXJ0Py5wcmVmZXJyZWRTdGFydFRpbWVSYW5nZSxcbiAgICAgICAgICAgIHByZWZlcnJlZEVuZFRpbWVSYW5nZTogZXZlbnRQYXJ0Py5wcmVmZXJyZWRFbmRUaW1lUmFuZ2UsXG4gICAgICAgICAgICBldmVudDogZXZlbnRQYXJ0Py5ldmVudCxcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcblxuICAgICAgcmV0dXJuIG1vZGlmaWVkTmV3RXZlbnRQYXJ0cz8ubGVuZ3RoID4gMFxuICAgICAgICA/IHtcbiAgICAgICAgICAgIHVzZXJJZDogbWFpbkhvc3RJZCxcbiAgICAgICAgICAgIGhvc3RJZDogbWFpbkhvc3RJZCxcbiAgICAgICAgICAgIGV2ZW50UGFydHM6IG1vZGlmaWVkTmV3RXZlbnRQYXJ0cyxcbiAgICAgICAgICAgIGFsbEV2ZW50czogZmlsdGVyZWRBbGxFdmVudHMsXG4gICAgICAgICAgICBicmVha3M6IHBhcmVudEJyZWFrcyxcbiAgICAgICAgICAgIG9sZEV2ZW50czogb2xkSG9zdEV2ZW50cyxcbiAgICAgICAgICAgIHRpbWVzbG90cyxcbiAgICAgICAgICAgIHVzZXJQbGFubmVyUmVxdWVzdEJvZHksXG4gICAgICAgICAgfVxuICAgICAgICA6IG51bGw7XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5sb2coXG4gICAgICBlLFxuICAgICAgJyB1bmFibGUgdG8gcHJvY2VzcyBldmVudHMgZm9yIG9wdGFwbGFubmVyIGZvciBob3N0IGF0dGVuZGVlJ1xuICAgICk7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBwcm9jZXNzRXZlbnRzRm9yT3B0YVBsYW5uZXJGb3JJbnRlcm5hbEF0dGVuZGVlcyA9IGFzeW5jIChcbiAgbWFpbkhvc3RJZDogc3RyaW5nLFxuICBhbGxFdmVudHM6IEV2ZW50UGx1c1R5cGVbXSxcbiAgd2luZG93U3RhcnREYXRlOiBzdHJpbmcsXG4gIHdpbmRvd0VuZERhdGU6IHN0cmluZyxcbiAgaG9zdFRpbWV6b25lOiBzdHJpbmcsXG4gIGludGVybmFsQXR0ZW5kZWVzOiBNZWV0aW5nQXNzaXN0QXR0ZW5kZWVUeXBlW10sXG4gIG9sZEV2ZW50czogRXZlbnRQbHVzVHlwZVtdLFxuICBvbGRNZWV0aW5nRXZlbnRzPzogRXZlbnRNZWV0aW5nUGx1c1R5cGVbXSxcbiAgbmV3TWVldGluZ0V2ZW50cz86IEV2ZW50TWVldGluZ1BsdXNUeXBlW10sXG4gIG5ld0hvc3RCdWZmZXJUaW1lcz86IEJ1ZmZlclRpbWVPYmplY3RUeXBlW11cbik6IFByb21pc2U8UmV0dXJuQm9keUZvckF0dGVuZGVlRm9yT3B0YXBsYW5uZXJQcmVwVHlwZT4gPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IG5ld0J1ZmZlclRpbWVBcnJheTogRXZlbnRQbHVzVHlwZVtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IG5ld0hvc3RCdWZmZXJUaW1lIG9mIG5ld0hvc3RCdWZmZXJUaW1lcykge1xuICAgICAgaWYgKG5ld0hvc3RCdWZmZXJUaW1lPy5iZWZvcmVFdmVudD8uaWQpIHtcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgbmV3SG9zdEJ1ZmZlclRpbWU/LmJlZm9yZUV2ZW50LFxuICAgICAgICAgICcgbmV3VGltZUJsb2NraW5nPy5iZWZvcmVFdmVudCdcbiAgICAgICAgKTtcbiAgICAgICAgbmV3QnVmZmVyVGltZUFycmF5LnB1c2gobmV3SG9zdEJ1ZmZlclRpbWUuYmVmb3JlRXZlbnQpO1xuICAgICAgfVxuXG4gICAgICBpZiAobmV3SG9zdEJ1ZmZlclRpbWU/LmFmdGVyRXZlbnQ/LmlkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgIG5ld0hvc3RCdWZmZXJUaW1lPy5hZnRlckV2ZW50LFxuICAgICAgICAgICcgbmV3VGltZUJsb2NraW5nPy5hZnRlckV2ZW50J1xuICAgICAgICApO1xuICAgICAgICBuZXdCdWZmZXJUaW1lQXJyYXkucHVzaChuZXdIb3N0QnVmZmVyVGltZS5hZnRlckV2ZW50KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBvbGRNZWV0aW5nRXZlbnRzPy5mb3JFYWNoKChvKSA9PiBjb25zb2xlLmxvZyhvLCAnIG9sZE1lZXRpbmdFdmVudHMnKSk7XG4gICAgaW50ZXJuYWxBdHRlbmRlZXM/LmZvckVhY2goKGkpID0+XG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgaSxcbiAgICAgICAgJyBpbnRlcm5hbEF0dGVuZGVlcyBpbnNpZGUgcHJvY2Vzc0V2ZW50c0Zvck9wdGFQbGFubmVyRm9ySW50ZXJuYWxBdHRlbmRlZXMnXG4gICAgICApXG4gICAgKTtcbiAgICBjb25zdCBmaWx0ZXJlZE9sZE1lZXRpbmdFdmVudHMgPSBvbGRNZWV0aW5nRXZlbnRzXG4gICAgICA/Lm1hcCgobSkgPT4ge1xuICAgICAgICBjb25zdCBmb3VuZEluZGV4ID0gYWxsRXZlbnRzPy5maW5kSW5kZXgoKGEpID0+IGE/LmlkID09PSBtPy5pZCk7XG5cbiAgICAgICAgaWYgKGZvdW5kSW5kZXggPiAtMSkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtO1xuICAgICAgfSlcbiAgICAgID8uZmlsdGVyKChlKSA9PiAhIWUpO1xuXG4gICAgZmlsdGVyZWRPbGRNZWV0aW5nRXZlbnRzPy5mb3JFYWNoKChlKSA9PlxuICAgICAgY29uc29sZS5sb2coZSwgJyBmaWx0ZXJlZE9sZE1lZXRpbmdFdmVudHMnKVxuICAgICk7XG4gICAgY29uc3QgbW9kaWZpZWRBbGxFdmVudHMgPSBfLmNsb25lRGVlcChhbGxFdmVudHMpPy5maWx0ZXIoKGUpID0+IHtcbiAgICAgIGlmIChmaWx0ZXJlZE9sZE1lZXRpbmdFdmVudHM/LlswXT8uaWQpIHtcbiAgICAgICAgY29uc3QgZm91bmRJbmRleCA9IGZpbHRlcmVkT2xkTWVldGluZ0V2ZW50cz8uZmluZEluZGV4KFxuICAgICAgICAgIChtKSA9PiBtPy5pZCA9PT0gZT8uaWRcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGZvdW5kSW5kZXggPiAtMSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xuXG4gICAgaWYgKGZpbHRlcmVkT2xkTWVldGluZ0V2ZW50cz8uWzBdPy5pZCkge1xuICAgICAgbW9kaWZpZWRBbGxFdmVudHMucHVzaChcbiAgICAgICAgLi4uZmlsdGVyZWRPbGRNZWV0aW5nRXZlbnRzPy5tYXAoKGEpID0+XG4gICAgICAgICAgY29udmVydE1lZXRpbmdQbHVzVHlwZVRvRXZlbnRQbHVzVHlwZShhKVxuICAgICAgICApXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChuZXdCdWZmZXJUaW1lQXJyYXk/Lmxlbmd0aCA+IDApIHtcbiAgICAgIG1vZGlmaWVkQWxsRXZlbnRzLnB1c2goLi4ubmV3QnVmZmVyVGltZUFycmF5KTtcbiAgICB9XG5cbiAgICBpZiAobmV3TWVldGluZ0V2ZW50cz8ubGVuZ3RoID4gMCkge1xuICAgICAgbW9kaWZpZWRBbGxFdmVudHMucHVzaChcbiAgICAgICAgLi4ubmV3TWVldGluZ0V2ZW50cz8ubWFwKChtKSA9PlxuICAgICAgICAgIGNvbnZlcnRNZWV0aW5nUGx1c1R5cGVUb0V2ZW50UGx1c1R5cGUobSlcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBtb2RpZmllZEFsbEV2ZW50cz8uZm9yRWFjaCgoZSkgPT4gY29uc29sZS5sb2coZSwgJyBtb2RpZmllZEFsbEV2ZW50cycpKTtcblxuICAgIGNvbnN0IHVuZmlsdGVyZWRVc2VyUHJlZmVyZW5jZXM6IFVzZXJQcmVmZXJlbmNlVHlwZVtdID0gW107XG4gICAgZm9yIChjb25zdCBpbnRlcm5hbEF0dGVuZGVlIG9mIGludGVybmFsQXR0ZW5kZWVzKSB7XG4gICAgICBjb25zdCB1c2VyUHJlZmVyZW5jZSA9IGF3YWl0IGdldFVzZXJQcmVmZXJlbmNlcyhpbnRlcm5hbEF0dGVuZGVlPy51c2VySWQpO1xuICAgICAgdW5maWx0ZXJlZFVzZXJQcmVmZXJlbmNlcy5wdXNoKHVzZXJQcmVmZXJlbmNlKTtcbiAgICB9XG5cbiAgICBjb25zdCB1c2VyUHJlZmVyZW5jZXM6IFVzZXJQcmVmZXJlbmNlVHlwZVtdID0gXy51bmlxV2l0aChcbiAgICAgIHVuZmlsdGVyZWRVc2VyUHJlZmVyZW5jZXMsXG4gICAgICBfLmlzRXF1YWxcbiAgICApO1xuXG4gICAgY29uc3QgdW5maWx0ZXJlZEdsb2JhbFByaW1hcnlDYWxlbmRhcnM6IENhbGVuZGFyVHlwZVtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IGludGVybmFsQXR0ZW5kZWUgb2YgaW50ZXJuYWxBdHRlbmRlZXMpIHtcbiAgICAgIGNvbnN0IGdsb2JhbFByaW1hcnlDYWxlbmRhciA9IGF3YWl0IGdldEdsb2JhbENhbGVuZGFyKFxuICAgICAgICBpbnRlcm5hbEF0dGVuZGVlPy51c2VySWRcbiAgICAgICk7XG4gICAgICB1bmZpbHRlcmVkR2xvYmFsUHJpbWFyeUNhbGVuZGFycy5wdXNoKGdsb2JhbFByaW1hcnlDYWxlbmRhcik7XG4gICAgfVxuXG4gICAgY29uc3QgZ2xvYmFsUHJpbWFyeUNhbGVuZGFycyA9IF8udW5pcVdpdGgoXG4gICAgICB1bmZpbHRlcmVkR2xvYmFsUHJpbWFyeUNhbGVuZGFycyxcbiAgICAgIF8uaXNFcXVhbFxuICAgICk7XG5cbiAgICBnbG9iYWxQcmltYXJ5Q2FsZW5kYXJzPy5mb3JFYWNoKChjKSA9PlxuICAgICAgY29uc29sZS5sb2coYywgJyBnbG9iYWxQcmltYXJ5Q2FsZW5kYXJzJylcbiAgICApO1xuXG4gICAgY29uc3QgbW9kaWZpZWRBbGxFdmVudHNXaXRoQnJlYWtzOiBFdmVudFBsdXNUeXBlW10gPSBbXTtcblxuICAgIGxldCBwYXJlbnRCcmVha3M6IEV2ZW50UGx1c1R5cGVbXSA9IFtdO1xuICAgIGZvciAoY29uc3QgdXNlclByZWZlcmVuY2Ugb2YgdXNlclByZWZlcmVuY2VzKSB7XG4gICAgICBjb25zdCBnbG9iYWxQcmltYXJ5Q2FsZW5kYXIgPSBnbG9iYWxQcmltYXJ5Q2FsZW5kYXJzPy5maW5kKFxuICAgICAgICAoZykgPT4gZz8udXNlcklkID09PSB1c2VyUHJlZmVyZW5jZT8udXNlcklkXG4gICAgICApO1xuICAgICAgaWYgKCFnbG9iYWxQcmltYXJ5Q2FsZW5kYXIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdubyBnbG9iYWwgcHJpbWFyeSBjYWxlbmRhciBmb3VuZCcpO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlcklkID0gdXNlclByZWZlcmVuY2U/LnVzZXJJZDtcblxuICAgICAgY29uc3QgYnJlYWtzID0gYXdhaXQgZ2VuZXJhdGVCcmVha0V2ZW50c0ZvckRhdGUoXG4gICAgICAgIHVzZXJQcmVmZXJlbmNlLFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIHdpbmRvd1N0YXJ0RGF0ZSxcbiAgICAgICAgd2luZG93RW5kRGF0ZSxcbiAgICAgICAgaG9zdFRpbWV6b25lLFxuICAgICAgICBnbG9iYWxQcmltYXJ5Q2FsZW5kYXI/LmlkXG4gICAgICApO1xuXG4gICAgICBicmVha3MuZm9yRWFjaCgoYikgPT4gY29uc29sZS5sb2coYiwgJyBnZW5lcmF0ZWRCcmVha3MnKSk7XG5cbiAgICAgIGlmIChicmVha3M/Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgYWxsRXZlbnRzV2l0aER1cGxpY2F0ZUZyZWVCcmVha3MgPSBfLmRpZmZlcmVuY2VCeShcbiAgICAgICAgICBtb2RpZmllZEFsbEV2ZW50cyxcbiAgICAgICAgICBicmVha3MsXG4gICAgICAgICAgJ2lkJ1xuICAgICAgICApO1xuICAgICAgICBtb2RpZmllZEFsbEV2ZW50c1dpdGhCcmVha3MucHVzaChcbiAgICAgICAgICAuLi5hbGxFdmVudHNXaXRoRHVwbGljYXRlRnJlZUJyZWFrcz8uZmlsdGVyKFxuICAgICAgICAgICAgKGUpID0+IGU/LnVzZXJJZCA9PT0gdXNlcklkXG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgICBtb2RpZmllZEFsbEV2ZW50c1dpdGhCcmVha3MucHVzaCguLi5icmVha3MpO1xuICAgICAgICBwYXJlbnRCcmVha3MucHVzaCguLi5icmVha3MpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbW9kaWZpZWRBbGxFdmVudHNXaXRoQnJlYWtzLnB1c2goXG4gICAgICAgICAgLi4ubW9kaWZpZWRBbGxFdmVudHM/LmZpbHRlcigoZSkgPT4gZT8udXNlcklkID09PSB1c2VySWQpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbW9kaWZpZWRBbGxFdmVudHNXaXRoQnJlYWtzPy5mb3JFYWNoKChtKSA9PlxuICAgICAgY29uc29sZS5sb2cobSwgJyBtb2RpZmllZEFsbEV2ZW50c1dpdGhCcmVha3MnKVxuICAgICk7XG5cbiAgICBjb25zdCBkaWZmRGF5cyA9IGRheWpzKHdpbmRvd0VuZERhdGUuc2xpY2UoMCwgMTkpKS5kaWZmKFxuICAgICAgZGF5anMod2luZG93U3RhcnREYXRlLnNsaWNlKDAsIDE5KSksXG4gICAgICAnZGF5J1xuICAgICk7XG4gICAgY29uc29sZS5sb2coXG4gICAgICBkaWZmRGF5cyxcbiAgICAgIHdpbmRvd0VuZERhdGUsXG4gICAgICB3aW5kb3dTdGFydERhdGUsXG4gICAgICAnIGRpZmZEYXlzLCB3aW5kb3dFbmREYXRlLCB3aW5kb3dTdGFydERhdGUnXG4gICAgKTtcbiAgICBjb25zdCBzdGFydERhdGVzRm9yRWFjaERheSA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gZGlmZkRheXM7IGkrKykge1xuICAgICAgc3RhcnREYXRlc0ZvckVhY2hEYXkucHVzaChcbiAgICAgICAgZGF5anMod2luZG93U3RhcnREYXRlLnNsaWNlKDAsIDE5KSlcbiAgICAgICAgICAudHooaG9zdFRpbWV6b25lLCB0cnVlKVxuICAgICAgICAgIC5hZGQoaSwgJ2RheScpXG4gICAgICAgICAgLmZvcm1hdCgpXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKHN0YXJ0RGF0ZXNGb3JFYWNoRGF5LCAnIHN0YXJ0RGF0ZXNGb3JFYWNoRGF5Jyk7XG5cbiAgICBjb25zdCB1bmZpbHRlcmVkV29ya1RpbWVzOiBXb3JrVGltZVR5cGVbXSA9IFtdO1xuICAgIGZvciAoY29uc3QgaW50ZXJuYWxBdHRlbmRlZSBvZiBpbnRlcm5hbEF0dGVuZGVlcykge1xuICAgICAgY29uc3QgdXNlclByZWZlcmVuY2UgPSB1c2VyUHJlZmVyZW5jZXMuZmluZChcbiAgICAgICAgKHUpID0+IHUudXNlcklkID09PSBpbnRlcm5hbEF0dGVuZGVlLnVzZXJJZFxuICAgICAgKTtcbiAgICAgIGNvbnN0IGF0dGVuZGVlVGltZXpvbmUgPSBpbnRlcm5hbEF0dGVuZGVlPy50aW1lem9uZTtcbiAgICAgIGNvbnN0IHdvcmtUaW1lc0ZvckF0dGVuZGVlID0gZ2VuZXJhdGVXb3JrVGltZXNGb3JJbnRlcm5hbEF0dGVuZGVlKFxuICAgICAgICBtYWluSG9zdElkLFxuICAgICAgICBpbnRlcm5hbEF0dGVuZGVlLnVzZXJJZCxcbiAgICAgICAgdXNlclByZWZlcmVuY2UsXG4gICAgICAgIGhvc3RUaW1lem9uZSxcbiAgICAgICAgYXR0ZW5kZWVUaW1lem9uZVxuICAgICAgKTtcbiAgICAgIHVuZmlsdGVyZWRXb3JrVGltZXMucHVzaCguLi53b3JrVGltZXNGb3JBdHRlbmRlZSk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2codW5maWx0ZXJlZFdvcmtUaW1lcywgJ3VuZmlsdGVyZWRXb3JrVGltZXMnKTtcbiAgICBjb25zdCB3b3JrVGltZXM6IFdvcmtUaW1lVHlwZVtdID0gXy51bmlxV2l0aChcbiAgICAgIHVuZmlsdGVyZWRXb3JrVGltZXMsXG4gICAgICBfLmlzRXF1YWxcbiAgICApO1xuXG4gICAgY29uc3QgdW5maWx0ZXJlZFRpbWVzbG90cyA9IFtdO1xuICAgIGNvbnN0IHRpbWVzbG90cyA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGFydERhdGVzRm9yRWFjaERheS5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGkgPT09IDApIHtcbiAgICAgICAgZm9yIChjb25zdCBpbnRlcm5hbEF0dGVuZGVlIG9mIGludGVybmFsQXR0ZW5kZWVzKSB7XG4gICAgICAgICAgY29uc3QgdXNlclByZWZlcmVuY2UgPSB1c2VyUHJlZmVyZW5jZXMuZmluZChcbiAgICAgICAgICAgICh1KSA9PiB1LnVzZXJJZCA9PT0gaW50ZXJuYWxBdHRlbmRlZS51c2VySWRcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IHRpbWVzbG90c0ZvckRheSA9XG4gICAgICAgICAgICBhd2FpdCBnZW5lcmF0ZVRpbWVTbG90c0xpdGVGb3JJbnRlcm5hbEF0dGVuZGVlKFxuICAgICAgICAgICAgICBzdGFydERhdGVzRm9yRWFjaERheT8uW2ldLFxuICAgICAgICAgICAgICBtYWluSG9zdElkLFxuICAgICAgICAgICAgICB1c2VyUHJlZmVyZW5jZSxcbiAgICAgICAgICAgICAgaG9zdFRpbWV6b25lLFxuICAgICAgICAgICAgICBpbnRlcm5hbEF0dGVuZGVlPy50aW1lem9uZSxcbiAgICAgICAgICAgICAgdHJ1ZVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB1bmZpbHRlcmVkVGltZXNsb3RzLnB1c2goLi4udGltZXNsb3RzRm9yRGF5KTtcbiAgICAgICAgfVxuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3QgaW50ZXJuYWxBdHRlbmRlZSBvZiBpbnRlcm5hbEF0dGVuZGVlcykge1xuICAgICAgICBjb25zdCB1c2VyUHJlZmVyZW5jZSA9IHVzZXJQcmVmZXJlbmNlcy5maW5kKFxuICAgICAgICAgICh1KSA9PiB1LnVzZXJJZCA9PT0gaW50ZXJuYWxBdHRlbmRlZS51c2VySWRcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgdGltZXNsb3RzRm9yRGF5ID0gYXdhaXQgZ2VuZXJhdGVUaW1lU2xvdHNMaXRlRm9ySW50ZXJuYWxBdHRlbmRlZShcbiAgICAgICAgICBzdGFydERhdGVzRm9yRWFjaERheT8uW2ldLFxuICAgICAgICAgIG1haW5Ib3N0SWQsXG4gICAgICAgICAgdXNlclByZWZlcmVuY2UsXG4gICAgICAgICAgaG9zdFRpbWV6b25lLFxuICAgICAgICAgIGludGVybmFsQXR0ZW5kZWU/LnRpbWV6b25lLFxuICAgICAgICAgIGZhbHNlXG4gICAgICAgICk7XG4gICAgICAgIHVuZmlsdGVyZWRUaW1lc2xvdHMucHVzaCguLi50aW1lc2xvdHNGb3JEYXkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRpbWVzbG90cy5wdXNoKC4uLl8udW5pcVdpdGgodW5maWx0ZXJlZFRpbWVzbG90cywgXy5pc0VxdWFsKSk7XG4gICAgY29uc29sZS5sb2codGltZXNsb3RzLCAnIHRpbWVzbG90cycpO1xuXG4gICAgY29uc3QgdW5maWx0ZXJlZEFsbEV2ZW50czogRXZlbnRQbHVzVHlwZVtdID0gW107XG4gICAgZm9yIChjb25zdCBpbnRlcm5hbEF0dGVuZGVlIG9mIGludGVybmFsQXR0ZW5kZWVzKSB7XG4gICAgICBjb25zdCB1c2VyUHJlZmVyZW5jZSA9IHVzZXJQcmVmZXJlbmNlcy5maW5kKFxuICAgICAgICAodSkgPT4gdS51c2VySWQgPT09IGludGVybmFsQXR0ZW5kZWUudXNlcklkXG4gICAgICApO1xuICAgICAgY29uc3QgbW9kaWZpZWRBbGxFdmVudHNXaXRoQnJlYWtzV2l0aFVzZXIgPVxuICAgICAgICBtb2RpZmllZEFsbEV2ZW50c1dpdGhCcmVha3MuZmlsdGVyKFxuICAgICAgICAgIChlKSA9PiBlLnVzZXJJZCA9PT0gaW50ZXJuYWxBdHRlbmRlZS51c2VySWRcbiAgICAgICAgKTtcbiAgICAgIGNvbnN0IGV2ZW50cyA9IG1vZGlmaWVkQWxsRXZlbnRzV2l0aEJyZWFrc1dpdGhVc2VyLmZpbHRlcigoZSkgPT5cbiAgICAgICAgdmFsaWRhdGVFdmVudERhdGVzKGUsIHVzZXJQcmVmZXJlbmNlKVxuICAgICAgKTtcbiAgICAgIHVuZmlsdGVyZWRBbGxFdmVudHMucHVzaCguLi5ldmVudHMpO1xuICAgIH1cbiAgICB1bmZpbHRlcmVkQWxsRXZlbnRzPy5mb3JFYWNoKChlKSA9PiBjb25zb2xlLmxvZyhlLCAnIHVuZmlsdGVyZWRBbGxFdmVudHMnKSk7XG5cbiAgICBjb25zdCBmaWx0ZXJlZEFsbEV2ZW50cyA9IF8udW5pcUJ5KHVuZmlsdGVyZWRBbGxFdmVudHMsICdpZCcpO1xuXG4gICAgZmlsdGVyZWRBbGxFdmVudHM/LmZvckVhY2goKGUpID0+IGNvbnNvbGUubG9nKGUsICcgZmlsdGVyZWRBbGxFdmVudHMnKSk7XG5cbiAgICBsZXQgZXZlbnRQYXJ0czogRXZlbnRQYXJ0UGxhbm5lclJlcXVlc3RCb2R5VHlwZVtdID0gW107XG5cbiAgICBjb25zdCBldmVudFBhcnRNaW5pc0FjY3VtdWxhdGVkID0gW107XG4gICAgZm9yIChjb25zdCBldmVudCBvZiBmaWx0ZXJlZEFsbEV2ZW50cykge1xuICAgICAgY29uc3QgZXZlbnRQYXJ0TWluaXMgPSBnZW5lcmF0ZUV2ZW50UGFydHNMaXRlKGV2ZW50LCBtYWluSG9zdElkKTtcbiAgICAgIGV2ZW50UGFydE1pbmlzQWNjdW11bGF0ZWQucHVzaCguLi5ldmVudFBhcnRNaW5pcyk7XG4gICAgfVxuXG4gICAgZXZlbnRQYXJ0TWluaXNBY2N1bXVsYXRlZD8uZm9yRWFjaCgoZSkgPT5cbiAgICAgIGNvbnNvbGUubG9nKGUsICcgZXZlbnRQYXJ0TWluaXNBY2N1bXVsYXRlZCcpXG4gICAgKTtcbiAgICBjb25zdCBtb2RpZmllZEV2ZW50UGFydE1pbmlzUHJlQnVmZmVyID1cbiAgICAgIG1vZGlmeUV2ZW50UGFydHNGb3JNdWx0aXBsZVByZUJ1ZmZlclRpbWUoZXZlbnRQYXJ0TWluaXNBY2N1bXVsYXRlZCk7XG4gICAgY29uc3QgbW9kaWZpZWRFdmVudFBhcnRNaW5pc1ByZUFuZFBvc3RCdWZmZXIgPVxuICAgICAgbW9kaWZ5RXZlbnRQYXJ0c0Zvck11bHRpcGxlUG9zdEJ1ZmZlclRpbWUoXG4gICAgICAgIG1vZGlmaWVkRXZlbnRQYXJ0TWluaXNQcmVCdWZmZXJcbiAgICAgICk7XG5cbiAgICBtb2RpZmllZEV2ZW50UGFydE1pbmlzUHJlQW5kUG9zdEJ1ZmZlcj8uZm9yRWFjaCgoZSkgPT5cbiAgICAgIGNvbnNvbGUubG9nKGUsICcgbW9kaWZpZWRFdmVudFBhcnRNaW5pc1ByZUFuZFBvc3RCdWZmZXInKVxuICAgICk7XG5cbiAgICBjb25zdCBmb3JtYXR0ZWRFdmVudFBhcnRzOiBFdmVudFBhcnRQbGFubmVyUmVxdWVzdEJvZHlUeXBlW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IHVzZXJQcmVmZXJlbmNlIG9mIHVzZXJQcmVmZXJlbmNlcykge1xuICAgICAgY29uc3QgZm9ybWF0dGVkRXZlbnRQYXJ0c0ZvclVzZXI6IEV2ZW50UGFydFBsYW5uZXJSZXF1ZXN0Qm9keVR5cGVbXSA9XG4gICAgICAgIG1vZGlmaWVkRXZlbnRQYXJ0TWluaXNQcmVBbmRQb3N0QnVmZmVyXG4gICAgICAgICAgPy5maWx0ZXIoKGUpID0+IGU/LnVzZXJJZCA9PT0gdXNlclByZWZlcmVuY2U/LnVzZXJJZClcbiAgICAgICAgICA/Lm1hcCgoZSkgPT5cbiAgICAgICAgICAgIGZvcm1hdEV2ZW50VHlwZVRvUGxhbm5lckV2ZW50KFxuICAgICAgICAgICAgICBlLFxuICAgICAgICAgICAgICB1c2VyUHJlZmVyZW5jZSxcbiAgICAgICAgICAgICAgd29ya1RpbWVzLFxuICAgICAgICAgICAgICBob3N0VGltZXpvbmVcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuXG4gICAgICBmb3JtYXR0ZWRFdmVudFBhcnRzRm9yVXNlcj8uZm9yRWFjaCgoZSkgPT5cbiAgICAgICAgY29uc29sZS5sb2coZSwgJyBmb3JtYXR0ZWRFdmVudFBhcnRzRm9yVXNlcicpXG4gICAgICApO1xuXG4gICAgICBmb3JtYXR0ZWRFdmVudFBhcnRzLnB1c2goLi4uZm9ybWF0dGVkRXZlbnRQYXJ0c0ZvclVzZXIpO1xuICAgIH1cblxuICAgIGZvcm1hdHRlZEV2ZW50UGFydHM/LmZvckVhY2goKGUpID0+IGNvbnNvbGUubG9nKGUsICcgZm9ybWF0dGVkRXZlbnRQYXJ0cycpKTtcblxuICAgIGlmIChmb3JtYXR0ZWRFdmVudFBhcnRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGV2ZW50UGFydHMucHVzaCguLi5fLnVuaXFXaXRoKGZvcm1hdHRlZEV2ZW50UGFydHMsIF8uaXNFcXVhbCkpO1xuICAgIH1cblxuICAgIGlmIChldmVudFBhcnRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGV2ZW50UGFydHMuZm9yRWFjaCgoZSkgPT4gY29uc29sZS5sb2coZSwgJyBldmVudFBhcnRzIGFmdGVyIGZvcm1hdHRpbmcnKSk7XG4gICAgICBjb25zdCBuZXdFdmVudFBhcnRzV2l0aFByZWZlcnJlZFRpbWVTZXQgPSBldmVudFBhcnRzLm1hcCgoZSkgPT5cbiAgICAgICAgc2V0UHJlZmVycmVkVGltZUZvclVuTW9kaWZpYWJsZUV2ZW50KFxuICAgICAgICAgIGUsXG4gICAgICAgICAgYWxsRXZlbnRzLmZpbmQoKGYpID0+IGYuaWQgPT09IGUuZXZlbnRJZCk/LnRpbWV6b25lXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgICBuZXdFdmVudFBhcnRzV2l0aFByZWZlcnJlZFRpbWVTZXQuZm9yRWFjaCgoZSkgPT5cbiAgICAgICAgY29uc29sZS5sb2coZSwgJyBuZXdFdmVudFBhcnRzV2l0aFByZWZlcnJlZFRpbWVTZXQnKVxuICAgICAgKTtcbiAgICAgIGNvbnN0IG5ld0V2ZW50UGFydHMgPSBhd2FpdCB0YWdFdmVudHNGb3JEYWlseU9yV2Vla2x5VGFzayhcbiAgICAgICAgbmV3RXZlbnRQYXJ0c1dpdGhQcmVmZXJyZWRUaW1lU2V0XG4gICAgICApO1xuICAgICAgbmV3RXZlbnRQYXJ0cy5mb3JFYWNoKChlKSA9PlxuICAgICAgICBjb25zb2xlLmxvZyhlLCAnIG5ld0V2ZW50UGFydHMgYWZ0ZXIgdGFnRXZlbnRzRm9yRGFpbHlPcldlZWtseVRhc2snKVxuICAgICAgKTtcbiAgICAgIGNvbnN0IHVuZmlsdGVyZWRVc2VyTGlzdDogVXNlclBsYW5uZXJSZXF1ZXN0Qm9keVR5cGVbXSA9IFtdO1xuICAgICAgZm9yIChjb25zdCB1c2VyUHJlZmVyZW5jZSBvZiB1c2VyUHJlZmVyZW5jZXMpIHtcbiAgICAgICAgY29uc3QgdXNlclBsYW5uZXJSZXF1ZXN0Qm9keSA9IGdlbmVyYXRlVXNlclBsYW5uZXJSZXF1ZXN0Qm9keShcbiAgICAgICAgICB1c2VyUHJlZmVyZW5jZSxcbiAgICAgICAgICB1c2VyUHJlZmVyZW5jZT8udXNlcklkLFxuICAgICAgICAgIHdvcmtUaW1lcyxcbiAgICAgICAgICBtYWluSG9zdElkXG4gICAgICAgICk7XG4gICAgICAgIGNvbnNvbGUubG9nKHVzZXJQbGFubmVyUmVxdWVzdEJvZHksICcgdXNlclBsYW5uZXJSZXF1ZXN0Qm9keScpO1xuICAgICAgICB1bmZpbHRlcmVkVXNlckxpc3QucHVzaCh1c2VyUGxhbm5lclJlcXVlc3RCb2R5KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdXNlckxpc3Q6IFVzZXJQbGFubmVyUmVxdWVzdEJvZHlUeXBlW10gPSBfLnVuaXFXaXRoKFxuICAgICAgICB1bmZpbHRlcmVkVXNlckxpc3QsXG4gICAgICAgIF8uaXNFcXVhbFxuICAgICAgKTtcblxuICAgICAgY29uc3QgbW9kaWZpZWROZXdFdmVudFBhcnRzOiBFdmVudFBhcnRQbGFubmVyUmVxdWVzdEJvZHlUeXBlW10gPVxuICAgICAgICBuZXdFdmVudFBhcnRzLm1hcCgoZXZlbnRQYXJ0KSA9PiB7XG4gICAgICAgICAgY29uc3Qgb2xkRXZlbnQgPSBmaWx0ZXJlZEFsbEV2ZW50cy5maW5kKFxuICAgICAgICAgICAgKGV2ZW50KSA9PiBldmVudC5pZCA9PT0gZXZlbnRQYXJ0LmV2ZW50SWRcbiAgICAgICAgICApO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBncm91cElkOiBldmVudFBhcnQ/Lmdyb3VwSWQsXG4gICAgICAgICAgICBldmVudElkOiBldmVudFBhcnQ/LmV2ZW50SWQsXG4gICAgICAgICAgICBwYXJ0OiBldmVudFBhcnQ/LnBhcnQsXG4gICAgICAgICAgICBsYXN0UGFydDogZXZlbnRQYXJ0Py5sYXN0UGFydCxcbiAgICAgICAgICAgIG1lZXRpbmdQYXJ0OiBldmVudFBhcnQ/Lm1lZXRpbmdQYXJ0LFxuICAgICAgICAgICAgbWVldGluZ0xhc3RQYXJ0OiBldmVudFBhcnQ/Lm1lZXRpbmdMYXN0UGFydCxcbiAgICAgICAgICAgIG1lZXRpbmdJZDogZXZlbnRQYXJ0Py5tZWV0aW5nSWQsXG4gICAgICAgICAgICBob3N0SWQ6IG1haW5Ib3N0SWQsXG4gICAgICAgICAgICBzdGFydERhdGU6IGRheWpzKGV2ZW50UGFydD8uc3RhcnREYXRlLnNsaWNlKDAsIDE5KSlcbiAgICAgICAgICAgICAgLnR6KG9sZEV2ZW50LnRpbWV6b25lLCB0cnVlKVxuICAgICAgICAgICAgICAudHooaG9zdFRpbWV6b25lKVxuICAgICAgICAgICAgICAuZm9ybWF0KCksXG4gICAgICAgICAgICBlbmREYXRlOiBkYXlqcyhldmVudFBhcnQ/LmVuZERhdGUuc2xpY2UoMCwgMTkpKVxuICAgICAgICAgICAgICAudHoob2xkRXZlbnQudGltZXpvbmUsIHRydWUpXG4gICAgICAgICAgICAgIC50eihob3N0VGltZXpvbmUpXG4gICAgICAgICAgICAgIC5mb3JtYXQoKSxcbiAgICAgICAgICAgIHVzZXJJZDogZXZlbnRQYXJ0Py51c2VySWQsXG4gICAgICAgICAgICB1c2VyOiBldmVudFBhcnQ/LnVzZXIsXG4gICAgICAgICAgICBwcmlvcml0eTogZXZlbnRQYXJ0Py5wcmlvcml0eSxcbiAgICAgICAgICAgIGlzUHJlRXZlbnQ6IGV2ZW50UGFydD8uaXNQcmVFdmVudCxcbiAgICAgICAgICAgIGlzUG9zdEV2ZW50OiBldmVudFBhcnQ/LmlzUG9zdEV2ZW50LFxuICAgICAgICAgICAgcG9zaXRpdmVJbXBhY3RTY29yZTogZXZlbnRQYXJ0Py5wb3NpdGl2ZUltcGFjdFNjb3JlLFxuICAgICAgICAgICAgbmVnYXRpdmVJbXBhY3RTY29yZTogZXZlbnRQYXJ0Py5uZWdhdGl2ZUltcGFjdFNjb3JlLFxuICAgICAgICAgICAgbW9kaWZpYWJsZTogZXZlbnRQYXJ0Py5tb2RpZmlhYmxlLFxuICAgICAgICAgICAgaXNNZWV0aW5nOiBldmVudFBhcnQ/LmlzTWVldGluZyxcbiAgICAgICAgICAgIGlzRXh0ZXJuYWxNZWV0aW5nOiBldmVudFBhcnQ/LmlzRXh0ZXJuYWxNZWV0aW5nLFxuICAgICAgICAgICAgaXNFeHRlcm5hbE1lZXRpbmdNb2RpZmlhYmxlOiBldmVudFBhcnQ/LmlzRXh0ZXJuYWxNZWV0aW5nTW9kaWZpYWJsZSxcbiAgICAgICAgICAgIGlzTWVldGluZ01vZGlmaWFibGU6IGV2ZW50UGFydD8uaXNNZWV0aW5nTW9kaWZpYWJsZSxcbiAgICAgICAgICAgIGRhaWx5VGFza0xpc3Q6IGV2ZW50UGFydD8uZGFpbHlUYXNrTGlzdCxcbiAgICAgICAgICAgIHdlZWtseVRhc2tMaXN0OiBldmVudFBhcnQ/LndlZWtseVRhc2tMaXN0LFxuICAgICAgICAgICAgZ2FwOiBldmVudFBhcnQ/LmdhcCxcbiAgICAgICAgICAgIHRvdGFsV29ya2luZ0hvdXJzOiBldmVudFBhcnQ/LnRvdGFsV29ya2luZ0hvdXJzLFxuICAgICAgICAgICAgaGFyZERlYWRsaW5lOiBldmVudFBhcnQ/LmhhcmREZWFkbGluZSxcbiAgICAgICAgICAgIHNvZnREZWFkbGluZTogZXZlbnRQYXJ0Py5zb2Z0RGVhZGxpbmUsXG4gICAgICAgICAgICBmb3JFdmVudElkOiBldmVudFBhcnQ/LmZvckV2ZW50SWQsXG4gICAgICAgICAgICBwb3NpdGl2ZUltcGFjdERheU9mV2VlazogZXZlbnRQYXJ0Py5wb3NpdGl2ZUltcGFjdERheU9mV2VlayxcbiAgICAgICAgICAgIHBvc2l0aXZlSW1wYWN0VGltZTogZXZlbnRQYXJ0Py5wb3NpdGl2ZUltcGFjdFRpbWUsXG4gICAgICAgICAgICBuZWdhdGl2ZUltcGFjdERheU9mV2VlazogZXZlbnRQYXJ0Py5uZWdhdGl2ZUltcGFjdERheU9mV2VlayxcbiAgICAgICAgICAgIG5lZ2F0aXZlSW1wYWN0VGltZTogZXZlbnRQYXJ0Py5uZWdhdGl2ZUltcGFjdFRpbWUsXG4gICAgICAgICAgICBwcmVmZXJyZWREYXlPZldlZWs6IGV2ZW50UGFydD8ucHJlZmVycmVkRGF5T2ZXZWVrLFxuICAgICAgICAgICAgcHJlZmVycmVkVGltZTogZXZlbnRQYXJ0Py5wcmVmZXJyZWRUaW1lLFxuICAgICAgICAgICAgcHJlZmVycmVkU3RhcnRUaW1lUmFuZ2U6IGV2ZW50UGFydD8ucHJlZmVycmVkU3RhcnRUaW1lUmFuZ2UsXG4gICAgICAgICAgICBwcmVmZXJyZWRFbmRUaW1lUmFuZ2U6IGV2ZW50UGFydD8ucHJlZmVycmVkRW5kVGltZVJhbmdlLFxuICAgICAgICAgICAgZXZlbnQ6IGV2ZW50UGFydD8uZXZlbnQsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgIG1vZGlmaWVkTmV3RXZlbnRQYXJ0cz8uZm9yRWFjaCgoZSkgPT5cbiAgICAgICAgY29uc29sZS5sb2coZSwgJyBtb2RpZmllZE5ld0V2ZW50UGFydHMnKVxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIG1vZGlmaWVkTmV3RXZlbnRQYXJ0cz8ubGVuZ3RoID4gMFxuICAgICAgICA/IHtcbiAgICAgICAgICAgIHVzZXJJZHM6IGludGVybmFsQXR0ZW5kZWVzLm1hcCgoYSkgPT4gYS51c2VySWQpLFxuICAgICAgICAgICAgaG9zdElkOiBtYWluSG9zdElkLFxuICAgICAgICAgICAgZXZlbnRQYXJ0czogbW9kaWZpZWROZXdFdmVudFBhcnRzLFxuICAgICAgICAgICAgYWxsRXZlbnRzOiBmaWx0ZXJlZEFsbEV2ZW50cyxcbiAgICAgICAgICAgIGJyZWFrczogcGFyZW50QnJlYWtzLFxuICAgICAgICAgICAgb2xkRXZlbnRzLFxuICAgICAgICAgICAgdGltZXNsb3RzLFxuICAgICAgICAgICAgdXNlckxpc3QsXG4gICAgICAgICAgfVxuICAgICAgICA6IG51bGw7XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5sb2coXG4gICAgICBlLFxuICAgICAgJyB1bmFibGUgdG8gcHJvY2VzcyBldmVudHMgZm9yIG9wdGFwbGFubmVyIGZvciBlYWNoIGF0dGVuZGVlJ1xuICAgICk7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBwcm9jZXNzRXZlbnRzRm9yT3B0YVBsYW5uZXIgPSBhc3luYyAoXG4gIG1haW5Ib3N0SWQ6IHN0cmluZyxcbiAgaW50ZXJuYWxBdHRlbmRlZXM6IE1lZXRpbmdBc3Npc3RBdHRlbmRlZVR5cGVbXSxcbiAgbWVldGluZ0V2ZW50UGx1czogRXZlbnRNZWV0aW5nUGx1c1R5cGVbXSxcbiAgbmV3TWVldGluZ0V2ZW50UGx1czogRXZlbnRNZWV0aW5nUGx1c1R5cGVbXSxcbiAgYWxsRXZlbnRzOiBFdmVudFBsdXNUeXBlW10sXG4gIHdpbmRvd1N0YXJ0RGF0ZTogc3RyaW5nLFxuICB3aW5kb3dFbmREYXRlOiBzdHJpbmcsXG4gIGhvc3RUaW1lem9uZTogc3RyaW5nLFxuICBvbGRFdmVudHM6IEV2ZW50UGx1c1R5cGVbXSxcbiAgZXh0ZXJuYWxBdHRlbmRlZXM/OiBNZWV0aW5nQXNzaXN0QXR0ZW5kZWVUeXBlW10sXG4gIG1lZXRpbmdBc3Npc3RFdmVudHM/OiBNZWV0aW5nQXNzaXN0RXZlbnRUeXBlW10sXG4gIG5ld0hvc3RSZW1pbmRlcnM/OiBSZW1pbmRlcnNGb3JFdmVudFR5cGVbXSxcbiAgbmV3SG9zdEJ1ZmZlclRpbWVzPzogQnVmZmVyVGltZU9iamVjdFR5cGVbXVxuKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coXG4gICAgICB3aW5kb3dTdGFydERhdGUsXG4gICAgICB3aW5kb3dFbmREYXRlLFxuICAgICAgJyB3aW5kb3dTdGFydERhdGUsIHdpbmRvd0VuZERhdGUgaW5zaWRlIHByb2Nlc3NFdmVudHNGb3JPcHRhUGxhbm5lcidcbiAgICApO1xuXG4gICAgY29uc3QgbmV3SW50ZXJuYWxNZWV0aW5nRXZlbnRzUGx1cyA9IG5ld01lZXRpbmdFdmVudFBsdXNcbiAgICAgID8ubWFwKChlKSA9PiB7XG4gICAgICAgIGNvbnN0IGZvdW5kSW5kZXggPSBleHRlcm5hbEF0dGVuZGVlcz8uZmluZEluZGV4KFxuICAgICAgICAgIChhKSA9PiBhPy51c2VySWQgPT09IGU/LnVzZXJJZFxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChmb3VuZEluZGV4ID4gLTEpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICAgIH0pXG4gICAgICA/LmZpbHRlcigoZSkgPT4gZSAhPT0gbnVsbCk7XG5cbiAgICBjb25zdCBuZXdFeHRlcm5hbE1lZXRpbmdFdmVudHNQbHVzID0gbmV3TWVldGluZ0V2ZW50UGx1c1xuICAgICAgPy5tYXAoKGUpID0+IHtcbiAgICAgICAgY29uc3QgZm91bmRJbmRleCA9IGV4dGVybmFsQXR0ZW5kZWVzPy5maW5kSW5kZXgoXG4gICAgICAgICAgKGEpID0+IGE/LnVzZXJJZCA9PT0gZT8udXNlcklkXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKGZvdW5kSW5kZXggPiAtMSkge1xuICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfSlcbiAgICAgID8uZmlsdGVyKChlKSA9PiBlICE9PSBudWxsKTtcblxuICAgIGNvbnN0IGFsbEhvc3RFdmVudHMgPSBhbGxFdmVudHMuZmlsdGVyKChlKSA9PiBlLnVzZXJJZCA9PT0gbWFpbkhvc3RJZCk7XG5cbiAgICBjb25zdCBvbGRIb3N0RXZlbnRzID0gb2xkRXZlbnRzLmZpbHRlcigoZSkgPT4gZT8udXNlcklkID09PSBtYWluSG9zdElkKTtcblxuICAgIGNvbnN0IGhvc3RJc0ludGVybmFsQXR0ZW5kZWUgPSBpbnRlcm5hbEF0dGVuZGVlcy5zb21lKFxuICAgICAgKGlhKSA9PiBpYT8udXNlcklkID09PSBtYWluSG9zdElkXG4gICAgKTtcblxuICAgIGxldCByZXR1cm5WYWx1ZXNGcm9tSW50ZXJuYWxBdHRlbmRlZXM6XG4gICAgICB8IFJldHVybkJvZHlGb3JBdHRlbmRlZUZvck9wdGFwbGFubmVyUHJlcFR5cGVcbiAgICAgIHwge30gPSB7fTtcbiAgICBsZXQgcmV0dXJuVmFsdWVzRnJvbUhvc3Q6IFJldHVybkJvZHlGb3JIb3N0Rm9yT3B0YXBsYW5uZXJQcmVwVHlwZSB8IHt9ID0ge307XG5cbiAgICBjb25zb2xlLmxvZyhob3N0SXNJbnRlcm5hbEF0dGVuZGVlLCAnIGhvc3RJc0ludGVybmFsQXR0ZW5kZWUnKTtcblxuICAgIGlmIChob3N0SXNJbnRlcm5hbEF0dGVuZGVlKSB7XG4gICAgICByZXR1cm5WYWx1ZXNGcm9tSW50ZXJuYWxBdHRlbmRlZXMgPVxuICAgICAgICBhd2FpdCBwcm9jZXNzRXZlbnRzRm9yT3B0YVBsYW5uZXJGb3JJbnRlcm5hbEF0dGVuZGVlcyhcbiAgICAgICAgICBtYWluSG9zdElkLFxuICAgICAgICAgIGFsbEV2ZW50cyxcbiAgICAgICAgICB3aW5kb3dTdGFydERhdGUsXG4gICAgICAgICAgd2luZG93RW5kRGF0ZSxcbiAgICAgICAgICBob3N0VGltZXpvbmUsXG4gICAgICAgICAgaW50ZXJuYWxBdHRlbmRlZXMsXG4gICAgICAgICAgb2xkRXZlbnRzLFxuICAgICAgICAgIG1lZXRpbmdFdmVudFBsdXMsXG4gICAgICAgICAgbmV3SW50ZXJuYWxNZWV0aW5nRXZlbnRzUGx1cyxcbiAgICAgICAgICBuZXdIb3N0QnVmZmVyVGltZXNcbiAgICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuVmFsdWVzRnJvbUhvc3QgPSBhd2FpdCBwcm9jZXNzRXZlbnRzRm9yT3B0YVBsYW5uZXJGb3JNYWluSG9zdChcbiAgICAgICAgbWFpbkhvc3RJZCxcbiAgICAgICAgYWxsSG9zdEV2ZW50cyxcbiAgICAgICAgd2luZG93U3RhcnREYXRlLFxuICAgICAgICB3aW5kb3dFbmREYXRlLFxuICAgICAgICBob3N0VGltZXpvbmUsXG4gICAgICAgIG9sZEhvc3RFdmVudHMsXG4gICAgICAgIG5ld0hvc3RCdWZmZXJUaW1lc1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhcbiAgICAgIHJldHVyblZhbHVlc0Zyb21JbnRlcm5hbEF0dGVuZGVlcyxcbiAgICAgICcgcmV0dXJuVmFsdWVzRnJvbUludGVybmFsQXR0ZW5kZWVzJ1xuICAgICk7XG4gICAgY29uc3QgZXh0ZXJuYWxNZWV0aW5nRXZlbnRQbHVzID0gbWVldGluZ0V2ZW50UGx1c1xuICAgICAgLm1hcCgoZSkgPT4ge1xuICAgICAgICBjb25zdCBmb3VuZEluZGV4ID0gZXh0ZXJuYWxBdHRlbmRlZXMuZmluZEluZGV4KFxuICAgICAgICAgIChhKSA9PiBhPy51c2VySWQgPT09IGU/LnVzZXJJZFxuICAgICAgICApO1xuICAgICAgICBpZiAoZm91bmRJbmRleCA+IC0xKSB7XG4gICAgICAgICAgcmV0dXJuIGU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9KVxuICAgICAgPy5maWx0ZXIoKGUpID0+IGUgIT09IG51bGwpO1xuXG4gICAgY29uc3QgcmV0dXJuVmFsdWVzRnJvbUV4dGVybmFsQXR0ZW5kZWVzOiBSZXR1cm5Cb2R5Rm9yRXh0ZXJuYWxBdHRlbmRlZUZvck9wdGFwbGFubmVyUHJlcFR5cGUgPVxuICAgICAgZXh0ZXJuYWxBdHRlbmRlZXM/Lmxlbmd0aCA+IDBcbiAgICAgICAgPyBhd2FpdCBwcm9jZXNzRXZlbnRzRm9yT3B0YVBsYW5uZXJGb3JFeHRlcm5hbEF0dGVuZGVlcyhcbiAgICAgICAgICAgIGV4dGVybmFsQXR0ZW5kZWVzPy5tYXAoKGEpID0+IGEudXNlcklkKSxcbiAgICAgICAgICAgIG1haW5Ib3N0SWQsXG4gICAgICAgICAgICBtZWV0aW5nQXNzaXN0RXZlbnRzLFxuICAgICAgICAgICAgd2luZG93U3RhcnREYXRlLFxuICAgICAgICAgICAgd2luZG93RW5kRGF0ZSxcbiAgICAgICAgICAgIGhvc3RUaW1lem9uZSxcbiAgICAgICAgICAgIGV4dGVybmFsQXR0ZW5kZWVzLFxuICAgICAgICAgICAgZXh0ZXJuYWxNZWV0aW5nRXZlbnRQbHVzLFxuICAgICAgICAgICAgbmV3RXh0ZXJuYWxNZWV0aW5nRXZlbnRzUGx1c1xuICAgICAgICAgIClcbiAgICAgICAgOiBudWxsO1xuXG4gICAgY29uc3QgZXZlbnRQYXJ0czogRXZlbnRQYXJ0UGxhbm5lclJlcXVlc3RCb2R5VHlwZVtdID0gW107XG4gICAgY29uc3QgYWxsRXZlbnRzRm9yUGxhbm5lcjogRXZlbnRQbHVzVHlwZVtdID0gW107XG4gICAgY29uc3QgYnJlYWtzOiBFdmVudFBsdXNUeXBlW10gPSBbXTtcbiAgICBjb25zdCBvbGRFdmVudHNGb3JQbGFubmVyOiBFdmVudFBsdXNUeXBlW10gPSBbXTtcbiAgICBjb25zdCBvbGRBdHRlbmRlZUV2ZW50czogTWVldGluZ0Fzc2lzdEV2ZW50VHlwZVtdID0gW107XG4gICAgY29uc3QgdW5maWx0ZXJlZFRpbWVzbG90czogVGltZVNsb3RUeXBlW10gPSBbXTtcbiAgICBjb25zdCB1bmZpbHRlcmVkVXNlckxpc3Q6IFVzZXJQbGFubmVyUmVxdWVzdEJvZHlUeXBlW10gPSBbXTtcblxuICAgIGlmIChcbiAgICAgIChyZXR1cm5WYWx1ZXNGcm9tSG9zdCBhcyBSZXR1cm5Cb2R5Rm9ySG9zdEZvck9wdGFwbGFubmVyUHJlcFR5cGUpXG4gICAgICAgID8uZXZlbnRQYXJ0cz8ubGVuZ3RoID4gMFxuICAgICkge1xuICAgICAgZXZlbnRQYXJ0cy5wdXNoKFxuICAgICAgICAuLi4ocmV0dXJuVmFsdWVzRnJvbUhvc3QgYXMgUmV0dXJuQm9keUZvckhvc3RGb3JPcHRhcGxhbm5lclByZXBUeXBlKVxuICAgICAgICAgID8uZXZlbnRQYXJ0c1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICAocmV0dXJuVmFsdWVzRnJvbUhvc3QgYXMgUmV0dXJuQm9keUZvckhvc3RGb3JPcHRhcGxhbm5lclByZXBUeXBlKVxuICAgICAgICA/LmFsbEV2ZW50cz8ubGVuZ3RoID4gMFxuICAgICkge1xuICAgICAgYWxsRXZlbnRzRm9yUGxhbm5lci5wdXNoKFxuICAgICAgICAuLi4ocmV0dXJuVmFsdWVzRnJvbUhvc3QgYXMgUmV0dXJuQm9keUZvckhvc3RGb3JPcHRhcGxhbm5lclByZXBUeXBlKVxuICAgICAgICAgID8uYWxsRXZlbnRzXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIChyZXR1cm5WYWx1ZXNGcm9tSG9zdCBhcyBSZXR1cm5Cb2R5Rm9ySG9zdEZvck9wdGFwbGFubmVyUHJlcFR5cGUpPy5icmVha3NcbiAgICAgICAgPy5sZW5ndGggPiAwXG4gICAgKSB7XG4gICAgICBicmVha3MucHVzaChcbiAgICAgICAgLi4uKHJldHVyblZhbHVlc0Zyb21Ib3N0IGFzIFJldHVybkJvZHlGb3JIb3N0Rm9yT3B0YXBsYW5uZXJQcmVwVHlwZSlcbiAgICAgICAgICA/LmJyZWFrc1xuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICAocmV0dXJuVmFsdWVzRnJvbUhvc3QgYXMgUmV0dXJuQm9keUZvckhvc3RGb3JPcHRhcGxhbm5lclByZXBUeXBlKVxuICAgICAgICA/Lm9sZEV2ZW50cz8ubGVuZ3RoID4gMFxuICAgICkge1xuICAgICAgb2xkRXZlbnRzRm9yUGxhbm5lci5wdXNoKFxuICAgICAgICAuLi4ocmV0dXJuVmFsdWVzRnJvbUhvc3QgYXMgUmV0dXJuQm9keUZvckhvc3RGb3JPcHRhcGxhbm5lclByZXBUeXBlKVxuICAgICAgICAgID8ub2xkRXZlbnRzXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIChyZXR1cm5WYWx1ZXNGcm9tSG9zdCBhcyBSZXR1cm5Cb2R5Rm9ySG9zdEZvck9wdGFwbGFubmVyUHJlcFR5cGUpXG4gICAgICAgID8udGltZXNsb3RzPy5sZW5ndGggPiAwXG4gICAgKSB7XG4gICAgICB1bmZpbHRlcmVkVGltZXNsb3RzLnB1c2goXG4gICAgICAgIC4uLihyZXR1cm5WYWx1ZXNGcm9tSG9zdCBhcyBSZXR1cm5Cb2R5Rm9ySG9zdEZvck9wdGFwbGFubmVyUHJlcFR5cGUpXG4gICAgICAgICAgPy50aW1lc2xvdHNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgKHJldHVyblZhbHVlc0Zyb21Ib3N0IGFzIFJldHVybkJvZHlGb3JIb3N0Rm9yT3B0YXBsYW5uZXJQcmVwVHlwZSlcbiAgICAgICAgPy51c2VyUGxhbm5lclJlcXVlc3RCb2R5Py5pZFxuICAgICkge1xuICAgICAgdW5maWx0ZXJlZFVzZXJMaXN0LnB1c2goXG4gICAgICAgIChyZXR1cm5WYWx1ZXNGcm9tSG9zdCBhcyBSZXR1cm5Cb2R5Rm9ySG9zdEZvck9wdGFwbGFubmVyUHJlcFR5cGUpXG4gICAgICAgICAgPy51c2VyUGxhbm5lclJlcXVlc3RCb2R5XG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIChcbiAgICAgICAgcmV0dXJuVmFsdWVzRnJvbUludGVybmFsQXR0ZW5kZWVzIGFzIFJldHVybkJvZHlGb3JBdHRlbmRlZUZvck9wdGFwbGFubmVyUHJlcFR5cGVcbiAgICAgICk/LnVzZXJMaXN0Py5bMF0/LmlkXG4gICAgKSB7XG4gICAgICB1bmZpbHRlcmVkVXNlckxpc3QucHVzaChcbiAgICAgICAgLi4uKFxuICAgICAgICAgIHJldHVyblZhbHVlc0Zyb21JbnRlcm5hbEF0dGVuZGVlcyBhcyBSZXR1cm5Cb2R5Rm9yQXR0ZW5kZWVGb3JPcHRhcGxhbm5lclByZXBUeXBlXG4gICAgICAgICk/LnVzZXJMaXN0XG4gICAgICApO1xuICAgIH1cblxuICAgIChcbiAgICAgIHJldHVyblZhbHVlc0Zyb21JbnRlcm5hbEF0dGVuZGVlcyBhcyBSZXR1cm5Cb2R5Rm9yQXR0ZW5kZWVGb3JPcHRhcGxhbm5lclByZXBUeXBlXG4gICAgKT8uZXZlbnRQYXJ0cz8uZm9yRWFjaCgoZSkgPT5cbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBlLFxuICAgICAgICAnIChyZXR1cm5WYWx1ZXNGcm9tSW50ZXJuYWxBdHRlbmRlZXMgYXMgUmV0dXJuQm9keUZvckF0dGVuZGVlRm9yT3B0YXBsYW5uZXJQcmVwVHlwZSk/LmV2ZW50UGFydHMnXG4gICAgICApXG4gICAgKTtcblxuICAgIGlmIChcbiAgICAgIChcbiAgICAgICAgcmV0dXJuVmFsdWVzRnJvbUludGVybmFsQXR0ZW5kZWVzIGFzIFJldHVybkJvZHlGb3JBdHRlbmRlZUZvck9wdGFwbGFubmVyUHJlcFR5cGVcbiAgICAgICk/LmV2ZW50UGFydHM/Lmxlbmd0aCA+IDBcbiAgICApIHtcbiAgICAgIGV2ZW50UGFydHMucHVzaChcbiAgICAgICAgLi4uKFxuICAgICAgICAgIHJldHVyblZhbHVlc0Zyb21JbnRlcm5hbEF0dGVuZGVlcyBhcyBSZXR1cm5Cb2R5Rm9yQXR0ZW5kZWVGb3JPcHRhcGxhbm5lclByZXBUeXBlXG4gICAgICAgICk/LmV2ZW50UGFydHNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgKFxuICAgICAgICByZXR1cm5WYWx1ZXNGcm9tSW50ZXJuYWxBdHRlbmRlZXMgYXMgUmV0dXJuQm9keUZvckF0dGVuZGVlRm9yT3B0YXBsYW5uZXJQcmVwVHlwZVxuICAgICAgKT8uYWxsRXZlbnRzPy5sZW5ndGggPiAwXG4gICAgKSB7XG4gICAgICBhbGxFdmVudHNGb3JQbGFubmVyLnB1c2goXG4gICAgICAgIC4uLihcbiAgICAgICAgICByZXR1cm5WYWx1ZXNGcm9tSW50ZXJuYWxBdHRlbmRlZXMgYXMgUmV0dXJuQm9keUZvckF0dGVuZGVlRm9yT3B0YXBsYW5uZXJQcmVwVHlwZVxuICAgICAgICApPy5hbGxFdmVudHNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgKFxuICAgICAgcmV0dXJuVmFsdWVzRnJvbUludGVybmFsQXR0ZW5kZWVzIGFzIFJldHVybkJvZHlGb3JBdHRlbmRlZUZvck9wdGFwbGFubmVyUHJlcFR5cGVcbiAgICApPy5icmVha3M/LmZvckVhY2goKGUpID0+XG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgZSxcbiAgICAgICAgJyAocmV0dXJuVmFsdWVzRnJvbUludGVybmFsQXR0ZW5kZWVzIGFzIFJldHVybkJvZHlGb3JBdHRlbmRlZUZvck9wdGFwbGFubmVyUHJlcFR5cGUpPy5icmVha3MnXG4gICAgICApXG4gICAgKTtcblxuICAgIGlmIChcbiAgICAgIChcbiAgICAgICAgcmV0dXJuVmFsdWVzRnJvbUludGVybmFsQXR0ZW5kZWVzIGFzIFJldHVybkJvZHlGb3JBdHRlbmRlZUZvck9wdGFwbGFubmVyUHJlcFR5cGVcbiAgICAgICk/LmJyZWFrcz8ubGVuZ3RoID4gMFxuICAgICkge1xuICAgICAgYnJlYWtzLnB1c2goXG4gICAgICAgIC4uLihcbiAgICAgICAgICByZXR1cm5WYWx1ZXNGcm9tSW50ZXJuYWxBdHRlbmRlZXMgYXMgUmV0dXJuQm9keUZvckF0dGVuZGVlRm9yT3B0YXBsYW5uZXJQcmVwVHlwZVxuICAgICAgICApPy5icmVha3NcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgKFxuICAgICAgICByZXR1cm5WYWx1ZXNGcm9tSW50ZXJuYWxBdHRlbmRlZXMgYXMgUmV0dXJuQm9keUZvckF0dGVuZGVlRm9yT3B0YXBsYW5uZXJQcmVwVHlwZVxuICAgICAgKT8ub2xkRXZlbnRzPy5sZW5ndGggPiAwXG4gICAgKSB7XG4gICAgICBvbGRFdmVudHNGb3JQbGFubmVyLnB1c2goXG4gICAgICAgIC4uLihcbiAgICAgICAgICByZXR1cm5WYWx1ZXNGcm9tSW50ZXJuYWxBdHRlbmRlZXMgYXMgUmV0dXJuQm9keUZvckF0dGVuZGVlRm9yT3B0YXBsYW5uZXJQcmVwVHlwZVxuICAgICAgICApPy5vbGRFdmVudHNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgKFxuICAgICAgICByZXR1cm5WYWx1ZXNGcm9tSW50ZXJuYWxBdHRlbmRlZXMgYXMgUmV0dXJuQm9keUZvckF0dGVuZGVlRm9yT3B0YXBsYW5uZXJQcmVwVHlwZVxuICAgICAgKT8udGltZXNsb3RzPy5sZW5ndGggPiAwXG4gICAgKSB7XG4gICAgICB1bmZpbHRlcmVkVGltZXNsb3RzLnB1c2goXG4gICAgICAgIC4uLihcbiAgICAgICAgICByZXR1cm5WYWx1ZXNGcm9tSW50ZXJuYWxBdHRlbmRlZXMgYXMgUmV0dXJuQm9keUZvckF0dGVuZGVlRm9yT3B0YXBsYW5uZXJQcmVwVHlwZVxuICAgICAgICApPy50aW1lc2xvdHNcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKHJldHVyblZhbHVlc0Zyb21FeHRlcm5hbEF0dGVuZGVlcz8uZXZlbnRQYXJ0cz8ubGVuZ3RoID4gMCkge1xuICAgICAgZXZlbnRQYXJ0cy5wdXNoKC4uLnJldHVyblZhbHVlc0Zyb21FeHRlcm5hbEF0dGVuZGVlcz8uZXZlbnRQYXJ0cyk7XG4gICAgfVxuXG4gICAgaWYgKHJldHVyblZhbHVlc0Zyb21FeHRlcm5hbEF0dGVuZGVlcz8uYWxsRXZlbnRzPy5sZW5ndGggPiAwKSB7XG4gICAgICBhbGxFdmVudHNGb3JQbGFubmVyLnB1c2goLi4ucmV0dXJuVmFsdWVzRnJvbUV4dGVybmFsQXR0ZW5kZWVzPy5hbGxFdmVudHMpO1xuICAgIH1cblxuICAgIGlmIChyZXR1cm5WYWx1ZXNGcm9tRXh0ZXJuYWxBdHRlbmRlZXM/Lm9sZEF0dGVuZGVlRXZlbnRzPy5sZW5ndGggPiAwKSB7XG4gICAgICBvbGRBdHRlbmRlZUV2ZW50cy5wdXNoKFxuICAgICAgICAuLi5yZXR1cm5WYWx1ZXNGcm9tRXh0ZXJuYWxBdHRlbmRlZXM/Lm9sZEF0dGVuZGVlRXZlbnRzXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChyZXR1cm5WYWx1ZXNGcm9tRXh0ZXJuYWxBdHRlbmRlZXM/LnRpbWVzbG90cz8ubGVuZ3RoID4gMCkge1xuICAgICAgdW5maWx0ZXJlZFRpbWVzbG90cy5wdXNoKC4uLnJldHVyblZhbHVlc0Zyb21FeHRlcm5hbEF0dGVuZGVlcz8udGltZXNsb3RzKTtcbiAgICB9XG5cbiAgICBpZiAocmV0dXJuVmFsdWVzRnJvbUV4dGVybmFsQXR0ZW5kZWVzPy51c2VyTGlzdD8ubGVuZ3RoID4gMCkge1xuICAgICAgdW5maWx0ZXJlZFVzZXJMaXN0LnB1c2goLi4ucmV0dXJuVmFsdWVzRnJvbUV4dGVybmFsQXR0ZW5kZWVzPy51c2VyTGlzdCk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2cob2xkRXZlbnRzLCAnIG9sZEV2ZW50cyBiZWZvcmUgc2F2aW5nIHRvIHMzJyk7XG5cbiAgICBjb25zdCBkdXBsaWNhdGVGcmVlRXZlbnRQYXJ0czogRXZlbnRQYXJ0UGxhbm5lclJlcXVlc3RCb2R5VHlwZVtdID1cbiAgICAgIF8udW5pcVdpdGgoZXZlbnRQYXJ0cywgXy5pc0VxdWFsKTtcbiAgICBjb25zdCBkdXBsaWNhdGVGcmVlQWxsRXZlbnRzID0gXy51bmlxV2l0aChhbGxFdmVudHNGb3JQbGFubmVyLCBfLmlzRXF1YWwpO1xuICAgIGNvbnN0IGR1cGxpY2F0ZUZyZWVCcmVha3MgPSBfLnVuaXFXaXRoKGJyZWFrcywgXy5pc0VxdWFsKTtcbiAgICBjb25zdCBkdXBsaWNhdGVGcmVlT2xkRXZlbnRzID0gXy51bmlxV2l0aChvbGRFdmVudHMsIF8uaXNFcXVhbCk7XG4gICAgY29uc3QgZHVwbGljYXRlRnJlZU9sZEF0dGVuZGVlRXZlbnRzID0gXy51bmlxV2l0aChcbiAgICAgIG9sZEF0dGVuZGVlRXZlbnRzLFxuICAgICAgXy5pc0VxdWFsXG4gICAgKTtcbiAgICBjb25zdCBkdXBsaWNhdGVGcmVlVGltZXNsb3RzOiBUaW1lU2xvdFR5cGVbXSA9IF8udW5pcVdpdGgoXG4gICAgICB1bmZpbHRlcmVkVGltZXNsb3RzLFxuICAgICAgXy5pc0VxdWFsXG4gICAgKTtcbiAgICBjb25zdCBzaW5nbGV0b25JZCA9IHV1aWQoKTtcblxuICAgIGNvbnNvbGUubG9nKGV2ZW50UGFydHMsICcgZXZlbnRQYXJ0cyBiZWZvcmUgdmFsaWRhdGlvbicpO1xuICAgIGNvbnNvbGUubG9nKFxuICAgICAgZHVwbGljYXRlRnJlZUV2ZW50UGFydHMsXG4gICAgICAnIGR1cGxpY2F0ZUZyZWVFdmVudFBhcnRzIGJlZm9yZSB2YWxpZGF0aW9uJ1xuICAgICk7XG4gICAgY29uc29sZS5sb2coZHVwbGljYXRlRnJlZUFsbEV2ZW50cywgJyBkdXBsaWNhdGVGcmVlQWxsRXZlbnRzJyk7XG4gICAgY29uc29sZS5sb2coZHVwbGljYXRlRnJlZU9sZEV2ZW50cywgJyBkdXBsaWNhdGVGcmVlT2xkRXZlbnRzJyk7XG4gICAgY29uc29sZS5sb2coZHVwbGljYXRlRnJlZVRpbWVzbG90cywgJyBkdXBsaWNhdGVGcmVlVGltZXNsb3RzJyk7XG4gICAgaWYgKCFkdXBsaWNhdGVGcmVlRXZlbnRQYXJ0cyB8fCBkdXBsaWNhdGVGcmVlRXZlbnRQYXJ0cz8ubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V2ZW50IFBhcnRzIGxlbmd0aCBpcyAwIG9yIGRvIG5vdCBleGlzdCcpO1xuICAgIH1cblxuICAgIGlmICghZHVwbGljYXRlRnJlZVRpbWVzbG90cyB8fCAhKGR1cGxpY2F0ZUZyZWVUaW1lc2xvdHM/Lmxlbmd0aCA+IDApKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJyBkdXBsaWNhdGVGcmVlVGltZXNsb3RzIGlzIGVtcHR5Jyk7XG4gICAgfVxuXG4gICAgaWYgKCF1bmZpbHRlcmVkVXNlckxpc3QgfHwgISh1bmZpbHRlcmVkVXNlckxpc3Q/Lmxlbmd0aCA+IDApKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3VuZmlsdGVyZWRVc2VyTGlzdCBpcyBlbXB0eScpO1xuICAgIH1cblxuICAgIGR1cGxpY2F0ZUZyZWVUaW1lc2xvdHM/LmZvckVhY2goKGQpID0+XG4gICAgICBjb25zb2xlLmxvZyhkLCAnIGR1cGxpY2F0ZUZyZWVUaW1lc2xvdHMnKVxuICAgICk7XG4gICAgdW5maWx0ZXJlZFVzZXJMaXN0Py5mb3JFYWNoKCh1KSA9PiBjb25zb2xlLmxvZyh1LCAnIHVuZmlsdGVyZWRVc2VyTGlzdCcpKTtcbiAgICBuZXdIb3N0QnVmZmVyVGltZXM/LmZvckVhY2goKGIpID0+XG4gICAgICBjb25zb2xlLmxvZyhiLmJlZm9yZUV2ZW50LCBiLmFmdGVyRXZlbnQsICcgYi5iZWZvcmVFdmVudCBiLmFmdGVyRXZlbnQgJylcbiAgICApO1xuXG4gICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgQm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBzaW5nbGV0b25JZCxcbiAgICAgICAgaG9zdElkOiBtYWluSG9zdElkLFxuICAgICAgICBldmVudFBhcnRzOiBkdXBsaWNhdGVGcmVlRXZlbnRQYXJ0cyxcbiAgICAgICAgYWxsRXZlbnRzOiBkdXBsaWNhdGVGcmVlQWxsRXZlbnRzLFxuICAgICAgICBicmVha3M6IGR1cGxpY2F0ZUZyZWVCcmVha3MsXG4gICAgICAgIG9sZEV2ZW50czogZHVwbGljYXRlRnJlZU9sZEV2ZW50cyxcbiAgICAgICAgb2xkQXR0ZW5kZWVFdmVudHM6IGR1cGxpY2F0ZUZyZWVPbGRBdHRlbmRlZUV2ZW50cyxcbiAgICAgICAgbmV3SG9zdEJ1ZmZlclRpbWVzOiBuZXdIb3N0QnVmZmVyVGltZXMsXG4gICAgICAgIG5ld0hvc3RSZW1pbmRlcnM6IG5ld0hvc3RSZW1pbmRlcnMsXG4gICAgICAgIGhvc3RUaW1lem9uZSxcbiAgICAgIH0pLFxuICAgICAgQnVja2V0OiBidWNrZXROYW1lLFxuICAgICAgS2V5OiBgJHttYWluSG9zdElkfS8ke3NpbmdsZXRvbklkfS5qc29uYCxcbiAgICAgIENvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgfTtcblxuICAgIGNvbnN0IHMzQ29tbWFuZCA9IG5ldyBQdXRPYmplY3RDb21tYW5kKHBhcmFtcyk7XG5cbiAgICBjb25zdCBzM1Jlc3BvbnNlID0gYXdhaXQgczNDbGllbnQuc2VuZChzM0NvbW1hbmQpO1xuXG4gICAgY29uc29sZS5sb2coczNSZXNwb25zZSwgJyBzM1Jlc3BvbnNlJyk7XG5cbiAgICBhd2FpdCBvcHRhUGxhbldlZWtseShcbiAgICAgIGR1cGxpY2F0ZUZyZWVUaW1lc2xvdHMsXG4gICAgICB1bmZpbHRlcmVkVXNlckxpc3QsXG4gICAgICBkdXBsaWNhdGVGcmVlRXZlbnRQYXJ0cyxcbiAgICAgIHNpbmdsZXRvbklkLFxuICAgICAgbWFpbkhvc3RJZCxcbiAgICAgIGAke21haW5Ib3N0SWR9LyR7c2luZ2xldG9uSWR9Lmpzb25gLFxuICAgICAgb3B0YXBsYW5uZXJEdXJhdGlvbixcbiAgICAgIG9uT3B0YVBsYW5DYWxlbmRhckFkbWluQ2FsbEJhY2tVcmxcbiAgICApO1xuXG4gICAgY29uc29sZS5sb2coJ29wdGFwbGFubmVyIHJlcXVlc3Qgc2VudCcpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5sb2coZSwgJyB1bmFibGUgdG8gcHJvY2VzcyBldmVudHMgZm9yIG9wdGFwbGFubmVyJyk7XG4gIH1cbn07XG4iXX0=