import { callOpenAI } from '@chat/_libs/api-helper';
import OpenAI from 'openai';
import { defaultOpenAIAPIKey, openAIChatGPT35Model, } from '@chat/_libs/constants';
import { categorizeSkillFromUserInputExampleInput, categorizeSkillFromUserInputExampleOutput, categorizeSkillFromUserInputPrompt, } from '@chat/_libs/prompts/categorizeSkillFromUserInput';
import { dayjs } from '@chat/_libs/datetime/date-utils';
import { askAvailabilityControlCenterForPending } from '@chat/_libs/skills/askCalendar/askAvailability/api-helper';
import { askEventControlCenter } from '@chat/_libs/skills/askCalendar/findEvent/api-helper';
import { nextEventControlCenter } from '@chat/_libs/skills/askCalendar/nextEvent/api-helper';
import { addTaskControlCenter } from '@chat/_libs/skills/orderCalendar/addTask/api-helper';
import { blockOffTimeControlCenter } from '@chat/_libs/skills/orderCalendar/blockOffTime/api-helper';
import { cancelMeetingControlCenterPending } from '@chat/_libs/skills/orderCalendar/cancelMeeting/api-helper';
import { queryEventsControlCenter } from '@chat/_libs/skills/askCalendar/findEvents/api-helper';
import { createEventControlCenter } from '@chat/_libs/skills/orderCalendar/createEvent/api-helper';
import { deleteEventControlCenter } from '@chat/_libs/skills/orderCalendar/deleteEvent/api-helper';
import { deletePriorityControlCenter } from '@chat/_libs/skills/orderCalendar/deletePriority/api-helper';
import { deleteTaskControlCenter } from '@chat/_libs/skills/orderCalendar/deleteTask/api-helper';
import { EAPTToPreferredTimesControlCenter } from '@chat/_libs/skills/orderCalendar/editAddPreferredTimeToPreferredTimes/api-helper';
import { editEventControlCenter } from '@chat/_libs/skills/orderCalendar/editEvent/api-helper';
import { ERPT2PTControlCenter } from '@chat/_libs/skills/orderCalendar/editRemovePreferredTimeToPreferredTimes/api-helper';
import { FMTWPControlCenter } from '@chat/_libs/skills/orderCalendar/findMeetingTimeWithPermission/api-helper';
import { generateMeetingInviteControlCenter } from '@chat/_libs/skills/orderCalendar/generateMeetingInvite/api-helper';
import { RAPControlCenter } from '@chat/_libs/skills/orderCalendar/removeAllPreferedTimes/api-helper';
import { RCEControlCenter } from '@chat/_libs/skills/orderCalendar/resolveConflictingEvents/api-helper';
import { scheduleMeetingControlCenter } from '@chat/_libs/skills/orderCalendar/scheduleMeeting/api-helper';
import { sendMeetingInviteControlCenter } from '@chat/_libs/skills/orderCalendar/sendMeetingInvite/api-helper';
import { updateMeetingControlCenter } from '@chat/_libs/skills/orderCalendar/updateMeeting/api-helper';
import { updatePriorityControlCenter } from '@chat/_libs/skills/orderCalendar/updatePriority/api-helper';
import { updateTaskControlCenter } from '@chat/_libs/skills/orderCalendar/updateTask/api-helper';
const openai = new OpenAI({
    apiKey: defaultOpenAIAPIKey,
});
const processQueries = async (userId, timezone, messageHistoryObject) => {
    try {
        // const userInput = messageHistoryObject?.messages?.[messageHistoryObject?.messages?.length - 1]?.content
        // extractQueryUserInputTimeToJSONTemplate
        const userCurrentTime = dayjs()
            .tz(timezone)
            .format('dddd, YYYY-MM-DDTHH:mm:ssZ');
        switch (messageHistoryObject.skill) {
            case 'ask-availability':
                const messageHistoryObjectReturnedAskAvailability = await askAvailabilityControlCenterForPending(openai, userId, timezone, messageHistoryObject, userCurrentTime);
                return messageHistoryObjectReturnedAskAvailability;
            case 'find-event':
                const messageHistoryObjectReturnedAskEvent = await askEventControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedAskEvent;
            case 'find-events':
                const messageHistoryObjectReturnedAskEvents = await queryEventsControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedAskEvents;
            case 'find-next-event':
                const messageHistoryObjectReturnedNextEvent = await nextEventControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedNextEvent;
            case 'add-task':
                const messageHistoryObjectReturnedAddTask = await addTaskControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedAddTask;
            case 'block-off-time':
                const messageHistoryObjectReturnedBockOffTime = await blockOffTimeControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject.query);
                return messageHistoryObjectReturnedBockOffTime;
            case 'cancel-meeting':
                const messageHistoryObjectReturnedCancelMeeting = await cancelMeetingControlCenterPending(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject.query);
                return messageHistoryObjectReturnedCancelMeeting;
            case 'create-event':
                const messageHistoryObjectReturnedCreateEvent = await createEventControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject.query);
                return messageHistoryObjectReturnedCreateEvent;
            case 'delete-event':
                const messageHistoryObjectReturnedDeleteEvent = await deleteEventControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject.query);
                return messageHistoryObjectReturnedDeleteEvent;
            case 'delete-priority':
                const messageHistoryObjectReturnedDeletePriority = await deletePriorityControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject.query);
                return messageHistoryObjectReturnedDeletePriority;
            case 'delete-task':
                const messageHistoryObjectReturnedDeleteTask = await deleteTaskControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedDeleteTask;
            case 'edit-add-preferred-time-to-preferred-times':
                // EAPTToPreferredTimesControlCenterPending
                const messageHistoryObjectReturnedEAPT = await EAPTToPreferredTimesControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedEAPT;
            case 'edit-event':
                // editEventControlCenterPending
                const messageHistoryObjectReturnedEditEvent = await editEventControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedEditEvent;
            case 'edit-remove-preferred-time-to-preferred-times':
                // ERPT2PTControlCenterPending
                const messageHistoryObjectReturnedERPT2PTs = await ERPT2PTControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedERPT2PTs;
            case 'find-meeting-time-with-permission':
                // findMeetingTimeWithPermissionControlCenterPending
                const messageHistoryObjectReturnedFMTWP = await FMTWPControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedFMTWP;
            case 'generate-meeting-invite':
                // generateMeetingInviteControlCenterPending
                const messageHistoryObjectReturnedGMI = await generateMeetingInviteControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedGMI;
            case 'remove-all-preferred-times':
                // RAPControlCenterPending
                const messageHistoryObjectReturnedRAP = await RAPControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedRAP;
            case 'resolve-conflicting-events':
                const messageHistoryObjectReturnedRCE = await RCEControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedRCE;
            case 'schedule-meeting':
                // scheduleMeetingControlCenterPending
                const messageHistoryObjectReturnedScheduleMeeting = await scheduleMeetingControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedScheduleMeeting;
            case 'send-meeting-invite':
                // sendMeetingInviteControlCenterPending
                const messageHistoryObjectReturnedSMI = await sendMeetingInviteControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedSMI;
            case 'update-meeting':
                // updateMeetingControlCenterPending
                const messageHistoryObjectReturnedUpdateMeeting = await updateMeetingControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedUpdateMeeting;
            case 'update-priority':
                // updatePriorityControlCenterPending
                const messageHistoryObjectReturnedUpdatePriority = await updatePriorityControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedUpdatePriority;
            case 'update-task':
                // updateTaskControlCenterPending
                const messageHistoryObjectReturnedUpdateTask = await updateTaskControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedUpdateTask;
            default:
                const messageHistoryObjectReturnedAskEventsDefault = await queryEventsControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedAskEventsDefault;
        }
    }
    catch (e) {
        console.log(e, ' unable to process pending queries');
    }
};
// Modify processQueries to accept sendCommandToUserFunc
const processQueries = async (userId, timezone, messageHistoryObject, sendCommandToUserFunc // New parameter
) => {
    try {
        const userCurrentTime = dayjs()
            .tz(timezone)
            .format('dddd, YYYY-MM-DDTHH:mm:ssZ');
        // Import the new skill handlers here if they are not too large,
        // or create a dedicated control center that imports them.
        // For now, let's assume we might call them more directly for simplicity of this step,
        // acknowledging this might be refactored into a proper "control center".
        // This dynamic import is for illustration; static imports are generally preferred.
        const ইনPersonAudioNoteSkills = await import('../../../atom-agent/skills/inPersonAudioNoteSkills');
        switch (messageHistoryObject.skill) {
            // --- NEW CASES FOR IN-PERSON AUDIO NOTES ---
            case 'IN_PERSON_AUDIO_NOTE_START': // Assuming NLU categorizes to this
            case 'IN_PERSON_AUDIO_NOTE_STOP':
            case 'IN_PERSON_AUDIO_NOTE_CANCEL':
                if (!sendCommandToUserFunc) {
                    console.error('sendCommandToUserFunc not provided to processQueries for audio note skill.');
                    // Fallback response or error
                    messageHistoryObject.messages.push({
                        role: 'assistant',
                        content: "Sorry, I can't control audio recording right now due to a setup issue.",
                    });
                    return messageHistoryObject;
                }
                const agentSkillContext = {
                    userId,
                    sendCommandToClient: sendCommandToUserFunc,
                };
                // Construct a simplified NLU result for the skill handler
                const nluResultForSkill = {
                    intent: { name: messageHistoryObject.skill }, // e.g., "IN_PERSON_AUDIO_NOTE_START"
                    entities: messageHistoryObject.prevData?.entities || {}, // Pass any entities gathered by NLU
                    raw_input: messageHistoryObject.messages[messageHistoryObject.messages.length - 1]?.content,
                };
                let skillResponse;
                if (messageHistoryObject.skill === 'IN_PERSON_AUDIO_NOTE_START') {
                    skillResponse =
                        await ইনPersonAudioNoteSkills.handleStartInPersonAudioNoteDirect(nluResultForSkill, agentSkillContext);
                }
                else if (messageHistoryObject.skill === 'IN_PERSON_AUDIO_NOTE_STOP') {
                    skillResponse =
                        await ইনPersonAudioNoteSkills.handleStopInPersonAudioNoteDirect(nluResultForSkill, agentSkillContext);
                }
                else {
                    // CANCEL
                    skillResponse =
                        await ইনPersonAudioNoteSkills.handleCancelInPersonAudioNoteDirect(nluResultForSkill, agentSkillContext);
                }
                messageHistoryObject.messages.push({
                    role: 'assistant',
                    content: skillResponse.message,
                });
                messageHistoryObject.query = 'completed'; // Mark as completed
                return messageHistoryObject;
            // --- EXISTING CASES ---
            case 'ask-availability':
                const messageHistoryObjectReturnedAskAvailability = await askAvailabilityControlCenterForPending(openai, userId, timezone, messageHistoryObject, userCurrentTime);
                return messageHistoryObjectReturnedAskAvailability;
            // ... (all other existing cases remain unchanged) ...
            case 'update-task':
                // updateTaskControlCenterPending
                const messageHistoryObjectReturnedUpdateTask = await updateTaskControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedUpdateTask;
            default:
                // If skill is not one of the audio commands or other known skills,
                // it might fall through to a default handler or error.
                // For now, let's assume the existing default (queryEventsControlCenter) is fine if no match.
                console.warn(`processQueries: Unhandled or default skill: ${messageHistoryObject.skill}`);
                const messageHistoryObjectReturnedAskEventsDefault = await queryEventsControlCenter(openai, userId, timezone, messageHistoryObject, userCurrentTime, messageHistoryObject?.query);
                return messageHistoryObjectReturnedAskEventsDefault;
        }
    }
    catch (e) {
        console.log(e, ' unable to process pending queries in processQueries');
        // Ensure a valid SkillMessageHistoryType is returned even on error
        messageHistoryObject.messages.push({
            role: 'assistant',
            content: 'An error occurred while processing your request.',
        });
        messageHistoryObject.query = 'error';
        return messageHistoryObject;
    }
};
// Modify assistant_brain to accept and pass sendCommandToUserFunc
const assistant_brain = async (eventPayload, // Changed 'event' to 'eventPayload' for clarity
userIdFromWs, // Explicitly passed by server.ts
// requestFromWs: any, // The original request object from WebSocket upgrade, if needed by any skill
sendCommandToUserFunc // New parameter
) => {
    // const body = eventPayload; // Keep if direct Buffer processing is needed
    try {
        // If eventPayload is Buffer, convert to string. If already string, use as is.
        const bodyString = Buffer.isBuffer(eventPayload)
            ? eventPayload.toString()
            : eventPayload;
        console.log(bodyString, ' bodyString inside assistant_brain');
        const bodyObject = JSON.parse(bodyString);
        console.log(bodyObject, ' bodyObject inside assistant_brain');
        // userId should be the authenticated one from WebSocket connection, not from body if possible
        const userId = userIdFromWs || bodyObject?.userId;
        const timezone = bodyObject?.timezone;
        const messageHistoryObject = bodyObject?.chat;
        if (!userId) {
            throw new Error('no userId provided (either from WebSocket auth or message body)');
        }
        if (!timezone) {
            // Fallback timezone or error
            // For now, let's use a default or throw. Agent might need user's actual timezone.
            console.warn(`No timezone provided for user ${userId}, falling back to UTC or agent default.`);
            // throw new Error('no timezone provided');
        }
        if (!messageHistoryObject) {
            throw new Error('no messageHistoryObject (chat payload)');
        }
        // NLU Skill Categorization (existing logic)
        if (messageHistoryObject?.skill === 'pending') {
            const userInputForNlu = messageHistoryObject?.messages?.[messageHistoryObject?.messages?.length - 1]?.content;
            if (userInputForNlu) {
                const openAIResSkill = await callOpenAI(openai, categorizeSkillFromUserInputPrompt, openAIChatGPT35Model, userInputForNlu, categorizeSkillFromUserInputExampleInput, categorizeSkillFromUserInputExampleOutput);
                console.log(openAIResSkill, ' openAIResSkill categorized by NLU');
                messageHistoryObject.skill = openAIResSkill;
                // TODO: If NLU categorizes to IN_PERSON_AUDIO_NOTE_START, etc., it needs to also extract entities
                // like suggestedTitle and pass them. For now, this is a gap if relying on this NLU.
                // The `inPersonAudioNoteSkills` currently expect entities in `nluResult.entities`.
                // `messageHistoryObject.prevData.entities` might be a place to store them.
            }
            else {
                console.warn('User input for NLU skill categorization is empty.');
                messageHistoryObject.skill = 'unknown_or_empty_input'; // Handle gracefully
            }
        }
        // Call processQueries, now passing sendCommandToUserFunc
        const res = await processQueries(userId, timezone || 'UTC', messageHistoryObject, sendCommandToUserFunc);
        return JSON.stringify(res);
    }
    catch (e) {
        console.error('Error in assistant_brain:', e.message, e.stack);
        return JSON.stringify(e);
    }
};
export default assistant_brain;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImhhbmRsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRXBELE9BQU8sTUFBTSxNQUFNLFFBQVEsQ0FBQztBQUM1QixPQUFPLEVBQ0wsbUJBQW1CLEVBQ25CLG9CQUFvQixHQUNyQixNQUFNLHVCQUF1QixDQUFDO0FBQy9CLE9BQU8sRUFDTCx3Q0FBd0MsRUFDeEMseUNBQXlDLEVBQ3pDLGtDQUFrQyxHQUNuQyxNQUFNLGtEQUFrRCxDQUFDO0FBSzFELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUN4RCxPQUFPLEVBQUUsc0NBQXNDLEVBQUUsTUFBTSwyREFBMkQsQ0FBQztBQUNuSCxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxxREFBcUQsQ0FBQztBQUM1RixPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxxREFBcUQsQ0FBQztBQUM3RixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxxREFBcUQsQ0FBQztBQUMzRixPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSwwREFBMEQsQ0FBQztBQUNyRyxPQUFPLEVBQUUsaUNBQWlDLEVBQUUsTUFBTSwyREFBMkQsQ0FBQztBQUM5RyxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSxzREFBc0QsQ0FBQztBQUNoRyxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSx5REFBeUQsQ0FBQztBQUNuRyxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSx5REFBeUQsQ0FBQztBQUNuRyxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSw0REFBNEQsQ0FBQztBQUN6RyxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSx3REFBd0QsQ0FBQztBQUNqRyxPQUFPLEVBQUUsaUNBQWlDLEVBQUUsTUFBTSxrRkFBa0YsQ0FBQztBQUNySSxPQUFPLEVBQUUs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QUFDO1FBRUQseURBQXlEO1FBQ3pELE1BQU0sR0FBRyxHQUFHLE1BQU0sY0FBYyxDQUM5QixNQUFNLEVBQ04sUUFBUSxJQUFJLEtBQUssRUFDakIsb0JBQW9CLEVBQ3BCLHFCQUFxQixDQUN0QixDQUFDO1FBRUYsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFBQyxPQUFPLENBQU0sRUFBRSxDQUFDO1FBQ2hCLE9BQU8sQ0FBQyxLQUFLLENBQUMsMkJBQTJCLEVBQUUsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDL0QsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzNCLENBQUM7QUFDSCxDQUFDLENBQUM7QUFFRixlQUFlLGVBQWUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYXRCcmFpbkJvZHlUeXBlIH0gZnJvbSAnLi90eXBlcyc7XG5pbXBvcnQgeyBjYWxsT3BlbkFJIH0gZnJvbSAnQGNoYXQvX2xpYnMvYXBpLWhlbHBlcic7XG5cbmltcG9ydCBPcGVuQUkgZnJvbSAnb3BlbmFpJztcbmltcG9ydCB7XG4gIGRlZmF1bHRPcGVuQUlBUElLZXksXG4gIG9wZW5BSUNoYXRHUFQzNU1vZGVsLFxufSBmcm9tICdAY2hhdC9fbGlicy9jb25zdGFudHMnO1xuaW1wb3J0IHtcbiAgY2F0ZWdvcml6ZVNraWxsRnJvbVVzZXJJbnB1dEV4YW1wbGVJbnB1dCxcbiAgY2F0ZWdvcml6ZVNraWxsRnJvbVVzZXJJbnB1dEV4YW1wbGVPdXRwdXQsXG4gIGNhdGVnb3JpemVTa2lsbEZyb21Vc2VySW5wdXRQcm9tcHQsXG59IGZyb20gJ0BjaGF0L19saWJzL3Byb21wdHMvY2F0ZWdvcml6ZVNraWxsRnJvbVVzZXJJbnB1dCc7XG5pbXBvcnQge1xuICBTa2lsbE1lc3NhZ2VIaXN0b3J5VHlwZSxcbiAgU2tpbGxUeXBlLFxufSBmcm9tICdAY2hhdC9fbGlicy90eXBlcy9NZXNzYWdpbmcvTWVzc2FnaW5nVHlwZXMnO1xuaW1wb3J0IHsgZGF5anMgfSBmcm9tICdAY2hhdC9fbGlicy9kYXRldGltZS9kYXRlLXV0aWxzJztcbmltcG9ydCB7IGFza0F2YWlsYWJpbGl0eUNvbnRyb2xDZW50ZXJGb3JQZW5kaW5nIH0gZnJvbSAnQGNoYXQvX2xpYnMvc2tpbGxzL2Fza0NhbGVuZGFyL2Fza0F2YWlsYWJpbGl0eS9hcGktaGVscGVyJztcbmltcG9ydCB7IGFza0V2ZW50Q29udHJvbENlbnRlciB9IGZyb20gJ0BjaGF0L19saWJzL3NraWxscy9hc2tDYWxlbmRhci9maW5kRXZlbnQvYXBpLWhlbHBlcic7XG5pbXBvcnQgeyBuZXh0RXZlbnRDb250cm9sQ2VudGVyIH0gZnJvbSAnQGNoYXQvX2xpYnMvc2tpbGxzL2Fza0NhbGVuZGFyL25leHRFdmVudC9hcGktaGVscGVyJztcbmltcG9ydCB7IGFkZFRhc2tDb250cm9sQ2VudGVyIH0gZnJvbSAnQGNoYXQvX2xpYnMvc2tpbGxzL29yZGVyQ2FsZW5kYXIvYWRkVGFzay9hcGktaGVscGVyJztcbmltcG9ydCB7IGJsb2NrT2ZmVGltZUNvbnRyb2xDZW50ZXIgfSBmcm9tICdAY2hhdC9fbGlicy9za2lsbHMvb3JkZXJDYWxlbmRhci9ibG9ja09mZlRpbWUvYXBpLWhlbHBlcic7XG5pbXBvcnQgeyBjYW5jZWxNZWV0aW5nQ29udHJvbENlbnRlclBlbmRpbmcgfSBmcm9tICdAY2hhdC9fbGlicy9za2lsbHMvb3JkZXJDYWxlbmRhci9jYW5jZWxNZWV0aW5nL2FwaS1oZWxwZXInO1xuaW1wb3J0IHsgcXVlcnlFdmVudHNDb250cm9sQ2VudGVyIH0gZnJvbSAnQGNoYXQvX2xpYnMvc2tpbGxzL2Fza0NhbGVuZGFyL2ZpbmRFdmVudHMvYXBpLWhlbHBlcic7XG5pbXBvcnQgeyBjcmVhdGVFdmVudENvbnRyb2xDZW50ZXIgfSBmcm9tICdAY2hhdC9fbGlicy9za2lsbHMvb3JkZXJDYWxlbmRhci9jcmVhdGVFdmVudC9hcGktaGVscGVyJztcbmltcG9ydCB7IGRlbGV0ZUV2ZW50Q29udHJvbENlbnRlciB9IGZyb20gJ0BjaGF0L19saWJzL3NraWxscy9vcmRlckNhbGVuZGFyL2RlbGV0ZUV2ZW50L2FwaS1oZWxwZXInO1xuaW1wb3J0IHsgZGVsZXRlUHJpb3JpdHlDb250cm9sQ2VudGVyIH0gZnJvbSAnQGNoYXQvX2xpYnMvc2tpbGxzL29yZGVyQ2FsZW5kYXIvZGVsZXRlUHJpb3JpdHkvYXBpLWhlbHBlcic7XG5pbXBvcnQgeyBkZWxldGVUYXNrQ29udHJvbENlbnRlciB9IGZyb20gJ0BjaGF0L19saWJzL3NraWxscy9vcmRlckNhbGVuZGFyL2RlbGV0ZVRhc2svYXBpLWhlbHBlcic7XG5pbXBvcnQgeyBFQVBUVG9QcmVmZXJyZWRUaW1lc0NvbnRyb2xDZW50ZXIgfSBmcm9tICdAY2hhdC9fbGlicy9za2lsbHMvb3JkZXJDYWxlbmRhci9lZGl0QWRkUHJlZmVycmVkVGltZVRvUHJlZmVycmVkVGltZXMvYXBpLWhlbHBlcic7XG5pbXBvcnQgeyBlZGl0RXZlbnRDb250cm9sQ2VudGVyIH0gZnJvbSAnQGNoYXQvX2xpYnMvc2tpbGxzL29yZGVyQ2FsZW5kYXIvZWRpdEV2ZW50L2FwaS1oZWxwZXInO1xuaW1wb3J0IHsgRVJQVDJQVENvbnRyb2xDZW50ZXIgfSBmcm9tICdAY2hhdC9fbGlicy9za2lsbHMvb3JkZXJDYWxlbmRhci9lZGl0UmVtb3ZlUHJlZmVycmVkVGltZVRvUHJlZmVycmVkVGltZXMvYXBpLWhlbHBlcic7XG5pbXBvcnQgeyBGTVRXUENvbnRyb2xDZW50ZXIgfSBmcm9tICdAY2hhdC9fbGlicy9za2lsbHMvb3JkZXJDYWxlbmRhci9maW5kTWVldGluZ1RpbWVXaXRoUGVybWlzc2lvbi9hcGktaGVscGVyJztcbmltcG9ydCB7IGdlbmVyYXRlTWVldGluZ0ludml0ZUNvbnRyb2xDZW50ZXIgfSBmcm9tICdAY2hhdC9fbGlicy9za2lsbHMvb3JkZXJDYWxlbmRhci9nZW5lcmF0ZU1lZXRpbmdJbnZpdGUvYXBpLWhlbHBlcic7XG5pbXBvcnQgeyBSQVBDb250cm9sQ2VudGVyIH0gZnJvbSAnQGNoYXQvX2xpYnMvc2tpbGxzL29yZGVyQ2FsZW5kYXIvcmVtb3ZlQWxsUHJlZmVyZWRUaW1lcy9hcGktaGVscGVyJztcbmltcG9ydCB7IFJDRUNvbnRyb2xDZW50ZXIgfSBmcm9tICdAY2hhdC9fbGlicy9za2lsbHMvb3JkZXJDYWxlbmRhci9yZXNvbHZlQ29uZmxpY3RpbmdFdmVudHMvYXBpLWhlbHBlcic7XG5pbXBvcnQgeyBzY2hlZHVsZU1lZXRpbmdDb250cm9sQ2VudGVyIH0gZnJvbSAnQGNoYXQvX2xpYnMvc2tpbGxzL29yZGVyQ2FsZW5kYXIvc2NoZWR1bGVNZWV0aW5nL2FwaS1oZWxwZXInO1xuaW1wb3J0IHsgc2VuZE1lZXRpbmdJbnZpdGVDb250cm9sQ2VudGVyIH0gZnJvbSAnQGNoYXQvX2xpYnMvc2tpbGxzL29yZGVyQ2FsZW5kYXIvc2VuZE1lZXRpbmdJbnZpdGUvYXBpLWhlbHBlcic7XG5pbXBvcnQgeyB1cGRhdGVNZWV0aW5nQ29udHJvbENlbnRlciB9IGZyb20gJ0BjaGF0L19saWJzL3NraWxscy9vcmRlckNhbGVuZGFyL3VwZGF0ZU1lZXRpbmcvYXBpLWhlbHBlcic7XG5pbXBvcnQgeyB1cGRhdGVQcmlvcml0eUNvbnRyb2xDZW50ZXIgfSBmcm9tICdAY2hhdC9fbGlicy9za2lsbHMvb3JkZXJDYWxlbmRhci91cGRhdGVQcmlvcml0eS9hcGktaGVscGVyJztcbmltcG9ydCB7IHVwZGF0ZVRhc2tDb250cm9sQ2VudGVyIH0gZnJvbSAnQGNoYXQvX2xpYnMvc2tpbGxzL29yZGVyQ2FsZW5kYXIvdXBkYXRlVGFzay9hcGktaGVscGVyJztcblxuY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7XG4gIGFwaUtleTogZGVmYXVsdE9wZW5BSUFQSUtleSxcbn0pO1xuXG5jb25zdCBwcm9jZXNzUXVlcmllcyA9IGFzeW5jIChcbiAgdXNlcklkOiBzdHJpbmcsXG4gIHRpbWV6b25lOiBzdHJpbmcsXG4gIG1lc3NhZ2VIaXN0b3J5T2JqZWN0OiBTa2lsbE1lc3NhZ2VIaXN0b3J5VHlwZVxuKSA9PiB7XG4gIHRyeSB7XG4gICAgLy8gY29uc3QgdXNlcklucHV0ID0gbWVzc2FnZUhpc3RvcnlPYmplY3Q/Lm1lc3NhZ2VzPy5bbWVzc2FnZUhpc3RvcnlPYmplY3Q/Lm1lc3NhZ2VzPy5sZW5ndGggLSAxXT8uY29udGVudFxuICAgIC8vIGV4dHJhY3RRdWVyeVVzZXJJbnB1dFRpbWVUb0pTT05UZW1wbGF0ZVxuICAgIGNvbnN0IHVzZXJDdXJyZW50VGltZSA9IGRheWpzKClcbiAgICAgIC50eih0aW1lem9uZSlcbiAgICAgIC5mb3JtYXQoJ2RkZGQsIFlZWVktTU0tRERUSEg6bW06c3NaJyk7XG5cbiAgICBzd2l0Y2ggKG1lc3NhZ2VIaXN0b3J5T2JqZWN0LnNraWxsKSB7XG4gICAgICBjYXNlICdhc2stYXZhaWxhYmlsaXR5JzpcbiAgICAgICAgY29uc3QgbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEFza0F2YWlsYWJpbGl0eSA9XG4gICAgICAgICAgYXdhaXQgYXNrQXZhaWxhYmlsaXR5Q29udHJvbENlbnRlckZvclBlbmRpbmcoXG4gICAgICAgICAgICBvcGVuYWksXG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICB0aW1lem9uZSxcbiAgICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0LFxuICAgICAgICAgICAgdXNlckN1cnJlbnRUaW1lXG4gICAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEFza0F2YWlsYWJpbGl0eTtcblxuICAgICAgY2FzZSAnZmluZC1ldmVudCc6XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VIaXN0b3J5T2JqZWN0UmV0dXJuZWRBc2tFdmVudCA9XG4gICAgICAgICAgYXdhaXQgYXNrRXZlbnRDb250cm9sQ2VudGVyKFxuICAgICAgICAgICAgb3BlbmFpLFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgdGltZXpvbmUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdCxcbiAgICAgICAgICAgIHVzZXJDdXJyZW50VGltZSxcbiAgICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0Py5xdWVyeVxuICAgICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIG1lc3NhZ2VIaXN0b3J5T2JqZWN0UmV0dXJuZWRBc2tFdmVudDtcbiAgICAgIGNhc2UgJ2ZpbmQtZXZlbnRzJzpcbiAgICAgICAgY29uc3QgbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEFza0V2ZW50cyA9XG4gICAgICAgICAgYXdhaXQgcXVlcnlFdmVudHNDb250cm9sQ2VudGVyKFxuICAgICAgICAgICAgb3BlbmFpLFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgdGltZXpvbmUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdCxcbiAgICAgICAgICAgIHVzZXJDdXJyZW50VGltZSxcbiAgICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0Py5xdWVyeVxuICAgICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIG1lc3NhZ2VIaXN0b3J5T2JqZWN0UmV0dXJuZWRBc2tFdmVudHM7XG4gICAgICBjYXNlICdmaW5kLW5leHQtZXZlbnQnOlxuICAgICAgICBjb25zdCBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkTmV4dEV2ZW50ID1cbiAgICAgICAgICBhd2FpdCBuZXh0RXZlbnRDb250cm9sQ2VudGVyKFxuICAgICAgICAgICAgb3BlbmFpLFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgdGltZXpvbmUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdCxcbiAgICAgICAgICAgIHVzZXJDdXJyZW50VGltZSxcbiAgICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0Py5xdWVyeVxuICAgICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIG1lc3NhZ2VIaXN0b3J5T2JqZWN0UmV0dXJuZWROZXh0RXZlbnQ7XG5cbiAgICAgIGNhc2UgJ2FkZC10YXNrJzpcbiAgICAgICAgY29uc3QgbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEFkZFRhc2sgPSBhd2FpdCBhZGRUYXNrQ29udHJvbENlbnRlcihcbiAgICAgICAgICBvcGVuYWksXG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIHRpbWV6b25lLFxuICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0LFxuICAgICAgICAgIHVzZXJDdXJyZW50VGltZSxcbiAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdD8ucXVlcnlcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEFkZFRhc2s7XG5cbiAgICAgIGNhc2UgJ2Jsb2NrLW9mZi10aW1lJzpcbiAgICAgICAgY29uc3QgbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEJvY2tPZmZUaW1lID1cbiAgICAgICAgICBhd2FpdCBibG9ja09mZlRpbWVDb250cm9sQ2VudGVyKFxuICAgICAgICAgICAgb3BlbmFpLFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgdGltZXpvbmUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdCxcbiAgICAgICAgICAgIHVzZXJDdXJyZW50VGltZSxcbiAgICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0LnF1ZXJ5XG4gICAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEJvY2tPZmZUaW1lO1xuICAgICAgY2FzZSAnY2FuY2VsLW1lZXRpbmcnOlxuICAgICAgICBjb25zdCBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkQ2FuY2VsTWVldGluZyA9XG4gICAgICAgICAgYXdhaXQgY2FuY2VsTWVldGluZ0NvbnRyb2xDZW50ZXJQZW5kaW5nKFxuICAgICAgICAgICAgb3BlbmFpLFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgdGltZXpvbmUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdCxcbiAgICAgICAgICAgIHVzZXJDdXJyZW50VGltZSxcbiAgICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0LnF1ZXJ5XG4gICAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZENhbmNlbE1lZXRpbmc7XG5cbiAgICAgIGNhc2UgJ2NyZWF0ZS1ldmVudCc6XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VIaXN0b3J5T2JqZWN0UmV0dXJuZWRDcmVhdGVFdmVudCA9XG4gICAgICAgICAgYXdhaXQgY3JlYXRlRXZlbnRDb250cm9sQ2VudGVyKFxuICAgICAgICAgICAgb3BlbmFpLFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgdGltZXpvbmUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdCxcbiAgICAgICAgICAgIHVzZXJDdXJyZW50VGltZSxcbiAgICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0LnF1ZXJ5XG4gICAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZENyZWF0ZUV2ZW50O1xuXG4gICAgICBjYXNlICdkZWxldGUtZXZlbnQnOlxuICAgICAgICBjb25zdCBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkRGVsZXRlRXZlbnQgPVxuICAgICAgICAgIGF3YWl0IGRlbGV0ZUV2ZW50Q29udHJvbENlbnRlcihcbiAgICAgICAgICAgIG9wZW5haSxcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgIHRpbWV6b25lLFxuICAgICAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3QsXG4gICAgICAgICAgICB1c2VyQ3VycmVudFRpbWUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdC5xdWVyeVxuICAgICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIG1lc3NhZ2VIaXN0b3J5T2JqZWN0UmV0dXJuZWREZWxldGVFdmVudDtcblxuICAgICAgY2FzZSAnZGVsZXRlLXByaW9yaXR5JzpcbiAgICAgICAgY29uc3QgbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZERlbGV0ZVByaW9yaXR5ID1cbiAgICAgICAgICBhd2FpdCBkZWxldGVQcmlvcml0eUNvbnRyb2xDZW50ZXIoXG4gICAgICAgICAgICBvcGVuYWksXG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICB0aW1lem9uZSxcbiAgICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0LFxuICAgICAgICAgICAgdXNlckN1cnJlbnRUaW1lLFxuICAgICAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3QucXVlcnlcbiAgICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkRGVsZXRlUHJpb3JpdHk7XG5cbiAgICAgIGNhc2UgJ2RlbGV0ZS10YXNrJzpcbiAgICAgICAgY29uc3QgbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZERlbGV0ZVRhc2sgPVxuICAgICAgICAgIGF3YWl0IGRlbGV0ZVRhc2tDb250cm9sQ2VudGVyKFxuICAgICAgICAgICAgb3BlbmFpLFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgdGltZXpvbmUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdCxcbiAgICAgICAgICAgIHVzZXJDdXJyZW50VGltZSxcbiAgICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0Py5xdWVyeVxuICAgICAgICAgICk7XG4gICAgICAgIHJldHVybiBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkRGVsZXRlVGFzaztcbiAgICAgIGNhc2UgJ2VkaXQtYWRkLXByZWZlcnJlZC10aW1lLXRvLXByZWZlcnJlZC10aW1lcyc6XG4gICAgICAgIC8vIEVBUFRUb1ByZWZlcnJlZFRpbWVzQ29udHJvbENlbnRlclBlbmRpbmdcbiAgICAgICAgY29uc3QgbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEVBUFQgPVxuICAgICAgICAgIGF3YWl0IEVBUFRUb1ByZWZlcnJlZFRpbWVzQ29udHJvbENlbnRlcihcbiAgICAgICAgICAgIG9wZW5haSxcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgIHRpbWV6b25lLFxuICAgICAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3QsXG4gICAgICAgICAgICB1c2VyQ3VycmVudFRpbWUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdD8ucXVlcnlcbiAgICAgICAgICApO1xuICAgICAgICByZXR1cm4gbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEVBUFQ7XG5cbiAgICAgIGNhc2UgJ2VkaXQtZXZlbnQnOlxuICAgICAgICAvLyBlZGl0RXZlbnRDb250cm9sQ2VudGVyUGVuZGluZ1xuICAgICAgICBjb25zdCBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkRWRpdEV2ZW50ID1cbiAgICAgICAgICBhd2FpdCBlZGl0RXZlbnRDb250cm9sQ2VudGVyKFxuICAgICAgICAgICAgb3BlbmFpLFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgdGltZXpvbmUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdCxcbiAgICAgICAgICAgIHVzZXJDdXJyZW50VGltZSxcbiAgICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0Py5xdWVyeVxuICAgICAgICAgICk7XG4gICAgICAgIHJldHVybiBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkRWRpdEV2ZW50O1xuXG4gICAgICBjYXNlICdlZGl0LXJlbW92ZS1wcmVmZXJyZWQtdGltZS10by1wcmVmZXJyZWQtdGltZXMnOlxuICAgICAgICAvLyBFUlBUMlBUQ29udHJvbENlbnRlclBlbmRpbmdcbiAgICAgICAgY29uc3QgbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEVSUFQyUFRzID0gYXdhaXQgRVJQVDJQVENvbnRyb2xDZW50ZXIoXG4gICAgICAgICAgb3BlbmFpLFxuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICB0aW1lem9uZSxcbiAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdCxcbiAgICAgICAgICB1c2VyQ3VycmVudFRpbWUsXG4gICAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3Q/LnF1ZXJ5XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkRVJQVDJQVHM7XG5cbiAgICAgIGNhc2UgJ2ZpbmQtbWVldGluZy10aW1lLXdpdGgtcGVybWlzc2lvbic6XG4gICAgICAgIC8vIGZpbmRNZWV0aW5nVGltZVdpdGhQZXJtaXNzaW9uQ29udHJvbENlbnRlclBlbmRpbmdcbiAgICAgICAgY29uc3QgbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEZNVFdQID0gYXdhaXQgRk1UV1BDb250cm9sQ2VudGVyKFxuICAgICAgICAgIG9wZW5haSxcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgdGltZXpvbmUsXG4gICAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3QsXG4gICAgICAgICAgdXNlckN1cnJlbnRUaW1lLFxuICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0Py5xdWVyeVxuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkRk1UV1A7XG4gICAgICBjYXNlICdnZW5lcmF0ZS1tZWV0aW5nLWludml0ZSc6XG4gICAgICAgIC8vIGdlbmVyYXRlTWVldGluZ0ludml0ZUNvbnRyb2xDZW50ZXJQZW5kaW5nXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VIaXN0b3J5T2JqZWN0UmV0dXJuZWRHTUkgPVxuICAgICAgICAgIGF3YWl0IGdlbmVyYXRlTWVldGluZ0ludml0ZUNvbnRyb2xDZW50ZXIoXG4gICAgICAgICAgICBvcGVuYWksXG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICB0aW1lem9uZSxcbiAgICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0LFxuICAgICAgICAgICAgdXNlckN1cnJlbnRUaW1lLFxuICAgICAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3Q/LnF1ZXJ5XG4gICAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEdNSTtcblxuICAgICAgY2FzZSAncmVtb3ZlLWFsbC1wcmVmZXJyZWQtdGltZXMnOlxuICAgICAgICAvLyBSQVBDb250cm9sQ2VudGVyUGVuZGluZ1xuICAgICAgICBjb25zdCBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkUkFQID0gYXdhaXQgUkFQQ29udHJvbENlbnRlcihcbiAgICAgICAgICBvcGVuYWksXG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIHRpbWV6b25lLFxuICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0LFxuICAgICAgICAgIHVzZXJDdXJyZW50VGltZSxcbiAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdD8ucXVlcnlcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZFJBUDtcblxuICAgICAgY2FzZSAncmVzb2x2ZS1jb25mbGljdGluZy1ldmVudHMnOlxuICAgICAgICBjb25zdCBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkUkNFID0gYXdhaXQgUkNFQ29udHJvbENlbnRlcihcbiAgICAgICAgICBvcGVuYWksXG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIHRpbWV6b25lLFxuICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0LFxuICAgICAgICAgIHVzZXJDdXJyZW50VGltZSxcbiAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdD8ucXVlcnlcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZFJDRTtcblxuICAgICAgY2FzZSAnc2NoZWR1bGUtbWVldGluZyc6XG4gICAgICAgIC8vIHNjaGVkdWxlTWVldGluZ0NvbnRyb2xDZW50ZXJQZW5kaW5nXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VIaXN0b3J5T2JqZWN0UmV0dXJuZWRTY2hlZHVsZU1lZXRpbmcgPVxuICAgICAgICAgIGF3YWl0IHNjaGVkdWxlTWVldGluZ0NvbnRyb2xDZW50ZXIoXG4gICAgICAgICAgICBvcGVuYWksXG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICB0aW1lem9uZSxcbiAgICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0LFxuICAgICAgICAgICAgdXNlckN1cnJlbnRUaW1lLFxuICAgICAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3Q/LnF1ZXJ5XG4gICAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZFNjaGVkdWxlTWVldGluZztcblxuICAgICAgY2FzZSAnc2VuZC1tZWV0aW5nLWludml0ZSc6XG4gICAgICAgIC8vIHNlbmRNZWV0aW5nSW52aXRlQ29udHJvbENlbnRlclBlbmRpbmdcbiAgICAgICAgY29uc3QgbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZFNNSSA9XG4gICAgICAgICAgYXdhaXQgc2VuZE1lZXRpbmdJbnZpdGVDb250cm9sQ2VudGVyKFxuICAgICAgICAgICAgb3BlbmFpLFxuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgdGltZXpvbmUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdCxcbiAgICAgICAgICAgIHVzZXJDdXJyZW50VGltZSxcbiAgICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0Py5xdWVyeVxuICAgICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIG1lc3NhZ2VIaXN0b3J5T2JqZWN0UmV0dXJuZWRTTUk7XG5cbiAgICAgIGNhc2UgJ3VwZGF0ZS1tZWV0aW5nJzpcbiAgICAgICAgLy8gdXBkYXRlTWVldGluZ0NvbnRyb2xDZW50ZXJQZW5kaW5nXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VIaXN0b3J5T2JqZWN0UmV0dXJuZWRVcGRhdGVNZWV0aW5nID1cbiAgICAgICAgICBhd2FpdCB1cGRhdGVNZWV0aW5nQ29udHJvbENlbnRlcihcbiAgICAgICAgICAgIG9wZW5haSxcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgIHRpbWV6b25lLFxuICAgICAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3QsXG4gICAgICAgICAgICB1c2VyQ3VycmVudFRpbWUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdD8ucXVlcnlcbiAgICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkVXBkYXRlTWVldGluZztcblxuICAgICAgY2FzZSAndXBkYXRlLXByaW9yaXR5JzpcbiAgICAgICAgLy8gdXBkYXRlUHJpb3JpdHlDb250cm9sQ2VudGVyUGVuZGluZ1xuICAgICAgICBjb25zdCBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkVXBkYXRlUHJpb3JpdHkgPVxuICAgICAgICAgIGF3YWl0IHVwZGF0ZVByaW9yaXR5Q29udHJvbENlbnRlcihcbiAgICAgICAgICAgIG9wZW5haSxcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgIHRpbWV6b25lLFxuICAgICAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3QsXG4gICAgICAgICAgICB1c2VyQ3VycmVudFRpbWUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdD8ucXVlcnlcbiAgICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkVXBkYXRlUHJpb3JpdHk7XG5cbiAgICAgIGNhc2UgJ3VwZGF0ZS10YXNrJzpcbiAgICAgICAgLy8gdXBkYXRlVGFza0NvbnRyb2xDZW50ZXJQZW5kaW5nXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VIaXN0b3J5T2JqZWN0UmV0dXJuZWRVcGRhdGVUYXNrID1cbiAgICAgICAgICBhd2FpdCB1cGRhdGVUYXNrQ29udHJvbENlbnRlcihcbiAgICAgICAgICAgIG9wZW5haSxcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgIHRpbWV6b25lLFxuICAgICAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3QsXG4gICAgICAgICAgICB1c2VyQ3VycmVudFRpbWUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdD8ucXVlcnlcbiAgICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkVXBkYXRlVGFzaztcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgY29uc3QgbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEFza0V2ZW50c0RlZmF1bHQgPVxuICAgICAgICAgIGF3YWl0IHF1ZXJ5RXZlbnRzQ29udHJvbENlbnRlcihcbiAgICAgICAgICAgIG9wZW5haSxcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgIHRpbWV6b25lLFxuICAgICAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3QsXG4gICAgICAgICAgICB1c2VyQ3VycmVudFRpbWUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdD8ucXVlcnlcbiAgICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkQXNrRXZlbnRzRGVmYXVsdDtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmxvZyhlLCAnIHVuYWJsZSB0byBwcm9jZXNzIHBlbmRpbmcgcXVlcmllcycpO1xuICB9XG59O1xuXG4vLyBEZWZpbmUgQWdlbnRDbGllbnRDb21tYW5kIGFuZCBBZ2VudENvbnRleHQgaW50ZXJmYWNlcyBsb2NhbGx5IG9yIGltcG9ydCBmcm9tIGEgc2hhcmVkIHR5cGVzIGZpbGVcbi8vIFRoaXMgc2hvdWxkIGFsaWduIHdpdGggZGVmaW5pdGlvbnMgaW4gYXRvbS1hZ2VudC9oYW5kbGVyLnRzIGFuZCBmdW5jdGlvbnNfYnVpbGRfZG9ja2VyL3NlcnZlci50c1xuaW50ZXJmYWNlIEFnZW50Q2xpZW50Q29tbWFuZCB7XG4gIGNvbW1hbmRfaWQ6IHN0cmluZztcbiAgYWN0aW9uOlxuICAgIHwgJ1NUQVJUX1JFQ09SRElOR19TRVNTSU9OJ1xuICAgIHwgJ1NUT1BfUkVDT1JESU5HX1NFU1NJT04nXG4gICAgfCAnQ0FOQ0VMX1JFQ09SRElOR19TRVNTSU9OJztcbiAgcGF5bG9hZD86IHtcbiAgICBzdWdnZXN0ZWRUaXRsZT86IHN0cmluZztcbiAgICBsaW5rZWRFdmVudElkPzogc3RyaW5nO1xuICB9O1xufVxuXG5pbnRlcmZhY2UgQWdlbnRTa2lsbENvbnRleHQge1xuICB1c2VySWQ6IHN0cmluZztcbiAgc2VuZENvbW1hbmRUb0NsaWVudDogKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIGNvbW1hbmQ6IEFnZW50Q2xpZW50Q29tbWFuZFxuICApID0+IFByb21pc2U8Ym9vbGVhbj47XG59XG5cbi8vIE5MVVJlc3VsdCBzdHJ1Y3R1cmUgZXhwZWN0ZWQgYnkgaW5QZXJzb25BdWRpb05vdGVTa2lsbHNcbmludGVyZmFjZSBObHVJbnRlbnRSZXN1bHQge1xuICAvLyBTaW1wbGlmaWVkIGZvciB0aGlzIGNvbnRleHRcbiAgaW50ZW50OiB7IG5hbWU6IHN0cmluZzsgY29uZmlkZW5jZT86IG51bWJlciB9O1xuICBlbnRpdGllcz86IHsgW2tleTogc3RyaW5nXTogYW55IH07XG4gIHJhd19pbnB1dD86IHN0cmluZztcbn1cblxuLy8gTW9kaWZ5IHByb2Nlc3NRdWVyaWVzIHRvIGFjY2VwdCBzZW5kQ29tbWFuZFRvVXNlckZ1bmNcbmNvbnN0IHByb2Nlc3NRdWVyaWVzID0gYXN5bmMgKFxuICB1c2VySWQ6IHN0cmluZyxcbiAgdGltZXpvbmU6IHN0cmluZyxcbiAgbWVzc2FnZUhpc3RvcnlPYmplY3Q6IFNraWxsTWVzc2FnZUhpc3RvcnlUeXBlLFxuICBzZW5kQ29tbWFuZFRvVXNlckZ1bmM/OiAoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgY29tbWFuZDogQWdlbnRDbGllbnRDb21tYW5kXG4gICkgPT4gUHJvbWlzZTxib29sZWFuPiAvLyBOZXcgcGFyYW1ldGVyXG4pID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VyQ3VycmVudFRpbWUgPSBkYXlqcygpXG4gICAgICAudHoodGltZXpvbmUpXG4gICAgICAuZm9ybWF0KCdkZGRkLCBZWVlZLU1NLUREVEhIOm1tOnNzWicpO1xuXG4gICAgLy8gSW1wb3J0IHRoZSBuZXcgc2tpbGwgaGFuZGxlcnMgaGVyZSBpZiB0aGV5IGFyZSBub3QgdG9vIGxhcmdlLFxuICAgIC8vIG9yIGNyZWF0ZSBhIGRlZGljYXRlZCBjb250cm9sIGNlbnRlciB0aGF0IGltcG9ydHMgdGhlbS5cbiAgICAvLyBGb3Igbm93LCBsZXQncyBhc3N1bWUgd2UgbWlnaHQgY2FsbCB0aGVtIG1vcmUgZGlyZWN0bHkgZm9yIHNpbXBsaWNpdHkgb2YgdGhpcyBzdGVwLFxuICAgIC8vIGFja25vd2xlZGdpbmcgdGhpcyBtaWdodCBiZSByZWZhY3RvcmVkIGludG8gYSBwcm9wZXIgXCJjb250cm9sIGNlbnRlclwiLlxuICAgIC8vIFRoaXMgZHluYW1pYyBpbXBvcnQgaXMgZm9yIGlsbHVzdHJhdGlvbjsgc3RhdGljIGltcG9ydHMgYXJlIGdlbmVyYWxseSBwcmVmZXJyZWQuXG4gICAgY29uc3Qg4KaH4KaoUGVyc29uQXVkaW9Ob3RlU2tpbGxzID0gYXdhaXQgaW1wb3J0KFxuICAgICAgJy4uLy4uLy4uL2F0b20tYWdlbnQvc2tpbGxzL2luUGVyc29uQXVkaW9Ob3RlU2tpbGxzJ1xuICAgICk7XG5cbiAgICBzd2l0Y2ggKG1lc3NhZ2VIaXN0b3J5T2JqZWN0LnNraWxsKSB7XG4gICAgICAvLyAtLS0gTkVXIENBU0VTIEZPUiBJTi1QRVJTT04gQVVESU8gTk9URVMgLS0tXG4gICAgICBjYXNlICdJTl9QRVJTT05fQVVESU9fTk9URV9TVEFSVCc6IC8vIEFzc3VtaW5nIE5MVSBjYXRlZ29yaXplcyB0byB0aGlzXG4gICAgICBjYXNlICdJTl9QRVJTT05fQVVESU9fTk9URV9TVE9QJzpcbiAgICAgIGNhc2UgJ0lOX1BFUlNPTl9BVURJT19OT1RFX0NBTkNFTCc6XG4gICAgICAgIGlmICghc2VuZENvbW1hbmRUb1VzZXJGdW5jKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgICAgICdzZW5kQ29tbWFuZFRvVXNlckZ1bmMgbm90IHByb3ZpZGVkIHRvIHByb2Nlc3NRdWVyaWVzIGZvciBhdWRpbyBub3RlIHNraWxsLidcbiAgICAgICAgICApO1xuICAgICAgICAgIC8vIEZhbGxiYWNrIHJlc3BvbnNlIG9yIGVycm9yXG4gICAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3QubWVzc2FnZXMucHVzaCh7XG4gICAgICAgICAgICByb2xlOiAnYXNzaXN0YW50JyxcbiAgICAgICAgICAgIGNvbnRlbnQ6XG4gICAgICAgICAgICAgIFwiU29ycnksIEkgY2FuJ3QgY29udHJvbCBhdWRpbyByZWNvcmRpbmcgcmlnaHQgbm93IGR1ZSB0byBhIHNldHVwIGlzc3VlLlwiLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBtZXNzYWdlSGlzdG9yeU9iamVjdDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhZ2VudFNraWxsQ29udGV4dDogQWdlbnRTa2lsbENvbnRleHQgPSB7XG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIHNlbmRDb21tYW5kVG9DbGllbnQ6IHNlbmRDb21tYW5kVG9Vc2VyRnVuYyxcbiAgICAgICAgfTtcbiAgICAgICAgLy8gQ29uc3RydWN0IGEgc2ltcGxpZmllZCBOTFUgcmVzdWx0IGZvciB0aGUgc2tpbGwgaGFuZGxlclxuICAgICAgICBjb25zdCBubHVSZXN1bHRGb3JTa2lsbDogTmx1SW50ZW50UmVzdWx0ID0ge1xuICAgICAgICAgIGludGVudDogeyBuYW1lOiBtZXNzYWdlSGlzdG9yeU9iamVjdC5za2lsbCB9LCAvLyBlLmcuLCBcIklOX1BFUlNPTl9BVURJT19OT1RFX1NUQVJUXCJcbiAgICAgICAgICBlbnRpdGllczogbWVzc2FnZUhpc3RvcnlPYmplY3QucHJldkRhdGE/LmVudGl0aWVzIHx8IHt9LCAvLyBQYXNzIGFueSBlbnRpdGllcyBnYXRoZXJlZCBieSBOTFVcbiAgICAgICAgICByYXdfaW5wdXQ6XG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdC5tZXNzYWdlc1tcbiAgICAgICAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3QubWVzc2FnZXMubGVuZ3RoIC0gMVxuICAgICAgICAgICAgXT8uY29udGVudCxcbiAgICAgICAgfTtcblxuICAgICAgICBsZXQgc2tpbGxSZXNwb25zZTtcbiAgICAgICAgaWYgKG1lc3NhZ2VIaXN0b3J5T2JqZWN0LnNraWxsID09PSAnSU5fUEVSU09OX0FVRElPX05PVEVfU1RBUlQnKSB7XG4gICAgICAgICAgc2tpbGxSZXNwb25zZSA9XG4gICAgICAgICAgICBhd2FpdCDgpofgpqhQZXJzb25BdWRpb05vdGVTa2lsbHMuaGFuZGxlU3RhcnRJblBlcnNvbkF1ZGlvTm90ZURpcmVjdChcbiAgICAgICAgICAgICAgbmx1UmVzdWx0Rm9yU2tpbGwsXG4gICAgICAgICAgICAgIGFnZW50U2tpbGxDb250ZXh0XG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKG1lc3NhZ2VIaXN0b3J5T2JqZWN0LnNraWxsID09PSAnSU5fUEVSU09OX0FVRElPX05PVEVfU1RPUCcpIHtcbiAgICAgICAgICBza2lsbFJlc3BvbnNlID1cbiAgICAgICAgICAgIGF3YWl0IOCmh+CmqFBlcnNvbkF1ZGlvTm90ZVNraWxscy5oYW5kbGVTdG9wSW5QZXJzb25BdWRpb05vdGVEaXJlY3QoXG4gICAgICAgICAgICAgIG5sdVJlc3VsdEZvclNraWxsLFxuICAgICAgICAgICAgICBhZ2VudFNraWxsQ29udGV4dFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBDQU5DRUxcbiAgICAgICAgICBza2lsbFJlc3BvbnNlID1cbiAgICAgICAgICAgIGF3YWl0IOCmh+CmqFBlcnNvbkF1ZGlvTm90ZVNraWxscy5oYW5kbGVDYW5jZWxJblBlcnNvbkF1ZGlvTm90ZURpcmVjdChcbiAgICAgICAgICAgICAgbmx1UmVzdWx0Rm9yU2tpbGwsXG4gICAgICAgICAgICAgIGFnZW50U2tpbGxDb250ZXh0XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3QubWVzc2FnZXMucHVzaCh7XG4gICAgICAgICAgcm9sZTogJ2Fzc2lzdGFudCcsXG4gICAgICAgICAgY29udGVudDogc2tpbGxSZXNwb25zZS5tZXNzYWdlLFxuICAgICAgICB9KTtcbiAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3QucXVlcnkgPSAnY29tcGxldGVkJzsgLy8gTWFyayBhcyBjb21wbGV0ZWRcbiAgICAgICAgcmV0dXJuIG1lc3NhZ2VIaXN0b3J5T2JqZWN0O1xuXG4gICAgICAvLyAtLS0gRVhJU1RJTkcgQ0FTRVMgLS0tXG4gICAgICBjYXNlICdhc2stYXZhaWxhYmlsaXR5JzpcbiAgICAgICAgY29uc3QgbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEFza0F2YWlsYWJpbGl0eSA9XG4gICAgICAgICAgYXdhaXQgYXNrQXZhaWxhYmlsaXR5Q29udHJvbENlbnRlckZvclBlbmRpbmcoXG4gICAgICAgICAgICBvcGVuYWksXG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICB0aW1lem9uZSxcbiAgICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0LFxuICAgICAgICAgICAgdXNlckN1cnJlbnRUaW1lXG4gICAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIG1lc3NhZ2VIaXN0b3J5T2JqZWN0UmV0dXJuZWRBc2tBdmFpbGFiaWxpdHk7XG5cbiAgICAgIC8vIC4uLiAoYWxsIG90aGVyIGV4aXN0aW5nIGNhc2VzIHJlbWFpbiB1bmNoYW5nZWQpIC4uLlxuXG4gICAgICBjYXNlICd1cGRhdGUtdGFzayc6XG4gICAgICAgIC8vIHVwZGF0ZVRhc2tDb250cm9sQ2VudGVyUGVuZGluZ1xuICAgICAgICBjb25zdCBtZXNzYWdlSGlzdG9yeU9iamVjdFJldHVybmVkVXBkYXRlVGFzayA9XG4gICAgICAgICAgYXdhaXQgdXBkYXRlVGFza0NvbnRyb2xDZW50ZXIoXG4gICAgICAgICAgICBvcGVuYWksXG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICB0aW1lem9uZSxcbiAgICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0LFxuICAgICAgICAgICAgdXNlckN1cnJlbnRUaW1lLFxuICAgICAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3Q/LnF1ZXJ5XG4gICAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIG1lc3NhZ2VIaXN0b3J5T2JqZWN0UmV0dXJuZWRVcGRhdGVUYXNrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICAvLyBJZiBza2lsbCBpcyBub3Qgb25lIG9mIHRoZSBhdWRpbyBjb21tYW5kcyBvciBvdGhlciBrbm93biBza2lsbHMsXG4gICAgICAgIC8vIGl0IG1pZ2h0IGZhbGwgdGhyb3VnaCB0byBhIGRlZmF1bHQgaGFuZGxlciBvciBlcnJvci5cbiAgICAgICAgLy8gRm9yIG5vdywgbGV0J3MgYXNzdW1lIHRoZSBleGlzdGluZyBkZWZhdWx0IChxdWVyeUV2ZW50c0NvbnRyb2xDZW50ZXIpIGlzIGZpbmUgaWYgbm8gbWF0Y2guXG4gICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICBgcHJvY2Vzc1F1ZXJpZXM6IFVuaGFuZGxlZCBvciBkZWZhdWx0IHNraWxsOiAke21lc3NhZ2VIaXN0b3J5T2JqZWN0LnNraWxsfWBcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEFza0V2ZW50c0RlZmF1bHQgPVxuICAgICAgICAgIGF3YWl0IHF1ZXJ5RXZlbnRzQ29udHJvbENlbnRlcihcbiAgICAgICAgICAgIG9wZW5haSxcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgIHRpbWV6b25lLFxuICAgICAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3QsXG4gICAgICAgICAgICB1c2VyQ3VycmVudFRpbWUsXG4gICAgICAgICAgICBtZXNzYWdlSGlzdG9yeU9iamVjdD8ucXVlcnlcbiAgICAgICAgICApO1xuICAgICAgICByZXR1cm4gbWVzc2FnZUhpc3RvcnlPYmplY3RSZXR1cm5lZEFza0V2ZW50c0RlZmF1bHQ7XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5sb2coZSwgJyB1bmFibGUgdG8gcHJvY2VzcyBwZW5kaW5nIHF1ZXJpZXMgaW4gcHJvY2Vzc1F1ZXJpZXMnKTtcbiAgICAvLyBFbnN1cmUgYSB2YWxpZCBTa2lsbE1lc3NhZ2VIaXN0b3J5VHlwZSBpcyByZXR1cm5lZCBldmVuIG9uIGVycm9yXG4gICAgbWVzc2FnZUhpc3RvcnlPYmplY3QubWVzc2FnZXMucHVzaCh7XG4gICAgICByb2xlOiAnYXNzaXN0YW50JyxcbiAgICAgIGNvbnRlbnQ6ICdBbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBwcm9jZXNzaW5nIHlvdXIgcmVxdWVzdC4nLFxuICAgIH0pO1xuICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0LnF1ZXJ5ID0gJ2Vycm9yJztcbiAgICByZXR1cm4gbWVzc2FnZUhpc3RvcnlPYmplY3Q7XG4gIH1cbn07XG5cbi8vIE1vZGlmeSBhc3Npc3RhbnRfYnJhaW4gdG8gYWNjZXB0IGFuZCBwYXNzIHNlbmRDb21tYW5kVG9Vc2VyRnVuY1xuY29uc3QgYXNzaXN0YW50X2JyYWluID0gYXN5bmMgKFxuICBldmVudFBheWxvYWQ6IHN0cmluZyB8IEJ1ZmZlciwgLy8gQ2hhbmdlZCAnZXZlbnQnIHRvICdldmVudFBheWxvYWQnIGZvciBjbGFyaXR5XG4gIHVzZXJJZEZyb21Xczogc3RyaW5nLCAvLyBFeHBsaWNpdGx5IHBhc3NlZCBieSBzZXJ2ZXIudHNcbiAgLy8gcmVxdWVzdEZyb21XczogYW55LCAvLyBUaGUgb3JpZ2luYWwgcmVxdWVzdCBvYmplY3QgZnJvbSBXZWJTb2NrZXQgdXBncmFkZSwgaWYgbmVlZGVkIGJ5IGFueSBza2lsbFxuICBzZW5kQ29tbWFuZFRvVXNlckZ1bmM/OiAoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgY29tbWFuZDogQWdlbnRDbGllbnRDb21tYW5kXG4gICkgPT4gUHJvbWlzZTxib29sZWFuPiAvLyBOZXcgcGFyYW1ldGVyXG4pID0+IHtcbiAgLy8gY29uc3QgYm9keSA9IGV2ZW50UGF5bG9hZDsgLy8gS2VlcCBpZiBkaXJlY3QgQnVmZmVyIHByb2Nlc3NpbmcgaXMgbmVlZGVkXG5cbiAgdHJ5IHtcbiAgICAvLyBJZiBldmVudFBheWxvYWQgaXMgQnVmZmVyLCBjb252ZXJ0IHRvIHN0cmluZy4gSWYgYWxyZWFkeSBzdHJpbmcsIHVzZSBhcyBpcy5cbiAgICBjb25zdCBib2R5U3RyaW5nID0gQnVmZmVyLmlzQnVmZmVyKGV2ZW50UGF5bG9hZClcbiAgICAgID8gZXZlbnRQYXlsb2FkLnRvU3RyaW5nKClcbiAgICAgIDogZXZlbnRQYXlsb2FkO1xuICAgIGNvbnNvbGUubG9nKGJvZHlTdHJpbmcsICcgYm9keVN0cmluZyBpbnNpZGUgYXNzaXN0YW50X2JyYWluJyk7XG5cbiAgICBjb25zdCBib2R5T2JqZWN0OiBDaGF0QnJhaW5Cb2R5VHlwZSA9IEpTT04ucGFyc2UoYm9keVN0cmluZyk7XG4gICAgY29uc29sZS5sb2coYm9keU9iamVjdCwgJyBib2R5T2JqZWN0IGluc2lkZSBhc3Npc3RhbnRfYnJhaW4nKTtcblxuICAgIC8vIHVzZXJJZCBzaG91bGQgYmUgdGhlIGF1dGhlbnRpY2F0ZWQgb25lIGZyb20gV2ViU29ja2V0IGNvbm5lY3Rpb24sIG5vdCBmcm9tIGJvZHkgaWYgcG9zc2libGVcbiAgICBjb25zdCB1c2VySWQgPSB1c2VySWRGcm9tV3MgfHwgYm9keU9iamVjdD8udXNlcklkO1xuICAgIGNvbnN0IHRpbWV6b25lID0gYm9keU9iamVjdD8udGltZXpvbmU7XG4gICAgY29uc3QgbWVzc2FnZUhpc3RvcnlPYmplY3QgPSBib2R5T2JqZWN0Py5jaGF0O1xuXG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ25vIHVzZXJJZCBwcm92aWRlZCAoZWl0aGVyIGZyb20gV2ViU29ja2V0IGF1dGggb3IgbWVzc2FnZSBib2R5KSdcbiAgICAgICk7XG4gICAgfVxuICAgIGlmICghdGltZXpvbmUpIHtcbiAgICAgIC8vIEZhbGxiYWNrIHRpbWV6b25lIG9yIGVycm9yXG4gICAgICAvLyBGb3Igbm93LCBsZXQncyB1c2UgYSBkZWZhdWx0IG9yIHRocm93LiBBZ2VudCBtaWdodCBuZWVkIHVzZXIncyBhY3R1YWwgdGltZXpvbmUuXG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgIGBObyB0aW1lem9uZSBwcm92aWRlZCBmb3IgdXNlciAke3VzZXJJZH0sIGZhbGxpbmcgYmFjayB0byBVVEMgb3IgYWdlbnQgZGVmYXVsdC5gXG4gICAgICApO1xuICAgICAgLy8gdGhyb3cgbmV3IEVycm9yKCdubyB0aW1lem9uZSBwcm92aWRlZCcpO1xuICAgIH1cbiAgICBpZiAoIW1lc3NhZ2VIaXN0b3J5T2JqZWN0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ25vIG1lc3NhZ2VIaXN0b3J5T2JqZWN0IChjaGF0IHBheWxvYWQpJyk7XG4gICAgfVxuXG4gICAgLy8gTkxVIFNraWxsIENhdGVnb3JpemF0aW9uIChleGlzdGluZyBsb2dpYylcbiAgICBpZiAobWVzc2FnZUhpc3RvcnlPYmplY3Q/LnNraWxsID09PSAncGVuZGluZycpIHtcbiAgICAgIGNvbnN0IHVzZXJJbnB1dEZvck5sdSA9XG4gICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0Py5tZXNzYWdlcz8uW1xuICAgICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0Py5tZXNzYWdlcz8ubGVuZ3RoIC0gMVxuICAgICAgICBdPy5jb250ZW50O1xuICAgICAgaWYgKHVzZXJJbnB1dEZvck5sdSkge1xuICAgICAgICBjb25zdCBvcGVuQUlSZXNTa2lsbCA9IGF3YWl0IGNhbGxPcGVuQUkoXG4gICAgICAgICAgb3BlbmFpLFxuICAgICAgICAgIGNhdGVnb3JpemVTa2lsbEZyb21Vc2VySW5wdXRQcm9tcHQsXG4gICAgICAgICAgb3BlbkFJQ2hhdEdQVDM1TW9kZWwsXG4gICAgICAgICAgdXNlcklucHV0Rm9yTmx1LFxuICAgICAgICAgIGNhdGVnb3JpemVTa2lsbEZyb21Vc2VySW5wdXRFeGFtcGxlSW5wdXQsXG4gICAgICAgICAgY2F0ZWdvcml6ZVNraWxsRnJvbVVzZXJJbnB1dEV4YW1wbGVPdXRwdXRcbiAgICAgICAgKTtcbiAgICAgICAgY29uc29sZS5sb2cob3BlbkFJUmVzU2tpbGwsICcgb3BlbkFJUmVzU2tpbGwgY2F0ZWdvcml6ZWQgYnkgTkxVJyk7XG4gICAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0LnNraWxsID0gb3BlbkFJUmVzU2tpbGwgYXMgU2tpbGxUeXBlO1xuICAgICAgICAvLyBUT0RPOiBJZiBOTFUgY2F0ZWdvcml6ZXMgdG8gSU5fUEVSU09OX0FVRElPX05PVEVfU1RBUlQsIGV0Yy4sIGl0IG5lZWRzIHRvIGFsc28gZXh0cmFjdCBlbnRpdGllc1xuICAgICAgICAvLyBsaWtlIHN1Z2dlc3RlZFRpdGxlIGFuZCBwYXNzIHRoZW0uIEZvciBub3csIHRoaXMgaXMgYSBnYXAgaWYgcmVseWluZyBvbiB0aGlzIE5MVS5cbiAgICAgICAgLy8gVGhlIGBpblBlcnNvbkF1ZGlvTm90ZVNraWxsc2AgY3VycmVudGx5IGV4cGVjdCBlbnRpdGllcyBpbiBgbmx1UmVzdWx0LmVudGl0aWVzYC5cbiAgICAgICAgLy8gYG1lc3NhZ2VIaXN0b3J5T2JqZWN0LnByZXZEYXRhLmVudGl0aWVzYCBtaWdodCBiZSBhIHBsYWNlIHRvIHN0b3JlIHRoZW0uXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLndhcm4oJ1VzZXIgaW5wdXQgZm9yIE5MVSBza2lsbCBjYXRlZ29yaXphdGlvbiBpcyBlbXB0eS4nKTtcbiAgICAgICAgbWVzc2FnZUhpc3RvcnlPYmplY3Quc2tpbGwgPSAndW5rbm93bl9vcl9lbXB0eV9pbnB1dCc7IC8vIEhhbmRsZSBncmFjZWZ1bGx5XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2FsbCBwcm9jZXNzUXVlcmllcywgbm93IHBhc3Npbmcgc2VuZENvbW1hbmRUb1VzZXJGdW5jXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcHJvY2Vzc1F1ZXJpZXMoXG4gICAgICB1c2VySWQsXG4gICAgICB0aW1lem9uZSB8fCAnVVRDJyxcbiAgICAgIG1lc3NhZ2VIaXN0b3J5T2JqZWN0LFxuICAgICAgc2VuZENvbW1hbmRUb1VzZXJGdW5jXG4gICAgKTtcblxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShyZXMpO1xuICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBhc3Npc3RhbnRfYnJhaW46JywgZS5tZXNzYWdlLCBlLnN0YWNrKTtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZSk7XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IGFzc2lzdGFudF9icmFpbjtcbiJdfQ==