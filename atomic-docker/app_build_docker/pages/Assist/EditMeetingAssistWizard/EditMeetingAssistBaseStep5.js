"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const date_utils_1 = require("@lib/date-utils");
// import DatePicker from 'react-native-date-picker'
// import DateTimePicker from 'react-datetime-picker/dist/entry.nostyle'
const colorsPalette_1 = require("@lib/theme/colorsPalette");
const react_2 = require("@chakra-ui/react");
const Switch_1 = __importDefault(require("@components/Switch"));
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const TextField_1 = __importDefault(require("@components/TextField"));
const react_native_1 = require("react-native");
const react_3 = require("@chakra-ui/react");
const react_4 = require("@chakra-ui/react");
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("../../../config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
const dark = react_native_1.Appearance.getColorScheme() === 'dark';
const styles = {
    duration: {
        fontSize: '21px',
        lineHeight: '28px',
        width: '30%',
    },
    container: {
        flex: 1,
        justifyContent: 'center',
        alignItems: 'center',
        width: '100%',
    },
};
function EditMeetingAssistBaseStep5(props) {
    const [cancelIfAnyRefuse, setCancelIfAnyRefuse] = (0, react_1.useState)(props?.cancelIfAnyRefuse);
    const [enableAttendeePreferences, setEnableAttendeePreferences] = (0, react_1.useState)(props?.enableAttendeePreferences);
    const [attendeeCanModify, setAttendeeCanModify] = (0, react_1.useState)(props?.attendeeCanModify);
    const [expireDate, setExpireDate] = (0, react_1.useState)(props?.expireDate);
    const [duration, setDuration] = (0, react_1.useState)(props?.duration);
    const [isMessage, setIsMessage] = (0, react_1.useState)(false);
    const [isExpireDatePicker, setIsExpireDatePicker] = (0, react_1.useState)(false);
    const [pageOffset, setPageOffset] = (0, react_1.useState)(0);
    const toast = (0, react_3.useToast)();
    const { height: fullHeight } = react_native_1.Dimensions.get('window');
    const setParentCancelIfAnyRefuse = props?.setParentCancelIfAnyRefuse;
    const setParentEnableAttendeePreferences = props?.setParentEnableAttendeePreferences;
    const setParentAttendeeCanModify = props?.setParentAttendeeCanModify;
    const setParentExpireDate = props?.setParentExpireDate;
    const setParentDuration = props?.setParentDuration;
    const changeCancelIfAnyRefuse = (value) => {
        setCancelIfAnyRefuse(value);
        setParentCancelIfAnyRefuse(value);
    };
    const changeEnableAttendeePreferences = (value) => {
        setEnableAttendeePreferences(value);
        setParentEnableAttendeePreferences(value);
    };
    const changeAttendeeCanModify = (value) => {
        setAttendeeCanModify(value);
        setParentAttendeeCanModify(value);
    };
    const changeExpireDate = (value) => {
        setExpireDate(value);
        setParentExpireDate(value);
    };
    // 
    const changeDuration = (e) => {
        const value = e?.target?.value;
        const intValue = parseInt(value.replace(/[^0-9.]/g, ''), 10);
        // validate
        if (intValue < 10) {
            toast({
                status: 'error',
                title: 'Too short',
                description: 'Your duration is too short',
                duration: 9000,
                isClosable: true,
            });
            return;
        }
        setDuration(intValue);
        setParentDuration(intValue);
    };
    const hideExpireDatePicker = () => setIsExpireDatePicker(false);
    const showExpireDatePicker = () => setIsExpireDatePicker(true);
    return ((0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(react_native_1.ScrollView, { style: { flex: 1, width: '100%' }, contentContainerStyle: { alignItems: 'center' }, children: (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: [(0, jsx_runtime_1.jsxs)(Box_1.default, { p: { phone: 's', tablet: 'm' }, justifyContent: "center", alignItems: "center", style: { width: '90%' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", pt: { phone: 'm', tablet: 's' }, children: "Cancel planning if any refuse?" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { onColor: colorsPalette_1.colorsPalette.purple30, offColor: colorsPalette_1.colorsPalette.purple60, checked: cancelIfAnyRefuse, onValueChange: changeCancelIfAnyRefuse, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { p: { phone: 's', tablet: 'm' }, justifyContent: "center", alignItems: "center", style: { width: '90%' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", pt: { phone: 'm', tablet: 's' }, children: "Allow attendee to select time preferences (slots) for event?" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { onColor: colorsPalette_1.colorsPalette.purple30, offColor: colorsPalette_1.colorsPalette.purple60, checked: enableAttendeePreferences, onValueChange: changeEnableAttendeePreferences, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { p: { phone: 's', tablet: 'm' }, justifyContent: "center", alignItems: "center", style: { width: '90%' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", pt: { phone: 'm', tablet: 's' }, children: "Allow attendee to change existing time preferences (slots) for event?" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { onColor: colorsPalette_1.colorsPalette.purple30, offColor: colorsPalette_1.colorsPalette.purple60, checked: attendeeCanModify, onValueChange: changeAttendeeCanModify, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { p: { phone: 's', tablet: 'm' }, justifyContent: "center", alignItems: "center", style: { width: '90%' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(react_2.Tooltip, { label: "You can select a time when the meeting assist will no longer valid if minimum number of attendees do not say \\'Yes\\'. In other words, no new events will be created.", bg: 'purple.700', color: 'white', "aria-label": 'A tooltip', children: (0, jsx_runtime_1.jsx)(Text_1.default, { p: { phone: 's', tablet: 'm' }, variant: "optionHeader", children: "When will planning this event expire if minimum threshold of accepted invites is not met?" }) }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(react_4.Input, { placeholder: "Select Date and Time", size: "md", type: "datetime-local", onChange: (e) => {
                                        changeExpireDate((0, date_utils_1.dayjs)(e?.target?.value, "YYYY-MM-DDTHH:mm").toDate());
                                    }, value: (0, date_utils_1.dayjs)(expireDate).format("YYYY-MM-DDTHH:mm") }) })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { p: { phone: 's', tablet: 'm' }, justifyContent: "center", alignItems: "center", style: { width: '90%' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", pt: { phone: 'm', tablet: 's' }, children: "How long is the event?" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(TextField_1.default, { label: "Duration (minutes)", type: "number", onChange: changeDuration, value: `${duration}`, placeholder: "1", style: styles.duration }) })] })] }) }) }));
}
exports.default = EditMeetingAssistBaseStep5;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWRpdE1lZXRpbmdBc3Npc3RCYXNlU3RlcDUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJFZGl0TWVldGluZ0Fzc2lzdEJhc2VTdGVwNS50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUF5QkEsZ0RBcUNDOztBQTlERCxpQ0FJYztBQUVkLGdEQUF1QztBQUN2QyxvREFBb0Q7QUFDcEQsd0VBQXdFO0FBQ3hFLDREQUFrRTtBQUNsRSw0Q0FBMEM7QUFDMUMsZ0VBQXdDO0FBQ3hDLGlFQUF3QztBQUN4QyxtRUFBMEM7QUFDMUMsc0VBQTZDO0FBRTdDLCtDQUF5SDtBQUN6SCw0Q0FBMkM7QUFFM0MsNENBQXdDO0FBRXhDLHdFQUE4QztBQUM5QyxpRUFBNkQ7QUFDN0QsOEVBQXFEO0FBRTlDLEtBQUssVUFBVSxrQkFBa0IsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQWlEO0lBQ2xHLDBGQUEwRjtJQUMxRixzQ0FBc0M7SUFDdEMseUVBQXlFO0lBQ3pFLDBCQUFlLENBQUMsSUFBSSxDQUFDLElBQUEsNkJBQWEsR0FBRSxDQUFDLENBQUE7SUFDckMsSUFBSSxPQUFPLENBQUE7SUFDWCxJQUFJLENBQUM7UUFDSCxPQUFPLEdBQUcsTUFBTSxpQkFBTyxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFO1lBQzNDLDZCQUE2QixFQUFFLEtBQUs7Z0JBQ2xDLE9BQU8sRUFBRSxDQUFBO1lBQ1gsQ0FBQztTQUNGLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFBQyxPQUFPLEdBQVEsRUFBRSxDQUFDO1FBQ2xCLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxpQkFBTyxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ2pELE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLEVBQUUsQ0FBQTtRQUN4RCxDQUFDO2FBQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLGlCQUFPLENBQUMsS0FBSyxDQUFD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LEtBQUssRUFBRSxLQUFLLEVBQUUsYUFDcEcsdUJBQUMsYUFBRyxJQUFDLGFBQWEsRUFBQyxLQUFLLEVBQUMsY0FBYyxFQUFDLFlBQVksRUFBQyxVQUFVLEVBQUMsUUFBUSxFQUFDLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFDN0YsdUJBQUMsY0FBSSxJQUFDLE9BQU8sRUFBQyxjQUFjLEVBQUMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLHVDQUVyRCxHQUNMLEVBQ0YsdUJBQUMsYUFBRyxJQUFDLGFBQWEsRUFBQyxLQUFLLEVBQUMsY0FBYyxFQUFDLFVBQVUsRUFBQyxVQUFVLEVBQUMsUUFBUSxFQUFDLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFFdkYsdUJBQUMsbUJBQVMsSUFDTixLQUFLLEVBQUMsb0JBQW9CLEVBQzFCLElBQUksRUFBQyxRQUFRLEVBQ2IsUUFBUSxFQUFFLGNBQWMsRUFDeEIsS0FBSyxFQUFFLEdBQUcsUUFBUSxFQUFFLEVBQ3BCLFdBQVcsRUFBQyxHQUFHLEVBQ2YsS0FBSyxFQUFFLE1BQU0sQ0FBQyxRQUFRLEdBQ3hCLEdBRVIsSUFDSixJQUNKLEdBQ0csR0FFWCxDQUNYLENBQUE7QUFDSCxDQUFDO0FBRUQsa0JBQWUsMEJBQTBCLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtcbiAgdXNlU3RhdGUsXG4gIERpc3BhdGNoLFxuICBTZXRTdGF0ZUFjdGlvbixcbn0gZnJvbSAncmVhY3QnXG5cbmltcG9ydCB7IGRheWpzIH0gZnJvbSAnQGxpYi9kYXRlLXV0aWxzJ1xuLy8gaW1wb3J0IERhdGVQaWNrZXIgZnJvbSAncmVhY3QtbmF0aXZlLWRhdGUtcGlja2VyJ1xuLy8gaW1wb3J0IERhdGVUaW1lUGlja2VyIGZyb20gJ3JlYWN0LWRhdGV0aW1lLXBpY2tlci9kaXN0L2VudHJ5Lm5vc3R5bGUnXG5pbXBvcnQgeyBjb2xvcnNQYWxldHRlIGFzIENvbG9ycyB9IGZyb20gJ0BsaWIvdGhlbWUvY29sb3JzUGFsZXR0ZSdcbmltcG9ydCB7IFRvb2x0aXAgfSBmcm9tICdAY2hha3JhLXVpL3JlYWN0J1xuaW1wb3J0IFN3aXRjaDEgZnJvbSAnQGNvbXBvbmVudHMvU3dpdGNoJ1xuaW1wb3J0IEJveCBmcm9tICdAY29tcG9uZW50cy9jb21tb24vQm94J1xuaW1wb3J0IFRleHQgZnJvbSAnQGNvbXBvbmVudHMvY29tbW9uL1RleHQnXG5pbXBvcnQgVGV4dEZpZWxkIGZyb20gJ0Bjb21wb25lbnRzL1RleHRGaWVsZCdcblxuaW1wb3J0IHsgQXBwZWFyYW5jZSwgUHJlc3NhYmxlLCBTY3JvbGxWaWV3LCBTdHlsZVNoZWV0LCBLZXlib2FyZEF2b2lkaW5nVmlldywgUGxhdGZvcm0sIERpbWVuc2lvbnMgfSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuaW1wb3J0IHsgdXNlVG9hc3QgfSBmcm9tICdAY2hha3JhLXVpL3JlYWN0J1xuXG5pbXBvcnQgeyBJbnB1dCB9IGZyb20gJ0BjaGFrcmEtdWkvcmVhY3QnXG5pbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgc3VwZXJ0b2tlbnNOb2RlIGZyb20gJ3N1cGVydG9rZW5zLW5vZGUnXG5pbXBvcnQgeyBiYWNrZW5kQ29uZmlnIH0gZnJvbSAnLi4vLi4vLi4vY29uZmlnL2JhY2tlbmRDb25maWcnXG5pbXBvcnQgU2Vzc2lvbiBmcm9tICdzdXBlcnRva2Vucy1ub2RlL3JlY2lwZS9zZXNzaW9uJ1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2VydmVyU2lkZVByb3BzKHsgcmVxLCByZXMgfTogeyByZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSB9KSB7XG4gIC8vIE5vdGljZSBob3cgdGhlIHNlcnZlciB1c2VzIGBBUElgIGZyb20gYHdpdGhTU1JDb250ZXh0YCwgaW5zdGVhZCBvZiB0aGUgdG9wLWxldmVsIGBBUElgLlxuICAvLyBjb25zdCBTU1IgPSB3aXRoU1NSQ29udGV4dCh7IHJlcSB9KVxuICAvLyB0aGlzIHJ1bnMgb24gdGhlIGJhY2tlbmQsIHNvIHdlIG11c3QgY2FsbCBpbml0IG9uIHN1cGVydG9rZW5zLW5vZGUgU0RLXG4gIHN1cGVydG9rZW5zTm9kZS5pbml0KGJhY2tlbmRDb25maWcoKSlcbiAgbGV0IHNlc3Npb25cbiAgdHJ5IHtcbiAgICBzZXNzaW9uID0gYXdhaXQgU2Vzc2lvbi5nZXRTZXNzaW9uKHJlcSwgcmVzLCB7XG4gICAgICBvdmVycmlkZUdsb2JhbENsYWltVmFsaWRhdG9yczogYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gW11cbiAgICAgIH0sXG4gICAgfSlcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICBpZiAoZXJyLnR5cGUgPT09IFNlc3Npb24uRXJyb3IuVFJZX1JFRlJFU0hfVE9LRU4pIHtcbiAgICAgIHJldHVybiB7IHByb3BzOiB7IGZyb21TdXBlcnRva2VuczogJ25lZWRzLXJlZnJlc2gnIH0gfVxuICAgIH0gZWxzZSBpZiAoZXJyLnR5cGUgPT09IFNlc3Npb24uRXJyb3IuVU5BVVRIT1JJU0VEKSB7XG4gICAgICAvLyB0aGlzIHdpbGwgZm9yY2UgdGhlIGZyb250ZW5kIHRvIHRyeSBhbmQgcmVmcmVzaCB3aGljaCB3aWxsIGZhaWxcbiAgICAgIC8vIGNsZWFyaW5nIGFsbCBjb29raWVzIGFuZCByZWRpcmVjdGluZyB0aGUgdXNlciB0byB0aGUgbG9naW4gc2NyZWVuLlxuICAgICAgcmV0dXJuIHsgcHJvcHM6IHsgZnJvbVN1cGVydG9rZW5zOiAnbmVlZHMtcmVmcmVzaCcgfSB9XG4gICAgfVxuICAgIHRocm93IGVyclxuICB9XG5cbiAgaWYgKCFzZXNzaW9uPy5nZXRVc2VySWQoKSkge1xuICAgIHJldHVybiB7XG4gICAgICByZWRpcmVjdDoge1xuICAgICAgICBkZXN0aW5hdGlvbjogJy9Vc2VyL0xvZ2luL1VzZXJMb2dpbicsXG4gICAgICAgIHBlcm1hbmVudDogZmFsc2UsXG4gICAgICB9LFxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgcHJvcHM6IHtcbiAgICAgIHN1Yjogc2Vzc2lvbi5nZXRVc2VySWQoKSxcbiAgICB9XG4gIH1cbn1cblxudHlwZSBQcm9wcyA9IHtcbiAgY2FuY2VsSWZBbnlSZWZ1c2U6IGJvb2xlYW4sXG4gIGVuYWJsZUF0dGVuZGVlUHJlZmVyZW5jZXM6IGJvb2xlYW4sXG4gIGF0dGVuZGVlQ2FuTW9kaWZ5OiBib29sZWFuLFxuICBleHBpcmVEYXRlOiBEYXRlLFxuICBkdXJhdGlvbjogbnVtYmVyLFxuICBzZXRQYXJlbnRDYW5jZWxJZkFueVJlZnVzZTogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248Ym9vbGVhbj4+LFxuICBzZXRQYXJlbnRFbmFibGVBdHRlbmRlZVByZWZlcmVuY2VzOiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxib29sZWFuPj4sXG4gIHNldFBhcmVudEF0dGVuZGVlQ2FuTW9kaWZ5OiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxib29sZWFuPj4sXG4gIHNldFBhcmVudEV4cGlyZURhdGU6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPERhdGU+PixcbiAgc2V0UGFyZW50RHVyYXRpb246IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPG51bWJlcj4+LFxufVxuXG5jb25zdCBkYXJrID0gQXBwZWFyYW5jZS5nZXRDb2xvclNjaGVtZSgpID09PSAnZGFyaydcblxuY29uc3Qgc3R5bGVzID0ge1xuICAgIGR1cmF0aW9uOiB7XG4gICAgICAgIGZvbnRTaXplOiAnMjFweCcsXG4gICAgICAgIGxpbmVIZWlnaHQ6ICcyOHB4JyxcbiAgICAgICAgd2lkdGg6ICczMCUnLFxuICAgIH0sXG4gICAgY29udGFpbmVyOiB7XG4gICAgICAgIGZsZXg6IDEsXG4gICAgICAgIGp1c3RpZnlDb250ZW50OiAnY2VudGVyJyxcbiAgICAgICAgYWxpZ25JdGVtczogJ2NlbnRlcicsXG4gICAgICAgIHdpZHRoOiAnMTAwJScsXG4gICAgfSxcbn1cblxuXG5mdW5jdGlvbiBFZGl0TWVldGluZ0Fzc2lzdEJhc2VTdGVwNShwcm9wczogUHJvcHMpIHtcbiAgY29uc3QgW2NhbmNlbElmQW55UmVmdXNlLCBzZXRDYW5jZWxJZkFueVJlZnVzZV0gPSB1c2VTdGF0ZTxib29sZWFuPihwcm9wcz8uY2FuY2VsSWZBbnlSZWZ1c2UpXG4gIGNvbnN0IFtlbmFibGVBdHRlbmRlZVByZWZlcmVuY2VzLCBzZXRFbmFibGVBdHRlbmRlZVByZWZlcmVuY2VzXSA9IHVzZVN0YXRlPGJvb2xlYW4+KHByb3BzPy5lbmFibGVBdHRlbmRlZVByZWZlcmVuY2VzKVxuICAgIGNvbnN0IFthdHRlbmRlZUNhbk1vZGlmeSwgc2V0QXR0ZW5kZWVDYW5Nb2RpZnldID0gdXNlU3RhdGU8Ym9vbGVhbj4ocHJvcHM/LmF0dGVuZGVlQ2FuTW9kaWZ5KVxuICAgIGNvbnN0IFtleHBpcmVEYXRlLCBzZXRFeHBpcmVEYXRlXSA9IHVzZVN0YXRlPERhdGU+KHByb3BzPy5leHBpcmVEYXRlKVxuICAgIGNvbnN0IFtkdXJhdGlvbiwgc2V0RHVyYXRpb25dID0gdXNlU3RhdGU8bnVtYmVyPihwcm9wcz8uZHVyYXRpb24pXG4gICAgY29uc3QgW2lzTWVzc2FnZSwgc2V0SXNNZXNzYWdlXSA9IHVzZVN0YXRlPGJvb2xlYW4+KGZhbHNlKVxuICAgIGNvbnN0IFtpc0V4cGlyZURhdGVQaWNrZXIsIHNldElzRXhwaXJlRGF0ZVBpY2tlcl0gPSB1c2VTdGF0ZTxib29sZWFuPihmYWxzZSlcbiAgICBjb25zdCBbcGFnZU9mZnNldCwgc2V0UGFnZU9mZnNldF0gPSB1c2VTdGF0ZTxudW1iZXI+KDApXG4gICAgY29uc3QgdG9hc3QgPSB1c2VUb2FzdCgpXG4gICAgY29uc3QgeyBoZWlnaHQ6IGZ1bGxIZWlnaHQgfSA9IERpbWVuc2lvbnMuZ2V0KCd3aW5kb3cnKVxuXG5cbiAgY29uc3Qgc2V0UGFyZW50Q2FuY2VsSWZBbnlSZWZ1c2UgPSBwcm9wcz8uc2V0UGFyZW50Q2FuY2VsSWZBbnlSZWZ1c2VcbiAgY29uc3Qgc2V0UGFyZW50RW5hYmxlQXR0ZW5kZWVQcmVmZXJlbmNlcyA9IHByb3BzPy5zZXRQYXJlbnRFbmFibGVBdHRlbmRlZVByZWZlcmVuY2VzXG4gIGNvbnN0IHNldFBhcmVudEF0dGVuZGVlQ2FuTW9kaWZ5ID0gcHJvcHM/LnNldFBhcmVudEF0dGVuZGVlQ2FuTW9kaWZ5XG4gIGNvbnN0IHNldFBhcmVudEV4cGlyZURhdGUgPSBwcm9wcz8uc2V0UGFyZW50RXhwaXJlRGF0ZVxuICBjb25zdCBzZXRQYXJlbnREdXJhdGlvbiA9IHByb3BzPy5zZXRQYXJlbnREdXJhdGlvblxuXG5cblxuICBjb25zdCBjaGFuZ2VDYW5jZWxJZkFueVJlZnVzZSA9ICh2YWx1ZTogYm9vbGVhbikgPT4ge1xuICAgIHNldENhbmNlbElmQW55UmVmdXNlKHZhbHVlKVxuICAgIHNldFBhcmVudENhbmNlbElmQW55UmVmdXNlKHZhbHVlKVxuICB9XG5cbiAgY29uc3QgY2hhbmdlRW5hYmxlQXR0ZW5kZWVQcmVmZXJlbmNlcyA9ICh2YWx1ZTogYm9vbGVhbikgPT4ge1xuICAgICAgc2V0RW5hYmxlQXR0ZW5kZWVQcmVmZXJlbmNlcyh2YWx1ZSlcbiAgICAgIHNldFBhcmVudEVuYWJsZUF0dGVuZGVlUHJlZmVyZW5jZXModmFsdWUpXG4gIH1cblxuICBjb25zdCBjaGFuZ2VBdHRlbmRlZUNhbk1vZGlmeSA9ICh2YWx1ZTogYm9vbGVhbikgPT4ge1xuICAgICAgc2V0QXR0ZW5kZWVDYW5Nb2RpZnkodmFsdWUpXG4gICAgICBzZXRQYXJlbnRBdHRlbmRlZUNhbk1vZGlmeSh2YWx1ZSlcbiAgfVxuXG4gIGNvbnN0IGNoYW5nZUV4cGlyZURhdGUgPSAodmFsdWU6IERhdGUpID0+IHtcbiAgICAgIHNldEV4cGlyZURhdGUodmFsdWUpXG4gICAgICBzZXRQYXJlbnRFeHBpcmVEYXRlKHZhbHVlKVxuICB9XG5cbiAgLy8gXG4gIGNvbnN0IGNoYW5nZUR1cmF0aW9uID0gKGU6IHsgdGFyZ2V0OiB7IHZhbHVlOiBzdHJpbmcgfSB9KSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSBlPy50YXJnZXQ/LnZhbHVlXG4gICAgY29uc3QgaW50VmFsdWUgPSBwYXJzZUludCh2YWx1ZS5yZXBsYWNlKC9bXjAtOS5dL2csICcnKSwgMTApXG5cbiAgICAgIC8vIHZhbGlkYXRlXG4gICAgICBpZiAoaW50VmFsdWUgPCAxMCkge1xuICAgICAgICB0b2FzdCh7XG4gICAgICAgICAgICBzdGF0dXM6ICdlcnJvcicsXG4gICAgICAgICAgICB0aXRsZTogJ1RvbyBzaG9ydCcsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1lvdXIgZHVyYXRpb24gaXMgdG9vIHNob3J0JyxcbiAgICAgICAgICAgIGR1cmF0aW9uOiA5MDAwLFxuICAgICAgICAgICAgaXNDbG9zYWJsZTogdHJ1ZSxcbiAgICAgICAgfSlcblxuICAgICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBzZXREdXJhdGlvbihpbnRWYWx1ZSlcbiAgICAgIHNldFBhcmVudER1cmF0aW9uKGludFZhbHVlKVxuICB9XG5cbiAgY29uc3QgaGlkZUV4cGlyZURhdGVQaWNrZXIgPSAoKSA9PiBzZXRJc0V4cGlyZURhdGVQaWNrZXIoZmFsc2UpXG5cbiAgY29uc3Qgc2hvd0V4cGlyZURhdGVQaWNrZXIgPSAoKSA9PiBzZXRJc0V4cGlyZURhdGVQaWNrZXIodHJ1ZSlcblxuICAgIHJldHVybiAoXG4gICAgICAgIDxCb3ggZmxleD17MX0gc3R5bGU9e3sgd2lkdGg6ICcxMDAlJyB9fT5cblxuICAgICAgICAgICAgPFNjcm9sbFZpZXcgc3R5bGU9e3sgZmxleDogMSwgd2lkdGg6ICcxMDAlJyB9fSBjb250ZW50Q29udGFpbmVyU3R5bGU9e3sgYWxpZ25JdGVtczogJ2NlbnRlcid9fT4gXG4gICAgICAgICAgICAgICAgPEJveCBmbGV4PXsxfSBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBzdHlsZT17eyB3aWR0aDogJzEwMCUnIH19PlxuICAgICAgICAgICAgICAgICAgICA8Qm94IHA9e3sgcGhvbmU6ICdzJywgdGFibGV0OiAnbScgfX0ganVzdGlmeUNvbnRlbnQ9XCJjZW50ZXJcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgc3R5bGU9e3sgd2lkdGg6ICc5MCUnIH19PlxuICAgICAgICAgICAgICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LXN0YXJ0XCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnMTAwJScgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD1cIm9wdGlvbkhlYWRlclwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYW5jZWwgcGxhbm5pbmcgaWYgYW55IHJlZnVzZT9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1lbmRcIiBwdD17eyBwaG9uZTogJ20nLCB0YWJsZXQ6ICdzJyB9fSBzdHlsZT17eyB3aWR0aDogJzEwMCUnIH19PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxTd2l0Y2gxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ29sb3I9e0NvbG9ycy5wdXJwbGUzMH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2ZmQ29sb3I9e0NvbG9ycy5wdXJwbGU2MH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17Y2FuY2VsSWZBbnlSZWZ1c2V9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uVmFsdWVDaGFuZ2U9e2NoYW5nZUNhbmNlbElmQW55UmVmdXNlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17e21hcmdpbkJvdHRvbTogMjB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgICAgIDxCb3ggcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fSBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBzdHlsZT17eyB3aWR0aDogJzkwJScgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICA8Qm94IGZsZXhEaXJlY3Rpb249XCJyb3dcIiBqdXN0aWZ5Q29udGVudD1cImZsZXgtc3RhcnRcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgc3R5bGU9e3sgd2lkdGg6ICcxMDAlJyB9fT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8VGV4dCB2YXJpYW50PVwib3B0aW9uSGVhZGVyXCIgcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsbG93IGF0dGVuZGVlIHRvIHNlbGVjdCB0aW1lIHByZWZlcmVuY2VzIChzbG90cykgZm9yIGV2ZW50P1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LWVuZFwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19IHN0eWxlPXt7IHdpZHRoOiAnMTAwJScgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPFN3aXRjaDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Db2xvcj17Q29sb3JzLnB1cnBsZTMwfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZDb2xvcj17Q29sb3JzLnB1cnBsZTYwfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkPXtlbmFibGVBdHRlbmRlZVByZWZlcmVuY2VzfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblZhbHVlQ2hhbmdlPXtjaGFuZ2VFbmFibGVBdHRlbmRlZVByZWZlcmVuY2VzfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17e21hcmdpbkJvdHRvbTogMjB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgICAgIDxCb3ggcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fSBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBzdHlsZT17eyB3aWR0aDogJzkwJScgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICA8Qm94IGZsZXhEaXJlY3Rpb249XCJyb3dcIiBqdXN0aWZ5Q29udGVudD1cImZsZXgtc3RhcnRcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgc3R5bGU9e3sgd2lkdGg6ICcxMDAlJyB9fT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8VGV4dCB2YXJpYW50PVwib3B0aW9uSGVhZGVyXCIgcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFsbG93IGF0dGVuZGVlIHRvIGNoYW5nZSBleGlzdGluZyB0aW1lIHByZWZlcmVuY2VzIChzbG90cykgZm9yIGV2ZW50P1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LWVuZFwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19IHN0eWxlPXt7IHdpZHRoOiAnMTAwJScgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPFN3aXRjaDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25Db2xvcj17Q29sb3JzLnB1cnBsZTMwfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZDb2xvcj17Q29sb3JzLnB1cnBsZTYwfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkPXthdHRlbmRlZUNhbk1vZGlmeX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25WYWx1ZUNoYW5nZT17Y2hhbmdlQXR0ZW5kZWVDYW5Nb2RpZnl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7bWFyZ2luQm90dG9tOiAyMH19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgPEJveCBwPXt7IHBob25lOiAncycsIHRhYmxldDogJ20nIH19IGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnOTAlJyB9fT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1zdGFydFwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBzdHlsZT17eyB3aWR0aDogJzEwMCUnIH19PiAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxUb29sdGlwIGxhYmVsPVwiWW91IGNhbiBzZWxlY3QgYSB0aW1lIHdoZW4gdGhlIG1lZXRpbmcgYXNzaXN0IHdpbGwgbm8gbG9uZ2VyIHZhbGlkIGlmIG1pbmltdW0gbnVtYmVyIG9mIGF0dGVuZGVlcyBkbyBub3Qgc2F5IFxcJ1llc1xcJy4gSW4gb3RoZXIgd29yZHMsIG5vIG5ldyBldmVudHMgd2lsbCBiZSBjcmVhdGVkLlwiIGJnPSdwdXJwbGUuNzAwJyBjb2xvcj0nd2hpdGUnIGFyaWEtbGFiZWw9J0EgdG9vbHRpcCc+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxUZXh0IHA9e3sgcGhvbmU6ICdzJywgdGFibGV0OiAnbScgfX0gdmFyaWFudD1cIm9wdGlvbkhlYWRlclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV2hlbiB3aWxsIHBsYW5uaW5nIHRoaXMgZXZlbnQgZXhwaXJlIGlmIG1pbmltdW0gdGhyZXNob2xkIG9mIGFjY2VwdGVkIGludml0ZXMgaXMgbm90IG1ldD9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvVG9vbHRpcD5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgICAgICAgICA8Qm94IGZsZXhEaXJlY3Rpb249XCJyb3dcIiBqdXN0aWZ5Q29udGVudD1cImZsZXgtZW5kXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnMTAwJScgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICA8SW5wdXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJTZWxlY3QgRGF0ZSBhbmQgVGltZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpemU9XCJtZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9XCJkYXRldGltZS1sb2NhbFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlRXhwaXJlRGF0ZShkYXlqcyhlPy50YXJnZXQ/LnZhbHVlLCBcIllZWVktTU0tRERUSEg6bW1cIikudG9EYXRlKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXtkYXlqcyhleHBpcmVEYXRlKS5mb3JtYXQoXCJZWVlZLU1NLUREVEhIOm1tXCIpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgICAgIDxCb3ggcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fSBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBzdHlsZT17eyB3aWR0aDogJzkwJScgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICA8Qm94IGZsZXhEaXJlY3Rpb249XCJyb3dcIiBqdXN0aWZ5Q29udGVudD1cImZsZXgtc3RhcnRcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgc3R5bGU9e3sgd2lkdGg6ICcxMDAlJyB9fT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8VGV4dCB2YXJpYW50PVwib3B0aW9uSGVhZGVyXCIgcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhvdyBsb25nIGlzIHRoZSBldmVudD9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Qm94IGZsZXhEaXJlY3Rpb249XCJyb3dcIiBqdXN0aWZ5Q29udGVudD1cImZsZXgtZW5kXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnMTAwJScgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFRleHRGaWVsZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPVwiRHVyYXRpb24gKG1pbnV0ZXMpXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwibnVtYmVyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17Y2hhbmdlRHVyYXRpb259XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e2Ake2R1cmF0aW9ufWB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCIxXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17c3R5bGVzLmR1cmF0aW9ufVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cblxuICAgICAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgPC9TY3JvbGxWaWV3PlxuICAgICAgICAgICAgXG4gICAgICAgIDwvQm94PlxuICApXG59XG5cbmV4cG9ydCBkZWZhdWx0IEVkaXRNZWV0aW5nQXNzaXN0QmFzZVN0ZXA1XG4iXX0=