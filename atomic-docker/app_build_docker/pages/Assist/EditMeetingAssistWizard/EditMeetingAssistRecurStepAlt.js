"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const react_native_1 = require("react-native");
// import DateTimePicker from 'react-datetime-picker/dist/entry.nostyle'
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const TextField_1 = __importDefault(require("@components/TextField"));
const react_2 = require("@chakra-ui/react");
const date_utils_1 = require("@lib/date-utils");
const lodash_1 = __importDefault(require("lodash"));
const frequencyOptions = [
    { label: 'Daily', value: 'daily' },
    { label: 'Weekly', value: 'weekly' },
    { label: 'Monthly', value: 'monthly' },
];
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("../../../config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
function EditMeetingAssistRecurStepAlt(props) {
    const [frequency, setFrequency] = (0, react_1.useState)(props?.frequency);
    const [interval, setInterval] = (0, react_1.useState)(props?.interval);
    const [until, setUntil] = (0, react_1.useState)(props?.until);
    const [isRecurring, setIsRecurring] = (0, react_1.useState)(false);
    const dark = (0, react_native_1.useColorScheme)() === 'dark';
    const setParentFrequency = props?.setParentFrequency;
    const setParentInterval = props?.setParentInterval;
    const setParentUntil = props?.setParentUntil;
    const changeUntil = (value) => {
        setUntil(value);
        setParentUntil(value);
    };
    const changeFrequency = (value) => {
        setFrequency(value);
        setParentFrequency(value);
    };
    const changeInterval = (value) => {
        setInterval(parseInt(value.replace(/[^0-9.]/g, ''), 10));
        setParentInterval(parseInt(value.replace(/[^0-9.]/g, ''), 10));
    };
    const hideUntilPicker = () => setIsRecurring(false);
    const showUntilPicker = () => setIsRecurring(true);
    return ((0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: [(0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, justifyContent: "flex-end", alignItems: "center", style: { width: '90%' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, justifyContent: "flex-end", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "End Date for Recurrence" }) }), (0, jsx_runtime_1.jsx)(react_2.Input, { placeholder: "Select Date and Time", size: "md", type: "datetime-local", onChange: (e) => {
                            changeUntil((0, date_utils_1.dayjs)(e?.target?.value, "YYYY-MM-DDTHH:mm").toDate());
                        }, value: (0, date_utils_1.dayjs)(until).format("YYYY-MM-DDTHH:mm") })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, p: { phone: 's', tablet: 'm' }, justifyContent: "center", alignItems: "center", children: [(0, jsx_runtime_1.jsx)(Text_1.default, { p: { phone: 's', tablet: 'm' }, variant: "buttonLink", children: "Select how oftern to recur?" }), (0, jsx_runtime_1.jsxs)("select", { value: frequency, onChange: (e) => changeFrequency(e?.target?.value), className: "select select-primary w-full max-w-xs", children: [(0, jsx_runtime_1.jsx)("option", { disabled: true, selected: true, children: "frequency" }), lodash_1.default.map(frequencyOptions, option => ((0, jsx_runtime_1.jsx)("option", { value: option.value, children: option.label }, option.value)))] })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, p: { phone: 's', tablet: 'm' }, justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { justifyContent: "center", alignItems: "flex-start", style: { width: '90%' }, children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Interval (ex: every 2 weeks)" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, p: { phone: 's', tablet: 'm' }, justifyContent: "center", alignItems: "flex-end", style: { width: '90%' }, children: (0, jsx_runtime_1.jsx)(TextField_1.default, { type: "number", onChange: (e) => changeInterval(e?.target?.value?.replace(/[^0-9.]/g, '') || '0'), value: `${interval}`, placeholder: "1", style: { width: '20%' } }) })] })] }));
}
exports.default = EditMeetingAssistRecurStepAlt;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWRpdE1lZXRpbmdBc3Npc3RSZWN1clN0ZXBBbHQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJFZGl0TWVldGluZ0Fzc2lzdFJlY3VyU3RlcEFsdC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUEyQkEsZ0RBcUNDOztBQWhFRCxpQ0FJYztBQUNkLCtDQUE4QztBQUU5Qyx3RUFBd0U7QUFDeEUsaUVBQXdDO0FBQ3hDLG1FQUEwQztBQUMxQyxzRUFBNkM7QUFDN0MsNENBQXdDO0FBRXhDLGdEQUF1QztBQUV2QyxvREFBc0I7QUFFdEIsTUFBTSxnQkFBZ0IsR0FBRztJQUNyQixFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRTtJQUNsQyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRTtJQUNwQyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRTtDQUN6QyxDQUFBO0FBRUQsd0VBQThDO0FBQzlDLGlFQUE2RDtBQUM3RCw4RUFBcUQ7QUFFOUMsS0FBSyxVQUFVLGtCQUFrQixDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBaUQ7SUFDbEcsMEZBQTBGO0lBQzFGLHNDQUFzQztJQUN0Qyx5RUFBeUU7SUFDekUsMEJBQWUsQ0FBQyxJQUFJLENBQUMsSUFBQSw2QkFBYSxHQUFFLENBQUMsQ0FBQTtJQUNyQyxJQUFJLE9BQU8sQ0FBQTtJQUNYLElBQUksQ0FBQztRQUNILE9BQU8sR0FBRyxNQUFNLGlCQUFPLENBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUU7WUFDM0MsNkJBQTZCLEVBQUUsS0FBSztnQkFDbEMsT0FBTyxFQUFFLENBQUE7WUFDWCxDQUFDO1NBQ0YsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUFDLE9BQU8sR0FBUSxFQUFFLENBQUM7UUFDbEIsSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLGlCQUFPLENBQUMsS0FBSyxDQUFD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QUUsR0FBRyxRQUFRLEVBQUUsRUFDcEIsV0FBVyxFQUFDLEdBQUcsRUFDZixLQUFLLEVBQUUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEdBQ3ZCLEdBRUEsSUFDRixJQUNGLENBQ1QsQ0FBQTtBQUNMLENBQUM7QUFFRCxrQkFBZSw2QkFBNkIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwge1xuICAgIHVzZVN0YXRlLFxuICAgIERpc3BhdGNoLFxuICAgIFNldFN0YXRlQWN0aW9uLFxufSBmcm9tICdyZWFjdCdcbmltcG9ydCB7IHVzZUNvbG9yU2NoZW1lLCB9IGZyb20gJ3JlYWN0LW5hdGl2ZSdcblxuLy8gaW1wb3J0IERhdGVUaW1lUGlja2VyIGZyb20gJ3JlYWN0LWRhdGV0aW1lLXBpY2tlci9kaXN0L2VudHJ5Lm5vc3R5bGUnXG5pbXBvcnQgQm94IGZyb20gJ0Bjb21wb25lbnRzL2NvbW1vbi9Cb3gnXG5pbXBvcnQgVGV4dCBmcm9tICdAY29tcG9uZW50cy9jb21tb24vVGV4dCdcbmltcG9ydCBUZXh0RmllbGQgZnJvbSAnQGNvbXBvbmVudHMvVGV4dEZpZWxkJ1xuaW1wb3J0IHsgSW5wdXQgfSBmcm9tICdAY2hha3JhLXVpL3JlYWN0J1xuXG5pbXBvcnQgeyBkYXlqcyB9IGZyb20gJ0BsaWIvZGF0ZS11dGlscydcbmltcG9ydCB7IFJlY3VycmVuY2VGcmVxdWVuY3lUeXBlIH0gZnJvbSAnQGxpYi9DYWxlbmRhci90eXBlcydcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCdcblxuY29uc3QgZnJlcXVlbmN5T3B0aW9ucyA9IFtcbiAgICB7IGxhYmVsOiAnRGFpbHknLCB2YWx1ZTogJ2RhaWx5JyB9LFxuICAgIHsgbGFiZWw6ICdXZWVrbHknLCB2YWx1ZTogJ3dlZWtseScgfSxcbiAgICB7IGxhYmVsOiAnTW9udGhseScsIHZhbHVlOiAnbW9udGhseScgfSxcbl1cbmltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcbmltcG9ydCBzdXBlcnRva2Vuc05vZGUgZnJvbSAnc3VwZXJ0b2tlbnMtbm9kZSdcbmltcG9ydCB7IGJhY2tlbmRDb25maWcgfSBmcm9tICcuLi8uLi8uLi9jb25maWcvYmFja2VuZENvbmZpZydcbmltcG9ydCBTZXNzaW9uIGZyb20gJ3N1cGVydG9rZW5zLW5vZGUvcmVjaXBlL3Nlc3Npb24nXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTZXJ2ZXJTaWRlUHJvcHMoeyByZXEsIHJlcyB9OiB7IHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlIH0pIHtcbiAgLy8gTm90aWNlIGhvdyB0aGUgc2VydmVyIHVzZXMgYEFQSWAgZnJvbSBgd2l0aFNTUkNvbnRleHRgLCBpbnN0ZWFkIG9mIHRoZSB0b3AtbGV2ZWwgYEFQSWAuXG4gIC8vIGNvbnN0IFNTUiA9IHdpdGhTU1JDb250ZXh0KHsgcmVxIH0pXG4gIC8vIHRoaXMgcnVucyBvbiB0aGUgYmFja2VuZCwgc28gd2UgbXVzdCBjYWxsIGluaXQgb24gc3VwZXJ0b2tlbnMtbm9kZSBTREtcbiAgc3VwZXJ0b2tlbnNOb2RlLmluaXQoYmFja2VuZENvbmZpZygpKVxuICBsZXQgc2Vzc2lvblxuICB0cnkge1xuICAgIHNlc3Npb24gPSBhd2FpdCBTZXNzaW9uLmdldFNlc3Npb24ocmVxLCByZXMsIHtcbiAgICAgIG92ZXJyaWRlR2xvYmFsQ2xhaW1WYWxpZGF0b3JzOiBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBbXVxuICAgICAgfSxcbiAgICB9KVxuICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgIGlmIChlcnIudHlwZSA9PT0gU2Vzc2lvbi5FcnJvci5UUllfUkVGUkVTSF9UT0tFTikge1xuICAgICAgcmV0dXJuIHsgcHJvcHM6IHsgZnJvbVN1cGVydG9rZW5zOiAnbmVlZHMtcmVmcmVzaCcgfSB9XG4gICAgfSBlbHNlIGlmIChlcnIudHlwZSA9PT0gU2Vzc2lvbi5FcnJvci5VTkFVVEhPUklTRUQpIHtcbiAgICAgIC8vIHRoaXMgd2lsbCBmb3JjZSB0aGUgZnJvbnRlbmQgdG8gdHJ5IGFuZCByZWZyZXNoIHdoaWNoIHdpbGwgZmFpbFxuICAgICAgLy8gY2xlYXJpbmcgYWxsIGNvb2tpZXMgYW5kIHJlZGlyZWN0aW5nIHRoZSB1c2VyIHRvIHRoZSBsb2dpbiBzY3JlZW4uXG4gICAgICByZXR1cm4geyBwcm9wczogeyBmcm9tU3VwZXJ0b2tlbnM6ICduZWVkcy1yZWZyZXNoJyB9IH1cbiAgICB9XG4gICAgdGhyb3cgZXJyXG4gIH1cblxuICBpZiAoIXNlc3Npb24/LmdldFVzZXJJZCgpKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlZGlyZWN0OiB7XG4gICAgICAgIGRlc3RpbmF0aW9uOiAnL1VzZXIvTG9naW4vVXNlckxvZ2luJyxcbiAgICAgICAgcGVybWFuZW50OiBmYWxzZSxcbiAgICAgIH0sXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBwcm9wczoge1xuICAgICAgc3ViOiBzZXNzaW9uLmdldFVzZXJJZCgpLFxuICAgIH1cbiAgfVxufVxuXG50eXBlIFByb3BzID0ge1xuICAgIGZyZXF1ZW5jeTogUmVjdXJyZW5jZUZyZXF1ZW5jeVR5cGUsXG4gICAgaW50ZXJ2YWw6IG51bWJlcixcbiAgICB1bnRpbDogRGF0ZSxcbiAgICBzZXRQYXJlbnRGcmVxdWVuY3k6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPFJlY3VycmVuY2VGcmVxdWVuY3lUeXBlPj4sXG4gICAgc2V0UGFyZW50SW50ZXJ2YWw6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPG51bWJlcj4+LFxuICAgIHNldFBhcmVudFVudGlsOiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxEYXRlPj4sXG59XG5cbmZ1bmN0aW9uIEVkaXRNZWV0aW5nQXNzaXN0UmVjdXJTdGVwQWx0KHByb3BzOiBQcm9wcykge1xuICAgIGNvbnN0IFtmcmVxdWVuY3ksIHNldEZyZXF1ZW5jeV0gPSB1c2VTdGF0ZTxSZWN1cnJlbmNlRnJlcXVlbmN5VHlwZT4ocHJvcHM/LmZyZXF1ZW5jeSlcbiAgICBjb25zdCBbaW50ZXJ2YWwsIHNldEludGVydmFsXSA9IHVzZVN0YXRlPG51bWJlcj4ocHJvcHM/LmludGVydmFsKVxuICAgIGNvbnN0IFt1bnRpbCwgc2V0VW50aWxdID0gdXNlU3RhdGU8RGF0ZT4ocHJvcHM/LnVudGlsKVxuICAgIGNvbnN0IFtpc1JlY3VycmluZywgc2V0SXNSZWN1cnJpbmddID0gdXNlU3RhdGU8Ym9vbGVhbj4oZmFsc2UpXG4gIFxuICAgIGNvbnN0IGRhcmsgPSB1c2VDb2xvclNjaGVtZSgpID09PSAnZGFyaydcblxuICBcbiAgICBjb25zdCBzZXRQYXJlbnRGcmVxdWVuY3kgPSBwcm9wcz8uc2V0UGFyZW50RnJlcXVlbmN5XG4gICAgY29uc3Qgc2V0UGFyZW50SW50ZXJ2YWwgPSBwcm9wcz8uc2V0UGFyZW50SW50ZXJ2YWxcbiAgICBjb25zdCBzZXRQYXJlbnRVbnRpbCA9IHByb3BzPy5zZXRQYXJlbnRVbnRpbFxuICBcbiAgICBjb25zdCBjaGFuZ2VVbnRpbCA9ICh2YWx1ZTogRGF0ZSkgPT4ge1xuICAgICAgc2V0VW50aWwodmFsdWUpXG4gICAgICBzZXRQYXJlbnRVbnRpbCh2YWx1ZSlcbiAgICB9XG4gIFxuICAgIGNvbnN0IGNoYW5nZUZyZXF1ZW5jeSA9ICh2YWx1ZTogUmVjdXJyZW5jZUZyZXF1ZW5jeVR5cGUpID0+IHtcbiAgICAgIHNldEZyZXF1ZW5jeSh2YWx1ZSlcbiAgICAgIHNldFBhcmVudEZyZXF1ZW5jeSh2YWx1ZSlcbiAgICB9XG4gIFxuICAgIGNvbnN0IGNoYW5nZUludGVydmFsID0gKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICAgIHNldEludGVydmFsKHBhcnNlSW50KHZhbHVlLnJlcGxhY2UoL1teMC05Ll0vZywgJycpLCAxMCkpXG4gICAgICBzZXRQYXJlbnRJbnRlcnZhbChwYXJzZUludCh2YWx1ZS5yZXBsYWNlKC9bXjAtOS5dL2csICcnKSwgMTApKVxuICAgIH1cbiAgXG4gICAgY29uc3QgaGlkZVVudGlsUGlja2VyID0gKCkgPT4gc2V0SXNSZWN1cnJpbmcoZmFsc2UpXG4gICAgXG4gICAgY29uc3Qgc2hvd1VudGlsUGlja2VyID0gKCkgPT4gc2V0SXNSZWN1cnJpbmcodHJ1ZSlcbiAgXG4gIHJldHVybiAoXG5cbiAgICAgICAgPEJveCBmbGV4PXsxfSBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBzdHlsZT17eyB3aWR0aDogJzEwMCUnIH19PlxuICAgICAgICAgIDxCb3ggZmxleD17MX0ganVzdGlmeUNvbnRlbnQ9XCJmbGV4LWVuZFwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBzdHlsZT17eyB3aWR0aDogJzkwJSd9fT5cbiAgICAgICAgICAgIDxCb3ggZmxleD17MX0ganVzdGlmeUNvbnRlbnQ9XCJmbGV4LWVuZFwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBzdHlsZT17eyB3aWR0aDogJzEwMCUnfX0+XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJvcHRpb25IZWFkZXJcIj5cbiAgICAgICAgICAgICAgICAgIEVuZCBEYXRlIGZvciBSZWN1cnJlbmNlXG4gICAgICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgICAgICBcbiAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgPElucHV0XG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJTZWxlY3QgRGF0ZSBhbmQgVGltZVwiXG4gICAgICAgICAgICAgICAgc2l6ZT1cIm1kXCJcbiAgICAgICAgICAgICAgICB0eXBlPVwiZGF0ZXRpbWUtbG9jYWxcIlxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNoYW5nZVVudGlsKGRheWpzKGU/LnRhcmdldD8udmFsdWUsIFwiWVlZWS1NTS1ERFRISDptbVwiKS50b0RhdGUoKSlcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIH19IHZhbHVlPXtkYXlqcyh1bnRpbCkuZm9ybWF0KFwiWVlZWS1NTS1ERFRISDptbVwiKX0gLz5cbiAgICAgICAgICAgIFxuICAgICAgICAgIDwvQm94PlxuICAgICAgICAgIDxCb3ggZmxleD17MX0gcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fSBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIj5cbiAgICAgICAgICAgICAgPFRleHQgcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fSB2YXJpYW50PVwiYnV0dG9uTGlua1wiPlxuICAgICAgICAgICAgICAgICAgU2VsZWN0IGhvdyBvZnRlcm4gdG8gcmVjdXI/XG4gICAgICAgIDwvVGV4dD4gXG4gICAgICAgIDxzZWxlY3QgdmFsdWU9e2ZyZXF1ZW5jeX0gb25DaGFuZ2U9eyhlKSA9PiBjaGFuZ2VGcmVxdWVuY3koZT8udGFyZ2V0Py52YWx1ZSBhcyBSZWN1cnJlbmNlRnJlcXVlbmN5VHlwZSl9IGNsYXNzTmFtZT1cInNlbGVjdCBzZWxlY3QtcHJpbWFyeSB3LWZ1bGwgbWF4LXcteHNcIj5cbiAgICAgICAgICA8b3B0aW9uIGRpc2FibGVkIHNlbGVjdGVkPmZyZXF1ZW5jeTwvb3B0aW9uPlxuICAgICAgICAgIHtfLm1hcChmcmVxdWVuY3lPcHRpb25zLCBvcHRpb24gPT4gKFxuICAgICAgICAgICAgICA8b3B0aW9uXG4gICAgICAgICAgICAgICAga2V5PXtvcHRpb24udmFsdWV9XG4gICAgICAgICAgICAgICAgdmFsdWU9e29wdGlvbi52YWx1ZX1cbiAgICAgICAgICAgICAgPntvcHRpb24ubGFiZWx9PC9vcHRpb24+XG4gICAgICAgICAgICApKX1cbiAgICAgICAgPC9zZWxlY3Q+XG4gICAgICAgICAgICAgIFxuICAgICAgICAgIDwvQm94PlxuICAgICAgICAgIDxCb3ggZmxleD17MX0gcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fSBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiAgc3R5bGU9e3sgd2lkdGg6ICcxMDAlJ319PlxuICAgICAgICAgICAgPEJveCBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJmbGV4LXN0YXJ0XCIgc3R5bGU9e3sgd2lkdGg6ICc5MCUnfX0+XG4gICAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJvcHRpb25IZWFkZXJcIj5cbiAgICAgICAgICAgICAgICBJbnRlcnZhbCAoZXg6IGV2ZXJ5IDIgd2Vla3MpXG4gICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgPEJveCBmbGV4PXsxfSBwPXt7IHBob25lOiAncycsIHRhYmxldDogJ20nIH19IGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImZsZXgtZW5kXCIgc3R5bGU9e3sgd2lkdGg6ICc5MCUnIH19PlxuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICA8VGV4dEZpZWxkXG4gICAgICAgICAgICAgICAgICB0eXBlPVwibnVtYmVyXCJcbiAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZTogeyB0YXJnZXQ6IHsgdmFsdWU6IHN0cmluZyB9IH0pID0+IGNoYW5nZUludGVydmFsKGU/LnRhcmdldD8udmFsdWU/LnJlcGxhY2UoL1teMC05Ll0vZywgJycpIHx8ICcwJyl9XG4gICAgICAgICAgICAgICAgICB2YWx1ZT17YCR7aW50ZXJ2YWx9YH1cbiAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiMVwiXG4gICAgICAgICAgICAgICAgICBzdHlsZT17eyB3aWR0aDogJzIwJScgfX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgXG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICA8L0JveD5cbiAgICAgICAgPC9Cb3g+XG4gICAgKVxufVxuXG5leHBvcnQgZGVmYXVsdCBFZGl0TWVldGluZ0Fzc2lzdFJlY3VyU3RlcEFsdFxuXG4iXX0=