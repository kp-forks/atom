"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const react_native_1 = require("react-native");
const TextField_1 = __importDefault(require("@components/TextField"));
// import DatePicker from 'react-native-date-picker'
// import DateTimePicker from 'react-datetime-picker/dist/entry.nostyle'
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const date_utils_1 = require("@lib/date-utils");
const lodash_1 = __importDefault(require("lodash"));
const react_2 = require("@chakra-ui/react");
const frequencyOptions = [
    { label: 'Daily', value: 'daily' },
    { label: 'Weekly', value: 'weekly' },
    { label: 'Monthly', value: 'monthly' },
];
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("../../../config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
function CreateMeetingAssistRecurStepAlt(props) {
    const [frequency, setFrequency] = (0, react_1.useState)(props?.frequency);
    const [interval, setInterval] = (0, react_1.useState)(props?.interval);
    const [until, setUntil] = (0, react_1.useState)(props?.until);
    const [isRecurring, setIsRecurring] = (0, react_1.useState)(false);
    const dark = (0, react_native_1.useColorScheme)() === 'dark';
    const setParentFrequency = props?.setParentFrequency;
    const setParentInterval = props?.setParentInterval;
    const setParentUntil = props?.setParentUntil;
    const changeUntil = (value) => {
        setUntil(value);
        setParentUntil(value);
    };
    const changeFrequency = (value) => {
        setFrequency(value);
        setParentFrequency(value);
    };
    const changeInterval = (value) => {
        setInterval(parseInt(value.replace(/[^0-9.]/g, ''), 10));
        setParentInterval(parseInt(value.replace(/[^0-9.]/g, ''), 10));
    };
    const hideUntilPicker = () => setIsRecurring(false);
    const showUntilPicker = () => setIsRecurring(true);
    return ((0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: [(0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, justifyContent: "flex-end", alignItems: "center", style: { width: '90%' }, children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Until" }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, justifyContent: "flex-end", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(react_2.Input, { placeholder: "Select Date and Time", size: "md", type: "datetime-local", onChange: (e) => {
                                changeUntil((0, date_utils_1.dayjs)(e?.target?.value, "YYYY-MM-DDTHH:mm").toDate());
                            }, value: (0, date_utils_1.dayjs)(until).format("YYYY-MM-DDTHH:mm") }) })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, p: { phone: 's', tablet: 'm' }, justifyContent: "center", alignItems: "center", children: [(0, jsx_runtime_1.jsx)(Text_1.default, { p: { phone: 's', tablet: 'm' }, variant: "optionHeader", children: "Select how oftern to recur?" }), (0, jsx_runtime_1.jsxs)("select", { value: frequency, onChange: (e) => changeFrequency(e?.target?.value), className: "select select-primary w-full max-w-xs", children: [(0, jsx_runtime_1.jsx)("option", { disabled: true, selected: true, children: "frequency" }), lodash_1.default.map(frequencyOptions, option => ((0, jsx_runtime_1.jsx)("option", { value: option.value, children: option.label }, option.value)))] })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, p: { phone: 's', tablet: 'm' }, justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { justifyContent: "center", alignItems: "flex-start", style: { width: '90%' }, children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Interval (ex: every 2 weeks)" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, p: { phone: 's', tablet: 'm' }, justifyContent: "center", alignItems: "flex-end", style: { width: '90%' }, children: (0, jsx_runtime_1.jsx)(TextField_1.default, { type: "number", onChange: (e) => changeInterval(e?.target?.value), value: `${interval}`, placeholder: "1", validate: "number", validationMessage: "Please type a number" }) })] })] }));
}
exports.default = CreateMeetingAssistRecurStepAlt;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ3JlYXRlTWVldGluZ0Fzc2lzdFJlY3VyU3RlcEFsdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkNyZWF0ZU1lZXRpbmdBc3Npc3RSZWN1clN0ZXBBbHQudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBaUNBLGdEQXFDQzs7QUF0RUQsaUNBSWM7QUFDZCwrQ0FBcUc7QUFFckcsc0VBQTZDO0FBQzdDLG9EQUFvRDtBQUNwRCx3RUFBd0U7QUFDeEUsaUVBQXdDO0FBQ3hDLG1FQUEwQztBQUkxQyxnREFBdUM7QUFFdkMsb0RBQXNCO0FBRXRCLDRDQUF5QztBQUd6QyxNQUFNLGdCQUFnQixHQUFHO0lBQ3ZCLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFO0lBQ2xDLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFO0lBQ3BDLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFO0NBQ3ZDLENBQUE7QUFHRCx3RUFBOEM7QUFDOUMsaUVBQTZEO0FBQzdELDhFQUFxRDtBQUU5QyxLQUFLLFVBQVUsa0JBQWtCLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFpRDtJQUNsRywwRkFBMEY7SUFDMUYsc0NBQXNDO0lBQ3RDLHlFQUF5RTtJQUN6RSwwQkFBZSxDQUFDLElBQUksQ0FBQyxJQUFBLDZCQUFhLEdBQUUsQ0FBQyxDQUFBO0lBQ3JDLElBQUksT0FBTyxDQUFBO0lBQ1gsSUFBSSxDQUFDO1FBQ0gsT0FBTyxHQUFHLE1BQU0saUJBQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRTtZQUMzQyw2QkFBNkIsRUFBRSxLQUFLO2dCQUNsQyxPQUFPLEVBQUUsQ0FBQTtZQUNYLENBQUM7U0FDRixDQUFDLENBQUE7SUFDSixDQUFDO0lBQUMsT0FBTyxHQUFRLEVBQUUsQ0FBQztRQUNsQixJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssaUJB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QUFDLEdBQUcsRUFDakIsUUFBUSxFQUFDLFFBQVEsRUFDakIsaUJBQWlCLEVBQUMsc0JBQXNCLEdBQ3BDLEdBRUYsSUFDRixJQUNGLENBQ1AsQ0FBQTtBQUNILENBQUM7QUFFRCxrQkFBZSwrQkFBK0IsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwge1xuICB1c2VTdGF0ZSxcbiAgRGlzcGF0Y2gsXG4gIFNldFN0YXRlQWN0aW9uLFxufSBmcm9tICdyZWFjdCdcbmltcG9ydCB7IFByZXNzYWJsZSwgU3R5bGVTaGVldCwgdXNlQ29sb3JTY2hlbWUsIEtleWJvYXJkQXZvaWRpbmdWaWV3LCBQbGF0Zm9ybSB9IGZyb20gJ3JlYWN0LW5hdGl2ZSc7XG5cbmltcG9ydCBUZXh0RmllbGQgZnJvbSAnQGNvbXBvbmVudHMvVGV4dEZpZWxkJ1xuLy8gaW1wb3J0IERhdGVQaWNrZXIgZnJvbSAncmVhY3QtbmF0aXZlLWRhdGUtcGlja2VyJ1xuLy8gaW1wb3J0IERhdGVUaW1lUGlja2VyIGZyb20gJ3JlYWN0LWRhdGV0aW1lLXBpY2tlci9kaXN0L2VudHJ5Lm5vc3R5bGUnXG5pbXBvcnQgQm94IGZyb20gJ0Bjb21wb25lbnRzL2NvbW1vbi9Cb3gnXG5pbXBvcnQgVGV4dCBmcm9tICdAY29tcG9uZW50cy9jb21tb24vVGV4dCdcblxuaW1wb3J0IHsgcGFsZXR0ZSB9IGZyb20gJ0BsaWIvdGhlbWUvdGhlbWUnXG5cbmltcG9ydCB7IGRheWpzIH0gZnJvbSAnQGxpYi9kYXRlLXV0aWxzJ1xuaW1wb3J0IHsgUmVjdXJyZW5jZUZyZXF1ZW5jeVR5cGUgfSBmcm9tICdAbGliL0NhbGVuZGFyL3R5cGVzJ1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJ1xuXG5pbXBvcnQgeyBJbnB1dCB9IGZyb20gJ0BjaGFrcmEtdWkvcmVhY3QnO1xuXG5cbmNvbnN0IGZyZXF1ZW5jeU9wdGlvbnMgPSBbXG4gIHsgbGFiZWw6ICdEYWlseScsIHZhbHVlOiAnZGFpbHknIH0sXG4gIHsgbGFiZWw6ICdXZWVrbHknLCB2YWx1ZTogJ3dlZWtseScgfSxcbiAgeyBsYWJlbDogJ01vbnRobHknLCB2YWx1ZTogJ21vbnRobHknIH0sXG5dXG5cbmltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcbmltcG9ydCBzdXBlcnRva2Vuc05vZGUgZnJvbSAnc3VwZXJ0b2tlbnMtbm9kZSdcbmltcG9ydCB7IGJhY2tlbmRDb25maWcgfSBmcm9tICcuLi8uLi8uLi9jb25maWcvYmFja2VuZENvbmZpZydcbmltcG9ydCBTZXNzaW9uIGZyb20gJ3N1cGVydG9rZW5zLW5vZGUvcmVjaXBlL3Nlc3Npb24nXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTZXJ2ZXJTaWRlUHJvcHMoeyByZXEsIHJlcyB9OiB7IHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlIH0pIHtcbiAgLy8gTm90aWNlIGhvdyB0aGUgc2VydmVyIHVzZXMgYEFQSWAgZnJvbSBgd2l0aFNTUkNvbnRleHRgLCBpbnN0ZWFkIG9mIHRoZSB0b3AtbGV2ZWwgYEFQSWAuXG4gIC8vIGNvbnN0IFNTUiA9IHdpdGhTU1JDb250ZXh0KHsgcmVxIH0pXG4gIC8vIHRoaXMgcnVucyBvbiB0aGUgYmFja2VuZCwgc28gd2UgbXVzdCBjYWxsIGluaXQgb24gc3VwZXJ0b2tlbnMtbm9kZSBTREtcbiAgc3VwZXJ0b2tlbnNOb2RlLmluaXQoYmFja2VuZENvbmZpZygpKVxuICBsZXQgc2Vzc2lvblxuICB0cnkge1xuICAgIHNlc3Npb24gPSBhd2FpdCBTZXNzaW9uLmdldFNlc3Npb24ocmVxLCByZXMsIHtcbiAgICAgIG92ZXJyaWRlR2xvYmFsQ2xhaW1WYWxpZGF0b3JzOiBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBbXVxuICAgICAgfSxcbiAgICB9KVxuICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgIGlmIChlcnIudHlwZSA9PT0gU2Vzc2lvbi5FcnJvci5UUllfUkVGUkVTSF9UT0tFTikge1xuICAgICAgcmV0dXJuIHsgcHJvcHM6IHsgZnJvbVN1cGVydG9rZW5zOiAnbmVlZHMtcmVmcmVzaCcgfSB9XG4gICAgfSBlbHNlIGlmIChlcnIudHlwZSA9PT0gU2Vzc2lvbi5FcnJvci5VTkFVVEhPUklTRUQpIHtcbiAgICAgIC8vIHRoaXMgd2lsbCBmb3JjZSB0aGUgZnJvbnRlbmQgdG8gdHJ5IGFuZCByZWZyZXNoIHdoaWNoIHdpbGwgZmFpbFxuICAgICAgLy8gY2xlYXJpbmcgYWxsIGNvb2tpZXMgYW5kIHJlZGlyZWN0aW5nIHRoZSB1c2VyIHRvIHRoZSBsb2dpbiBzY3JlZW4uXG4gICAgICByZXR1cm4geyBwcm9wczogeyBmcm9tU3VwZXJ0b2tlbnM6ICduZWVkcy1yZWZyZXNoJyB9IH1cbiAgICB9XG4gICAgdGhyb3cgZXJyXG4gIH1cblxuICBpZiAoIXNlc3Npb24/LmdldFVzZXJJZCgpKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlZGlyZWN0OiB7XG4gICAgICAgIGRlc3RpbmF0aW9uOiAnL1VzZXIvTG9naW4vVXNlckxvZ2luJyxcbiAgICAgICAgcGVybWFuZW50OiBmYWxzZSxcbiAgICAgIH0sXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBwcm9wczoge1xuICAgICAgc3ViOiBzZXNzaW9uLmdldFVzZXJJZCgpLFxuICAgIH1cbiAgfVxufVxuXG50eXBlIFByb3BzID0ge1xuICBmcmVxdWVuY3k6IFJlY3VycmVuY2VGcmVxdWVuY3lUeXBlLFxuICBpbnRlcnZhbDogbnVtYmVyLFxuICB1bnRpbDogRGF0ZSxcbiAgc2V0UGFyZW50RnJlcXVlbmN5OiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxSZWN1cnJlbmNlRnJlcXVlbmN5VHlwZT4+LFxuICBzZXRQYXJlbnRJbnRlcnZhbDogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248bnVtYmVyPj4sXG4gIHNldFBhcmVudFVudGlsOiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxEYXRlPj4sXG59XG5cbmZ1bmN0aW9uIENyZWF0ZU1lZXRpbmdBc3Npc3RSZWN1clN0ZXBBbHQocHJvcHM6IFByb3BzKSB7XG4gIGNvbnN0IFtmcmVxdWVuY3ksIHNldEZyZXF1ZW5jeV0gPSB1c2VTdGF0ZTxSZWN1cnJlbmNlRnJlcXVlbmN5VHlwZT4ocHJvcHM/LmZyZXF1ZW5jeSlcbiAgY29uc3QgW2ludGVydmFsLCBzZXRJbnRlcnZhbF0gPSB1c2VTdGF0ZTxudW1iZXI+KHByb3BzPy5pbnRlcnZhbClcbiAgY29uc3QgW3VudGlsLCBzZXRVbnRpbF0gPSB1c2VTdGF0ZTxEYXRlPihwcm9wcz8udW50aWwpXG4gIGNvbnN0IFtpc1JlY3VycmluZywgc2V0SXNSZWN1cnJpbmddID0gdXNlU3RhdGU8Ym9vbGVhbj4oZmFsc2UpXG5cbiAgY29uc3QgZGFyayA9IHVzZUNvbG9yU2NoZW1lKCkgPT09ICdkYXJrJ1xuXG5cbiAgY29uc3Qgc2V0UGFyZW50RnJlcXVlbmN5ID0gcHJvcHM/LnNldFBhcmVudEZyZXF1ZW5jeVxuICBjb25zdCBzZXRQYXJlbnRJbnRlcnZhbCA9IHByb3BzPy5zZXRQYXJlbnRJbnRlcnZhbFxuICBjb25zdCBzZXRQYXJlbnRVbnRpbCA9IHByb3BzPy5zZXRQYXJlbnRVbnRpbFxuXG4gIGNvbnN0IGNoYW5nZVVudGlsID0gKHZhbHVlOiBEYXRlKSA9PiB7XG4gICAgc2V0VW50aWwodmFsdWUpXG4gICAgc2V0UGFyZW50VW50aWwodmFsdWUpXG4gIH1cblxuICBjb25zdCBjaGFuZ2VGcmVxdWVuY3kgPSAodmFsdWU6IFJlY3VycmVuY2VGcmVxdWVuY3lUeXBlKSA9PiB7XG4gICAgc2V0RnJlcXVlbmN5KHZhbHVlKVxuICAgIHNldFBhcmVudEZyZXF1ZW5jeSh2YWx1ZSlcbiAgfVxuXG4gIGNvbnN0IGNoYW5nZUludGVydmFsID0gKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICBzZXRJbnRlcnZhbChwYXJzZUludCh2YWx1ZS5yZXBsYWNlKC9bXjAtOS5dL2csICcnKSwgMTApKVxuICAgIHNldFBhcmVudEludGVydmFsKHBhcnNlSW50KHZhbHVlLnJlcGxhY2UoL1teMC05Ll0vZywgJycpLCAxMCkpXG4gIH1cblxuICBjb25zdCBoaWRlVW50aWxQaWNrZXIgPSAoKSA9PiBzZXRJc1JlY3VycmluZyhmYWxzZSlcbiAgXG4gIGNvbnN0IHNob3dVbnRpbFBpY2tlciA9ICgpID0+IHNldElzUmVjdXJyaW5nKHRydWUpXG5cbiAgcmV0dXJuIChcbiAgICA8Qm94IGZsZXg9ezF9IGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnMTAwJScgfX0+XG4gICAgICA8Qm94IGZsZXg9ezF9IGp1c3RpZnlDb250ZW50PVwiZmxleC1lbmRcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgc3R5bGU9e3sgd2lkdGg6ICc5MCUnIH19PlxuICAgICAgICA8VGV4dCB2YXJpYW50PVwib3B0aW9uSGVhZGVyXCI+XG4gICAgICAgICAgVW50aWxcbiAgICAgICAgPC9UZXh0PlxuICAgICAgICA8Qm94IGZsZXg9ezF9IGp1c3RpZnlDb250ZW50PVwiZmxleC1lbmRcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgc3R5bGU9e3sgd2lkdGg6ICcxMDAlJ319PlxuICAgICAgICAgPElucHV0XG4gICAgICAgICAgICBwbGFjZWhvbGRlcj1cIlNlbGVjdCBEYXRlIGFuZCBUaW1lXCJcbiAgICAgICAgICAgIHNpemU9XCJtZFwiXG4gICAgICAgICAgICB0eXBlPVwiZGF0ZXRpbWUtbG9jYWxcIlxuICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiB7XG4gICAgICAgICAgICAgIGNoYW5nZVVudGlsKGRheWpzKGU/LnRhcmdldD8udmFsdWUsIFwiWVlZWS1NTS1ERFRISDptbVwiKS50b0RhdGUoKSlcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgICB2YWx1ZT17ZGF5anModW50aWwpLmZvcm1hdChcIllZWVktTU0tRERUSEg6bW1cIil9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9Cb3g+XG4gICAgICA8L0JveD5cbiAgICAgIDxCb3ggZmxleD17MX0gcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fSBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIj5cbiAgICAgICAgICA8VGV4dCBwPXt7IHBob25lOiAncycsIHRhYmxldDogJ20nIH19IHZhcmlhbnQ9XCJvcHRpb25IZWFkZXJcIj5cbiAgICAgICAgICAgICAgU2VsZWN0IGhvdyBvZnRlcm4gdG8gcmVjdXI/XG4gICAgICAgIDwvVGV4dD5cbiAgICAgICAgPHNlbGVjdCB2YWx1ZT17ZnJlcXVlbmN5fSBvbkNoYW5nZT17KGUpID0+IGNoYW5nZUZyZXF1ZW5jeShlPy50YXJnZXQ/LnZhbHVlIGFzIFJlY3VycmVuY2VGcmVxdWVuY3lUeXBlKX0gY2xhc3NOYW1lPVwic2VsZWN0IHNlbGVjdC1wcmltYXJ5IHctZnVsbCBtYXgtdy14c1wiPlxuICAgICAgICAgIDxvcHRpb24gZGlzYWJsZWQgc2VsZWN0ZWQ+ZnJlcXVlbmN5PC9vcHRpb24+XG4gICAgICAgICAge18ubWFwKGZyZXF1ZW5jeU9wdGlvbnMsIG9wdGlvbiA9PiAoXG4gICAgICAgICAgICAgIDxvcHRpb25cbiAgICAgICAgICAgICAgICBrZXk9e29wdGlvbi52YWx1ZX1cbiAgICAgICAgICAgICAgICB2YWx1ZT17b3B0aW9uLnZhbHVlfVxuICAgICAgICAgICAgICA+e29wdGlvbi5sYWJlbH08L29wdGlvbj5cbiAgICAgICAgICAgICkpfVxuICAgICAgICA8L3NlbGVjdD5cbiAgICAgIDwvQm94PlxuICAgICAgPEJveCBmbGV4PXsxfSBwPXt7IHBob25lOiAncycsIHRhYmxldDogJ20nIH19ICAganVzdGlmeUNvbnRlbnQ9XCJjZW50ZXJcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgIHN0eWxlPXt7IHdpZHRoOiAnMTAwJSd9fT5cbiAgICAgICAgPEJveCBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJmbGV4LXN0YXJ0XCIgc3R5bGU9e3sgd2lkdGg6ICc5MCUnfX0+XG4gICAgICAgICAgPFRleHQgdmFyaWFudD1cIm9wdGlvbkhlYWRlclwiPlxuICAgICAgICAgICAgSW50ZXJ2YWwgKGV4OiBldmVyeSAyIHdlZWtzKVxuICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgPC9Cb3g+XG4gICAgICAgIDxCb3ggZmxleD17MX0gcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fSBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJmbGV4LWVuZFwiIHN0eWxlPXt7IHdpZHRoOiAnOTAlJyB9fT5cbiAgICAgICAgICBcbiAgICAgICAgICAgIDxUZXh0RmllbGRcbiAgICAgICAgICAgICAgdHlwZT1cIm51bWJlclwiXG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZTogYW55KSA9PiBjaGFuZ2VJbnRlcnZhbChlPy50YXJnZXQ/LnZhbHVlKX1cbiAgICAgICAgICAgICAgdmFsdWU9e2Ake2ludGVydmFsfWB9XG4gICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiMVwiXG4gICAgICAgICAgICB2YWxpZGF0ZT1cIm51bWJlclwiXG4gICAgICAgICAgICB2YWxpZGF0aW9uTWVzc2FnZT1cIlBsZWFzZSB0eXBlIGEgbnVtYmVyXCJcbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICBcbiAgICAgICAgPC9Cb3g+XG4gICAgICA8L0JveD5cbiAgICA8L0JveD5cbiAgKVxufVxuXG5leHBvcnQgZGVmYXVsdCBDcmVhdGVNZWV0aW5nQXNzaXN0UmVjdXJTdGVwQWx0XG5cbiJdfQ==