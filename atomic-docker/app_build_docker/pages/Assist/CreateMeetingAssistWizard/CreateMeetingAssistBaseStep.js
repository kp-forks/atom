"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const date_utils_1 = require("@lib/date-utils");
// import DatePicker from 'react-native-date-picker'
// import DateTimePicker from 'react-datetime-picker/dist/entry.nostyle'
const TextField_1 = __importDefault(require("@components/TextField"));
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const react_native_1 = require("react-native");
const react_2 = require("@chakra-ui/react");
const react_3 = require("@chakra-ui/react");
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("../../../config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
function CreateMeetingAssistBaseStep(props) {
    const [notes, setNotes] = (0, react_1.useState)(props?.notes);
    const [summary, setSummary] = (0, react_1.useState)(props?.summary);
    const [windowStartDate, setWindowStartDate] = (0, react_1.useState)(props?.windowStartDate);
    const [windowEndDate, setWindowEndDate] = (0, react_1.useState)(props?.windowEndDate);
    const [location, setLocation] = (0, react_1.useState)(props?.location);
    const [isStartDatePickerVisible, setIsStartDatePickerVisible] = (0, react_1.useState)(false);
    const [isEndDatePickerVisible, setIsEndDatePickerVisible] = (0, react_1.useState)(false);
    const [pageOffset, setPageOffset] = (0, react_1.useState)(0);
    const { height: fullHeight } = react_native_1.Dimensions.get('window');
    const setParentNotes = props?.setParentNotes;
    const setParentSummary = props?.setParentSummary;
    const setParentWindowStartDate = props?.setParentWindowStartDate;
    const setParentWindowEndDate = props?.setParentWindowEndDate;
    const setParentLocation = props?.setParentLocation;
    const toast = (0, react_2.useToast)();
    const changeNotes = (value) => {
        setNotes(value);
        setParentNotes(value);
    };
    const changeSummary = (value) => {
        setSummary(value);
        setParentSummary(value);
    };
    const changeWindowStartDate = (value) => {
        setWindowStartDate(value);
        setParentWindowStartDate(value);
    };
    const changeWindowEndDate = (value) => {
        setWindowEndDate(value);
        setParentWindowEndDate(value);
    };
    const changeLocation = (value) => {
        setLocation(value);
        setParentLocation(value);
    };
    const showStartDatePicker = () => {
        setIsStartDatePickerVisible(true);
    };
    const hideStartDatePicker = () => {
        setIsStartDatePickerVisible(false);
    };
    const showEndDatePicker = () => {
        setIsEndDatePickerVisible(true);
    };
    const hideEndDatePicker = () => {
        setIsEndDatePickerVisible(false);
    };
    return ((0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, style: { width: '100%' }, minHeight: "65vh", maxHeight: "65vh", children: (0, jsx_runtime_1.jsxs)(react_native_1.ScrollView, { style: { flex: 1, width: '100%' }, contentContainerStyle: { alignItems: 'center' }, children: [(0, jsx_runtime_1.jsx)(Text_1.default, { p: { phone: 's', tablet: 'm' }, variant: "optionHeader", style: { width: '80%' }, children: "Provide a time window for scheduling a meeting" }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, p: { phone: 's', tablet: 'm' }, style: { width: '80%' }, children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Start" }), (0, jsx_runtime_1.jsx)(react_3.Input, { placeholder: "Select Date and Time", size: "md", type: "datetime-local", onChange: (e) => {
                                const durationMinutes = date_utils_1.dayjs.duration((0, date_utils_1.dayjs)(windowEndDate).diff((0, date_utils_1.dayjs)(windowStartDate))).asMinutes();
                                const newEndDate = (0, date_utils_1.dayjs)(e?.target?.value, "YYYY-MM-DDTHH:mm").add(durationMinutes, 'minutes').toDate();
                                changeWindowStartDate((0, date_utils_1.dayjs)(e?.target?.value, "YYYY-MM-DDTHH:mm").toDate());
                                changeWindowEndDate(newEndDate);
                            }, value: (0, date_utils_1.dayjs)(windowStartDate).format("YYYY-MM-DDTHH:mm") })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, p: { phone: 's', tablet: 'm' }, style: { width: '80%' }, children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "End" }), (0, jsx_runtime_1.jsx)(react_3.Input, { placeholder: "Select Date and Time", size: "md", type: "datetime-local", onChange: (e) => {
                                const days = (0, date_utils_1.dayjs)(e?.target?.value, "YYYY-MM-DDTHH:mm").diff(windowStartDate, 'd');
                                console.log(days, ' days');
                                if (days > 6) {
                                    toast({
                                        status: 'info',
                                        title: 'Window too long',
                                        description: 'Time window cannot be longer than 7 days long',
                                        duration: 9000,
                                        isClosable: true,
                                    });
                                    changeWindowEndDate((0, date_utils_1.dayjs)(windowStartDate).add(6, 'd').hour(19).toDate());
                                    return;
                                }
                                const hours = (0, date_utils_1.dayjs)(e?.target?.value).diff(windowStartDate, 'h');
                                if (hours < 2) {
                                    toast({
                                        status: 'info',
                                        title: 'Window too short',
                                        description: 'Time window should be at least 2 hours long',
                                        duration: 9000,
                                        isClosable: true,
                                    });
                                    changeWindowEndDate((0, date_utils_1.dayjs)(windowStartDate).add(2, 'h').toDate());
                                    return;
                                }
                                changeWindowEndDate((0, date_utils_1.dayjs)(e?.target?.value).toDate());
                            }, value: (0, date_utils_1.dayjs)(windowEndDate).format("YYYY-MM-DDTHH:mm") })] }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, p: { phone: 's', tablet: 'm' }, flexDirection: "row", justifyContent: "flex-start", alignItems: "center", style: { width: '80%' }, children: (0, jsx_runtime_1.jsx)(Box_1.default, { children: (0, jsx_runtime_1.jsx)(TextField_1.default, { label: "Title", placeholder: "title", multiline: true, numberOfLines: 4, onChange: (e) => changeSummary(e?.target?.value), value: summary || props?.summary, style: { width: '100%' } }) }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, p: { phone: 's', tablet: 'm' }, flexDirection: "row", justifyContent: "flex-start", alignItems: "center", style: { width: '80%' }, children: (0, jsx_runtime_1.jsx)(TextField_1.default, { label: "Notes", multiline: true, numberOfLines: 4, onChange: (e) => changeNotes(e?.target?.value), value: notes || props?.notes, style: { width: '100%' } }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, p: { phone: 's', tablet: 'm' }, flexDirection: "row", justifyContent: "flex-start", alignItems: "center", style: { width: '80%' }, children: (0, jsx_runtime_1.jsx)(TextField_1.default, { label: "Location", placeholder: "location if any", onChange: (e) => changeLocation(e?.target?.value), value: location || props?.location, style: { width: '100%' } }) })] }) }));
}
exports.default = CreateMeetingAssistBaseStep;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ3JlYXRlTWVldGluZ0Fzc2lzdEJhc2VTdGVwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQ3JlYXRlTWVldGluZ0Fzc2lzdEJhc2VTdGVwLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQXNCQSxnREFxQ0M7O0FBM0RELGlDQUljO0FBRWQsZ0RBQXVDO0FBQ3ZDLG9EQUFvRDtBQUNwRCx3RUFBd0U7QUFDeEUsc0VBQTZDO0FBQzdDLGlFQUF3QztBQUN4QyxtRUFBMEM7QUFFMUMsK0NBQXdGO0FBQ3hGLDRDQUEyQztBQUUzQyw0Q0FBd0M7QUFFeEMsd0VBQThDO0FBQzlDLGlFQUE2RDtBQUM3RCw4RUFBcUQ7QUFFOUMsS0FBSyxVQUFVLGtCQUFrQixDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBaUQ7SUFDbEcsMEZBQTBGO0lBQzFGLHNDQUFzQztJQUN0Qyx5RUFBeUU7SUFDekUsMEJBQWUsQ0FBQyxJQUFJLENBQUMsSUFBQSw2QkFBYSxHQUFFLENBQUMsQ0FBQTtJQUNyQyxJQUFJLE9BQU8sQ0FBQTtJQUNYLElBQUksQ0FBQztRQUNILE9BQU8sR0FBRyxNQUFNLGlCQUFPLENBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUU7WUFDM0MsNkJBQTZCLEVBQUUsS0FBSztnQkFDbEMsT0FBTyxFQUFFLENBQUE7WUFDWCxDQUFDO1NBQ0YsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUFDLE9BQU8sR0FBUSxFQUFFLENBQUM7UUFDbEIsSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLGlCQUFPLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDakQsT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFLGVBQWUsRUFBRSxlQUFlLEVBQUUsRUFBRSxDQUFBO1FBQ3hELENBQUM7YUFBTSxJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssaUJBQU8sQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDbkQsa0VBQWtFO1lBQ2xFLHFF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aW1wb3J0IFJlYWN0LCB7XG4gIHVzZVN0YXRlLFxuICBEaXNwYXRjaCxcbiAgU2V0U3RhdGVBY3Rpb24sXG59IGZyb20gJ3JlYWN0J1xuXG5pbXBvcnQgeyBkYXlqcyB9IGZyb20gJ0BsaWIvZGF0ZS11dGlscydcbi8vIGltcG9ydCBEYXRlUGlja2VyIGZyb20gJ3JlYWN0LW5hdGl2ZS1kYXRlLXBpY2tlcidcbi8vIGltcG9ydCBEYXRlVGltZVBpY2tlciBmcm9tICdyZWFjdC1kYXRldGltZS1waWNrZXIvZGlzdC9lbnRyeS5ub3N0eWxlJ1xuaW1wb3J0IFRleHRGaWVsZCBmcm9tICdAY29tcG9uZW50cy9UZXh0RmllbGQnXG5pbXBvcnQgQm94IGZyb20gJ0Bjb21wb25lbnRzL2NvbW1vbi9Cb3gnXG5pbXBvcnQgVGV4dCBmcm9tICdAY29tcG9uZW50cy9jb21tb24vVGV4dCdcblxuaW1wb3J0IHsgQXBwZWFyYW5jZSwgRGltZW5zaW9ucywgUHJlc3NhYmxlLCBTY3JvbGxWaWV3LCBTdHlsZVNoZWV0IH0gZnJvbSAncmVhY3QtbmF0aXZlJ1xuaW1wb3J0IHsgdXNlVG9hc3QgfSBmcm9tICdAY2hha3JhLXVpL3JlYWN0J1xuXG5pbXBvcnQgeyBJbnB1dCB9IGZyb20gJ0BjaGFrcmEtdWkvcmVhY3QnXG5pbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgc3VwZXJ0b2tlbnNOb2RlIGZyb20gJ3N1cGVydG9rZW5zLW5vZGUnXG5pbXBvcnQgeyBiYWNrZW5kQ29uZmlnIH0gZnJvbSAnLi4vLi4vLi4vY29uZmlnL2JhY2tlbmRDb25maWcnXG5pbXBvcnQgU2Vzc2lvbiBmcm9tICdzdXBlcnRva2Vucy1ub2RlL3JlY2lwZS9zZXNzaW9uJ1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2VydmVyU2lkZVByb3BzKHsgcmVxLCByZXMgfTogeyByZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSB9KSB7XG4gIC8vIE5vdGljZSBob3cgdGhlIHNlcnZlciB1c2VzIGBBUElgIGZyb20gYHdpdGhTU1JDb250ZXh0YCwgaW5zdGVhZCBvZiB0aGUgdG9wLWxldmVsIGBBUElgLlxuICAvLyBjb25zdCBTU1IgPSB3aXRoU1NSQ29udGV4dCh7IHJlcSB9KVxuICAvLyB0aGlzIHJ1bnMgb24gdGhlIGJhY2tlbmQsIHNvIHdlIG11c3QgY2FsbCBpbml0IG9uIHN1cGVydG9rZW5zLW5vZGUgU0RLXG4gIHN1cGVydG9rZW5zTm9kZS5pbml0KGJhY2tlbmRDb25maWcoKSlcbiAgbGV0IHNlc3Npb25cbiAgdHJ5IHtcbiAgICBzZXNzaW9uID0gYXdhaXQgU2Vzc2lvbi5nZXRTZXNzaW9uKHJlcSwgcmVzLCB7XG4gICAgICBvdmVycmlkZUdsb2JhbENsYWltVmFsaWRhdG9yczogYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gW11cbiAgICAgIH0sXG4gICAgfSlcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICBpZiAoZXJyLnR5cGUgPT09IFNlc3Npb24uRXJyb3IuVFJZX1JFRlJFU0hfVE9LRU4pIHtcbiAgICAgIHJldHVybiB7IHByb3BzOiB7IGZyb21TdXBlcnRva2VuczogJ25lZWRzLXJlZnJlc2gnIH0gfVxuICAgIH0gZWxzZSBpZiAoZXJyLnR5cGUgPT09IFNlc3Npb24uRXJyb3IuVU5BVVRIT1JJU0VEKSB7XG4gICAgICAvLyB0aGlzIHdpbGwgZm9yY2UgdGhlIGZyb250ZW5kIHRvIHRyeSBhbmQgcmVmcmVzaCB3aGljaCB3aWxsIGZhaWxcbiAgICAgIC8vIGNsZWFyaW5nIGFsbCBjb29raWVzIGFuZCByZWRpcmVjdGluZyB0aGUgdXNlciB0byB0aGUgbG9naW4gc2NyZWVuLlxuICAgICAgcmV0dXJuIHsgcHJvcHM6IHsgZnJvbVN1cGVydG9rZW5zOiAnbmVlZHMtcmVmcmVzaCcgfSB9XG4gICAgfVxuICAgIHRocm93IGVyclxuICB9XG5cbiAgaWYgKCFzZXNzaW9uPy5nZXRVc2VySWQoKSkge1xuICAgIHJldHVybiB7XG4gICAgICByZWRpcmVjdDoge1xuICAgICAgICBkZXN0aW5hdGlvbjogJy9Vc2VyL0xvZ2luL1VzZXJMb2dpbicsXG4gICAgICAgIHBlcm1hbmVudDogZmFsc2UsXG4gICAgICB9LFxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgcHJvcHM6IHtcbiAgICAgIHN1Yjogc2Vzc2lvbi5nZXRVc2VySWQoKSxcbiAgICB9XG4gIH1cbn1cblxuXG50eXBlIFByb3BzID0ge1xuICAgIG5vdGVzOiBzdHJpbmcsXG4gICAgc3VtbWFyeTogc3RyaW5nLFxuICAgIHdpbmRvd1N0YXJ0RGF0ZTogRGF0ZSxcbiAgICB3aW5kb3dFbmREYXRlOiBEYXRlLFxuICAgIGxvY2F0aW9uOiBzdHJpbmcsXG4gICAgc2V0UGFyZW50Tm90ZXM6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPHN0cmluZz4+LFxuICAgIHNldFBhcmVudFN1bW1hcnk6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPHN0cmluZz4+LFxuICAgIHNldFBhcmVudFdpbmRvd1N0YXJ0RGF0ZTogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248RGF0ZT4+LFxuICAgIHNldFBhcmVudFdpbmRvd0VuZERhdGU6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPERhdGU+PixcbiAgICBzZXRQYXJlbnRMb2NhdGlvbjogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248c3RyaW5nPj4sXG59XG5cblxuXG5mdW5jdGlvbiBDcmVhdGVNZWV0aW5nQXNzaXN0QmFzZVN0ZXAocHJvcHM6IFByb3BzKSB7XG4gICAgY29uc3QgW25vdGVzLCBzZXROb3Rlc10gPSB1c2VTdGF0ZTxzdHJpbmc+KHByb3BzPy5ub3RlcylcbiAgICBjb25zdCBbc3VtbWFyeSwgc2V0U3VtbWFyeV0gPSB1c2VTdGF0ZTxzdHJpbmc+KHByb3BzPy5zdW1tYXJ5KVxuICAgIGNvbnN0IFt3aW5kb3dTdGFydERhdGUsIHNldFdpbmRvd1N0YXJ0RGF0ZV0gPSB1c2VTdGF0ZTxEYXRlPihwcm9wcz8ud2luZG93U3RhcnREYXRlKVxuICAgIGNvbnN0IFt3aW5kb3dFbmREYXRlLCBzZXRXaW5kb3dFbmREYXRlXSA9IHVzZVN0YXRlPERhdGU+KHByb3BzPy53aW5kb3dFbmREYXRlKVxuICAgIGNvbnN0IFtsb2NhdGlvbiwgc2V0TG9jYXRpb25dID0gdXNlU3RhdGU8c3RyaW5nPihwcm9wcz8ubG9jYXRpb24pXG4gICAgY29uc3QgW2lzU3RhcnREYXRlUGlja2VyVmlzaWJsZSwgc2V0SXNTdGFydERhdGVQaWNrZXJWaXNpYmxlXSA9IHVzZVN0YXRlPGJvb2xlYW4+KGZhbHNlKVxuICAgIGNvbnN0IFtpc0VuZERhdGVQaWNrZXJWaXNpYmxlLCBzZXRJc0VuZERhdGVQaWNrZXJWaXNpYmxlXSA9IHVzZVN0YXRlPGJvb2xlYW4+KGZhbHNlKVxuICAgIGNvbnN0IFtwYWdlT2Zmc2V0LCBzZXRQYWdlT2Zmc2V0XSA9IHVzZVN0YXRlPG51bWJlcj4oMClcblxuICAgIGNvbnN0IHsgaGVpZ2h0OiBmdWxsSGVpZ2h0IH0gPSBEaW1lbnNpb25zLmdldCgnd2luZG93JylcblxuICAgIGNvbnN0IHNldFBhcmVudE5vdGVzID0gcHJvcHM/LnNldFBhcmVudE5vdGVzXG4gICAgY29uc3Qgc2V0UGFyZW50U3VtbWFyeSA9IHByb3BzPy5zZXRQYXJlbnRTdW1tYXJ5XG4gICAgY29uc3Qgc2V0UGFyZW50V2luZG93U3RhcnREYXRlID0gcHJvcHM/LnNldFBhcmVudFdpbmRvd1N0YXJ0RGF0ZVxuICAgIGNvbnN0IHNldFBhcmVudFdpbmRvd0VuZERhdGUgPSBwcm9wcz8uc2V0UGFyZW50V2luZG93RW5kRGF0ZVxuICAgIGNvbnN0IHNldFBhcmVudExvY2F0aW9uID0gcHJvcHM/LnNldFBhcmVudExvY2F0aW9uXG4gICAgY29uc3QgdG9hc3QgPSB1c2VUb2FzdCgpXG5cblxuICAgIGNvbnN0IGNoYW5nZU5vdGVzID0gKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgc2V0Tm90ZXModmFsdWUpXG4gICAgICAgIHNldFBhcmVudE5vdGVzKHZhbHVlKVxuICAgIH1cblxuICAgIGNvbnN0IGNoYW5nZVN1bW1hcnkgPSAodmFsdWU6IHN0cmluZykgPT4ge1xuICAgICAgICBzZXRTdW1tYXJ5KHZhbHVlKVxuICAgICAgICBzZXRQYXJlbnRTdW1tYXJ5KHZhbHVlKVxuICAgIH1cblxuICAgIGNvbnN0IGNoYW5nZVdpbmRvd1N0YXJ0RGF0ZSA9ICh2YWx1ZTogRGF0ZSkgPT4ge1xuICAgICAgICBzZXRXaW5kb3dTdGFydERhdGUodmFsdWUpXG4gICAgICAgIHNldFBhcmVudFdpbmRvd1N0YXJ0RGF0ZSh2YWx1ZSlcbiAgICB9XG5cbiAgICBjb25zdCBjaGFuZ2VXaW5kb3dFbmREYXRlID0gKHZhbHVlOiBEYXRlKSA9PiB7XG4gICAgICAgIHNldFdpbmRvd0VuZERhdGUodmFsdWUpXG4gICAgICAgIHNldFBhcmVudFdpbmRvd0VuZERhdGUodmFsdWUpXG4gICAgfVxuXG4gICAgY29uc3QgY2hhbmdlTG9jYXRpb24gPSAodmFsdWU6IHN0cmluZykgPT4ge1xuICAgICAgICBzZXRMb2NhdGlvbih2YWx1ZSlcbiAgICAgICAgc2V0UGFyZW50TG9jYXRpb24odmFsdWUpXG4gICAgfVxuXG4gICAgY29uc3Qgc2hvd1N0YXJ0RGF0ZVBpY2tlciA9ICgpID0+IHtcbiAgICAgICAgc2V0SXNTdGFydERhdGVQaWNrZXJWaXNpYmxlKHRydWUpXG4gICAgfVxuXG4gICAgY29uc3QgaGlkZVN0YXJ0RGF0ZVBpY2tlciA9ICgpID0+IHtcbiAgICAgICAgc2V0SXNTdGFydERhdGVQaWNrZXJWaXNpYmxlKGZhbHNlKVxuICAgIH1cblxuICAgIGNvbnN0IHNob3dFbmREYXRlUGlja2VyID0gKCkgPT4ge1xuICAgICAgICBzZXRJc0VuZERhdGVQaWNrZXJWaXNpYmxlKHRydWUpXG4gICAgfVxuXG4gICAgY29uc3QgaGlkZUVuZERhdGVQaWNrZXIgPSAoKSA9PiB7XG4gICAgICAgIHNldElzRW5kRGF0ZVBpY2tlclZpc2libGUoZmFsc2UpXG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgICAgPEJveCBmbGV4PXsxfSBzdHlsZT17eyB3aWR0aDogJzEwMCUnIH19IG1pbkhlaWdodD1cIjY1dmhcIiBtYXhIZWlnaHQ9XCI2NXZoXCI+XG5cbiAgICAgICAgICAgIDxTY3JvbGxWaWV3IHN0eWxlPXt7IGZsZXg6IDEsIHdpZHRoOiAnMTAwJScgfX0gIGNvbnRlbnRDb250YWluZXJTdHlsZT17eyBhbGlnbkl0ZW1zOiAnY2VudGVyJ319PlxuICAgICAgICAgICAgICAgIDxUZXh0IHA9e3sgcGhvbmU6ICdzJywgdGFibGV0OiAnbScgfX0gdmFyaWFudD1cIm9wdGlvbkhlYWRlclwiIHN0eWxlPXt7IHdpZHRoOiAnODAlJ319PlxuICAgICAgICAgICAgICAgICAgICBQcm92aWRlIGEgdGltZSB3aW5kb3cgZm9yIHNjaGVkdWxpbmcgYSBtZWV0aW5nXG4gICAgICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgICAgICAgIDxCb3ggZmxleD17MX0gcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fSBzdHlsZT17eyB3aWR0aDogJzgwJScgfX0+XG4gICAgICAgICAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJvcHRpb25IZWFkZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGFydFxuICAgICAgICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICAgICAgICAgIDxJbnB1dFxuICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJTZWxlY3QgRGF0ZSBhbmQgVGltZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplPVwibWRcIlxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cImRhdGV0aW1lLWxvY2FsXCIgb25DaGFuZ2U9eyhlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZHVyYXRpb25NaW51dGVzID0gZGF5anMuZHVyYXRpb24oZGF5anMod2luZG93RW5kRGF0ZSkuZGlmZihkYXlqcyh3aW5kb3dTdGFydERhdGUpKSkuYXNNaW51dGVzKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdFbmREYXRlID0gZGF5anMoZT8udGFyZ2V0Py52YWx1ZSwgXCJZWVlZLU1NLUREVEhIOm1tXCIpLmFkZChkdXJhdGlvbk1pbnV0ZXMsICdtaW51dGVzJykudG9EYXRlKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VXaW5kb3dTdGFydERhdGUoZGF5anMoZT8udGFyZ2V0Py52YWx1ZSwgXCJZWVlZLU1NLUREVEhIOm1tXCIpLnRvRGF0ZSgpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZVdpbmRvd0VuZERhdGUobmV3RW5kRGF0ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfX0gdmFsdWU9e2RheWpzKHdpbmRvd1N0YXJ0RGF0ZSkuZm9ybWF0KFwiWVlZWS1NTS1ERFRISDptbVwiKX0gLz5cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgPEJveCBmbGV4PXsxfSBwPXt7IHBob25lOiAncycsIHRhYmxldDogJ20nIH19IHN0eWxlPXt7IHdpZHRoOiAnODAlJ319PlxuICAgICAgICAgICAgICAgICAgICA8VGV4dCB2YXJpYW50PVwib3B0aW9uSGVhZGVyXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVuZFxuICAgICAgICAgICAgICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgICAgICAgICAgICA8SW5wdXRcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwiU2VsZWN0IERhdGUgYW5kIFRpbWVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZT1cIm1kXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU9XCJkYXRldGltZS1sb2NhbFwiIG9uQ2hhbmdlPXsoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRheXMgPSBkYXlqcyhlPy50YXJnZXQ/LnZhbHVlLCBcIllZWVktTU0tRERUSEg6bW1cIikuZGlmZih3aW5kb3dTdGFydERhdGUsICdkJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXlzLCAnIGRheXMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXlzID4gNikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2FzdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdpbmZvJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnV2luZG93IHRvbyBsb25nJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGltZSB3aW5kb3cgY2Fubm90IGJlIGxvbmdlciB0aGFuIDcgZGF5cyBsb25nJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA5MDAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNDbG9zYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VXaW5kb3dFbmREYXRlKGRheWpzKHdpbmRvd1N0YXJ0RGF0ZSkuYWRkKDYsICdkJykuaG91cigxOSkudG9EYXRlKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBob3VycyA9IGRheWpzKGU/LnRhcmdldD8udmFsdWUpLmRpZmYod2luZG93U3RhcnREYXRlLCAnaCcpXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaG91cnMgPCAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ2luZm8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdXaW5kb3cgdG9vIHNob3J0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGltZSB3aW5kb3cgc2hvdWxkIGJlIGF0IGxlYXN0IDIgaG91cnMgbG9uZycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogOTAwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzQ2xvc2FibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZVdpbmRvd0VuZERhdGUoZGF5anMod2luZG93U3RhcnREYXRlKS5hZGQoMiwgJ2gnKS50b0RhdGUoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZVdpbmRvd0VuZERhdGUoZGF5anMoZT8udGFyZ2V0Py52YWx1ZSkudG9EYXRlKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIH19IHZhbHVlPXtkYXlqcyh3aW5kb3dFbmREYXRlKS5mb3JtYXQoXCJZWVlZLU1NLUREVEhIOm1tXCIpfSAvPlxuICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgIDxCb3ggZmxleD17MX0gcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fSBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LXN0YXJ0XCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnODAlJyB9fT5cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIDxCb3g+XG4gICAgICAgICAgICAgICAgICAgICAgICA8VGV4dEZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9XCJUaXRsZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJ0aXRsZVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbXVsdGlsaW5lPXt0cnVlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlck9mTGluZXM9ezR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlOiB7IHRhcmdldDogeyB2YWx1ZTogc3RyaW5nIH0gfSkgPT4gY2hhbmdlU3VtbWFyeShlPy50YXJnZXQ/LnZhbHVlKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17c3VtbWFyeSB8fCBwcm9wcz8uc3VtbWFyeX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17eyB3aWR0aDogJzEwMCUnfX1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICA8Qm94IGZsZXg9ezF9IHA9e3sgcGhvbmU6ICdzJywgdGFibGV0OiAnbScgfX0gZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1zdGFydFwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBzdHlsZT17eyB3aWR0aDogJzgwJScgfX0+XG5cbiAgICAgICAgICAgICAgICAgICAgPFRleHRGaWVsZFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9XCJOb3Rlc1wiXG4gICAgICAgICAgICAgICAgICAgICAgICBtdWx0aWxpbmU9e3RydWV9XG4gICAgICAgICAgICAgICAgICAgICAgICBudW1iZXJPZkxpbmVzPXs0fVxuICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlOiB7IHRhcmdldDogeyB2YWx1ZTogc3RyaW5nIH0gfSkgPT4gY2hhbmdlTm90ZXMoZT8udGFyZ2V0Py52YWx1ZSl9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17bm90ZXMgfHwgcHJvcHM/Lm5vdGVzfVxuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3sgd2lkdGg6ICcxMDAlJ319XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgIDxCb3ggZmxleD17MX0gcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fSBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LXN0YXJ0XCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnODAlJyB9fT5cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICA8VGV4dEZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9XCJMb2NhdGlvblwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJsb2NhdGlvbiBpZiBhbnlcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZTogeyB0YXJnZXQ6IHsgdmFsdWU6IHN0cmluZyB9IH0pID0+IGNoYW5nZUxvY2F0aW9uKGU/LnRhcmdldD8udmFsdWUpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXtsb2NhdGlvbiB8fCBwcm9wcz8ubG9jYXRpb259XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3sgd2lkdGg6ICcxMDAlJ319XG4gICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgIDwvU2Nyb2xsVmlldz5cblxuICAgICAgICA8L0JveD5cbiAgICApXG59XG5cbmV4cG9ydCBkZWZhdWx0IENyZWF0ZU1lZXRpbmdBc3Npc3RCYXNlU3RlcFxuXG5cbiJdfQ==