"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const io_1 = require("react-icons/io");
const TextField_1 = __importDefault(require("@components/TextField"));
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const lodash_1 = __importDefault(require("lodash"));
const react_native_1 = require("react-native");
const theme_1 = require("@lib/theme/theme");
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("@config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
function EditCategoryStep5(props) {
    const [defaultReminders, setDefaultReminders] = (0, react_1.useState)(props?.defaultReminders || []);
    const [alarm, setAlarm] = (0, react_1.useState)(0);
    const [isMessage1, setIsMessage1] = (0, react_1.useState)(false);
    const [isMessage2, setIsMessage2] = (0, react_1.useState)(false);
    const setParentDefaultReminders = props?.setParentDefaultReminders;
    const changeDefaultReminders = (value) => {
        const newAlarms = lodash_1.default.uniqWith(defaultReminders.concat([value]), lodash_1.default.isEqual);
        setDefaultReminders(newAlarms);
        setParentDefaultReminders(newAlarms);
    };
    const removeItemFromDefaultReminders = (item) => {
        const newAlarms = lodash_1.default.without(defaultReminders, item);
        setDefaultReminders(newAlarms);
        setParentDefaultReminders(newAlarms);
    };
    const changeAlarm = (value) => {
        setAlarm(parseInt(value.replace(/[^0-9.]/g, ''), 10));
    };
    return ((0, jsx_runtime_1.jsxs)(Box_1.default, { justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { mt: { phone: 's', tablet: 'm' }, justifyContent: "center", alignItems: "center", children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "subheader", children: "Add reminders" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { pt: { phone: 'm', tablet: 'l' }, justifyContent: "center", alignItems: "center", style: { width: '100%' }, minHeight: "30vh", children: (0, jsx_runtime_1.jsx)(react_native_1.FlatList, { data: defaultReminders, renderItem: ({ item, index }) => ((0, jsx_runtime_1.jsx)(Box_1.default, { justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsxs)(Box_1.default, { style: { width: '100%' }, flexDirection: "row", justifyContent: "space-between", children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: `${item} minutes before` }), (0, jsx_runtime_1.jsx)(react_native_1.Pressable, { hitSlop: 15, onPress: () => removeItemFromDefaultReminders(item), children: (0, jsx_runtime_1.jsx)(io_1.IoIosClose, { size: "3em", color: theme_1.palette.red }) })] }) })), keyExtractor: (item, index) => `${item}-${index}` }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { justifyContent: "center", alignItems: "center", children: (0, jsx_runtime_1.jsx)(Box_1.default, { pt: { phone: 'xs', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(TextField_1.default, { type: "number", onChange: (e) => changeAlarm(e?.target?.value), value: `${alarm}`, placeholder: "0", label: "Reminder" }) }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { pt: { phone: 'xs', tablet: 's' }, justifyContent: "center", alignItems: "center", children: (0, jsx_runtime_1.jsx)(react_native_1.Pressable, { onPress: () => changeDefaultReminders(alarm), children: (0, jsx_runtime_1.jsxs)(Box_1.default, { flexDirection: "row", justifyContent: "space-between", alignItems: "center", children: [(0, jsx_runtime_1.jsx)(io_1.IoIosAdd, { size: "3em", color: theme_1.palette.pinkPrimary }), (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "buttonLink", children: "Add" })] }) }) })] }));
}
exports.default = EditCategoryStep5;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWRpdENhdGVnb3J5U3RlcDUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJFZGl0Q2F0ZWdvcnlTdGVwNS50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFtQkEsZ0RBcUNDOztBQXhERCxpQ0FJYztBQUNkLHVDQUFzRDtBQUN0RCxzRUFBNkM7QUFDN0MsaUVBQXdDO0FBQ3hDLG1FQUEwQztBQUUxQyxvREFBc0I7QUFFdEIsK0NBQTBFO0FBQzFFLDRDQUEwQztBQUUxQyx3RUFBOEM7QUFDOUMseURBQXFEO0FBQ3JELDhFQUFxRDtBQUU5QyxLQUFLLFVBQVUsa0JBQWtCLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFpRDtJQUNoRywwRkFBMEY7SUFDMUYsc0NBQXNDO0lBQ3RDLHlFQUF5RTtJQUN6RSwwQkFBZSxDQUFDLElBQUksQ0FBQyxJQUFBLDZCQUFhLEdBQUUsQ0FBQyxDQUFBO0lBQ3JDLElBQUksT0FBTyxDQUFBO0lBQ1gsSUFBSSxDQUFDO1FBQ0QsT0FBTyxHQUFHLE1BQU0saUJBQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRTtZQUN6Qyw2QkFBNkIsRUFBRSxLQUFLO2dCQUNoQyxPQUFPLEVBQUUsQ0FBQTtZQUNiLENBQUM7U0FDSixDQUFDLENBQUE7SUFDTixDQUFDO0lBQUMsT0FBTyxHQUFRLEVBQUUsQ0FBQztRQUNoQixJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssaUJBQU8sQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUMvQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsZUFBZSxFQUFFLGVBQWUsRUFBRSxFQUFFLENBQUE7UUFDMUQsQ0FBQzthQUFNLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxpQkFBTyxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUNqRCxrRUFBa0U7WUFDbEUscUVBQXFFO1lBQ3JFLE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxlQUFlLEVBQUUs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QUFFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLEVBQUUsY0FBYyxFQUFDLFFBQVEsRUFBQyxVQUFVLEVBQUMsUUFBUSxZQUM5RSx1QkFBQyx3QkFBUyxJQUFDLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxzQkFBc0IsQ0FBQyxLQUFLLENBQUMsWUFDbkQsd0JBQUMsYUFBRyxJQUFDLGFBQWEsRUFBQyxLQUFLLEVBQUMsY0FBYyxFQUFDLGVBQWUsRUFBQyxVQUFVLEVBQUMsUUFBUSxhQUN2RSx1QkFBQyxhQUFRLElBQUMsSUFBSSxFQUFDLEtBQUssRUFBQyxLQUFLLEVBQUUsZUFBTyxDQUFDLFdBQVcsR0FBSSxFQUNuRCx1QkFBQyxjQUFJLElBQUMsT0FBTyxFQUFDLFlBQVksb0JBRW5CLElBQ0wsR0FDRSxHQUNWLElBQ0osQ0FDVCxDQUFBO0FBQ0wsQ0FBQztBQUVELGtCQUFlLGlCQUFpQixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7XG4gIHVzZVN0YXRlLFxuICBEaXNwYXRjaCxcbiAgICBTZXRTdGF0ZUFjdGlvbixcbn0gZnJvbSAncmVhY3QnXG5pbXBvcnQgeyBJb0lvc0FkZCwgSW9Jb3NDbG9zZSB9IGZyb20gXCJyZWFjdC1pY29ucy9pb1wiO1xuaW1wb3J0IFRleHRGaWVsZCBmcm9tICdAY29tcG9uZW50cy9UZXh0RmllbGQnXG5pbXBvcnQgQm94IGZyb20gJ0Bjb21wb25lbnRzL2NvbW1vbi9Cb3gnXG5pbXBvcnQgVGV4dCBmcm9tICdAY29tcG9uZW50cy9jb21tb24vVGV4dCdcbmltcG9ydCB7IERlZmF1bHRSZW1pbmRlcnNUeXBlIH0gZnJvbSAnQGxpYi9kYXRhVHlwZXMvQ2F0ZWdvcnlUeXBlJ1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJ1xuaW1wb3J0IEJ1dHRvbiBmcm9tICdAY29tcG9uZW50cy9CdXR0b24nXG5pbXBvcnQgeyBBcHBlYXJhbmNlLCBGbGF0TGlzdCwgUHJlc3NhYmxlLCBTdHlsZVNoZWV0IH0gZnJvbSAncmVhY3QtbmF0aXZlJ1xuaW1wb3J0IHsgcGFsZXR0ZSB9IGZyb20gJ0BsaWIvdGhlbWUvdGhlbWUnXG5pbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgc3VwZXJ0b2tlbnNOb2RlIGZyb20gJ3N1cGVydG9rZW5zLW5vZGUnXG5pbXBvcnQgeyBiYWNrZW5kQ29uZmlnIH0gZnJvbSAnQGNvbmZpZy9iYWNrZW5kQ29uZmlnJ1xuaW1wb3J0IFNlc3Npb24gZnJvbSAnc3VwZXJ0b2tlbnMtbm9kZS9yZWNpcGUvc2Vzc2lvbidcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNlcnZlclNpZGVQcm9wcyh7IHJlcSwgcmVzIH06IHsgcmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UgfSkge1xuICAgIC8vIE5vdGljZSBob3cgdGhlIHNlcnZlciB1c2VzIGBBUElgIGZyb20gYHdpdGhTU1JDb250ZXh0YCwgaW5zdGVhZCBvZiB0aGUgdG9wLWxldmVsIGBBUElgLlxuICAgIC8vIGNvbnN0IFNTUiA9IHdpdGhTU1JDb250ZXh0KHsgcmVxIH0pXG4gICAgLy8gdGhpcyBydW5zIG9uIHRoZSBiYWNrZW5kLCBzbyB3ZSBtdXN0IGNhbGwgaW5pdCBvbiBzdXBlcnRva2Vucy1ub2RlIFNES1xuICAgIHN1cGVydG9rZW5zTm9kZS5pbml0KGJhY2tlbmRDb25maWcoKSlcbiAgICBsZXQgc2Vzc2lvblxuICAgIHRyeSB7XG4gICAgICAgIHNlc3Npb24gPSBhd2FpdCBTZXNzaW9uLmdldFNlc3Npb24ocmVxLCByZXMsIHtcbiAgICAgICAgICAgIG92ZXJyaWRlR2xvYmFsQ2xhaW1WYWxpZGF0b3JzOiBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KVxuICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICAgIGlmIChlcnIudHlwZSA9PT0gU2Vzc2lvbi5FcnJvci5UUllfUkVGUkVTSF9UT0tFTikge1xuICAgICAgICAgICAgcmV0dXJuIHsgcHJvcHM6IHsgZnJvbVN1cGVydG9rZW5zOiAnbmVlZHMtcmVmcmVzaCcgfSB9XG4gICAgICAgIH0gZWxzZSBpZiAoZXJyLnR5cGUgPT09IFNlc3Npb24uRXJyb3IuVU5BVVRIT1JJU0VEKSB7XG4gICAgICAgICAgICAvLyB0aGlzIHdpbGwgZm9yY2UgdGhlIGZyb250ZW5kIHRvIHRyeSBhbmQgcmVmcmVzaCB3aGljaCB3aWxsIGZhaWxcbiAgICAgICAgICAgIC8vIGNsZWFyaW5nIGFsbCBjb29raWVzIGFuZCByZWRpcmVjdGluZyB0aGUgdXNlciB0byB0aGUgbG9naW4gc2NyZWVuLlxuICAgICAgICAgICAgcmV0dXJuIHsgcHJvcHM6IHsgZnJvbVN1cGVydG9rZW5zOiAnbmVlZHMtcmVmcmVzaCcgfSB9XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZXJyXG4gICAgfVxuXG4gICAgaWYgKCFzZXNzaW9uPy5nZXRVc2VySWQoKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVkaXJlY3Q6IHtcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogJy9Vc2VyL0xvZ2luL1VzZXJMb2dpbicsXG4gICAgICAgICAgICAgICAgcGVybWFuZW50OiBmYWxzZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBwcm9wczoge1xuICAgICAgICBzdWI6IHNlc3Npb24uZ2V0VXNlcklkKCksXG4gICAgICAgIH1cbiAgICB9XG59XG5cbnR5cGUgUHJvcHMgPSB7XG4gICAgZGVmYXVsdFJlbWluZGVyczogRGVmYXVsdFJlbWluZGVyc1R5cGUsXG4gICAgc2V0UGFyZW50RGVmYXVsdFJlbWluZGVyczogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248RGVmYXVsdFJlbWluZGVyc1R5cGU+Pixcbn1cblxuXG5mdW5jdGlvbiBFZGl0Q2F0ZWdvcnlTdGVwNShwcm9wczogUHJvcHMpIHtcbiAgICBjb25zdCBbZGVmYXVsdFJlbWluZGVycywgc2V0RGVmYXVsdFJlbWluZGVyc10gPSB1c2VTdGF0ZTxEZWZhdWx0UmVtaW5kZXJzVHlwZT4ocHJvcHM/LmRlZmF1bHRSZW1pbmRlcnMgfHwgW10pXG4gICAgY29uc3QgW2FsYXJtLCBzZXRBbGFybV0gPSB1c2VTdGF0ZTxudW1iZXI+KDApICBcbiAgICBjb25zdCBbaXNNZXNzYWdlMSwgc2V0SXNNZXNzYWdlMV0gPSB1c2VTdGF0ZTxib29sZWFuPihmYWxzZSlcbiAgICBjb25zdCBbaXNNZXNzYWdlMiwgc2V0SXNNZXNzYWdlMl0gPSB1c2VTdGF0ZTxib29sZWFuPihmYWxzZSlcblxuICAgIGNvbnN0IHNldFBhcmVudERlZmF1bHRSZW1pbmRlcnMgPSBwcm9wcz8uc2V0UGFyZW50RGVmYXVsdFJlbWluZGVyc1xuXG4gICAgXG5cbiAgICBjb25zdCBjaGFuZ2VEZWZhdWx0UmVtaW5kZXJzID0gKHZhbHVlOiBudW1iZXIpID0+IHtcbiAgICAgICAgY29uc3QgbmV3QWxhcm1zID0gXy51bmlxV2l0aChkZWZhdWx0UmVtaW5kZXJzLmNvbmNhdChbdmFsdWVdKSwgXy5pc0VxdWFsKVxuICAgICAgICBzZXREZWZhdWx0UmVtaW5kZXJzKG5ld0FsYXJtcylcbiAgICAgICAgc2V0UGFyZW50RGVmYXVsdFJlbWluZGVycyhuZXdBbGFybXMpXG4gICAgfVxuXG4gICAgY29uc3QgcmVtb3ZlSXRlbUZyb21EZWZhdWx0UmVtaW5kZXJzID0gKGl0ZW06IG51bWJlcikgPT4ge1xuICAgICAgICBjb25zdCBuZXdBbGFybXMgPSBfLndpdGhvdXQoZGVmYXVsdFJlbWluZGVycywgaXRlbSlcblxuICAgICAgICBzZXREZWZhdWx0UmVtaW5kZXJzKG5ld0FsYXJtcylcbiAgICAgICAgc2V0UGFyZW50RGVmYXVsdFJlbWluZGVycyhuZXdBbGFybXMpXG4gICAgfVxuXG4gICAgY29uc3QgY2hhbmdlQWxhcm0gPSAodmFsdWU6IHN0cmluZykgPT4ge1xuICAgICAgICBzZXRBbGFybShwYXJzZUludCh2YWx1ZS5yZXBsYWNlKC9bXjAtOS5dL2csICcnKSwgMTApKVxuICAgIH1cblxuXG5cbiAgICByZXR1cm4gKFxuICAgICAgICA8Qm94IGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnMTAwJSd9fT5cbiAgICAgICAgICAgIDxCb3ggbXQ9e3sgcGhvbmU6ICdzJywgdGFibGV0OiAnbScgfX0ganVzdGlmeUNvbnRlbnQ9XCJjZW50ZXJcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCI+XG4gICAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD1cInN1YmhlYWRlclwiPlxuICAgICAgICAgICAgICAgIEFkZCByZW1pbmRlcnNcbiAgICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgIDxCb3ggcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAnbCcgfX0ganVzdGlmeUNvbnRlbnQ9XCJjZW50ZXJcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgc3R5bGU9e3sgd2lkdGg6ICcxMDAlJyB9fSBtaW5IZWlnaHQ9XCIzMHZoXCI+XG4gICAgICAgICAgICAgICAgPEZsYXRMaXN0XG4gICAgICAgICAgICAgICAgICAgIGRhdGE9e2RlZmF1bHRSZW1pbmRlcnN9XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlckl0ZW09eyh7IGl0ZW0sIGluZGV4IH0pID0+IChcbiAgICAgICAgICAgICAgICAgICAgICAgIDxCb3gganVzdGlmeUNvbnRlbnQ9XCJjZW50ZXJcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgc3R5bGU9e3sgd2lkdGg6ICcxMDAlJyB9fT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Qm94IHN0eWxlPXt7IHdpZHRoOiAnMTAwJScgfX0gZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwic3BhY2UtYmV0d2VlblwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8VGV4dCB2YXJpYW50PVwib3B0aW9uSGVhZGVyXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7YCR7aXRlbX0gbWludXRlcyBiZWZvcmVgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxQcmVzc2FibGUgaGl0U2xvcD17MTV9IG9uUHJlc3M9eygpID0+IHJlbW92ZUl0ZW1Gcm9tRGVmYXVsdFJlbWluZGVycyhpdGVtKX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8SW9Jb3NDbG9zZSBzaXplPVwiM2VtXCIgY29sb3I9e3BhbGV0dGUucmVkfSAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L1ByZXNzYWJsZT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgICBrZXlFeHRyYWN0b3I9eyhpdGVtLCBpbmRleCkgPT4gYCR7aXRlbX0tJHtpbmRleH1gfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgIDxCb3ggIGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiPlxuICAgICAgICAgICAgICAgIDxCb3ggcHQ9e3sgcGhvbmU6ICd4cycsIHRhYmxldDogJ3MnIH19PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICA8VGV4dEZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cIm51bWJlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlOiB7IHRhcmdldDogeyB2YWx1ZTogc3RyaW5nIH0gfSkgPT4gY2hhbmdlQWxhcm0oZT8udGFyZ2V0Py52YWx1ZSl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e2Ake2FsYXJtfWB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCIwXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD1cIlJlbWluZGVyXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICA8Qm94IHB0PXt7IHBob25lOiAneHMnLCB0YWJsZXQ6ICdzJyB9fSBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIj5cbiAgICAgICAgICAgICAgICA8UHJlc3NhYmxlIG9uUHJlc3M9eygpID0+IGNoYW5nZURlZmF1bHRSZW1pbmRlcnMoYWxhcm0pfT5cbiAgICAgICAgICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJzcGFjZS1iZXR3ZWVuXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPElvSW9zQWRkIHNpemU9XCIzZW1cIiBjb2xvcj17cGFsZXR0ZS5waW5rUHJpbWFyeX0gLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJidXR0b25MaW5rXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQWRkXG4gICAgICAgICAgICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgIDwvUHJlc3NhYmxlPlxuICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgIDwvQm94PlxuICAgIClcbn1cblxuZXhwb3J0IGRlZmF1bHQgRWRpdENhdGVnb3J5U3RlcDVcbiJdfQ==