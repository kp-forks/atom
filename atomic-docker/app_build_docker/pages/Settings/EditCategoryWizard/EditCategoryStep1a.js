"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const react_2 = require("@chakra-ui/react");
const Switch_1 = __importDefault(require("@components/Switch"));
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("@config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
function EditCategoryStep2(props) {
    const [copyTimePreference, setCopyTimePreference] = (0, react_1.useState)(props?.copyTimePreference ?? false);
    const [copyReminders, setCopyReminders] = (0, react_1.useState)(props?.copyReminders ?? false);
    const [copyPriorityLevel, setCopyPriorityLevel] = (0, react_1.useState)(props?.copyPriorityLevel ?? false);
    const [isMessage1, setIsMessage1] = (0, react_1.useState)(false);
    const [isMessage2, setIsMessage2] = (0, react_1.useState)(false);
    const setParentCopyTimePreference = props?.setParentCopyTimePreference;
    const setParentCopyReminders = props?.setParentCopyReminders;
    const setParentCopyPriorityLevel = props?.setParentCopyPriorityLevel;
    (0, react_1.useEffect)(() => {
        if (copyTimePreference !== props?.copyTimePreference) {
            setCopyTimePreference(props?.copyTimePreference ?? false);
        }
        if (copyReminders !== props?.copyReminders) {
            setCopyReminders(props?.copyReminders ?? false);
        }
    }, [props?.copyTimePreference, props?.copyReminders, copyTimePreference, copyReminders]);
    const changeCopyPriorityLevel = (value) => {
        setCopyPriorityLevel(value);
        setParentCopyPriorityLevel(value);
    };
    const changeCopyTimePreference = (value) => {
        setCopyTimePreference(value);
        setParentCopyTimePreference(value);
    };
    const changeCopyReminders = (value) => {
        setCopyReminders(value);
        setParentCopyReminders(value);
    };
    return ((0, jsx_runtime_1.jsx)(Box_1.default, { justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsxs)("div", { className: "flex-1 flex flex-col justify-center items-center", style: { minHeight: '70vh' }, children: [(0, jsx_runtime_1.jsxs)(Box_1.default, { style: { width: '90%' }, pt: { phone: 'm', tablet: 's' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(react_2.Tooltip, { hasArrow: true, label: 'New events whose details are similar to this one will have their priority level set to the level found on this event. If priority changes with time, avoid enabling this feature.', bg: 'purple.700', color: 'white', children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "buttonLink", children: "Copy over priority level to any new events whose details are similar in context to this event? (Hint)" }) }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, width: "100%", children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: copyPriorityLevel, onValueChange: changeCopyPriorityLevel, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { style: { width: '90%' }, pt: { phone: 'm', tablet: 's' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", alignItems: "center", children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Copy over time preferences to any new events whose details have similar context?" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, width: "100%", children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: copyTimePreference, onValueChange: changeCopyTimePreference, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { style: { width: '90%' }, pt: { phone: 'm', tablet: 's' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", alignItems: "center", children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Copy over reminders to any new events whose details have similar context?" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, width: "100%", children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: copyReminders, onValueChange: changeCopyReminders, style: { marginBottom: 20 } }) })] })] }) }));
}
exports.default = EditCategoryStep2;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWRpdENhdGVnb3J5U3RlcDFhLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiRWRpdENhdGVnb3J5U3RlcDFhLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQWlCQSxnREFxQ0M7O0FBdERELGlDQUtjO0FBQ2QsNENBQTBDO0FBRTFDLGdFQUF3QztBQUV4QyxpRUFBd0M7QUFDeEMsbUVBQTBDO0FBRTFDLHdFQUE4QztBQUM5Qyx5REFBcUQ7QUFDckQsOEVBQXFEO0FBRTlDLEtBQUssVUFBVSxrQkFBa0IsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQWlEO0lBQ2hHLDBGQUEwRjtJQUMxRixzQ0FBc0M7SUFDdEMseUVBQXlFO0lBQ3pFLDBCQUFlLENBQUMsSUFBSSxDQUFDLElBQUEsNkJBQWEsR0FBRSxDQUFDLENBQUE7SUFDckMsSUFBSSxPQUFPLENBQUE7SUFDWCxJQUFJLENBQUM7UUFDRCxPQUFPLEdBQUcsTUFBTSxpQkFBTyxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFO1lBQ3pDLDZCQUE2QixFQUFFLEtBQUs7Z0JBQ2hDLE9BQU8sRUFBRSxDQUFBO1lBQ2IsQ0FBQztTQUNKLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFBQyxPQUFPLEdBQVEsRUFBRSxDQUFDO1FBQ2hCLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxpQkFBTyxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQy9DLE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLEVBQUUsQ0FBQTtRQUMxRCxDQUFDO2FBQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLGlCQUFPLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ2pELGtFQUFrRTtZQUNsRSxxRUFBcUU7WUFDckUsT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFLGVBQWUsRUFBRSxlQUFlLEVBQUUsRUFBRSxDQUFBO1FBQzFELENBQUM7UUFDRCxN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QUFLLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsRUFBRSxLQUFLLEVBQUMsTUFBTSxZQUM1Rix1QkFBQyxnQkFBTyxJQUNKLE9BQU8sRUFBRSxrQkFBa0IsRUFDM0IsYUFBYSxFQUFFLHdCQUF3QixFQUN2QyxLQUFLLEVBQUUsRUFBRSxZQUFZLEVBQUUsRUFBRSxFQUFFLEdBQzdCLEdBQ0EsSUFDSixFQUNOLHdCQUFDLGFBQUcsSUFBQyxLQUFLLEVBQUUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLGFBQzdELHVCQUFDLGFBQUcsSUFBQyxhQUFhLEVBQUMsS0FBSyxFQUFDLGNBQWMsRUFBQyxZQUFZLEVBQUMsVUFBVSxFQUFDLFFBQVEsWUFDcEUsdUJBQUMsY0FBSSxJQUFDLE9BQU8sRUFBQyxjQUFjLDBGQUFpRixHQUMzRyxFQUNOLHVCQUFDLGFBQUcsSUFBQyxhQUFhLEVBQUMsS0FBSyxFQUFDLGNBQWMsRUFBQyxVQUFVLEVBQUMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLEVBQUUsS0FBSyxFQUFDLE1BQU0sWUFDNUYsdUJBQUMsZ0JBQU8sSUFDSixPQUFPLEVBQUUsYUFBYSxFQUN0QixhQUFhLEVBQUUsbUJBQW1CLEVBQ2xDLEtBQUssRUFBRSxFQUFFLFlBQVksRUFBRSxFQUFFLEVBQUUsR0FDN0IsR0FDQSxJQUNBLElBQ0osR0FDSixDQUNULENBQUE7QUFFTCxDQUFDO0FBRUQsa0JBQWUsaUJBQWlCLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtcbiAgICB1c2VTdGF0ZSxcbiAgICBEaXNwYXRjaCxcbiAgICBTZXRTdGF0ZUFjdGlvbixcbiAgICB1c2VFZmZlY3QsXG59IGZyb20gJ3JlYWN0J1xuaW1wb3J0IHsgVG9vbHRpcCB9IGZyb20gJ0BjaGFrcmEtdWkvcmVhY3QnXG5cbmltcG9ydCBTd2l0Y2gxIGZyb20gJ0Bjb21wb25lbnRzL1N3aXRjaCdcblxuaW1wb3J0IEJveCBmcm9tICdAY29tcG9uZW50cy9jb21tb24vQm94J1xuaW1wb3J0IFRleHQgZnJvbSAnQGNvbXBvbmVudHMvY29tbW9uL1RleHQnXG5pbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgc3VwZXJ0b2tlbnNOb2RlIGZyb20gJ3N1cGVydG9rZW5zLW5vZGUnXG5pbXBvcnQgeyBiYWNrZW5kQ29uZmlnIH0gZnJvbSAnQGNvbmZpZy9iYWNrZW5kQ29uZmlnJ1xuaW1wb3J0IFNlc3Npb24gZnJvbSAnc3VwZXJ0b2tlbnMtbm9kZS9yZWNpcGUvc2Vzc2lvbidcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNlcnZlclNpZGVQcm9wcyh7IHJlcSwgcmVzIH06IHsgcmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UgfSkge1xuICAgIC8vIE5vdGljZSBob3cgdGhlIHNlcnZlciB1c2VzIGBBUElgIGZyb20gYHdpdGhTU1JDb250ZXh0YCwgaW5zdGVhZCBvZiB0aGUgdG9wLWxldmVsIGBBUElgLlxuICAgIC8vIGNvbnN0IFNTUiA9IHdpdGhTU1JDb250ZXh0KHsgcmVxIH0pXG4gICAgLy8gdGhpcyBydW5zIG9uIHRoZSBiYWNrZW5kLCBzbyB3ZSBtdXN0IGNhbGwgaW5pdCBvbiBzdXBlcnRva2Vucy1ub2RlIFNES1xuICAgIHN1cGVydG9rZW5zTm9kZS5pbml0KGJhY2tlbmRDb25maWcoKSlcbiAgICBsZXQgc2Vzc2lvblxuICAgIHRyeSB7XG4gICAgICAgIHNlc3Npb24gPSBhd2FpdCBTZXNzaW9uLmdldFNlc3Npb24ocmVxLCByZXMsIHtcbiAgICAgICAgICAgIG92ZXJyaWRlR2xvYmFsQ2xhaW1WYWxpZGF0b3JzOiBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KVxuICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICAgIGlmIChlcnIudHlwZSA9PT0gU2Vzc2lvbi5FcnJvci5UUllfUkVGUkVTSF9UT0tFTikge1xuICAgICAgICAgICAgcmV0dXJuIHsgcHJvcHM6IHsgZnJvbVN1cGVydG9rZW5zOiAnbmVlZHMtcmVmcmVzaCcgfSB9XG4gICAgICAgIH0gZWxzZSBpZiAoZXJyLnR5cGUgPT09IFNlc3Npb24uRXJyb3IuVU5BVVRIT1JJU0VEKSB7XG4gICAgICAgICAgICAvLyB0aGlzIHdpbGwgZm9yY2UgdGhlIGZyb250ZW5kIHRvIHRyeSBhbmQgcmVmcmVzaCB3aGljaCB3aWxsIGZhaWxcbiAgICAgICAgICAgIC8vIGNsZWFyaW5nIGFsbCBjb29raWVzIGFuZCByZWRpcmVjdGluZyB0aGUgdXNlciB0byB0aGUgbG9naW4gc2NyZWVuLlxuICAgICAgICAgICAgcmV0dXJuIHsgcHJvcHM6IHsgZnJvbVN1cGVydG9rZW5zOiAnbmVlZHMtcmVmcmVzaCcgfSB9XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZXJyXG4gICAgfVxuXG4gICAgaWYgKCFzZXNzaW9uPy5nZXRVc2VySWQoKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVkaXJlY3Q6IHtcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogJy9Vc2VyL0xvZ2luL1VzZXJMb2dpbicsXG4gICAgICAgICAgICAgICAgcGVybWFuZW50OiBmYWxzZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBwcm9wczoge1xuICAgICAgICBzdWI6IHNlc3Npb24uZ2V0VXNlcklkKCksXG4gICAgICAgIH1cbiAgICB9XG59XG5cbnR5cGUgUHJvcHMgPSB7XG4gICAgY29weVByaW9yaXR5TGV2ZWw6IGJvb2xlYW4sXG4gICAgc2V0UGFyZW50Q29weVByaW9yaXR5TGV2ZWw6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPGJvb2xlYW4+PixcbiAgICBjb3B5VGltZVByZWZlcmVuY2U6IGJvb2xlYW4sXG4gICAgc2V0UGFyZW50Q29weVRpbWVQcmVmZXJlbmNlOiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxib29sZWFuPj4sXG4gICAgY29weVJlbWluZGVyczogYm9vbGVhbixcbiAgICBzZXRQYXJlbnRDb3B5UmVtaW5kZXJzOiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxib29sZWFuPj4sXG59XG5cbmZ1bmN0aW9uIEVkaXRDYXRlZ29yeVN0ZXAyKHByb3BzOiBQcm9wcykge1xuICAgIGNvbnN0IFtjb3B5VGltZVByZWZlcmVuY2UsIHNldENvcHlUaW1lUHJlZmVyZW5jZV0gPSB1c2VTdGF0ZTxib29sZWFuPihwcm9wcz8uY29weVRpbWVQcmVmZXJlbmNlID8/IGZhbHNlKVxuICAgIGNvbnN0IFtjb3B5UmVtaW5kZXJzLCBzZXRDb3B5UmVtaW5kZXJzXSA9IHVzZVN0YXRlPGJvb2xlYW4+KHByb3BzPy5jb3B5UmVtaW5kZXJzID8/IGZhbHNlKVxuICAgIGNvbnN0IFtjb3B5UHJpb3JpdHlMZXZlbCwgc2V0Q29weVByaW9yaXR5TGV2ZWxdID0gdXNlU3RhdGU8Ym9vbGVhbj4ocHJvcHM/LmNvcHlQcmlvcml0eUxldmVsID8/IGZhbHNlKVxuICAgIGNvbnN0IFtpc01lc3NhZ2UxLCBzZXRJc01lc3NhZ2UxXSA9IHVzZVN0YXRlPGJvb2xlYW4+KGZhbHNlKVxuICAgIGNvbnN0IFtpc01lc3NhZ2UyLCBzZXRJc01lc3NhZ2UyXSA9IHVzZVN0YXRlPGJvb2xlYW4+KGZhbHNlKVxuXG4gICAgY29uc3Qgc2V0UGFyZW50Q29weVRpbWVQcmVmZXJlbmNlID0gcHJvcHM/LnNldFBhcmVudENvcHlUaW1lUHJlZmVyZW5jZVxuICAgIGNvbnN0IHNldFBhcmVudENvcHlSZW1pbmRlcnMgPSBwcm9wcz8uc2V0UGFyZW50Q29weVJlbWluZGVyc1xuICAgIGNvbnN0IHNldFBhcmVudENvcHlQcmlvcml0eUxldmVsID0gcHJvcHM/LnNldFBhcmVudENvcHlQcmlvcml0eUxldmVsXG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoY29weVRpbWVQcmVmZXJlbmNlICE9PSBwcm9wcz8uY29weVRpbWVQcmVmZXJlbmNlKSB7XG4gICAgICAgICAgICBzZXRDb3B5VGltZVByZWZlcmVuY2UocHJvcHM/LmNvcHlUaW1lUHJlZmVyZW5jZSA/PyBmYWxzZSlcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjb3B5UmVtaW5kZXJzICE9PSBwcm9wcz8uY29weVJlbWluZGVycykge1xuICAgICAgICAgICAgc2V0Q29weVJlbWluZGVycyhwcm9wcz8uY29weVJlbWluZGVycyA/PyBmYWxzZSlcbiAgICAgICAgfVxuICAgIH0sIFtwcm9wcz8uY29weVRpbWVQcmVmZXJlbmNlLCBwcm9wcz8uY29weVJlbWluZGVycywgY29weVRpbWVQcmVmZXJlbmNlLCBjb3B5UmVtaW5kZXJzXSlcblxuICAgIGNvbnN0IGNoYW5nZUNvcHlQcmlvcml0eUxldmVsID0gKHZhbHVlOiBib29sZWFuKSA9PiB7XG4gICAgICAgIHNldENvcHlQcmlvcml0eUxldmVsKHZhbHVlKVxuICAgICAgICBzZXRQYXJlbnRDb3B5UHJpb3JpdHlMZXZlbCh2YWx1ZSlcbiAgICB9XG5cbiAgICBjb25zdCBjaGFuZ2VDb3B5VGltZVByZWZlcmVuY2UgPSAodmFsdWU6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgc2V0Q29weVRpbWVQcmVmZXJlbmNlKHZhbHVlKVxuICAgICAgICBzZXRQYXJlbnRDb3B5VGltZVByZWZlcmVuY2UodmFsdWUpXG4gICAgfVxuXG4gICAgY29uc3QgY2hhbmdlQ29weVJlbWluZGVycyA9ICh2YWx1ZTogYm9vbGVhbikgPT4ge1xuICAgICAgICBzZXRDb3B5UmVtaW5kZXJzKHZhbHVlKVxuICAgICAgICBzZXRQYXJlbnRDb3B5UmVtaW5kZXJzKHZhbHVlKVxuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICAgIDxCb3gganVzdGlmeUNvbnRlbnQ9XCJjZW50ZXJcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgc3R5bGU9e3sgd2lkdGg6ICcxMDAlJyB9fT5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleC0xIGZsZXggZmxleC1jb2wganVzdGlmeS1jZW50ZXIgaXRlbXMtY2VudGVyXCIgc3R5bGU9e3sgbWluSGVpZ2h0OiAnNzB2aCcgfX0+XG4gICAgICAgICAgICAgICAgPEJveCBzdHlsZT17eyB3aWR0aDogJzkwJScgfX0gcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0+XG4gICAgICAgICAgICAgICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1zdGFydFwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBzdHlsZT17eyB3aWR0aDogJzEwMCUnIH19PlxuICAgICAgICAgICAgICAgICAgICAgICAgPFRvb2x0aXAgaGFzQXJyb3cgbGFiZWw9J05ldyBldmVudHMgd2hvc2UgZGV0YWlscyBhcmUgc2ltaWxhciB0byB0aGlzIG9uZSB3aWxsIGhhdmUgdGhlaXIgcHJpb3JpdHkgbGV2ZWwgc2V0IHRvIHRoZSBsZXZlbCBmb3VuZCBvbiB0aGlzIGV2ZW50LiBJZiBwcmlvcml0eSBjaGFuZ2VzIHdpdGggdGltZSwgYXZvaWQgZW5hYmxpbmcgdGhpcyBmZWF0dXJlLicgYmc9J3B1cnBsZS43MDAnIGNvbG9yPSd3aGl0ZSc+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD1cImJ1dHRvbkxpbmtcIj5Db3B5IG92ZXIgcHJpb3JpdHkgbGV2ZWwgdG8gYW55IG5ldyBldmVudHMgd2hvc2UgZGV0YWlscyBhcmUgc2ltaWxhciBpbiBjb250ZXh0IHRvIHRoaXMgZXZlbnQ/IChIaW50KTwvVGV4dD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvVG9vbHRpcD5cbiAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1lbmRcIiBwdD17eyBwaG9uZTogJ20nLCB0YWJsZXQ6ICdzJyB9fSB3aWR0aD1cIjEwMCVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxTd2l0Y2gxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17Y29weVByaW9yaXR5TGV2ZWx9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25WYWx1ZUNoYW5nZT17Y2hhbmdlQ29weVByaW9yaXR5TGV2ZWx9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3sgbWFyZ2luQm90dG9tOiAyMCB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgPEJveCBzdHlsZT17eyB3aWR0aDogJzkwJScgfX0gcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0+XG4gICAgICAgICAgICAgICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1zdGFydFwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJvcHRpb25IZWFkZXJcIj5Db3B5IG92ZXIgdGltZSBwcmVmZXJlbmNlcyB0byBhbnkgbmV3IGV2ZW50cyB3aG9zZSBkZXRhaWxzIGhhdmUgc2ltaWxhciBjb250ZXh0PzwvVGV4dD5cbiAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1lbmRcIiBwdD17eyBwaG9uZTogJ20nLCB0YWJsZXQ6ICdzJyB9fSB3aWR0aD1cIjEwMCVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxTd2l0Y2gxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17Y29weVRpbWVQcmVmZXJlbmNlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uVmFsdWVDaGFuZ2U9e2NoYW5nZUNvcHlUaW1lUHJlZmVyZW5jZX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17eyBtYXJnaW5Cb3R0b206IDIwIH19XG4gICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICA8Qm94IHN0eWxlPXt7IHdpZHRoOiAnOTAlJyB9fSBwdD17eyBwaG9uZTogJ20nLCB0YWJsZXQ6ICdzJyB9fT5cbiAgICAgICAgICAgICAgICA8Qm94IGZsZXhEaXJlY3Rpb249XCJyb3dcIiBqdXN0aWZ5Q29udGVudD1cImZsZXgtc3RhcnRcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCI+ICBcbiAgICAgICAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD1cIm9wdGlvbkhlYWRlclwiPkNvcHkgb3ZlciByZW1pbmRlcnMgdG8gYW55IG5ldyBldmVudHMgd2hvc2UgZGV0YWlscyBoYXZlIHNpbWlsYXIgY29udGV4dD88L1RleHQ+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LWVuZFwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19IHdpZHRoPVwiMTAwJVwiPlxuICAgICAgICAgICAgICAgICAgICA8U3dpdGNoMVxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17Y29weVJlbWluZGVyc30gICBcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uVmFsdWVDaGFuZ2U9e2NoYW5nZUNvcHlSZW1pbmRlcnN9IFxuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3sgbWFyZ2luQm90dG9tOiAyMCB9fVxuICAgICAgICAgICAgICAgICAgICAvPiAgXG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9Cb3g+XG4gICAgKVxuICAgICAgICBcbn1cblxuZXhwb3J0IGRlZmF1bHQgRWRpdENhdGVnb3J5U3RlcDJcblxuIl19