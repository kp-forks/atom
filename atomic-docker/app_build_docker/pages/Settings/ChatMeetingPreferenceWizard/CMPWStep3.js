"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const Switch_1 = __importDefault(require("@components/Switch"));
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("@config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
function CMPWStep3(props) {
    const [zoomMeet, setZoomMeet] = (0, react_1.useState)(props?.zoomMeet);
    const [googleMeet, setGoogleMeet] = (0, react_1.useState)(props?.googleMeet);
    const [enableConference, setEnableConference] = (0, react_1.useState)(props?.enableConference);
    const [notAvailable, setNotAvailable] = (0, react_1.useState)(false);
    const isZoomAvailable = props?.isZoomAvailable;
    const isGoogleMeetAvailable = props?.isGoogleMeetAvailable;
    const setParentZoomMeet = props?.setParentZoomMeet;
    const setParentGoogleMeet = props?.setParentGoogleMeet;
    const setParentConferenceApp = props?.setParentConferenceApp;
    const setParentEnableConference = props?.setParentEnableConference;
    const onEnableVirtual = (value) => {
        setEnableConference(value);
        setParentEnableConference(value);
        if (!isZoomAvailable && !isGoogleMeetAvailable) {
            setNotAvailable(true);
            setParentConferenceApp(null);
        }
        else {
            setNotAvailable(false);
        }
        if (value === false) {
            setParentConferenceApp(null);
        }
    };
    const onZoomMeet = (value) => {
        setZoomMeet(value);
        setParentZoomMeet(value);
        setGoogleMeet(!value);
        setParentGoogleMeet(!value);
        if (value) {
            setParentConferenceApp('zoom');
        }
        else {
            setParentConferenceApp('google');
        }
    };
    const onGoogleMeet = (value) => {
        setGoogleMeet(value);
        setParentGoogleMeet(value);
        setZoomMeet(!value);
        setParentZoomMeet(!value);
        if (value) {
            setParentConferenceApp('google');
        }
        else {
            setParentConferenceApp('zoom');
        }
    };
    return ((0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, justifyContent: "center", alignItems: "center", minHeight: "65vh", width: "100%", children: [(0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, pt: { phone: 'm', tablet: 's' }, flexDirection: "row", justifyContent: "space-between", alignItems: "flex-start", width: "70%", children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", pt: { phone: 'm', tablet: 's' }, children: "Enable a virtual meeting for this event?" }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: enableConference, onValueChange: onEnableVirtual, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, width: "70%", pt: { phone: 'm', tablet: 's' }, children: notAvailable
                    ? ((0, jsx_runtime_1.jsx)(Box_1.default, { width: "100%", children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "subheader", children: "3rd party providers are not enabled. Please enable either zoom or google to use this feature." }) })) : ((0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, width: "100%", children: enableConference
                        ? ((0, jsx_runtime_1.jsxs)(Box_1.default, { width: "100%", children: [(0, jsx_runtime_1.jsx)(Box_1.default, { width: "100%", children: isZoomAvailable
                                        ? ((0, jsx_runtime_1.jsxs)(Box_1.default, { width: "100%", children: [(0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, pt: { phone: 'm', tablet: 's' }, flexDirection: "row", justifyContent: "space-between", alignItems: "center", width: "100%", children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", pt: { phone: 'm', tablet: 's' }, children: "Enable a Zoom Meeting for this event?" }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: zoomMeet, onValueChange: onZoomMeet, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsx)(Box_1.default, {})] })) : null }), (0, jsx_runtime_1.jsx)(Box_1.default, { width: "100%", children: isGoogleMeetAvailable
                                        ? ((0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, pt: { phone: 'm', tablet: 's' }, flexDirection: "row", justifyContent: "space-between", alignItems: "center", width: "100%", children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", pt: { phone: 'm', tablet: 's' }, children: "Enable a Google Meet for this event?" }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: googleMeet, onValueChange: onGoogleMeet, style: { marginBottom: 20 } }) })] })) : null })] })) : null })) })] }));
}
exports.default = CMPWStep3;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ01QV1N0ZXAzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQ01QV1N0ZXAzLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQWNBLGdEQXFDQzs7QUFuREQsaUNBSWM7QUFDZCxnRUFBd0M7QUFDeEMsaUVBQXdDO0FBQ3hDLG1FQUEwQztBQUcxQyx3RUFBOEM7QUFDOUMseURBQXFEO0FBQ3JELDhFQUFxRDtBQUU5QyxLQUFLLFVBQVUsa0JBQWtCLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFpRDtJQUNoRywwRkFBMEY7SUFDMUYsc0NBQXNDO0lBQ3RDLHlFQUF5RTtJQUN6RSwwQkFBZSxDQUFDLElBQUksQ0FBQyxJQUFBLDZCQUFhLEdBQUUsQ0FBQyxDQUFBO0lBQ3JDLElBQUksT0FBTyxDQUFBO0lBQ1gsSUFBSSxDQUFDO1FBQ0QsT0FBTyxHQUFHLE1BQU0saUJBQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRTtZQUN6Qyw2QkFBNkIsRUFBRSxLQUFLO2dCQUNoQyxPQUFPLEVBQUUsQ0FBQTtZQUNiLENBQUM7U0FDSixDQUFDLENBQUE7SUFDTixDQUFDO0lBQUMsT0FBTyxHQUFRLEVBQUUsQ0FBQztRQUNoQixJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssaUJBQU8sQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUMvQyxPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsZUFBZSxFQUFFLGVBQWUsRUFBRSxFQUFFLENBQUE7UUFDMUQsQ0FBQzthQUFNLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxpQkFBTyxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUNqRCxrRUFBa0U7WUFDbEUscUVBQXFFO1lBQ3JFLE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLEVBQUUsQ0FBQTtRQUMxRCxDQUFDO1FBQ0QsTUFBTSxHQUFHLENBQUE7SUFDYixDQUFDO0lBRUQsSUFB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QUMsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsRUFBRSxhQUFhLEVBQUMsS0FBSyxFQUFDLGNBQWMsRUFBQyxlQUFlLEVBQUMsVUFBVSxFQUFDLFFBQVEsRUFBQyxLQUFLLEVBQUMsTUFBTSxhQUNoSSx1QkFBQyxjQUFJLElBQUMsT0FBTyxFQUFDLGNBQWMsRUFBQyxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUscURBRXJELEVBQ1AsdUJBQUMsYUFBRyxJQUFDLGFBQWEsRUFBQyxLQUFLLEVBQUMsY0FBYyxFQUFDLFVBQVUsRUFBQyxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsWUFDaEYsdUJBQUMsZ0JBQU8sSUFDTixPQUFPLEVBQUUsVUFBVSxFQUNuQixhQUFhLEVBQUUsWUFBWSxFQUMzQixLQUFLLEVBQUUsRUFBQyxZQUFZLEVBQUUsRUFBRSxFQUFDLEdBQ3pCLEdBQ0UsSUFDRixDQUNQLENBQUMsQ0FBQyxDQUFDLElBQUksR0FFTixJQUNGLENBQ1AsQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUVOLENBQ1AsR0FFQyxJQUNGLENBQ1QsQ0FBQTtBQUVMLENBQUM7QUFHRCxrQkFBZSxTQUFTLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtcbiAgICB1c2VTdGF0ZSxcbiAgICBEaXNwYXRjaCxcbiAgICBTZXRTdGF0ZUFjdGlvbixcbn0gZnJvbSAncmVhY3QnXG5pbXBvcnQgU3dpdGNoMSBmcm9tICdAY29tcG9uZW50cy9Td2l0Y2gnXG5pbXBvcnQgQm94IGZyb20gJ0Bjb21wb25lbnRzL2NvbW1vbi9Cb3gnXG5pbXBvcnQgVGV4dCBmcm9tICdAY29tcG9uZW50cy9jb21tb24vVGV4dCdcbmltcG9ydCB7IENvbmZlcmVuY2VBcHBUeXBlIH0gZnJvbSAnQGxpYi9kYXRhVHlwZXMvTWVldGluZ0Fzc2lzdFR5cGUnXG5pbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgc3VwZXJ0b2tlbnNOb2RlIGZyb20gJ3N1cGVydG9rZW5zLW5vZGUnXG5pbXBvcnQgeyBiYWNrZW5kQ29uZmlnIH0gZnJvbSAnQGNvbmZpZy9iYWNrZW5kQ29uZmlnJ1xuaW1wb3J0IFNlc3Npb24gZnJvbSAnc3VwZXJ0b2tlbnMtbm9kZS9yZWNpcGUvc2Vzc2lvbidcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNlcnZlclNpZGVQcm9wcyh7IHJlcSwgcmVzIH06IHsgcmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UgfSkge1xuICAgIC8vIE5vdGljZSBob3cgdGhlIHNlcnZlciB1c2VzIGBBUElgIGZyb20gYHdpdGhTU1JDb250ZXh0YCwgaW5zdGVhZCBvZiB0aGUgdG9wLWxldmVsIGBBUElgLlxuICAgIC8vIGNvbnN0IFNTUiA9IHdpdGhTU1JDb250ZXh0KHsgcmVxIH0pXG4gICAgLy8gdGhpcyBydW5zIG9uIHRoZSBiYWNrZW5kLCBzbyB3ZSBtdXN0IGNhbGwgaW5pdCBvbiBzdXBlcnRva2Vucy1ub2RlIFNES1xuICAgIHN1cGVydG9rZW5zTm9kZS5pbml0KGJhY2tlbmRDb25maWcoKSlcbiAgICBsZXQgc2Vzc2lvblxuICAgIHRyeSB7XG4gICAgICAgIHNlc3Npb24gPSBhd2FpdCBTZXNzaW9uLmdldFNlc3Npb24ocmVxLCByZXMsIHtcbiAgICAgICAgICAgIG92ZXJyaWRlR2xvYmFsQ2xhaW1WYWxpZGF0b3JzOiBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KVxuICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICAgIGlmIChlcnIudHlwZSA9PT0gU2Vzc2lvbi5FcnJvci5UUllfUkVGUkVTSF9UT0tFTikge1xuICAgICAgICAgICAgcmV0dXJuIHsgcHJvcHM6IHsgZnJvbVN1cGVydG9rZW5zOiAnbmVlZHMtcmVmcmVzaCcgfSB9XG4gICAgICAgIH0gZWxzZSBpZiAoZXJyLnR5cGUgPT09IFNlc3Npb24uRXJyb3IuVU5BVVRIT1JJU0VEKSB7XG4gICAgICAgICAgICAvLyB0aGlzIHdpbGwgZm9yY2UgdGhlIGZyb250ZW5kIHRvIHRyeSBhbmQgcmVmcmVzaCB3aGljaCB3aWxsIGZhaWxcbiAgICAgICAgICAgIC8vIGNsZWFyaW5nIGFsbCBjb29raWVzIGFuZCByZWRpcmVjdGluZyB0aGUgdXNlciB0byB0aGUgbG9naW4gc2NyZWVuLlxuICAgICAgICAgICAgcmV0dXJuIHsgcHJvcHM6IHsgZnJvbVN1cGVydG9rZW5zOiAnbmVlZHMtcmVmcmVzaCcgfSB9XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZXJyXG4gICAgfVxuXG4gICAgaWYgKCFzZXNzaW9uPy5nZXRVc2VySWQoKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVkaXJlY3Q6IHtcbiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbjogJy9Vc2VyL0xvZ2luL1VzZXJMb2dpbicsXG4gICAgICAgICAgICAgICAgcGVybWFuZW50OiBmYWxzZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBwcm9wczoge1xuICAgICAgICBzdWI6IHNlc3Npb24uZ2V0VXNlcklkKCksXG4gICAgICAgIH1cbiAgICB9XG59XG5cbnR5cGUgUHJvcHMgPSB7XG4gICAgaXNab29tQXZhaWxhYmxlOiBib29sZWFuLFxuICAgIGlzR29vZ2xlTWVldEF2YWlsYWJsZTogYm9vbGVhbixcbiAgICB6b29tTWVldDogYm9vbGVhbixcbiAgICBnb29nbGVNZWV0OiBib29sZWFuLFxuICAgIGVuYWJsZUNvbmZlcmVuY2U6IGJvb2xlYW4sXG4gICAgc2V0UGFyZW50Wm9vbU1lZXQ6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPGJvb2xlYW4+PixcbiAgICBzZXRQYXJlbnRHb29nbGVNZWV0OiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxib29sZWFuPj4sXG4gICAgc2V0UGFyZW50RW5hYmxlQ29uZmVyZW5jZTogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248Ym9vbGVhbj4+LFxuICAgIHNldFBhcmVudENvbmZlcmVuY2VBcHA6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPENvbmZlcmVuY2VBcHBUeXBlIHwgbnVsbCB8IHVuZGVmaW5lZD4+LFxufVxuXG5mdW5jdGlvbiBDTVBXU3RlcDMocHJvcHM6IFByb3BzKSB7XG4gICAgY29uc3QgW3pvb21NZWV0LCBzZXRab29tTWVldF0gPSB1c2VTdGF0ZTxib29sZWFuPihwcm9wcz8uem9vbU1lZXQpXG4gICAgY29uc3QgW2dvb2dsZU1lZXQsIHNldEdvb2dsZU1lZXRdID0gdXNlU3RhdGU8Ym9vbGVhbj4ocHJvcHM/Lmdvb2dsZU1lZXQpXG4gICAgY29uc3QgW2VuYWJsZUNvbmZlcmVuY2UsIHNldEVuYWJsZUNvbmZlcmVuY2VdID0gdXNlU3RhdGU8Ym9vbGVhbj4ocHJvcHM/LmVuYWJsZUNvbmZlcmVuY2UpXG4gICAgY29uc3QgW25vdEF2YWlsYWJsZSwgc2V0Tm90QXZhaWxhYmxlXSA9IHVzZVN0YXRlPGJvb2xlYW4+KGZhbHNlKVxuXG4gICAgY29uc3QgaXNab29tQXZhaWxhYmxlID0gcHJvcHM/LmlzWm9vbUF2YWlsYWJsZVxuICAgIGNvbnN0IGlzR29vZ2xlTWVldEF2YWlsYWJsZSA9IHByb3BzPy5pc0dvb2dsZU1lZXRBdmFpbGFibGVcbiAgICBjb25zdCBzZXRQYXJlbnRab29tTWVldCA9IHByb3BzPy5zZXRQYXJlbnRab29tTWVldFxuICAgIGNvbnN0IHNldFBhcmVudEdvb2dsZU1lZXQgPSBwcm9wcz8uc2V0UGFyZW50R29vZ2xlTWVldFxuICAgIGNvbnN0IHNldFBhcmVudENvbmZlcmVuY2VBcHAgPSBwcm9wcz8uc2V0UGFyZW50Q29uZmVyZW5jZUFwcFxuICAgIGNvbnN0IHNldFBhcmVudEVuYWJsZUNvbmZlcmVuY2UgPSBwcm9wcz8uc2V0UGFyZW50RW5hYmxlQ29uZmVyZW5jZVxuXG4gICAgY29uc3Qgb25FbmFibGVWaXJ0dWFsID0gKHZhbHVlOiBib29sZWFuKSA9PiB7XG4gICAgICAgIHNldEVuYWJsZUNvbmZlcmVuY2UodmFsdWUpXG4gICAgICAgIHNldFBhcmVudEVuYWJsZUNvbmZlcmVuY2UodmFsdWUpXG4gICAgICAgIFxuICAgICAgICBpZiAoIWlzWm9vbUF2YWlsYWJsZSAmJiAhaXNHb29nbGVNZWV0QXZhaWxhYmxlKSB7XG4gICAgICAgICAgc2V0Tm90QXZhaWxhYmxlKHRydWUpXG4gICAgICAgICAgc2V0UGFyZW50Q29uZmVyZW5jZUFwcChudWxsKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNldE5vdEF2YWlsYWJsZShmYWxzZSlcbiAgICAgICAgfVxuICAgIFxuICAgICAgICBpZiAodmFsdWUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgc2V0UGFyZW50Q29uZmVyZW5jZUFwcChudWxsKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3Qgb25ab29tTWVldCA9ICh2YWx1ZTogYm9vbGVhbikgPT4ge1xuICAgICAgICBzZXRab29tTWVldCh2YWx1ZSlcbiAgICAgICAgc2V0UGFyZW50Wm9vbU1lZXQodmFsdWUpXG4gICAgICAgIHNldEdvb2dsZU1lZXQoIXZhbHVlKVxuICAgICAgICBzZXRQYXJlbnRHb29nbGVNZWV0KCF2YWx1ZSlcbiAgICBcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgc2V0UGFyZW50Q29uZmVyZW5jZUFwcCgnem9vbScpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2V0UGFyZW50Q29uZmVyZW5jZUFwcCgnZ29vZ2xlJylcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IG9uR29vZ2xlTWVldCA9ICh2YWx1ZTogYm9vbGVhbikgPT4ge1xuICAgICAgICBzZXRHb29nbGVNZWV0KHZhbHVlKVxuICAgICAgICBzZXRQYXJlbnRHb29nbGVNZWV0KHZhbHVlKVxuICAgICAgICBzZXRab29tTWVldCghdmFsdWUpXG4gICAgICAgIHNldFBhcmVudFpvb21NZWV0KCF2YWx1ZSlcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgc2V0UGFyZW50Q29uZmVyZW5jZUFwcCgnZ29vZ2xlJylcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZXRQYXJlbnRDb25mZXJlbmNlQXBwKCd6b29tJylcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgICA8Qm94IGZsZXg9ezF9IGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIG1pbkhlaWdodD1cIjY1dmhcIiB3aWR0aD1cIjEwMCVcIj5cbiAgICAgICAgICA8Qm94IGZsZXg9ezF9IHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19IGZsZXhEaXJlY3Rpb249XCJyb3dcIiBqdXN0aWZ5Q29udGVudD1cInNwYWNlLWJldHdlZW5cIiBhbGlnbkl0ZW1zPVwiZmxleC1zdGFydFwiIHdpZHRoPVwiNzAlXCI+XG4gICAgICAgICAgICA8VGV4dCB2YXJpYW50PVwib3B0aW9uSGVhZGVyXCIgcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0+XG4gICAgICAgICAgICAgIEVuYWJsZSBhIHZpcnR1YWwgbWVldGluZyBmb3IgdGhpcyBldmVudD9cbiAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1lbmRcIiBwdD17eyBwaG9uZTogJ20nLCB0YWJsZXQ6ICdzJyB9fT5cbiAgICAgICAgICAgICAgPFN3aXRjaDFcbiAgICAgICAgICAgICAgICBjaGVja2VkPXtlbmFibGVDb25mZXJlbmNlfVxuICAgICAgICAgICAgICAgIG9uVmFsdWVDaGFuZ2U9e29uRW5hYmxlVmlydHVhbH1cbiAgICAgICAgICAgICAgICBzdHlsZT17e21hcmdpbkJvdHRvbTogMjB9fVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgPEJveCBmbGV4PXsxfSB3aWR0aD1cIjcwJVwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19PlxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBub3RBdmFpbGFibGVcbiAgICAgICAgICAgICAgPyAoXG4gICAgICAgICAgICAgICAgPEJveCB3aWR0aD1cIjEwMCVcIj5cbiAgICAgICAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJzdWJoZWFkZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgM3JkIHBhcnR5IHByb3ZpZGVycyBhcmUgbm90IGVuYWJsZWQuIFBsZWFzZSBlbmFibGUgZWl0aGVyIHpvb20gb3IgZ29vZ2xlIHRvIHVzZSB0aGlzIGZlYXR1cmUuXG4gICAgICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgICAgPEJveCBmbGV4PXsxfSB3aWR0aD1cIjEwMCVcIj5cbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZW5hYmxlQ29uZmVyZW5jZVxuICAgICAgICAgICAgICAgICAgICA/IChcbiAgICAgICAgICAgICAgICAgICAgICA8Qm94IHdpZHRoPVwiMTAwJVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPEJveCB3aWR0aD1cIjEwMCVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzWm9vbUF2YWlsYWJsZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJveCAgd2lkdGg9XCIxMDAlXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCb3ggZmxleD17MX0gcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0gZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwic3BhY2UtYmV0d2VlblwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiB3aWR0aD1cIjEwMCVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8VGV4dCB2YXJpYW50PVwib3B0aW9uSGVhZGVyXCIgcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbmFibGUgYSBab29tIE1lZXRpbmcgZm9yIHRoaXMgZXZlbnQ/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1lbmRcIiBwdD17eyBwaG9uZTogJ20nLCB0YWJsZXQ6ICdzJyB9fT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxTd2l0Y2gxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e3pvb21NZWV0fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblZhbHVlQ2hhbmdlPXtvblpvb21NZWV0fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17e21hcmdpbkJvdHRvbTogMjB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCb3g+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTogbnVsbFxuICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxCb3ggd2lkdGg9XCIxMDAlXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0dvb2dsZU1lZXRBdmFpbGFibGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCb3ggZmxleD17MX0gcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0gZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwic3BhY2UtYmV0d2VlblwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiB3aWR0aD1cIjEwMCVcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD1cIm9wdGlvbkhlYWRlclwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVuYWJsZSBhIEdvb2dsZSBNZWV0IGZvciB0aGlzIGV2ZW50P1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1lbmRcIiBwdD17eyBwaG9uZTogJ20nLCB0YWJsZXQ6ICdzJyB9fT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8U3dpdGNoMVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17Z29vZ2xlTWVldH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uVmFsdWVDaGFuZ2U9e29uR29vZ2xlTWVldH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7bWFyZ2luQm90dG9tOiAyMH19XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApIDogbnVsbFxuICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgKSA6IG51bGxcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIDwvQm94PlxuICAgICAgICA8L0JveD5cbiAgICApXG5cbn1cblxuXG5leHBvcnQgZGVmYXVsdCBDTVBXU3RlcDNcbiJdfQ==