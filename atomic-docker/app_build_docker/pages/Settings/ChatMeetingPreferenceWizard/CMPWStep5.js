"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const colorsPalette_1 = require("@lib/theme/colorsPalette");
const Switch_1 = __importDefault(require("@components/Switch"));
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const TextField_1 = __importDefault(require("@components/TextField"));
const styles = {
    minThresholdCount: {
        fontSize: '21px',
        lineHeight: '28px',
    },
    container: {
        flex: 1,
    },
};
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("@config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
function CMPWStep5(props) {
    const [anyoneCanAddSelf, setAnyoneCanAddSelf] = (0, react_1.useState)(props?.anyoneCanAddSelf);
    const [guestsCanSeeOtherGuests, setGuestsCanSeeOtherGuests] = (0, react_1.useState)(props?.guestsCanSeeOtherGuests);
    const [primaryEmail, setPrimaryEmail] = (0, react_1.useState)(props?.primaryEmail);
    const [lockAfter, setLockAfter] = (0, react_1.useState)(props?.lockAfter);
    (0, react_1.useEffect)(() => {
        if (primaryEmail !== props?.primaryEmail) {
            setPrimaryEmail(props?.primaryEmail);
        }
    }, [primaryEmail, props?.primaryEmail]);
    const setParentAnyoneCanAddSelf = props?.setParentAnyoneCanAddSelf;
    const setParentGuestsCanSeeOtherGuests = props?.setParentGuestsCanSeeOtherGuests;
    const setParentPrimaryEmail = props?.setParentPrimaryEmail;
    const setParentLockAfter = props?.setParentLockAfter;
    const changeAnyoneCanAddSelf = (value) => {
        setAnyoneCanAddSelf(value);
        setParentAnyoneCanAddSelf(value);
    };
    const changeLockAfter = (value) => {
        setLockAfter(value);
        setParentLockAfter(value);
    };
    const changeGuestsCanSeeOtherGuests = (value) => {
        setGuestsCanSeeOtherGuests(value);
        setParentGuestsCanSeeOtherGuests(value);
    };
    const changePrimaryEmail = (e) => {
        setPrimaryEmail(e?.target?.value);
        setParentPrimaryEmail(e?.target?.value);
    };
    return ((0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, justifyContent: "center", alignItems: "center", style: { width: '100%' }, minHeight: "65vh", maxHeight: "65vh", children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: { tablet: "row" }, justifyContent: "space-between", alignItems: "flex-start", width: "70%", children: (0, jsx_runtime_1.jsx)(TextField_1.default, { label: "Primary Email", placeholder: "r@r.r", onChange: changePrimaryEmail, value: primaryEmail }) }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flexDirection: { tablet: "row" }, justifyContent: "space-between", alignItems: "flex-start", width: "70%", children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Can non-invited guests add themselves?" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { onColor: colorsPalette_1.colorsPalette.purple30, offColor: colorsPalette_1.colorsPalette.purple60, checked: anyoneCanAddSelf, onValueChange: changeAnyoneCanAddSelf, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flexDirection: { tablet: "row" }, justifyContent: "space-between", alignItems: "flex-start", width: "70%", children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Can guests see other guests?" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { onColor: colorsPalette_1.colorsPalette.purple30, offColor: colorsPalette_1.colorsPalette.purple60, checked: guestsCanSeeOtherGuests, onValueChange: changeGuestsCanSeeOtherGuests, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flexDirection: { tablet: "row" }, justifyContent: "space-between", alignItems: "flex-start", width: "70%", children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Lock after event created?" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { onColor: colorsPalette_1.colorsPalette.purple30, offColor: colorsPalette_1.colorsPalette.purple60, checked: lockAfter, onValueChange: changeLockAfter, style: { marginBottom: 20 } }) })] })] }));
}
exports.default = CMPWStep5;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ01QV1N0ZXA1LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQ01QV1N0ZXA1LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQTRCQSxnREFxQ0M7O0FBakVELGlDQUtjO0FBQ2QsNERBQWtFO0FBRWxFLGdFQUF3QztBQUN4QyxpRUFBd0M7QUFDeEMsbUVBQTBDO0FBQzFDLHNFQUE2QztBQUU3QyxNQUFNLE1BQU0sR0FBRztJQUNYLGlCQUFpQixFQUFFO1FBQ2YsUUFBUSxFQUFFLE1BQU07UUFDaEIsVUFBVSxFQUFFLE1BQU07S0FDckI7SUFDRCxTQUFTLEVBQUU7UUFDVCxJQUFJLEVBQUUsQ0FBQztLQUNSO0NBQ0osQ0FBQTtBQUdELHdFQUE4QztBQUM5Qyx5REFBcUQ7QUFDckQsOEVBQXFEO0FBRTlDLEtBQUssVUFBVSxrQkFBa0IsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQWlEO0lBQ2hHLDBGQUEwRjtJQUMxRixzQ0FBc0M7SUFDdEMseUVBQXlFO0lBQ3pFLDBCQUFlLENBQUMsSUFBSSxDQUFDLElBQUEsNkJBQWEsR0FBRSxDQUFDLENBQUE7SUFDckMsSUFBSSxPQUFPLENBQUE7SUFDWCxJQUFJLENBQUM7UUFDRCxPQUFPLEdBQUcsTUFBTSxpQkFBTyxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFO1lBQ3pDLDZCQUE2QixFQUFFLEtBQUs7Z0JBQ2hDLE9BQU8sRUFBRSxDQUFBO1lBQ2IsQ0FBQztTQUNKLENBQUMsQ0FBQTtJQUNOLENBQUM7SUFBQyxPQUFPLEdBQVEsRUFBRSxDQUFDO1FBQ2hCLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxpQkFBTyxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQy9DLE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLEVBQUUsQ0FBQTtRQUMxRCxDQUFDO2FBQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLGlCQUFPLENBQUMs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QUFFLGVBQWUsRUFDOUIsS0FBSyxFQUFFLEVBQUMsWUFBWSxFQUFFLEVBQUUsRUFBQyxHQUMzQixHQUNBLElBQ0osSUFDSixDQUNULENBQUE7QUFFTCxDQUFDO0FBRUQsa0JBQWUsU0FBUyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7XG4gICAgdXNlU3RhdGUsXG4gICAgRGlzcGF0Y2gsXG4gICAgU2V0U3RhdGVBY3Rpb24sXG4gICAgdXNlRWZmZWN0LFxufSBmcm9tICdyZWFjdCdcbmltcG9ydCB7IGNvbG9yc1BhbGV0dGUgYXMgQ29sb3JzIH0gZnJvbSAnQGxpYi90aGVtZS9jb2xvcnNQYWxldHRlJ1xuaW1wb3J0IHsgVG9vbHRpcCB9IGZyb20gJ0BjaGFrcmEtdWkvcmVhY3QnXG5pbXBvcnQgU3dpdGNoMSBmcm9tICdAY29tcG9uZW50cy9Td2l0Y2gnXG5pbXBvcnQgQm94IGZyb20gJ0Bjb21wb25lbnRzL2NvbW1vbi9Cb3gnXG5pbXBvcnQgVGV4dCBmcm9tICdAY29tcG9uZW50cy9jb21tb24vVGV4dCdcbmltcG9ydCBUZXh0RmllbGQgZnJvbSAnQGNvbXBvbmVudHMvVGV4dEZpZWxkJ1xuXG5jb25zdCBzdHlsZXMgPSB7XG4gICAgbWluVGhyZXNob2xkQ291bnQ6IHtcbiAgICAgICAgZm9udFNpemU6ICcyMXB4JyxcbiAgICAgICAgbGluZUhlaWdodDogJzI4cHgnLFxuICAgIH0sXG4gICAgY29udGFpbmVyOiB7XG4gICAgICBmbGV4OiAxLFxuICAgIH0sXG59XG5cbmltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcbmltcG9ydCBzdXBlcnRva2Vuc05vZGUgZnJvbSAnc3VwZXJ0b2tlbnMtbm9kZSdcbmltcG9ydCB7IGJhY2tlbmRDb25maWcgfSBmcm9tICdAY29uZmlnL2JhY2tlbmRDb25maWcnXG5pbXBvcnQgU2Vzc2lvbiBmcm9tICdzdXBlcnRva2Vucy1ub2RlL3JlY2lwZS9zZXNzaW9uJ1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2VydmVyU2lkZVByb3BzKHsgcmVxLCByZXMgfTogeyByZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSB9KSB7XG4gICAgLy8gTm90aWNlIGhvdyB0aGUgc2VydmVyIHVzZXMgYEFQSWAgZnJvbSBgd2l0aFNTUkNvbnRleHRgLCBpbnN0ZWFkIG9mIHRoZSB0b3AtbGV2ZWwgYEFQSWAuXG4gICAgLy8gY29uc3QgU1NSID0gd2l0aFNTUkNvbnRleHQoeyByZXEgfSlcbiAgICAvLyB0aGlzIHJ1bnMgb24gdGhlIGJhY2tlbmQsIHNvIHdlIG11c3QgY2FsbCBpbml0IG9uIHN1cGVydG9rZW5zLW5vZGUgU0RLXG4gICAgc3VwZXJ0b2tlbnNOb2RlLmluaXQoYmFja2VuZENvbmZpZygpKVxuICAgIGxldCBzZXNzaW9uXG4gICAgdHJ5IHtcbiAgICAgICAgc2Vzc2lvbiA9IGF3YWl0IFNlc3Npb24uZ2V0U2Vzc2lvbihyZXEsIHJlcywge1xuICAgICAgICAgICAgb3ZlcnJpZGVHbG9iYWxDbGFpbVZhbGlkYXRvcnM6IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gW11cbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pXG4gICAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICAgICAgaWYgKGVyci50eXBlID09PSBTZXNzaW9uLkVycm9yLlRSWV9SRUZSRVNIX1RPS0VOKSB7XG4gICAgICAgICAgICByZXR1cm4geyBwcm9wczogeyBmcm9tU3VwZXJ0b2tlbnM6ICduZWVkcy1yZWZyZXNoJyB9IH1cbiAgICAgICAgfSBlbHNlIGlmIChlcnIudHlwZSA9PT0gU2Vzc2lvbi5FcnJvci5VTkFVVEhPUklTRUQpIHtcbiAgICAgICAgICAgIC8vIHRoaXMgd2lsbCBmb3JjZSB0aGUgZnJvbnRlbmQgdG8gdHJ5IGFuZCByZWZyZXNoIHdoaWNoIHdpbGwgZmFpbFxuICAgICAgICAgICAgLy8gY2xlYXJpbmcgYWxsIGNvb2tpZXMgYW5kIHJlZGlyZWN0aW5nIHRoZSB1c2VyIHRvIHRoZSBsb2dpbiBzY3JlZW4uXG4gICAgICAgICAgICByZXR1cm4geyBwcm9wczogeyBmcm9tU3VwZXJ0b2tlbnM6ICduZWVkcy1yZWZyZXNoJyB9IH1cbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBlcnJcbiAgICB9XG5cbiAgICBpZiAoIXNlc3Npb24/LmdldFVzZXJJZCgpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZWRpcmVjdDoge1xuICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiAnL1VzZXIvTG9naW4vVXNlckxvZ2luJyxcbiAgICAgICAgICAgICAgICBwZXJtYW5lbnQ6IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIHByb3BzOiB7XG4gICAgICAgIHN1Yjogc2Vzc2lvbi5nZXRVc2VySWQoKSxcbiAgICAgICAgfVxuICAgIH1cbn1cblxuICB0eXBlIFByb3BzID0ge1xuICAgIGFueW9uZUNhbkFkZFNlbGY6IGJvb2xlYW4sXG4gICAgZ3Vlc3RzQ2FuU2VlT3RoZXJHdWVzdHM6IGJvb2xlYW4sXG4gICAgbG9ja0FmdGVyOiBib29sZWFuLFxuICAgIHByaW1hcnlFbWFpbDogc3RyaW5nLFxuICAgIHNldFBhcmVudEFueW9uZUNhbkFkZFNlbGY6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPGJvb2xlYW4+PixcbiAgICBzZXRQYXJlbnRHdWVzdHNDYW5TZWVPdGhlckd1ZXN0czogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248Ym9vbGVhbj4+LFxuICAgIHNldFBhcmVudFByaW1hcnlFbWFpbDogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248c3RyaW5nPj4sXG4gICAgc2V0UGFyZW50TG9ja0FmdGVyOiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxib29sZWFuPj4sXG59XG5cblxuZnVuY3Rpb24gQ01QV1N0ZXA1KHByb3BzOiBQcm9wcykge1xuICAgIGNvbnN0IFthbnlvbmVDYW5BZGRTZWxmLCBzZXRBbnlvbmVDYW5BZGRTZWxmXSA9IHVzZVN0YXRlPGJvb2xlYW4+KHByb3BzPy5hbnlvbmVDYW5BZGRTZWxmKVxuICAgIGNvbnN0IFtndWVzdHNDYW5TZWVPdGhlckd1ZXN0cywgc2V0R3Vlc3RzQ2FuU2VlT3RoZXJHdWVzdHNdID0gdXNlU3RhdGU8Ym9vbGVhbj4ocHJvcHM/Lmd1ZXN0c0NhblNlZU90aGVyR3Vlc3RzKVxuICAgIGNvbnN0IFtwcmltYXJ5RW1haWwsIHNldFByaW1hcnlFbWFpbF0gPSB1c2VTdGF0ZTxzdHJpbmc+KHByb3BzPy5wcmltYXJ5RW1haWwpXG4gICAgY29uc3QgW2xvY2tBZnRlciwgc2V0TG9ja0FmdGVyXSA9IHVzZVN0YXRlPGJvb2xlYW4+KHByb3BzPy5sb2NrQWZ0ZXIpXG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAocHJpbWFyeUVtYWlsICE9PSBwcm9wcz8ucHJpbWFyeUVtYWlsKSB7XG4gICAgICAgICAgc2V0UHJpbWFyeUVtYWlsKHByb3BzPy5wcmltYXJ5RW1haWwpXG4gICAgICAgIH1cbiAgICAgIH0sIFtwcmltYXJ5RW1haWwsIHByb3BzPy5wcmltYXJ5RW1haWxdKVxuXG4gICAgY29uc3Qgc2V0UGFyZW50QW55b25lQ2FuQWRkU2VsZiA9IHByb3BzPy5zZXRQYXJlbnRBbnlvbmVDYW5BZGRTZWxmXG4gICAgY29uc3Qgc2V0UGFyZW50R3Vlc3RzQ2FuU2VlT3RoZXJHdWVzdHMgPSBwcm9wcz8uc2V0UGFyZW50R3Vlc3RzQ2FuU2VlT3RoZXJHdWVzdHNcbiAgICBjb25zdCBzZXRQYXJlbnRQcmltYXJ5RW1haWwgPSBwcm9wcz8uc2V0UGFyZW50UHJpbWFyeUVtYWlsXG4gICAgY29uc3Qgc2V0UGFyZW50TG9ja0FmdGVyID0gcHJvcHM/LnNldFBhcmVudExvY2tBZnRlclxuICAgIFxuICAgIGNvbnN0IGNoYW5nZUFueW9uZUNhbkFkZFNlbGYgPSAodmFsdWU6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgc2V0QW55b25lQ2FuQWRkU2VsZih2YWx1ZSlcbiAgICAgICAgc2V0UGFyZW50QW55b25lQ2FuQWRkU2VsZih2YWx1ZSlcbiAgICB9XG5cbiAgICBjb25zdCBjaGFuZ2VMb2NrQWZ0ZXIgPSAodmFsdWU6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgc2V0TG9ja0FmdGVyKHZhbHVlKVxuICAgICAgICBzZXRQYXJlbnRMb2NrQWZ0ZXIodmFsdWUpXG4gICAgfVxuXG4gICAgY29uc3QgY2hhbmdlR3Vlc3RzQ2FuU2VlT3RoZXJHdWVzdHMgPSAodmFsdWU6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgc2V0R3Vlc3RzQ2FuU2VlT3RoZXJHdWVzdHModmFsdWUpXG4gICAgICAgIHNldFBhcmVudEd1ZXN0c0NhblNlZU90aGVyR3Vlc3RzKHZhbHVlKVxuICAgIH1cblxuICAgIGNvbnN0IGNoYW5nZVByaW1hcnlFbWFpbCA9IChlOiB7IHRhcmdldDogeyB2YWx1ZTogUmVhY3QuU2V0U3RhdGVBY3Rpb248c3RyaW5nPiB9IH0pID0+IHtcbiAgICAgICAgc2V0UHJpbWFyeUVtYWlsKGU/LnRhcmdldD8udmFsdWUpXG4gICAgICAgIHNldFBhcmVudFByaW1hcnlFbWFpbChlPy50YXJnZXQ/LnZhbHVlKVxuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICAgIDxCb3ggZmxleD17MX0ganVzdGlmeUNvbnRlbnQ9XCJjZW50ZXJcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgc3R5bGU9e3sgd2lkdGg6ICcxMDAlJyB9fSBtaW5IZWlnaHQ9XCI2NXZoXCIgbWF4SGVpZ2h0PVwiNjV2aFwiPlxuICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPXt7IHRhYmxldDogXCJyb3dcIn19IGp1c3RpZnlDb250ZW50PVwic3BhY2UtYmV0d2VlblwiIGFsaWduSXRlbXM9XCJmbGV4LXN0YXJ0XCIgd2lkdGg9XCI3MCVcIj5cbiAgICAgICAgICAgICAgICA8VGV4dEZpZWxkXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsPVwiUHJpbWFyeSBFbWFpbFwiXG4gICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwickByLnJcIlxuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17Y2hhbmdlUHJpbWFyeUVtYWlsfVxuICAgICAgICAgICAgICAgICAgICB2YWx1ZT17cHJpbWFyeUVtYWlsfVxuICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj17eyB0YWJsZXQ6IFwicm93XCJ9fSBqdXN0aWZ5Q29udGVudD1cInNwYWNlLWJldHdlZW5cIiBhbGlnbkl0ZW1zPVwiZmxleC1zdGFydFwiIHdpZHRoPVwiNzAlXCI+XG4gICAgICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LXN0YXJ0XCIgID5cbiAgICAgICAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD1cIm9wdGlvbkhlYWRlclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgQ2FuIG5vbi1pbnZpdGVkIGd1ZXN0cyBhZGQgdGhlbXNlbHZlcz9cbiAgICAgICAgICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1lbmRcIiBwdD17eyBwaG9uZTogJ20nLCB0YWJsZXQ6ICdzJyB9fT5cbiAgICAgICAgICAgICAgICAgICAgPFN3aXRjaDFcbiAgICAgICAgICAgICAgICAgICAgICAgIG9uQ29sb3I9e0NvbG9ycy5wdXJwbGUzMH1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9mZkNvbG9yPXtDb2xvcnMucHVycGxlNjB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkPXthbnlvbmVDYW5BZGRTZWxmfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25WYWx1ZUNoYW5nZT17Y2hhbmdlQW55b25lQ2FuQWRkU2VsZn1cbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7bWFyZ2luQm90dG9tOiAyMH19XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj17eyB0YWJsZXQ6IFwicm93XCJ9fSBqdXN0aWZ5Q29udGVudD1cInNwYWNlLWJldHdlZW5cIiBhbGlnbkl0ZW1zPVwiZmxleC1zdGFydFwiIHdpZHRoPVwiNzAlXCI+XG4gICAgICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LXN0YXJ0XCIgcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0gPlxuICAgICAgICAgICAgICAgICAgICA8VGV4dCB2YXJpYW50PVwib3B0aW9uSGVhZGVyXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICBDYW4gZ3Vlc3RzIHNlZSBvdGhlciBndWVzdHM/XG4gICAgICAgICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICA8Qm94IGZsZXhEaXJlY3Rpb249XCJyb3dcIiBqdXN0aWZ5Q29udGVudD1cImZsZXgtZW5kXCIgcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0+XG4gICAgICAgICAgICAgICAgICAgIDxTd2l0Y2gxXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNvbG9yPXtDb2xvcnMucHVycGxlMzB9XG4gICAgICAgICAgICAgICAgICAgICAgICBvZmZDb2xvcj17Q29sb3JzLnB1cnBsZTYwfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17Z3Vlc3RzQ2FuU2VlT3RoZXJHdWVzdHN9XG4gICAgICAgICAgICAgICAgICAgICAgICBvblZhbHVlQ2hhbmdlPXtjaGFuZ2VHdWVzdHNDYW5TZWVPdGhlckd1ZXN0c31cbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7bWFyZ2luQm90dG9tOiAyMH19XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj17eyB0YWJsZXQ6IFwicm93XCJ9fSBqdXN0aWZ5Q29udGVudD1cInNwYWNlLWJldHdlZW5cIiBhbGlnbkl0ZW1zPVwiZmxleC1zdGFydFwiIHdpZHRoPVwiNzAlXCI+XG4gICAgICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LXN0YXJ0XCIgID5cbiAgICAgICAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD1cIm9wdGlvbkhlYWRlclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgTG9jayBhZnRlciBldmVudCBjcmVhdGVkP1xuICAgICAgICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LWVuZFwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19PlxuICAgICAgICAgICAgICAgICAgICA8U3dpdGNoMVxuICAgICAgICAgICAgICAgICAgICAgICAgb25Db2xvcj17Q29sb3JzLnB1cnBsZTMwfVxuICAgICAgICAgICAgICAgICAgICAgICAgb2ZmQ29sb3I9e0NvbG9ycy5wdXJwbGU2MH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e2xvY2tBZnRlcn1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uVmFsdWVDaGFuZ2U9e2NoYW5nZUxvY2tBZnRlcn1cbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7bWFyZ2luQm90dG9tOiAyMH19XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgPC9Cb3g+XG4gICAgKVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IENNUFdTdGVwNSJdfQ==