"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("@chakra-ui/react");
const react_2 = require("react");
const constants_1 = require("@lib/constants");
const api_backend_helper_1 = require("@lib/api-backend-helper");
async function getServerSideProps({ req, res }) {
    const thisUrl = new URL(req.url, `https://${req.headers.host}`);
    if (thisUrl.searchParams.get('code')) {
        const urlParam = thisUrl.searchParams.get('code');
        console.log(urlParam, ' code');
        const state = thisUrl.searchParams.get('state');
        console.log(state, ' state');
        const userId = state;
        // console.log(process.env.ZOOM_CLIENT_ID, ' clientId')
        // console.log(process.env.ZOOM_CLIENT_SECRET, ' clientSecret')
        const data = process.env.ZOOM_CLIENT_ID + ':' + process.env.ZOOM_CLIENT_SECRET;
        const newData = Buffer.from(data, 'utf8');
        const b64string = newData.toString('base64');
        // console.log(b64string, ' b64string')
        const zoomUrl = new URL('https://zoom.us/oauth/token');
        zoomUrl.searchParams.set('grant_type', 'authorization_code');
        zoomUrl.searchParams.set('code', urlParam);
        // dev only
        zoomUrl.searchParams.set('redirect_uri', process.env.NEXT_PUBLIC_ZOOM_REDIRECT_URL);
        // zoomUrl.searchParams.set('state', state)
        try {
            const options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Basic ' + b64string
                }
            };
            const response = await fetch(zoomUrl.href, options);
            const zoomAuthTokens = await response.json();
            // console.log(zoomAuthTokens, ' zoomAuthTokens')
            const newOptions = {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + zoomAuthTokens.access_token
                }
            };
            const preUser = await fetch('https://api.zoom.us/v2/users/me', newOptions);
            const zoomUser = await preUser.json();
            console.log(zoomUser, ' zoomUser');
            if (zoomAuthTokens.access_token && userId) {
                const zoomIntegration = await (0, api_backend_helper_1.getMinimalCalendarIntegrationByResource)(userId, constants_1.zoomResourceName);
                if (!zoomIntegration?.id) {
                    throw new Error('zoom integration not found');
                }
                await (0, api_backend_helper_1.updateZoomIntegration)(zoomIntegration?.id, zoomUser?.account_id, zoomUser?.email, zoomUser?.id, zoomAuthTokens?.access_token, zoomAuthTokens?.expires_in, zoomAuthTokens?.refresh_token, zoomUser?.first_name, zoomUser?.last_name, zoomUser?.phone_country, zoomUser?.phone_number, true);
                return {
                    props: { zoomUser, userId }
                };
            }
        }
        catch (e) {
            console.log(e, ' unable to get response');
        }
    }
    return {
        props: {},
    };
}
const ZoomWebCallback = ({ zoomUser, userId }) => {
    // const [url, setUrl] = useState('')
    const [isValid, setIsValid] = (0, react_2.useState)(true);
    // const router = useRouter()
    const toast = (0, react_1.useToast)();
    (0, react_2.useEffect)(() => {
        if (!zoomUser?.id || !userId) {
            toast({
                title: 'Missing info',
                description: "Somehting went wrong with the Auth process. Let us know or try again.",
                status: 'error',
                duration: 9000,
                isClosable: true,
            });
            setIsValid(false);
            return;
        }
    }, [toast, userId, zoomUser?.id]);
    return ((0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col justify-center items-center h-screen w-full", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col justify-center items-center text-center sm:text-left lg:my-12 sm:my-8 w-full", children: [(0, jsx_runtime_1.jsx)("h1", { className: "text-xl font-bold text-gray-900 dark:text-gray-100  sm:text-2xl", children: "Success!" }), (0, jsx_runtime_1.jsx)("p", { className: "mt-1.5 text-sm text-gray-500 dark:text-gray-100", children: "Zoom Successfully Authenticated ðŸŽ‰!" }), (0, jsx_runtime_1.jsx)("p", { className: "mt-1.5 text-sm text-gray-500 dark:text-gray-100", children: "You can close this tab and refresh https://app.atomiclife.app to get updated view" }), !isValid
                        ? ((0, jsx_runtime_1.jsx)("p", { className: "mt-1.5 text-sm text-red-500", children: "Something went wrong with the sync " })) : null] }), (0, jsx_runtime_1.jsx)(react_1.Spinner, { color: 'pink.500' })] }));
};
exports.default = ZoomWebCallback;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9iaWxlLWNhbGxiYWNrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibW9iaWxlLWNhbGxiYWNrLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQVNBLGdEQW9GQzs7QUE1RkQsNENBQW9EO0FBQ3BELGlDQUEyQztBQUkzQyw4Q0FBa0Q7QUFDbEQsZ0VBQXlHO0FBRWxHLEtBQUssVUFBVSxrQkFBa0IsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQWlEO0lBR2hHLE1BQU0sT0FBTyxHQUFHLElBQUksR0FBRyxDQUFDLEdBQUcsQ0FBQyxHQUFhLEVBQUUsV0FBVyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUE7SUFFekUsSUFBSSxPQUFPLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1FBQ25DLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBVyxDQUFBO1FBQzNELE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFBO1FBQzlCLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBVyxDQUFBO1FBQ3pELE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxDQUFBO1FBQzVCLE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQTtRQUVwQix1REFBdUQ7UUFDdkQsK0RBQStEO1FBQy9ELE1BQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxHQUFHLEdBQUcsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFBO1FBQzlFLE1BQU0sT0FBTyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFBO1FBQ3pDLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENB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QUMsR0FBRyxFQUFFO1FBQ1gsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUMzQixLQUFLLENBQUM7Z0JBQ0YsS0FBSyxFQUFFLGNBQWM7Z0JBQ3JCLFdBQVcsRUFBRSx1RUFBdUU7Z0JBQ3BGLE1BQU0sRUFBRSxPQUFPO2dCQUNmLFFBQVEsRUFBRSxJQUFJO2dCQUNkLFVBQVUsRUFBRSxJQUFJO2FBQ25CLENBQUMsQ0FBQTtZQUNGLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQTtZQUNqQixPQUFNO1FBQ1YsQ0FBQztJQUlMLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUE7SUFFakMsT0FBTyxDQUNILGlDQUFLLFNBQVMsRUFBQywyREFBMkQsYUFDdEUsaUNBQUssU0FBUyxFQUFDLDRGQUE0RixhQUN2RywrQkFBSSxTQUFTLEVBQUMsaUVBQWlFLFlBQzFFLFVBQVUsR0FDVixFQUVMLDhCQUFHLFNBQVMsRUFBQyxpREFBaUQsWUFDekQscUNBQXFDLEdBQ3RDLEVBQ0osOEJBQUcsU0FBUyxFQUFDLGlEQUFpRCxZQUN6RCxtRkFBbUYsR0FDcEYsRUFFSixDQUFDLE9BQU87d0JBQ0osQ0FBQyxDQUFDLENBQ0UsOEJBQUcsU0FBUyxFQUFDLDZCQUE2QixZQUNyQyxxQ0FBcUMsR0FDdEMsQ0FDUCxDQUFDLENBQUMsQ0FBQyxJQUFJLElBRVYsRUFDTix1QkFBQyxlQUFPLElBQUMsS0FBSyxFQUFDLFVBQVUsR0FBRyxJQUMxQixDQUNULENBQUE7QUFDTCxDQUFDLENBQUE7QUFFRCxrQkFBZSxlQUFlLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJcbmltcG9ydCB7IHVzZVRvYXN0LCBTcGlubmVyIH0gZnJvbSAnQGNoYWtyYS11aS9yZWFjdCdcbmltcG9ydCB7IHVzZUVmZmVjdCwgdXNlU3RhdGUgfSBmcm9tIFwicmVhY3RcIlxuaW1wb3J0IHsgTmV4dFBhZ2UsIE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tIFwibmV4dFwiXG5pbXBvcnQgeyBab29tSlNPTlJlc3BvbnNlVHlwZSwgWm9vbUpTT05Vc2VyUmVzcG9uc2VUeXBlIH0gZnJvbSBcIkBsaWIvdHlwZXNcIlxuXG5pbXBvcnQgeyB6b29tUmVzb3VyY2VOYW1lIH0gZnJvbSAnQGxpYi9jb25zdGFudHMnO1xuaW1wb3J0IHsgZ2V0TWluaW1hbENhbGVuZGFySW50ZWdyYXRpb25CeVJlc291cmNlLCB1cGRhdGVab29tSW50ZWdyYXRpb24gfSBmcm9tICdAbGliL2FwaS1iYWNrZW5kLWhlbHBlcic7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTZXJ2ZXJTaWRlUHJvcHMoeyByZXEsIHJlcyB9OiB7IHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlIH0pIHtcbiAgICBcbiAgICBcbiAgICBjb25zdCB0aGlzVXJsID0gbmV3IFVSTChyZXEudXJsIGFzIHN0cmluZywgYGh0dHBzOi8vJHtyZXEuaGVhZGVycy5ob3N0fWApXG4gICAgXG4gICAgaWYgKHRoaXNVcmwuc2VhcmNoUGFyYW1zLmdldCgnY29kZScpKSB7XG4gICAgICAgIGNvbnN0IHVybFBhcmFtID0gdGhpc1VybC5zZWFyY2hQYXJhbXMuZ2V0KCdjb2RlJykgYXMgc3RyaW5nXG4gICAgICAgIGNvbnNvbGUubG9nKHVybFBhcmFtLCAnIGNvZGUnKVxuICAgICAgICBjb25zdCBzdGF0ZSA9IHRoaXNVcmwuc2VhcmNoUGFyYW1zLmdldCgnc3RhdGUnKSBhcyBzdHJpbmdcbiAgICAgICAgY29uc29sZS5sb2coc3RhdGUsICcgc3RhdGUnKVxuICAgICAgICBjb25zdCB1c2VySWQgPSBzdGF0ZVxuXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHByb2Nlc3MuZW52LlpPT01fQ0xJRU5UX0lELCAnIGNsaWVudElkJylcbiAgICAgICAgLy8gY29uc29sZS5sb2cocHJvY2Vzcy5lbnYuWk9PTV9DTElFTlRfU0VDUkVULCAnIGNsaWVudFNlY3JldCcpXG4gICAgICAgIGNvbnN0IGRhdGEgPSBwcm9jZXNzLmVudi5aT09NX0NMSUVOVF9JRCArICc6JyArIHByb2Nlc3MuZW52LlpPT01fQ0xJRU5UX1NFQ1JFVFxuICAgICAgICBjb25zdCBuZXdEYXRhID0gQnVmZmVyLmZyb20oZGF0YSwgJ3V0ZjgnKVxuICAgICAgICBjb25zdCBiNjRzdHJpbmcgPSBuZXdEYXRhLnRvU3RyaW5nKCdiYXNlNjQnKVxuICAgICAgICAvLyBjb25zb2xlLmxvZyhiNjRzdHJpbmcsICcgYjY0c3RyaW5nJylcblxuICAgICAgICBjb25zdCB6b29tVXJsID0gbmV3IFVSTCgnaHR0cHM6Ly96b29tLnVzL29hdXRoL3Rva2VuJylcbiAgICAgICAgem9vbVVybC5zZWFyY2hQYXJhbXMuc2V0KCdncmFudF90eXBlJywgJ2F1dGhvcml6YXRpb25fY29kZScpXG4gICAgICAgIHpvb21Vcmwuc2VhcmNoUGFyYW1zLnNldCgnY29kZScsIHVybFBhcmFtKVxuICAgICAgICAvLyBkZXYgb25seVxuICAgICAgICB6b29tVXJsLnNlYXJjaFBhcmFtcy5zZXQoJ3JlZGlyZWN0X3VyaScsIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1pPT01fUkVESVJFQ1RfVVJMIGFzIHN0cmluZylcbiAgICAgICAgLy8gem9vbVVybC5zZWFyY2hQYXJhbXMuc2V0KCdzdGF0ZScsIHN0YXRlKVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBvcHRpb25zID0ge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiAnQmFzaWMgJyArIGI2NHN0cmluZ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goem9vbVVybC5ocmVmLCBvcHRpb25zKSAgXG4gICAgICAgICAgICBjb25zdCB6b29tQXV0aFRva2VuczogWm9vbUpTT05SZXNwb25zZVR5cGUgPSBhd2FpdCByZXNwb25zZS5qc29uKClcblxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coem9vbUF1dGhUb2tlbnMsICcgem9vbUF1dGhUb2tlbnMnKVxuXG4gICAgICAgICAgICBjb25zdCBuZXdPcHRpb25zID0ge1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6ICdCZWFyZXIgJyArIHpvb21BdXRoVG9rZW5zLmFjY2Vzc190b2tlblxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnN0IHByZVVzZXIgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9hcGkuem9vbS51cy92Mi91c2Vycy9tZScsIG5ld09wdGlvbnMpXG4gICAgICAgICAgICAgICAgY29uc3Qgem9vbVVzZXI6IFpvb21KU09OVXNlclJlc3BvbnNlVHlwZSA9IGF3YWl0IHByZVVzZXIuanNvbigpXG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh6b29tVXNlciwgJyB6b29tVXNlcicpXG4gICAgICAgICAgICBpZiAoem9vbUF1dGhUb2tlbnMuYWNjZXNzX3Rva2VuICYmIHVzZXJJZCkge1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNvbnN0IHpvb21JbnRlZ3JhdGlvbiA9IGF3YWl0IGdldE1pbmltYWxDYWxlbmRhckludGVncmF0aW9uQnlSZXNvdXJjZSh1c2VySWQsIHpvb21SZXNvdXJjZU5hbWUpXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKCF6b29tSW50ZWdyYXRpb24/LmlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignem9vbSBpbnRlZ3JhdGlvbiBub3QgZm91bmQnKVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGF3YWl0IHVwZGF0ZVpvb21JbnRlZ3JhdGlvbihcbiAgICAgICAgICAgICAgICAgICAgem9vbUludGVncmF0aW9uPy5pZCxcbiAgICAgICAgICAgICAgICAgICAgem9vbVVzZXI/LmFjY291bnRfaWQsXG4gICAgICAgICAgICAgICAgICAgIHpvb21Vc2VyPy5lbWFpbCxcbiAgICAgICAgICAgICAgICAgICAgem9vbVVzZXI/LmlkLFxuICAgICAgICAgICAgICAgICAgICB6b29tQXV0aFRva2Vucz8uYWNjZXNzX3Rva2VuLFxuICAgICAgICAgICAgICAgICAgICB6b29tQXV0aFRva2Vucz8uZXhwaXJlc19pbixcbiAgICAgICAgICAgICAgICAgICAgem9vbUF1dGhUb2tlbnM/LnJlZnJlc2hfdG9rZW4sXG4gICAgICAgICAgICAgICAgICAgIHpvb21Vc2VyPy5maXJzdF9uYW1lLFxuICAgICAgICAgICAgICAgICAgICB6b29tVXNlcj8ubGFzdF9uYW1lLFxuICAgICAgICAgICAgICAgICAgICB6b29tVXNlcj8ucGhvbmVfY291bnRyeSxcbiAgICAgICAgICAgICAgICAgICAgem9vbVVzZXI/LnBob25lX251bWJlcixcbiAgICAgICAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICAgICApXG5cbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBwcm9wczoge3pvb21Vc2VyLCB1c2VySWQgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZSwgJyB1bmFibGUgdG8gZ2V0IHJlc3BvbnNlJylcbiAgICAgICAgfVxuICAgIH1cblxuICByZXR1cm4ge1xuICAgIHByb3BzOiB7fSxcbiAgfVxufVxuXG50eXBlIFByb3BzID0ge1xuICAgIHpvb21Vc2VyOiBab29tSlNPTlVzZXJSZXNwb25zZVR5cGUsXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgcGF0aDogc3RyaW5nLFxufVxuXG5jb25zdCBab29tV2ViQ2FsbGJhY2s6IE5leHRQYWdlPFByb3BzPiA9ICh7IHpvb21Vc2VyLCB1c2VySWQgfSkgPT4ge1xuICAgIC8vIGNvbnN0IFt1cmwsIHNldFVybF0gPSB1c2VTdGF0ZSgnJylcbiAgICBjb25zdCBbaXNWYWxpZCwgc2V0SXNWYWxpZF0gID0gdXNlU3RhdGU8Ym9vbGVhbj4odHJ1ZSlcbiAgICAvLyBjb25zdCByb3V0ZXIgPSB1c2VSb3V0ZXIoKVxuXG4gICAgY29uc3QgdG9hc3QgPSB1c2VUb2FzdCgpXG5cbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoIXpvb21Vc2VyPy5pZCB8fCAhdXNlcklkKSB7XG4gICAgICAgICAgICB0b2FzdCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICdNaXNzaW5nIGluZm8nLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIlNvbWVodGluZyB3ZW50IHdyb25nIHdpdGggdGhlIEF1dGggcHJvY2Vzcy4gTGV0IHVzIGtub3cgb3IgdHJ5IGFnYWluLlwiLFxuICAgICAgICAgICAgICAgIHN0YXR1czogJ2Vycm9yJyxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogOTAwMCxcbiAgICAgICAgICAgICAgICBpc0Nsb3NhYmxlOiB0cnVlLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHNldElzVmFsaWQoZmFsc2UpXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfSAgXG4gICAgICAgIFxuICAgICAgICBcbiAgICAgICAgXG4gICAgfSwgW3RvYXN0LCB1c2VySWQsIHpvb21Vc2VyPy5pZF0pXG5cbiAgICByZXR1cm4gKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZmxleC1jb2wganVzdGlmeS1jZW50ZXIgaXRlbXMtY2VudGVyIGgtc2NyZWVuIHctZnVsbFwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtY29sIGp1c3RpZnktY2VudGVyIGl0ZW1zLWNlbnRlciB0ZXh0LWNlbnRlciBzbTp0ZXh0LWxlZnQgbGc6bXktMTIgc206bXktOCB3LWZ1bGxcIj5cbiAgICAgICAgICAgICAgICA8aDEgY2xhc3NOYW1lPVwidGV4dC14bCBmb250LWJvbGQgdGV4dC1ncmF5LTkwMCBkYXJrOnRleHQtZ3JheS0xMDAgIHNtOnRleHQtMnhsXCI+XG4gICAgICAgICAgICAgICAgICAgIHtcIlN1Y2Nlc3MhXCJ9XG4gICAgICAgICAgICAgICAgPC9oMT5cblxuICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cIm10LTEuNSB0ZXh0LXNtIHRleHQtZ3JheS01MDAgZGFyazp0ZXh0LWdyYXktMTAwXCI+XG4gICAgICAgICAgICAgICAgICAgIHtcIlpvb20gU3VjY2Vzc2Z1bGx5IEF1dGhlbnRpY2F0ZWQg8J+OiSFcIn1cbiAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPVwibXQtMS41IHRleHQtc20gdGV4dC1ncmF5LTUwMCBkYXJrOnRleHQtZ3JheS0xMDBcIj5cbiAgICAgICAgICAgICAgICAgICAge1wiWW91IGNhbiBjbG9zZSB0aGlzIHRhYiBhbmQgcmVmcmVzaCBodHRwczovL2FwcC5hdG9taWNsaWZlLmFwcCB0byBnZXQgdXBkYXRlZCB2aWV3XCJ9XG4gICAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAhaXNWYWxpZFxuICAgICAgICAgICAgICAgICAgICA/IChcbiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cIm10LTEuNSB0ZXh0LXNtIHRleHQtcmVkLTUwMFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcIlNvbWV0aGluZyB3ZW50IHdyb25nIHdpdGggdGhlIHN5bmMgXCJ9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgICAgICAgICkgOiBudWxsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8U3Bpbm5lciBjb2xvcj0ncGluay41MDAnIC8+XG4gICAgICAgIDwvZGl2PlxuICAgIClcbn1cblxuZXhwb3J0IGRlZmF1bHQgWm9vbVdlYkNhbGxiYWNrXG5cbiJdfQ==