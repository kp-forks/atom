"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const TextField_1 = __importDefault(require("@components/TextField"));
const date_utils_1 = require("@lib/date-utils");
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const UserCreateCalendarHelper_1 = require("@lib/Calendar/UserCreateCalendarHelper");
const UserEditCalendarHelper_1 = require("@lib/Calendar/UserEditCalendarHelper");
const react_2 = require("@chakra-ui/react");
const Button_1 = __importDefault(require("@components/Button"));
const listCategoriesForEventId_1 = __importDefault(require("@lib/apollo/gql/listCategoriesForEventId"));
const listRemindersForEventId_1 = __importDefault(require("@lib/apollo/gql/listRemindersForEventId"));
const updateEventForPreEventId_1 = __importDefault(require("@lib/apollo/gql/updateEventForPreEventId"));
const updateEventForPostEventId_1 = __importDefault(require("@lib/apollo/gql/updateEventForPostEventId"));
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("../../config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
function UserPreAndPostForEventModal(props) {
    const [beforeEventMinutes, setBeforeEventMinutes] = (0, react_1.useState)(props?.event?.timeBlocking?.beforeEvent ?? 0);
    const [afterEventMinutes, setAfterEventMinutes] = (0, react_1.useState)(props?.event?.timeBlocking?.afterEvent ?? 0);
    const [pageOffset, setPageOffset] = (0, react_1.useState)(0);
    const event = props?.event;
    const client = props?.client;
    console.log(event?.id, ' event id inside userpreandpostforeventmodal');
    console.log(event?.timeBlocking, ' event?.timeBlocking inside userpreandpostforeventmodal');
    console.log(beforeEventMinutes, ' beforeEventMinutes');
    console.log(event?.preEventId, ' event?.preEventId');
    console.log(event?.postEventId, ' event?.postEventId');
    console.log(afterEventMinutes, ' afterEventMinutes');
    const toast = (0, react_2.useToast)();
    (0, react_1.useEffect)(() => {
        if ((props?.event?.timeBlocking?.beforeEvent > 0) && (props?.event?.timeBlocking?.beforeEvent !== beforeEventMinutes)) {
            setBeforeEventMinutes(props?.event?.timeBlocking?.beforeEvent);
        }
    }, [beforeEventMinutes, props?.event?.timeBlocking?.beforeEvent]);
    (0, react_1.useEffect)(() => {
        if ((props?.event?.timeBlocking?.afterEvent > 0) && (props?.event?.timeBlocking?.afterEvent !== afterEventMinutes)) {
            setAfterEventMinutes(props?.event?.timeBlocking?.afterEvent);
        }
    }, [afterEventMinutes, props?.event?.timeBlocking?.afterEvent]);
    const createEvent = async (minutes, eventType) => {
        try {
            // validate
            if (minutes === 0) {
                toast({
                    status: 'error',
                    title: 'Please enter a valid time',
                    description: 'Please enter a valid time',
                    duration: 9000,
                    isClosable: true,
                });
                return;
            }
            if (event?.allDay) {
                toast({
                    title: 'All day event',
                    description: 'All day events cannot have prep or debrief events',
                    status: 'success',
                    duration: 9000,
                    isClosable: true,
                });
                return;
            }
            const categoryIds = (await client.query({
                query: listCategoriesForEventId_1.default,
                variables: {
                    eventId: event?.id,
                },
            }))?.data?.Category?.map(c => c?.id);
            const reminders = (await client.query({
                query: listRemindersForEventId_1.default,
                variables: {
                    eventId: event.id,
                },
            })).data?.Reminder?.map(r => r.minutes);
            if (eventType === 'pre') {
                const id = await (0, UserCreateCalendarHelper_1.createNewEvent)((0, date_utils_1.dayjs)(event.startDate).subtract(minutes, 'minute').format(), (0, date_utils_1.dayjs)(event.startDate).format(), event?.userId, client, event?.calendarId, categoryIds, 'Buffer time', false, undefined, undefined, undefined, reminders, 'Buffer time', event?.location, false, true, false, true, false, false, false, false, event?.timezone, undefined, undefined, undefined, undefined, undefined, event?.id, false, false, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, 'opaque', undefined, undefined, undefined, undefined, event?.colorId, event?.originalTimezone, event?.backgroundColor, event?.foregroundColor, event?.useDefaultAlarms, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, true, true, true, true, true, true, true, true, undefined, undefined, undefined, undefined, true, true, minutes, undefined, true, 'create', undefined);
                console.log(id, ' eventId inside pre createEvent');
                if (id) {
                    // setPreEventId(eventId)
                    return updateForEvent(id, eventType, minutes);
                }
                else {
                    toast({
                        title: 'Error creating prep event',
                        description: 'Error creating prep event',
                        status: 'error',
                        duration: 9000,
                        isClosable: true,
                    });
                }
            }
            else if (eventType == 'post') {
                const id = await (0, UserCreateCalendarHelper_1.createNewEvent)((0, date_utils_1.dayjs)(event.endDate).format(), (0, date_utils_1.dayjs)(event.endDate).add(minutes, 'minute').format(), event?.userId, client, event?.calendarId, categoryIds, 'Buffer time', false, undefined, undefined, undefined, reminders, 'Buffer time', event?.location, false, false, true, true, false, false, false, false, event?.timezone, undefined, undefined, undefined, undefined, undefined, event?.id, false, false, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, 'Buffer time', 'opaque', undefined, undefined, undefined, undefined, event?.colorId, event?.originalTimezone, event?.backgroundColor, event?.foregroundColor, event?.useDefaultAlarms, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, true, true, true, true, true, true, undefined, undefined, undefined, undefined, undefined, true, minutes, undefined, true, 'create', undefined);
                console.log(id, ' eventId inside post createEvent');
                if (id) {
                    // setPostEventId(eventId)
                    return updateForEvent(id, eventType, undefined, minutes);
                }
                else {
                    toast({
                        title: 'Error creating debrief event',
                        description: 'Error creating debrief event',
                        status: 'error',
                        duration: 9000,
                        isClosable: true,
                    });
                }
            }
        }
        catch (e) {
            console.log(e, ' unable to create event');
        }
    };
    const updateForEvent = async (id, eventType, beforeMinutes, afterMinutes) => {
        console.log(id, ' id inside updateForEvent');
        try {
            if (eventType === 'pre') {
                await client.mutate({
                    mutation: updateEventForPreEventId_1.default,
                    variables: {
                        id: event?.id,
                        preEventId: id,
                        timeBlocking: {
                            beforeEvent: beforeMinutes || beforeEventMinutes,
                            afterEvent: afterMinutes || afterEventMinutes || event?.timeBlocking?.afterEvent || 0,
                        }
                    },
                });
            }
            else if (eventType === 'post') {
                await client.mutate({
                    mutation: updateEventForPostEventId_1.default,
                    variables: {
                        id: event?.id,
                        postEventId: id,
                        timeBlocking: {
                            beforeEvent: beforeMinutes || beforeEventMinutes || event?.timeBlocking?.beforeEvent || 0,
                            afterEvent: afterMinutes || afterEventMinutes,
                        }
                    },
                });
            }
        }
        catch (e) {
            console.log(e, 'Error updating existing event for prep/debrief');
            toast({
                title: 'Error updating event',
                description: 'Error updating event',
                status: 'error',
                duration: 9000,
                isClosable: true,
            });
        }
    };
    const updateLocalEvent = async (id, minutes, eventType) => {
        try {
            // validate
            if (minutes === 0) {
                toast({
                    status: 'error',
                    title: 'Please enter a valid time',
                    description: 'Please enter a valid time',
                    duration: 9000,
                    isClosable: true,
                });
                return;
            }
            if (event?.allDay) {
                toast({
                    title: 'All day event',
                    description: 'All day events cannot have prep or debrief events',
                    status: 'success',
                    duration: 9000,
                    isClosable: true,
                });
                return;
            }
            const categoryIds = (await client.query({
                query: listCategoriesForEventId_1.default,
                variables: {
                    eventId: event?.id,
                },
            }))?.data?.Category?.map(c => c?.id);
            const reminders = (await client.query({
                query: listRemindersForEventId_1.default,
                variables: {
                    eventId: event.id,
                },
            })).data?.Reminder?.map(r => r.minutes);
            if (eventType === 'pre') {
                await (0, UserEditCalendarHelper_1.updateEvent)(id, (0, date_utils_1.dayjs)(event.startDate).subtract(minutes, 'minute').format(), (0, date_utils_1.dayjs)(event.startDate).format(), event?.userId, client, event?.calendarId, categoryIds, 'Buffer time', false, undefined, undefined, undefined, reminders, 'Buffer time', event?.location, false, true, false, true, false, false, false, false, event?.timezone, undefined, undefined, undefined, undefined, undefined, event?.id, false, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, 'Buffer time', 'opaque', undefined, undefined, undefined, undefined, event?.colorId, event?.originalTimezone, event?.backgroundColor, event?.foregroundColor, event?.useDefaultAlarms, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, true, true, true, true, true, true, true, true, undefined, undefined, undefined, undefined, true, true, minutes, undefined, true, 'update', true);
                return updateForEvent(id, eventType, minutes);
            }
            else if (eventType === 'post') {
                await (0, UserEditCalendarHelper_1.updateEvent)(id, (0, date_utils_1.dayjs)(event.endDate).format(), (0, date_utils_1.dayjs)(event.endDate).add(minutes, 'minute').format(), event?.userId, client, event?.calendarId, categoryIds, 'Buffer time', false, undefined, undefined, undefined, reminders, 'Buffer time', event?.location, false, false, true, true, false, false, false, false, event?.timezone, undefined, undefined, undefined, undefined, undefined, event?.id, false, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, 'Buffer time', 'opaque', undefined, undefined, undefined, undefined, event?.colorId, event?.originalTimezone, event?.backgroundColor, event?.foregroundColor, event?.useDefaultAlarms, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, true, undefined, undefined, true, true, true, true, true, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, true, 'update', true);
                return updateForEvent(id, eventType, undefined, minutes);
            }
        }
        catch (e) {
            console.log(e, 'Error updating existing event for prep/debrief');
            toast({
                title: 'Error updating event',
                description: 'Error updating event',
                status: 'error',
                duration: 9000,
                isClosable: true,
            });
        }
    };
    const onBeforeEventMinutesChange = (e) => {
        setBeforeEventMinutes(parseInt(e?.target?.value.replace(/[^0-9.]/g, ''), 10));
    };
    const onAfterEventMinutesChange = (e) => {
        setAfterEventMinutes(parseInt(e?.target?.value.replace(/[^0-9.]/g, ''), 10));
    };
    const onSubmit = async () => {
        try {
            const promises = [];
            if (event?.preEventId
                && (beforeEventMinutes > 0)
                && (event?.timeBlocking?.beforeEvent !== beforeEventMinutes)) {
                console.log(event?.id, event?.preEventId, ' event?.id, event?.preEventId inside onSubmit');
                promises.push(updateLocalEvent(event?.preEventId, beforeEventMinutes, 'pre'));
            }
            if (event?.postEventId
                && (afterEventMinutes > 0)
                && (event?.timeBlocking?.afterEvent !== afterEventMinutes)) {
                console.log(event?.id, event?.postEventId, ' event?.id, event?.postEventId inside onSubmit');
                promises.push(updateLocalEvent(event?.postEventId, afterEventMinutes, 'post'));
            }
            if (!event?.preEventId && (beforeEventMinutes > 0)) {
                console.log(beforeEventMinutes, ' beforeEventMinutes inside onSubmit');
                promises.push(createEvent(beforeEventMinutes, 'pre'));
            }
            if (!event?.postEventId && (afterEventMinutes > 0)) {
                console.log(afterEventMinutes, ' afterEventMinutes inside onSubmit');
                promises.push(createEvent(afterEventMinutes, 'post'));
            }
            await Promise.all(promises);
            props.hidePrepAndReview();
        }
        catch (e) {
            console.log(e, ' Error updating event');
            toast({
                title: 'Error updating event',
                description: 'Error updating event',
                status: 'error',
                duration: 9000,
                isClosable: true,
            });
        }
    };
    return ((0, jsx_runtime_1.jsx)(Box_1.default, { justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsxs)(Box_1.default, { style: { flex: 1, width: '100%' }, children: [(0, jsx_runtime_1.jsxs)(Box_1.default, { pt: { phone: 'm', tablet: 's' }, justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { style: { width: '100%' }, justifyContent: "center", alignItems: "center", children: (0, jsx_runtime_1.jsxs)(Box_1.default, { style: { width: '100%' }, flexDirection: "row", justifyContent: "space-between", alignItems: "center", pt: { phone: 'm', tablet: 's' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Prep time before event:" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { children: (0, jsx_runtime_1.jsx)(TextField_1.default, { label: "Minutes", value: `${beforeEventMinutes}`, onChange: onBeforeEventMinutesChange, type: "number" }) })] }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { style: { width: '100%' }, justifyContent: "center", alignItems: "center", children: (0, jsx_runtime_1.jsxs)(Box_1.default, { style: { width: '100%' }, flexDirection: "row", justifyContent: "space-between", alignItems: "center", pt: { phone: 'm', tablet: 's' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Review time after event:" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { children: (0, jsx_runtime_1.jsx)(TextField_1.default, { label: "Minutes", value: `${afterEventMinutes}`, onChange: onAfterEventMinutesChange, type: "number" }) })] }) })] }), (0, jsx_runtime_1.jsx)(Box_1.default, { children: (0, jsx_runtime_1.jsx)(Button_1.default, { onClick: onSubmit, children: "Submit" }) }), (0, jsx_runtime_1.jsx)("button", { className: "btn btn-link no-underline hover:no-underline", onClick: props.hidePrepAndReview, children: "Close" })] }) }));
}
exports.default = UserPreAndPostForEventModal;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlclByZUFuZFBvc3RGb3JFdmVudE1vZGFsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiVXNlclByZUFuZFBvc3RGb3JFdmVudE1vZGFsLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQThCQSxnREFxQ0M7O0FBbkVELGlDQUdjO0FBQ2Qsc0VBQTZDO0FBRTdDLGdEQUF1QztBQUd2QyxpRUFBd0M7QUFDeEMsbUVBQTBDO0FBQzFDLHFGQUF1RTtBQUN2RSxpRkFBa0U7QUFHbEUsNENBQTJDO0FBQzNDLGdFQUF1QztBQUN2Qyx3R0FBK0U7QUFFL0Usc0dBQTZFO0FBQzdFLHdHQUErRTtBQUcvRSwwR0FBaUY7QUFHakYsd0VBQThDO0FBQzlDLDhEQUEwRDtBQUMxRCw4RUFBcUQ7QUFFOUMsS0FBSyxVQUFVLGtCQUFrQixDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBaUQ7SUFDbEcsMEZBQTBGO0lBQzFGLHNDQUFzQztJQUN0Qyx5RUFBeUU7SUFDekUsMEJBQWUsQ0FBQyxJQUFJLENBQUMsSUFBQSw2QkFBYSxHQUFFLENBQUMsQ0FBQTtJQUNyQyxJQUFJLE9BQU8sQ0FBQTtJQUNYLElBQUksQ0FBQztRQUNILE9BQU8sR0FBRyxNQUFNLGlCQUFPLENBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUU7WUFDM0MsNkJBQTZCLEVBQUUsS0FBSztnQkFDbEMsT0FBTyxFQUFFLENBQUE7WUFDWCxDQUFDO1NBQ0YsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUFDLE9BQU8sR0FBUSxFQUFFLENBQUM7UUFDbEIsSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLGlCQUFPLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDakQsT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFLGVBQWUsRUFBRSxlQUFlLEVBQUUsRUFBRSxDQUFBO1FBQ3hELENBQUM7YUFBTSxJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssaUJBQU8sQ0FBQyxLQUFLLENB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ZmZlY3QsXG59IGZyb20gJ3JlYWN0J1xuaW1wb3J0IFRleHRGaWVsZCBmcm9tICdAY29tcG9uZW50cy9UZXh0RmllbGQnXG5cbmltcG9ydCB7IGRheWpzIH0gZnJvbSAnQGxpYi9kYXRlLXV0aWxzJ1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJ1xuXG5pbXBvcnQgQm94IGZyb20gJ0Bjb21wb25lbnRzL2NvbW1vbi9Cb3gnXG5pbXBvcnQgVGV4dCBmcm9tICdAY29tcG9uZW50cy9jb21tb24vVGV4dCdcbmltcG9ydCB7IGNyZWF0ZU5ld0V2ZW50IH0gZnJvbSAnQGxpYi9DYWxlbmRhci9Vc2VyQ3JlYXRlQ2FsZW5kYXJIZWxwZXInXG5pbXBvcnQgeyB1cGRhdGVFdmVudCB9IGZyb20gJ0BsaWIvQ2FsZW5kYXIvVXNlckVkaXRDYWxlbmRhckhlbHBlcidcblxuaW1wb3J0IHtFdmVudFR5cGV9IGZyb20gJ0BsaWIvZGF0YVR5cGVzL0V2ZW50VHlwZSdcbmltcG9ydCB7IHVzZVRvYXN0IH0gZnJvbSAnQGNoYWtyYS11aS9yZWFjdCdcbmltcG9ydCBCdXR0b24gZnJvbSAnQGNvbXBvbmVudHMvQnV0dG9uJ1xuaW1wb3J0IGxpc3RDYXRlZ29yaWVzRm9yRXZlbnRJZCBmcm9tICdAbGliL2Fwb2xsby9ncWwvbGlzdENhdGVnb3JpZXNGb3JFdmVudElkJ1xuaW1wb3J0IHsgQ2F0ZWdvcnlUeXBlIH0gZnJvbSAnQGxpYi9kYXRhVHlwZXMvQ2F0ZWdvcnlUeXBlJ1xuaW1wb3J0IGxpc3RSZW1pbmRlcnNGb3JFdmVudElkIGZyb20gJ0BsaWIvYXBvbGxvL2dxbC9saXN0UmVtaW5kZXJzRm9yRXZlbnRJZCdcbmltcG9ydCB1cGRhdGVFdmVudEZvclByZUV2ZW50SWQgZnJvbSAnQGxpYi9hcG9sbG8vZ3FsL3VwZGF0ZUV2ZW50Rm9yUHJlRXZlbnRJZCdcbmltcG9ydCB7IFJlbWluZGVyVHlwZSB9IGZyb20gJ0BsaWIvZGF0YVR5cGVzL1JlbWluZGVyVHlwZSdcbmltcG9ydCB7IEFwb2xsb0NsaWVudCwgTm9ybWFsaXplZENhY2hlT2JqZWN0IH0gZnJvbSAnQGFwb2xsby9jbGllbnQnXG5pbXBvcnQgdXBkYXRlRXZlbnRGb3JQb3N0RXZlbnRJZCBmcm9tICdAbGliL2Fwb2xsby9ncWwvdXBkYXRlRXZlbnRGb3JQb3N0RXZlbnRJZCdcblxuaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xuaW1wb3J0IHN1cGVydG9rZW5zTm9kZSBmcm9tICdzdXBlcnRva2Vucy1ub2RlJ1xuaW1wb3J0IHsgYmFja2VuZENvbmZpZyB9IGZyb20gJy4uLy4uL2NvbmZpZy9iYWNrZW5kQ29uZmlnJ1xuaW1wb3J0IFNlc3Npb24gZnJvbSAnc3VwZXJ0b2tlbnMtbm9kZS9yZWNpcGUvc2Vzc2lvbidcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNlcnZlclNpZGVQcm9wcyh7IHJlcSwgcmVzIH06IHsgcmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UgfSkge1xuICAvLyBOb3RpY2UgaG93IHRoZSBzZXJ2ZXIgdXNlcyBgQVBJYCBmcm9tIGB3aXRoU1NSQ29udGV4dGAsIGluc3RlYWQgb2YgdGhlIHRvcC1sZXZlbCBgQVBJYC5cbiAgLy8gY29uc3QgU1NSID0gd2l0aFNTUkNvbnRleHQoeyByZXEgfSlcbiAgLy8gdGhpcyBydW5zIG9uIHRoZSBiYWNrZW5kLCBzbyB3ZSBtdXN0IGNhbGwgaW5pdCBvbiBzdXBlcnRva2Vucy1ub2RlIFNES1xuICBzdXBlcnRva2Vuc05vZGUuaW5pdChiYWNrZW5kQ29uZmlnKCkpXG4gIGxldCBzZXNzaW9uXG4gIHRyeSB7XG4gICAgc2Vzc2lvbiA9IGF3YWl0IFNlc3Npb24uZ2V0U2Vzc2lvbihyZXEsIHJlcywge1xuICAgICAgb3ZlcnJpZGVHbG9iYWxDbGFpbVZhbGlkYXRvcnM6IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFtdXG4gICAgICB9LFxuICAgIH0pXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgaWYgKGVyci50eXBlID09PSBTZXNzaW9uLkVycm9yLlRSWV9SRUZSRVNIX1RPS0VOKSB7XG4gICAgICByZXR1cm4geyBwcm9wczogeyBmcm9tU3VwZXJ0b2tlbnM6ICduZWVkcy1yZWZyZXNoJyB9IH1cbiAgICB9IGVsc2UgaWYgKGVyci50eXBlID09PSBTZXNzaW9uLkVycm9yLlVOQVVUSE9SSVNFRCkge1xuICAgICAgLy8gdGhpcyB3aWxsIGZvcmNlIHRoZSBmcm9udGVuZCB0byB0cnkgYW5kIHJlZnJlc2ggd2hpY2ggd2lsbCBmYWlsXG4gICAgICAvLyBjbGVhcmluZyBhbGwgY29va2llcyBhbmQgcmVkaXJlY3RpbmcgdGhlIHVzZXIgdG8gdGhlIGxvZ2luIHNjcmVlbi5cbiAgICAgIHJldHVybiB7IHByb3BzOiB7IGZyb21TdXBlcnRva2VuczogJ25lZWRzLXJlZnJlc2gnIH0gfVxuICAgIH1cbiAgICB0aHJvdyBlcnJcbiAgfVxuXG4gIGlmICghc2Vzc2lvbj8uZ2V0VXNlcklkKCkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcmVkaXJlY3Q6IHtcbiAgICAgICAgZGVzdGluYXRpb246ICcvVXNlci9Mb2dpbi9Vc2VyTG9naW4nLFxuICAgICAgICBwZXJtYW5lbnQ6IGZhbHNlLFxuICAgICAgfSxcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHByb3BzOiB7XG4gICAgICBzdWI6IHNlc3Npb24uZ2V0VXNlcklkKCksXG4gICAgfVxuICB9XG59XG5cblxudHlwZSBQcm9wcyA9IHtcbiAgICBldmVudDogRXZlbnRUeXBlLFxuICAgIGhpZGVQcmVwQW5kUmV2aWV3OiAoKSA9PiB2b2lkLFxuICAgIGNsaWVudDogQXBvbGxvQ2xpZW50PE5vcm1hbGl6ZWRDYWNoZU9iamVjdD4sXG59XG5cbmZ1bmN0aW9uIFVzZXJQcmVBbmRQb3N0Rm9yRXZlbnRNb2RhbChwcm9wczogUHJvcHMpIHtcbiAgICBjb25zdCBbYmVmb3JlRXZlbnRNaW51dGVzLCBzZXRCZWZvcmVFdmVudE1pbnV0ZXNdID0gdXNlU3RhdGU8bnVtYmVyPihwcm9wcz8uZXZlbnQ/LnRpbWVCbG9ja2luZz8uYmVmb3JlRXZlbnQgPz8gMClcbiAgICBjb25zdCBbYWZ0ZXJFdmVudE1pbnV0ZXMsIHNldEFmdGVyRXZlbnRNaW51dGVzXSA9IHVzZVN0YXRlPG51bWJlcj4ocHJvcHM/LmV2ZW50Py50aW1lQmxvY2tpbmc/LmFmdGVyRXZlbnQgPz8gMClcbiAgICBjb25zdCBbcGFnZU9mZnNldCwgc2V0UGFnZU9mZnNldF0gPSB1c2VTdGF0ZTxudW1iZXI+KDApXG5cbiAgICBjb25zdCBldmVudCA9IHByb3BzPy5ldmVudFxuICAgIGNvbnN0IGNsaWVudCA9IHByb3BzPy5jbGllbnRcbiAgICBjb25zb2xlLmxvZyhldmVudD8uaWQsICcgZXZlbnQgaWQgaW5zaWRlIHVzZXJwcmVhbmRwb3N0Zm9yZXZlbnRtb2RhbCcpXG4gICAgY29uc29sZS5sb2coZXZlbnQ/LnRpbWVCbG9ja2luZywgJyBldmVudD8udGltZUJsb2NraW5nIGluc2lkZSB1c2VycHJlYW5kcG9zdGZvcmV2ZW50bW9kYWwnKVxuICAgIGNvbnNvbGUubG9nKGJlZm9yZUV2ZW50TWludXRlcywgJyBiZWZvcmVFdmVudE1pbnV0ZXMnKVxuICAgIGNvbnNvbGUubG9nKGV2ZW50Py5wcmVFdmVudElkLCAnIGV2ZW50Py5wcmVFdmVudElkJylcbiAgICBjb25zb2xlLmxvZyhldmVudD8ucG9zdEV2ZW50SWQsICcgZXZlbnQ/LnBvc3RFdmVudElkJylcbiAgICBjb25zb2xlLmxvZyhhZnRlckV2ZW50TWludXRlcywgJyBhZnRlckV2ZW50TWludXRlcycpXG4gICAgY29uc3QgdG9hc3QgPSB1c2VUb2FzdCgpXG4gICAgXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKChwcm9wcz8uZXZlbnQ/LnRpbWVCbG9ja2luZz8uYmVmb3JlRXZlbnQgPiAwKSAmJiAocHJvcHM/LmV2ZW50Py50aW1lQmxvY2tpbmc/LmJlZm9yZUV2ZW50ICE9PSBiZWZvcmVFdmVudE1pbnV0ZXMpKSB7XG4gICAgICAgICAgICBzZXRCZWZvcmVFdmVudE1pbnV0ZXMocHJvcHM/LmV2ZW50Py50aW1lQmxvY2tpbmc/LmJlZm9yZUV2ZW50KVxuICAgICAgICB9XG4gICAgfSwgW2JlZm9yZUV2ZW50TWludXRlcywgcHJvcHM/LmV2ZW50Py50aW1lQmxvY2tpbmc/LmJlZm9yZUV2ZW50XSlcblxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmICgocHJvcHM/LmV2ZW50Py50aW1lQmxvY2tpbmc/LmFmdGVyRXZlbnQgPiAwKSAmJiAocHJvcHM/LmV2ZW50Py50aW1lQmxvY2tpbmc/LmFmdGVyRXZlbnQgIT09IGFmdGVyRXZlbnRNaW51dGVzKSkge1xuICAgICAgICAgICAgc2V0QWZ0ZXJFdmVudE1pbnV0ZXMocHJvcHM/LmV2ZW50Py50aW1lQmxvY2tpbmc/LmFmdGVyRXZlbnQpXG4gICAgICAgIH1cbiAgICB9LCBbYWZ0ZXJFdmVudE1pbnV0ZXMsIHByb3BzPy5ldmVudD8udGltZUJsb2NraW5nPy5hZnRlckV2ZW50XSlcblxuICAgIGNvbnN0IGNyZWF0ZUV2ZW50ID0gYXN5bmMgKG1pbnV0ZXM6IG51bWJlciwgZXZlbnRUeXBlOiAncHJlJyB8ICdwb3N0JykgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gdmFsaWRhdGVcbiAgICAgICAgICAgIGlmIChtaW51dGVzID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdG9hc3Qoe1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnUGxlYXNlIGVudGVyIGEgdmFsaWQgdGltZScsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnUGxlYXNlIGVudGVyIGEgdmFsaWQgdGltZScsXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA5MDAwLFxuICAgICAgICAgICAgICAgICAgICBpc0Nsb3NhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChldmVudD8uYWxsRGF5KSB7XG4gICAgICAgICAgICAgICAgdG9hc3Qoe1xuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0FsbCBkYXkgZXZlbnQnLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0FsbCBkYXkgZXZlbnRzIGNhbm5vdCBoYXZlIHByZXAgb3IgZGVicmllZiBldmVudHMnLFxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdzdWNjZXNzJyxcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDkwMDAsXG4gICAgICAgICAgICAgICAgICAgIGlzQ2xvc2FibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgY2F0ZWdvcnlJZHMgPSAoYXdhaXQgY2xpZW50LnF1ZXJ5PHsgQ2F0ZWdvcnk6IENhdGVnb3J5VHlwZVtdIH0+KHtcbiAgICAgICAgICAgICAgICBxdWVyeTogbGlzdENhdGVnb3JpZXNGb3JFdmVudElkLFxuICAgICAgICAgICAgICAgIHZhcmlhYmxlczoge1xuICAgICAgICAgICAgICAgIGV2ZW50SWQ6IGV2ZW50Py5pZCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSkpPy5kYXRhPy5DYXRlZ29yeT8ubWFwKGMgPT4gYz8uaWQpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHJlbWluZGVycyA9IChhd2FpdCBjbGllbnQucXVlcnk8eyBSZW1pbmRlcjogUmVtaW5kZXJUeXBlW10gfT4oe1xuICAgICAgICAgICAgICAgIHF1ZXJ5OiBsaXN0UmVtaW5kZXJzRm9yRXZlbnRJZCxcbiAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRJZDogZXZlbnQuaWQsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pKS5kYXRhPy5SZW1pbmRlcj8ubWFwKHIgPT4gci5taW51dGVzKVxuXG4gICAgICAgICAgICBpZiAoZXZlbnRUeXBlID09PSAncHJlJykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGlkID0gYXdhaXQgY3JlYXRlTmV3RXZlbnQoXG4gICAgICAgICAgICAgICAgICAgIGRheWpzKGV2ZW50LnN0YXJ0RGF0ZSkuc3VidHJhY3QobWludXRlcywgJ21pbnV0ZScpLmZvcm1hdCgpLFxuICAgICAgICAgICAgICAgICAgICBkYXlqcyhldmVudC5zdGFydERhdGUpLmZvcm1hdCgpLFxuICAgICAgICAgICAgICAgICAgICBldmVudD8udXNlcklkLFxuICAgICAgICAgICAgICAgICAgICBjbGllbnQsXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50Py5jYWxlbmRhcklkLFxuICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeUlkcyxcbiAgICAgICAgICAgICAgICAgICAgJ0J1ZmZlciB0aW1lJyxcbiAgICAgICAgICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHJlbWluZGVycyxcbiAgICAgICAgICAgICAgICAgICAgJ0J1ZmZlciB0aW1lJyxcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQ/LmxvY2F0aW9uLFxuICAgICAgICAgICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBldmVudD8udGltZXpvbmUsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICBldmVudD8uaWQsXG4gICAgICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgJ29wYXF1ZScsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQ/LmNvbG9ySWQsXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50Py5vcmlnaW5hbFRpbWV6b25lLFxuICAgICAgICAgICAgICAgICAgICBldmVudD8uYmFja2dyb3VuZENvbG9yLFxuICAgICAgICAgICAgICAgICAgICBldmVudD8uZm9yZWdyb3VuZENvbG9yLFxuICAgICAgICAgICAgICAgICAgICBldmVudD8udXNlRGVmYXVsdEFsYXJtcyxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbWludXRlcyxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAnY3JlYXRlJyxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIClcblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGlkLCAnIGV2ZW50SWQgaW5zaWRlIHByZSBjcmVhdGVFdmVudCcpXG5cbiAgICAgICAgICAgICAgICBpZiAoaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0UHJlRXZlbnRJZChldmVudElkKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXBkYXRlRm9yRXZlbnQoaWQsIGV2ZW50VHlwZSwgbWludXRlcylcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0Vycm9yIGNyZWF0aW5nIHByZXAgZXZlbnQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdFcnJvciBjcmVhdGluZyBwcmVwIGV2ZW50JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ2Vycm9yJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA5MDAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNDbG9zYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50VHlwZSA9PSAncG9zdCcpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpZCA9IGF3YWl0IGNyZWF0ZU5ld0V2ZW50KFxuICAgICAgICAgICAgICAgICAgICBkYXlqcyhldmVudC5lbmREYXRlKS5mb3JtYXQoKSxcbiAgICAgICAgICAgICAgICAgICAgZGF5anMoZXZlbnQuZW5kRGF0ZSkuYWRkKG1pbnV0ZXMsICdtaW51dGUnKS5mb3JtYXQoKSxcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQ/LnVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50LFxuICAgICAgICAgICAgICAgICAgICBldmVudD8uY2FsZW5kYXJJZCxcbiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnlJZHMsXG4gICAgICAgICAgICAgICAgICAgICdCdWZmZXIgdGltZScsXG4gICAgICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICByZW1pbmRlcnMsXG4gICAgICAgICAgICAgICAgICAgICdCdWZmZXIgdGltZScsXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50Py5sb2NhdGlvbixcbiAgICAgICAgICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQ/LnRpbWV6b25lLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQ/LmlkLFxuICAgICAgICAgICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICAnQnVmZmVyIHRpbWUnLFxuICAgICAgICAgICAgICAgICAgICAnb3BhcXVlJyxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICBldmVudD8uY29sb3JJZCxcbiAgICAgICAgICAgICAgICAgICAgZXZlbnQ/Lm9yaWdpbmFsVGltZXpvbmUsXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50Py5iYWNrZ3JvdW5kQ29sb3IsXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50Py5mb3JlZ3JvdW5kQ29sb3IsXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50Py51c2VEZWZhdWx0QWxhcm1zLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBtaW51dGVzLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgICAgICdjcmVhdGUnLFxuICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coaWQsICcgZXZlbnRJZCBpbnNpZGUgcG9zdCBjcmVhdGVFdmVudCcpXG4gICAgICAgICAgICAgICAgaWYgKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIHNldFBvc3RFdmVudElkKGV2ZW50SWQpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1cGRhdGVGb3JFdmVudChpZCwgZXZlbnRUeXBlLCB1bmRlZmluZWQsIG1pbnV0ZXMpXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdFcnJvciBjcmVhdGluZyBkZWJyaWVmIGV2ZW50JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRXJyb3IgY3JlYXRpbmcgZGVicmllZiBldmVudCcsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogOTAwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzQ2xvc2FibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUsICcgdW5hYmxlIHRvIGNyZWF0ZSBldmVudCcpXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuXG4gICAgY29uc3QgdXBkYXRlRm9yRXZlbnQgPSBhc3luYyAoaWQ6IHN0cmluZywgZXZlbnRUeXBlOiAncHJlJyB8ICdwb3N0JywgYmVmb3JlTWludXRlcz86IG51bWJlciwgYWZ0ZXJNaW51dGVzPzogbnVtYmVyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGlkLCAnIGlkIGluc2lkZSB1cGRhdGVGb3JFdmVudCcpXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoZXZlbnRUeXBlID09PSAncHJlJykge1xuXG4gICAgICAgICAgICAgICAgYXdhaXQgY2xpZW50Lm11dGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIG11dGF0aW9uOiB1cGRhdGVFdmVudEZvclByZUV2ZW50SWQsXG4gICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGV2ZW50Py5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByZUV2ZW50SWQ6IGlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGltZUJsb2NraW5nOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmVmb3JlRXZlbnQ6IGJlZm9yZU1pbnV0ZXMgfHwgYmVmb3JlRXZlbnRNaW51dGVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFmdGVyRXZlbnQ6IGFmdGVyTWludXRlcyB8fCBhZnRlckV2ZW50TWludXRlcyB8fCBldmVudD8udGltZUJsb2NraW5nPy5hZnRlckV2ZW50IHx8IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudFR5cGUgPT09ICdwb3N0Jykge1xuXG4gICAgICAgICAgICAgICAgYXdhaXQgY2xpZW50Lm11dGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIG11dGF0aW9uOiB1cGRhdGVFdmVudEZvclBvc3RFdmVudElkLFxuICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBldmVudD8uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3N0RXZlbnRJZDogaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lQmxvY2tpbmc6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVFdmVudDogYmVmb3JlTWludXRlcyB8fCBiZWZvcmVFdmVudE1pbnV0ZXMgfHwgZXZlbnQ/LnRpbWVCbG9ja2luZz8uYmVmb3JlRXZlbnQgfHwgMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZnRlckV2ZW50OiBhZnRlck1pbnV0ZXMgfHwgYWZ0ZXJFdmVudE1pbnV0ZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZSxcbiAgICAgICAgICAgICAgICAnRXJyb3IgdXBkYXRpbmcgZXhpc3RpbmcgZXZlbnQgZm9yIHByZXAvZGVicmllZicpXG4gICAgICAgICAgICB0b2FzdCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICdFcnJvciB1cGRhdGluZyBldmVudCcsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdFcnJvciB1cGRhdGluZyBldmVudCcsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA5MDAwLFxuICAgICAgICAgICAgICAgIGlzQ2xvc2FibGU6IHRydWUsXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgdXBkYXRlTG9jYWxFdmVudCA9IGFzeW5jIChpZDogc3RyaW5nLCBtaW51dGVzOiBudW1iZXIsIGV2ZW50VHlwZTogJ3ByZScgfCAncG9zdCcpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIHZhbGlkYXRlXG4gICAgICAgIGlmIChtaW51dGVzID09PSAwKSB7XG4gICAgICAgICAgICB0b2FzdCh7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnUGxlYXNlIGVudGVyIGEgdmFsaWQgdGltZScsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdQbGVhc2UgZW50ZXIgYSB2YWxpZCB0aW1lJyxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogOTAwMCxcbiAgICAgICAgICAgICAgICBpc0Nsb3NhYmxlOiB0cnVlLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGV2ZW50Py5hbGxEYXkpIHtcbiAgICAgICAgICAgIHRvYXN0KHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0FsbCBkYXkgZXZlbnQnLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQWxsIGRheSBldmVudHMgY2Fubm90IGhhdmUgcHJlcCBvciBkZWJyaWVmIGV2ZW50cycsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiAnc3VjY2VzcycsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDkwMDAsXG4gICAgICAgICAgICAgICAgaXNDbG9zYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNhdGVnb3J5SWRzID0gKGF3YWl0IGNsaWVudC5xdWVyeTx7IENhdGVnb3J5OiBDYXRlZ29yeVR5cGVbXSB9Pih7XG4gICAgICAgICAgICBxdWVyeTogbGlzdENhdGVnb3JpZXNGb3JFdmVudElkLFxuICAgICAgICAgICAgdmFyaWFibGVzOiB7XG4gICAgICAgICAgICAgIGV2ZW50SWQ6IGV2ZW50Py5pZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pKT8uZGF0YT8uQ2F0ZWdvcnk/Lm1hcChjID0+IGM/LmlkKVxuICAgICAgICBcbiAgICAgICAgY29uc3QgcmVtaW5kZXJzID0gKGF3YWl0IGNsaWVudC5xdWVyeTx7IFJlbWluZGVyOiBSZW1pbmRlclR5cGVbXSB9Pih7XG4gICAgICAgICAgICBxdWVyeTogbGlzdFJlbWluZGVyc0ZvckV2ZW50SWQsXG4gICAgICAgICAgICB2YXJpYWJsZXM6IHtcbiAgICAgICAgICAgICAgICBldmVudElkOiBldmVudC5pZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pKS5kYXRhPy5SZW1pbmRlcj8ubWFwKHIgPT4gci5taW51dGVzKVxuXG4gICAgICAgIGlmIChldmVudFR5cGUgPT09ICdwcmUnKSB7XG5cbiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZUV2ZW50KFxuICAgICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICAgIGRheWpzKGV2ZW50LnN0YXJ0RGF0ZSkuc3VidHJhY3QobWludXRlcywgJ21pbnV0ZScpLmZvcm1hdCgpLFxuICAgICAgICAgICAgICAgIGRheWpzKGV2ZW50LnN0YXJ0RGF0ZSkuZm9ybWF0KCksXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnVzZXJJZCxcbiAgICAgICAgICAgICAgICBjbGllbnQsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LmNhbGVuZGFySWQsXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnlJZHMsXG4gICAgICAgICAgICAgICAgJ0J1ZmZlciB0aW1lJyxcbiAgICAgICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICByZW1pbmRlcnMsXG4gICAgICAgICAgICAgICAgJ0J1ZmZlciB0aW1lJyxcbiAgICAgICAgICAgICAgICBldmVudD8ubG9jYXRpb24sXG4gICAgICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgICAgIGV2ZW50Py50aW1lem9uZSxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5pZCxcbiAgICAgICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAnQnVmZmVyIHRpbWUnLFxuICAgICAgICAgICAgICAgICdvcGFxdWUnLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBldmVudD8uY29sb3JJZCxcbiAgICAgICAgICAgICAgICBldmVudD8ub3JpZ2luYWxUaW1lem9uZSxcbiAgICAgICAgICAgICAgICBldmVudD8uYmFja2dyb3VuZENvbG9yLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5mb3JlZ3JvdW5kQ29sb3IsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnVzZURlZmF1bHRBbGFybXMsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICAgICBtaW51dGVzLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgICd1cGRhdGUnLFxuICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICApXG4gICAgICAgICAgICByZXR1cm4gdXBkYXRlRm9yRXZlbnQoaWQsIGV2ZW50VHlwZSwgbWludXRlcykgICAgIFxuICAgICAgICB9IGVsc2UgaWYgKGV2ZW50VHlwZSA9PT0gJ3Bvc3QnKSB7XG5cbiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZUV2ZW50KFxuICAgICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICAgIGRheWpzKGV2ZW50LmVuZERhdGUpLmZvcm1hdCgpLFxuICAgICAgICAgICAgICAgIGRheWpzKGV2ZW50LmVuZERhdGUpLmFkZChtaW51dGVzLCAnbWludXRlJykuZm9ybWF0KCksXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnVzZXJJZCxcbiAgICAgICAgICAgICAgICBjbGllbnQsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LmNhbGVuZGFySWQsXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnlJZHMsXG4gICAgICAgICAgICAgICAgJ0J1ZmZlciB0aW1lJyxcbiAgICAgICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICByZW1pbmRlcnMsXG4gICAgICAgICAgICAgICAgJ0J1ZmZlciB0aW1lJyxcbiAgICAgICAgICAgICAgICBldmVudD8ubG9jYXRpb24sXG4gICAgICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgICAgICAgICAgICAgIGV2ZW50Py50aW1lem9uZSxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5pZCxcbiAgICAgICAgICAgICAgICBmYWxzZSxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICAnQnVmZmVyIHRpbWUnLFxuICAgICAgICAgICAgICAgICdvcGFxdWUnLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBldmVudD8uY29sb3JJZCxcbiAgICAgICAgICAgICAgICBldmVudD8ub3JpZ2luYWxUaW1lem9uZSxcbiAgICAgICAgICAgICAgICBldmVudD8uYmFja2dyb3VuZENvbG9yLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5mb3JlZ3JvdW5kQ29sb3IsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnVzZURlZmF1bHRBbGFybXMsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgIHRydWUsXG4gICAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICAgICAgICAndXBkYXRlJyxcbiAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICByZXR1cm4gdXBkYXRlRm9yRXZlbnQoaWQsIGV2ZW50VHlwZSwgdW5kZWZpbmVkLCBtaW51dGVzKVxuICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZSxcbiAgICAgICAgICAgICAgICAnRXJyb3IgdXBkYXRpbmcgZXhpc3RpbmcgZXZlbnQgZm9yIHByZXAvZGVicmllZicpXG4gICAgICAgICAgICB0b2FzdCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICdFcnJvciB1cGRhdGluZyBldmVudCcsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdFcnJvciB1cGRhdGluZyBldmVudCcsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA5MDAwLFxuICAgICAgICAgICAgICAgIGlzQ2xvc2FibGU6IHRydWUsXG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3Qgb25CZWZvcmVFdmVudE1pbnV0ZXNDaGFuZ2UgPSAoZTogeyB0YXJnZXQ6IHsgdmFsdWU6IHN0cmluZyB9IH0pID0+IHtcbiAgICAgICAgc2V0QmVmb3JlRXZlbnRNaW51dGVzKHBhcnNlSW50KGU/LnRhcmdldD8udmFsdWUucmVwbGFjZSgvW14wLTkuXS9nLCAnJyksIDEwKSlcbiAgICB9XG5cbiAgICBjb25zdCBvbkFmdGVyRXZlbnRNaW51dGVzQ2hhbmdlID0gKGU6IHsgdGFyZ2V0OiB7IHZhbHVlOiBzdHJpbmcgfSB9KSA9PiB7XG4gICAgICAgIHNldEFmdGVyRXZlbnRNaW51dGVzKHBhcnNlSW50KGU/LnRhcmdldD8udmFsdWUucmVwbGFjZSgvW14wLTkuXS9nLCAnJyksIDEwKSlcbiAgICB9XG4gICAgXG4gICAgY29uc3Qgb25TdWJtaXQgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBwcm9taXNlcyA9IFtdXG4gICAgICAgICAgICBpZiAoZXZlbnQ/LnByZUV2ZW50SWQgXG4gICAgICAgICAgICAgICAgJiYgKGJlZm9yZUV2ZW50TWludXRlcyA+IDApXG4gICAgICAgICAgICAgICAgJiYgKGV2ZW50Py50aW1lQmxvY2tpbmc/LmJlZm9yZUV2ZW50ICE9PSBiZWZvcmVFdmVudE1pbnV0ZXMpXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhldmVudD8uaWQsIGV2ZW50Py5wcmVFdmVudElkLCAnIGV2ZW50Py5pZCwgZXZlbnQ/LnByZUV2ZW50SWQgaW5zaWRlIG9uU3VibWl0JylcbiAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKHVwZGF0ZUxvY2FsRXZlbnQoZXZlbnQ/LnByZUV2ZW50SWQsIGJlZm9yZUV2ZW50TWludXRlcywgJ3ByZScpKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnBvc3RFdmVudElkIFxuICAgICAgICAgICAgICAgICYmIChhZnRlckV2ZW50TWludXRlcyA+IDApXG4gICAgICAgICAgICAgICAgJiYgKGV2ZW50Py50aW1lQmxvY2tpbmc/LmFmdGVyRXZlbnQgIT09IGFmdGVyRXZlbnRNaW51dGVzKVxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGV2ZW50Py5pZCwgZXZlbnQ/LnBvc3RFdmVudElkLCAnIGV2ZW50Py5pZCwgZXZlbnQ/LnBvc3RFdmVudElkIGluc2lkZSBvblN1Ym1pdCcpXG4gICAgICAgICAgICAgICAgcHJvbWlzZXMucHVzaCh1cGRhdGVMb2NhbEV2ZW50KGV2ZW50Py5wb3N0RXZlbnRJZCwgYWZ0ZXJFdmVudE1pbnV0ZXMsICdwb3N0JykpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICghZXZlbnQ/LnByZUV2ZW50SWQgJiYgKGJlZm9yZUV2ZW50TWludXRlcyA+IDApKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYmVmb3JlRXZlbnRNaW51dGVzLCAnIGJlZm9yZUV2ZW50TWludXRlcyBpbnNpZGUgb25TdWJtaXQnKVxuICAgICAgICAgICAgICAgIHByb21pc2VzLnB1c2goY3JlYXRlRXZlbnQoYmVmb3JlRXZlbnRNaW51dGVzLCAncHJlJykpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICghZXZlbnQ/LnBvc3RFdmVudElkICYmIChhZnRlckV2ZW50TWludXRlcyA+IDApKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYWZ0ZXJFdmVudE1pbnV0ZXMsICcgYWZ0ZXJFdmVudE1pbnV0ZXMgaW5zaWRlIG9uU3VibWl0JylcbiAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKGNyZWF0ZUV2ZW50KGFmdGVyRXZlbnRNaW51dGVzLCAncG9zdCcpKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcylcblxuICAgICAgICAgICAgcHJvcHMuaGlkZVByZXBBbmRSZXZpZXcoKVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlLCAnIEVycm9yIHVwZGF0aW5nIGV2ZW50JylcbiAgICAgICAgICAgIHRvYXN0KHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0Vycm9yIHVwZGF0aW5nIGV2ZW50JyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0Vycm9yIHVwZGF0aW5nIGV2ZW50JyxcbiAgICAgICAgICAgICAgICBzdGF0dXM6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDkwMDAsXG4gICAgICAgICAgICAgICAgaXNDbG9zYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgICA8Qm94IGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnMTAwJScgfX0+XG5cbiAgICAgICAgICAgIDxCb3ggc3R5bGU9e3sgZmxleDogMSwgd2lkdGg6ICcxMDAlJyB9fSA+IFxuICAgICAgICAgICAgICAgIDxCb3ggcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0ganVzdGlmeUNvbnRlbnQ9XCJjZW50ZXJcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgIHN0eWxlPXt7IHdpZHRoOiAnMTAwJScgfX0+XG4gICAgICAgICAgICAgICAgICAgIDxCb3ggc3R5bGU9e3sgd2lkdGg6ICcxMDAlJyB9fSBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxCb3ggc3R5bGU9e3sgd2lkdGg6ICcxMDAlJyB9fSBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJzcGFjZS1iZXR3ZWVuXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCb3g+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJvcHRpb25IZWFkZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFByZXAgdGltZSBiZWZvcmUgZXZlbnQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Qm94PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8VGV4dEZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD1cIk1pbnV0ZXNcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e2Ake2JlZm9yZUV2ZW50TWludXRlc31gfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e29uQmVmb3JlRXZlbnRNaW51dGVzQ2hhbmdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cIm51bWJlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgPEJveCBzdHlsZT17eyB3aWR0aDogJzEwMCUnIH19IGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPEJveCBzdHlsZT17eyB3aWR0aDogJzEwMCUnIH19IGZsZXhEaXJlY3Rpb249XCJyb3dcIiBqdXN0aWZ5Q29udGVudD1cInNwYWNlLWJldHdlZW5cIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJveD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD1cIm9wdGlvbkhlYWRlclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmV2aWV3IHRpbWUgYWZ0ZXIgZXZlbnQ6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Qm94PlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxUZXh0RmllbGRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPVwiTWludXRlc1wiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17YCR7YWZ0ZXJFdmVudE1pbnV0ZXN9YH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXtvbkFmdGVyRXZlbnRNaW51dGVzQ2hhbmdlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cIm51bWJlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICA8Qm94PlxuICAgICAgICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e29uU3VibWl0fT5cbiAgICAgICAgICAgICAgICAgICAgICAgIFN1Ym1pdFxuICAgICAgICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzTmFtZT1cImJ0biBidG4tbGluayBuby11bmRlcmxpbmUgaG92ZXI6bm8tdW5kZXJsaW5lXCIgb25DbGljaz17cHJvcHMuaGlkZVByZXBBbmRSZXZpZXd9PlxuICAgICAgICAgICAgICAgICAgICBDbG9zZVxuICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICBcbiAgICAgICAgPC9Cb3g+IFxuICAgIClcbn1cblxuZXhwb3J0IGRlZmF1bHQgVXNlclByZUFuZFBvc3RGb3JFdmVudE1vZGFsXG5cbiJdfQ==