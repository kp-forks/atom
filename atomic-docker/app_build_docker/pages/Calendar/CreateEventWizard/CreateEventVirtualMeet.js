"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const Switch_1 = __importDefault(require("@components/Switch"));
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("../../../config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
function CreateEventVirtualMeet(props) {
    const [zoomMeet, setZoomMeet] = (0, react_1.useState)(props?.zoomMeet);
    const [googleMeet, setGoogleMeet] = (0, react_1.useState)(props?.googleMeet);
    const [zoomPrivateMeeting, setZoomPrivateMeeting] = (0, react_1.useState)(false);
    const [enableVirtual, setEnableVirtual] = (0, react_1.useState)(false);
    const [notAvailable, setNotAvailable] = (0, react_1.useState)(false);
    const isZoomAvailable = props?.isZoomAvailable;
    const isGoogleMeetAvailable = props?.isGoogleMeetAvailable;
    const setParentZoomMeet = props?.setParentZoomMeet;
    const setParentGoogleMeet = props?.setParentGoogleMeet;
    const setParentZoomPrivateMeeting = props?.setParentZoomPrivateMeeting;
    const onEnableVirtual = (value) => {
        setEnableVirtual(value);
        if (!isZoomAvailable && !isGoogleMeetAvailable) {
            setNotAvailable(true);
        }
        else {
            setNotAvailable(false);
        }
    };
    const onZoomMeet = (value) => {
        setZoomMeet(value);
        setParentZoomMeet(value);
        setGoogleMeet(!value);
        setParentGoogleMeet(!value);
    };
    const onGoogleMeet = (value) => {
        setGoogleMeet(value);
        setParentGoogleMeet(value);
        setZoomMeet(!value);
        setParentZoomMeet(!value);
    };
    const onPrivateZoomMeeting = (value) => {
        setZoomPrivateMeeting(value);
        setParentZoomPrivateMeeting(value);
    };
    return ((0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, justifyContent: "center", alignItems: "center", children: [(0, jsx_runtime_1.jsxs)(Box_1.default, { p: { phone: 's', tablet: 'm' }, children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", pt: { phone: 'm', tablet: 's' }, children: "Enable a virtual meeting for this event?" }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: enableVirtual, onValueChange: onEnableVirtual, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsx)(Box_1.default, { children: notAvailable
                    ? ((0, jsx_runtime_1.jsx)(Box_1.default, { children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "subheader", children: "3rd party providers are not enabled. Please enable either zoom or google to use this feature." }) })) : ((0, jsx_runtime_1.jsx)(Box_1.default, { children: enableVirtual
                        ? ((0, jsx_runtime_1.jsxs)(Box_1.default, { children: [(0, jsx_runtime_1.jsx)(Box_1.default, { children: isZoomAvailable
                                        ? ((0, jsx_runtime_1.jsxs)(Box_1.default, { children: [(0, jsx_runtime_1.jsxs)(Box_1.default, { p: { phone: 's', tablet: 'm' }, children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", pt: { phone: 'm', tablet: 's' }, children: "Enable a Zoom Meeting for this event?" }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: zoomMeet, onValueChange: onZoomMeet, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsx)(Box_1.default, { children: zoomMeet
                                                        ? ((0, jsx_runtime_1.jsx)(Box_1.default, { children: (0, jsx_runtime_1.jsxs)(Box_1.default, { p: { phone: 's', tablet: 'm' }, children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", pt: { phone: 'm', tablet: 's' }, children: "Make this Zoom Meeting private?" }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: zoomPrivateMeeting, onValueChange: onPrivateZoomMeeting, style: { marginBottom: 20 } }) })] }) })) : null })] })) : null }), (0, jsx_runtime_1.jsx)(Box_1.default, { children: isGoogleMeetAvailable
                                        ? ((0, jsx_runtime_1.jsxs)(Box_1.default, { p: { phone: 's', tablet: 'm' }, children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", pt: { phone: 'm', tablet: 's' }, children: "Enable a Google Meet for this event?" }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: googleMeet, onValueChange: onGoogleMeet, style: { marginBottom: 20 } }) })] })) : null })] })) : null })) })] }));
}
exports.default = CreateEventVirtualMeet;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ3JlYXRlRXZlbnRWaXJ0dWFsTWVldC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkNyZWF0ZUV2ZW50VmlydHVhbE1lZXQudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBZUEsZ0RBcUNDOztBQXBERCxpQ0FJZTtBQUVmLGdFQUF3QztBQUN4QyxpRUFBd0M7QUFDeEMsbUVBQTBDO0FBRzFDLHdFQUE4QztBQUM5QyxpRUFBNkQ7QUFDN0QsOEVBQXFEO0FBRTlDLEtBQUssVUFBVSxrQkFBa0IsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQWlEO0lBQ2xHLDBGQUEwRjtJQUMxRixzQ0FBc0M7SUFDdEMseUVBQXlFO0lBQ3pFLDBCQUFlLENBQUMsSUFBSSxDQUFDLElBQUEsNkJBQWEsR0FBRSxDQUFDLENBQUE7SUFDckMsSUFBSSxPQUFPLENBQUE7SUFDWCxJQUFJLENBQUM7UUFDSCxPQUFPLEdBQUcsTUFBTSxpQkFBTyxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFO1lBQzNDLDZCQUE2QixFQUFFLEtBQUs7Z0JBQ2xDLE9BQU8sRUFBRSxDQUFBO1lBQ1gsQ0FBQztTQUNGLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFBQyxPQUFPLEdBQVEsRUFBRSxDQUFDO1FBQ2xCLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxpQkFBTyxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ2pELE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLEVBQUUsQ0FBQTtRQUN4RCxDQUFDO2FBQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLGlCQUFPLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ25ELGtFQUFrRTtZQUNsRSxxRUFBcUU7WUFDckUsT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFLGVBQWUsRUFBRSxlQUFlLEVBQUUsRUFBRSxDQUFBO1FBQ3hELENBQUM7UUFDRCxNQUFNLEdB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RUFBQyxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsWUFDaEYsdUJBQUMsZ0JBQU8sSUFDTixPQUFPLEVBQUUsVUFBVSxFQUNuQixhQUFhLEVBQUUsWUFBWSxFQUMzQixLQUFLLEVBQUUsRUFBQyxZQUFZLEVBQUUsRUFBRSxFQUFDLEdBQ3pCLEdBQ0UsSUFDRixDQUNQLENBQUMsQ0FBQyxDQUFDLElBQUksR0FFTixJQUNGLENBQ1AsQ0FBQyxDQUFDLENBQUMsSUFBSSxHQUVOLENBQ1AsR0FFQyxJQUNGLENBQ1AsQ0FBQTtBQUNILENBQUM7QUFFRCxrQkFBZSxzQkFBc0IsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwge1xuICB1c2VTdGF0ZSxcbiAgRGlzcGF0Y2gsXG4gIFNldFN0YXRlQWN0aW9uLFxuIH0gZnJvbSAncmVhY3QnXG5cbmltcG9ydCBTd2l0Y2gxIGZyb20gJ0Bjb21wb25lbnRzL1N3aXRjaCdcbmltcG9ydCBCb3ggZnJvbSAnQGNvbXBvbmVudHMvY29tbW9uL0JveCdcbmltcG9ydCBUZXh0IGZyb20gJ0Bjb21wb25lbnRzL2NvbW1vbi9UZXh0J1xuXG5pbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgc3VwZXJ0b2tlbnNOb2RlIGZyb20gJ3N1cGVydG9rZW5zLW5vZGUnXG5pbXBvcnQgeyBiYWNrZW5kQ29uZmlnIH0gZnJvbSAnLi4vLi4vLi4vY29uZmlnL2JhY2tlbmRDb25maWcnXG5pbXBvcnQgU2Vzc2lvbiBmcm9tICdzdXBlcnRva2Vucy1ub2RlL3JlY2lwZS9zZXNzaW9uJ1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2VydmVyU2lkZVByb3BzKHsgcmVxLCByZXMgfTogeyByZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSB9KSB7XG4gIC8vIE5vdGljZSBob3cgdGhlIHNlcnZlciB1c2VzIGBBUElgIGZyb20gYHdpdGhTU1JDb250ZXh0YCwgaW5zdGVhZCBvZiB0aGUgdG9wLWxldmVsIGBBUElgLlxuICAvLyBjb25zdCBTU1IgPSB3aXRoU1NSQ29udGV4dCh7IHJlcSB9KVxuICAvLyB0aGlzIHJ1bnMgb24gdGhlIGJhY2tlbmQsIHNvIHdlIG11c3QgY2FsbCBpbml0IG9uIHN1cGVydG9rZW5zLW5vZGUgU0RLXG4gIHN1cGVydG9rZW5zTm9kZS5pbml0KGJhY2tlbmRDb25maWcoKSlcbiAgbGV0IHNlc3Npb25cbiAgdHJ5IHtcbiAgICBzZXNzaW9uID0gYXdhaXQgU2Vzc2lvbi5nZXRTZXNzaW9uKHJlcSwgcmVzLCB7XG4gICAgICBvdmVycmlkZUdsb2JhbENsYWltVmFsaWRhdG9yczogYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gW11cbiAgICAgIH0sXG4gICAgfSlcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICBpZiAoZXJyLnR5cGUgPT09IFNlc3Npb24uRXJyb3IuVFJZX1JFRlJFU0hfVE9LRU4pIHtcbiAgICAgIHJldHVybiB7IHByb3BzOiB7IGZyb21TdXBlcnRva2VuczogJ25lZWRzLXJlZnJlc2gnIH0gfVxuICAgIH0gZWxzZSBpZiAoZXJyLnR5cGUgPT09IFNlc3Npb24uRXJyb3IuVU5BVVRIT1JJU0VEKSB7XG4gICAgICAvLyB0aGlzIHdpbGwgZm9yY2UgdGhlIGZyb250ZW5kIHRvIHRyeSBhbmQgcmVmcmVzaCB3aGljaCB3aWxsIGZhaWxcbiAgICAgIC8vIGNsZWFyaW5nIGFsbCBjb29raWVzIGFuZCByZWRpcmVjdGluZyB0aGUgdXNlciB0byB0aGUgbG9naW4gc2NyZWVuLlxuICAgICAgcmV0dXJuIHsgcHJvcHM6IHsgZnJvbVN1cGVydG9rZW5zOiAnbmVlZHMtcmVmcmVzaCcgfSB9XG4gICAgfVxuICAgIHRocm93IGVyclxuICB9XG5cbiAgaWYgKCFzZXNzaW9uPy5nZXRVc2VySWQoKSkge1xuICAgIHJldHVybiB7XG4gICAgICByZWRpcmVjdDoge1xuICAgICAgICBkZXN0aW5hdGlvbjogJy9Vc2VyL0xvZ2luL1VzZXJMb2dpbicsXG4gICAgICAgIHBlcm1hbmVudDogZmFsc2UsXG4gICAgICB9LFxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgcHJvcHM6IHtcbiAgICAgIHN1Yjogc2Vzc2lvbi5nZXRVc2VySWQoKSxcbiAgICB9XG4gIH1cbn1cblxudHlwZSBQcm9wcyA9IHtcbiAgaXNab29tQXZhaWxhYmxlOiBib29sZWFuLFxuICBpc0dvb2dsZU1lZXRBdmFpbGFibGU6IGJvb2xlYW4sXG4gIHpvb21NZWV0OiBib29sZWFuLFxuICBnb29nbGVNZWV0OiBib29sZWFuLFxuICBzZXRQYXJlbnRab29tTWVldDogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248Ym9vbGVhbj4+LFxuICBzZXRQYXJlbnRHb29nbGVNZWV0OiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxib29sZWFuPj4sXG4gIHpvb21Qcml2YXRlTWVldGluZzogYm9vbGVhbixcbiAgc2V0UGFyZW50Wm9vbVByaXZhdGVNZWV0aW5nOiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxib29sZWFuPj4sXG59XG5cbmZ1bmN0aW9uIENyZWF0ZUV2ZW50VmlydHVhbE1lZXQocHJvcHM6IFByb3BzKSB7XG4gIGNvbnN0IFt6b29tTWVldCwgc2V0Wm9vbU1lZXRdID0gdXNlU3RhdGU8Ym9vbGVhbj4ocHJvcHM/Lnpvb21NZWV0KVxuICBjb25zdCBbZ29vZ2xlTWVldCwgc2V0R29vZ2xlTWVldF0gPSB1c2VTdGF0ZTxib29sZWFuPihwcm9wcz8uZ29vZ2xlTWVldClcbiAgY29uc3QgW3pvb21Qcml2YXRlTWVldGluZywgc2V0Wm9vbVByaXZhdGVNZWV0aW5nXSA9IHVzZVN0YXRlPGJvb2xlYW4+KGZhbHNlKVxuICBjb25zdCBbZW5hYmxlVmlydHVhbCwgc2V0RW5hYmxlVmlydHVhbF0gPSB1c2VTdGF0ZTxib29sZWFuPihmYWxzZSlcbiAgY29uc3QgW25vdEF2YWlsYWJsZSwgc2V0Tm90QXZhaWxhYmxlXSA9IHVzZVN0YXRlPGJvb2xlYW4+KGZhbHNlKVxuXG4gIGNvbnN0IGlzWm9vbUF2YWlsYWJsZSA9IHByb3BzPy5pc1pvb21BdmFpbGFibGVcbiAgY29uc3QgaXNHb29nbGVNZWV0QXZhaWxhYmxlID0gcHJvcHM/LmlzR29vZ2xlTWVldEF2YWlsYWJsZVxuICBjb25zdCBzZXRQYXJlbnRab29tTWVldCA9IHByb3BzPy5zZXRQYXJlbnRab29tTWVldFxuICBjb25zdCBzZXRQYXJlbnRHb29nbGVNZWV0ID0gcHJvcHM/LnNldFBhcmVudEdvb2dsZU1lZXRcbiAgY29uc3Qgc2V0UGFyZW50Wm9vbVByaXZhdGVNZWV0aW5nID0gcHJvcHM/LnNldFBhcmVudFpvb21Qcml2YXRlTWVldGluZ1xuXG4gIGNvbnN0IG9uRW5hYmxlVmlydHVhbCA9ICh2YWx1ZTogYm9vbGVhbikgPT4ge1xuICAgIHNldEVuYWJsZVZpcnR1YWwodmFsdWUpXG5cbiAgICBpZiAoIWlzWm9vbUF2YWlsYWJsZSAmJiAhaXNHb29nbGVNZWV0QXZhaWxhYmxlKSB7XG4gICAgICBzZXROb3RBdmFpbGFibGUodHJ1ZSlcbiAgICB9IGVsc2Uge1xuICAgICAgc2V0Tm90QXZhaWxhYmxlKGZhbHNlKVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IG9uWm9vbU1lZXQgPSAodmFsdWU6IGJvb2xlYW4pID0+IHtcbiAgICBzZXRab29tTWVldCh2YWx1ZSlcbiAgICBzZXRQYXJlbnRab29tTWVldCh2YWx1ZSlcbiAgICBzZXRHb29nbGVNZWV0KCF2YWx1ZSlcbiAgICBzZXRQYXJlbnRHb29nbGVNZWV0KCF2YWx1ZSlcbiAgfVxuXG4gIGNvbnN0IG9uR29vZ2xlTWVldCA9ICh2YWx1ZTogYm9vbGVhbikgPT4ge1xuICAgIHNldEdvb2dsZU1lZXQodmFsdWUpXG4gICAgc2V0UGFyZW50R29vZ2xlTWVldCh2YWx1ZSlcbiAgICBzZXRab29tTWVldCghdmFsdWUpXG4gICAgc2V0UGFyZW50Wm9vbU1lZXQoIXZhbHVlKVxuICB9XG5cbiAgY29uc3Qgb25Qcml2YXRlWm9vbU1lZXRpbmcgPSAodmFsdWU6IGJvb2xlYW4pID0+IHtcbiAgICBzZXRab29tUHJpdmF0ZU1lZXRpbmcodmFsdWUpXG4gICAgc2V0UGFyZW50Wm9vbVByaXZhdGVNZWV0aW5nKHZhbHVlKVxuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8Qm94IGZsZXg9ezF9IGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiPlxuICAgICAgPEJveCBwPXt7IHBob25lOiAncycsIHRhYmxldDogJ20nIH19PlxuICAgICAgICA8VGV4dCB2YXJpYW50PVwib3B0aW9uSGVhZGVyXCIgcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0+XG4gICAgICAgICAgRW5hYmxlIGEgdmlydHVhbCBtZWV0aW5nIGZvciB0aGlzIGV2ZW50P1xuICAgICAgICA8L1RleHQ+XG4gICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1lbmRcIiBwdD17eyBwaG9uZTogJ20nLCB0YWJsZXQ6ICdzJyB9fT5cbiAgICAgICAgICA8U3dpdGNoMVxuICAgICAgICAgICAgY2hlY2tlZD17ZW5hYmxlVmlydHVhbH1cbiAgICAgICAgICAgIG9uVmFsdWVDaGFuZ2U9e29uRW5hYmxlVmlydHVhbH1cbiAgICAgICAgICAgIHN0eWxlPXt7bWFyZ2luQm90dG9tOiAyMH19XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9Cb3g+XG4gICAgICA8L0JveD5cbiAgICAgIDxCb3g+XG4gICAgICAgIHtcbiAgICAgICAgICBub3RBdmFpbGFibGVcbiAgICAgICAgICA/IChcbiAgICAgICAgICAgIDxCb3g+XG4gICAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJzdWJoZWFkZXJcIj5cbiAgICAgICAgICAgICAgICAzcmQgcGFydHkgcHJvdmlkZXJzIGFyZSBub3QgZW5hYmxlZC4gUGxlYXNlIGVuYWJsZSBlaXRoZXIgem9vbSBvciBnb29nbGUgdG8gdXNlIHRoaXMgZmVhdHVyZS5cbiAgICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgKSA6IChcbiAgICAgICAgICAgIDxCb3g+XG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBlbmFibGVWaXJ0dWFsXG4gICAgICAgICAgICAgICAgPyAoXG4gICAgICAgICAgICAgICAgICA8Qm94PlxuICAgICAgICAgICAgICAgICAgICA8Qm94PlxuICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzWm9vbUF2YWlsYWJsZVxuICAgICAgICAgICAgICAgICAgICAgICAgPyAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxCb3g+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJveCBwPXt7IHBob25lOiAncycsIHRhYmxldDogJ20nIH19PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD1cIm9wdGlvbkhlYWRlclwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbmFibGUgYSBab29tIE1lZXRpbmcgZm9yIHRoaXMgZXZlbnQ/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Qm94IGZsZXhEaXJlY3Rpb249XCJyb3dcIiBqdXN0aWZ5Q29udGVudD1cImZsZXgtZW5kXCIgcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxTd2l0Y2gxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17em9vbU1lZXR9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25WYWx1ZUNoYW5nZT17b25ab29tTWVldH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17e21hcmdpbkJvdHRvbTogMjB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJveD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgem9vbU1lZXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJveD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxCb3ggcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD1cIm9wdGlvbkhlYWRlclwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1ha2UgdGhpcyBab29tIE1lZXRpbmcgcHJpdmF0ZT9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9UZXh0PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Qm94IGZsZXhEaXJlY3Rpb249XCJyb3dcIiBqdXN0aWZ5Q29udGVudD1cImZsZXgtZW5kXCIgcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFN3aXRjaDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e3pvb21Qcml2YXRlTWVldGluZ31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uVmFsdWVDaGFuZ2U9e29uUHJpdmF0ZVpvb21NZWV0aW5nfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3ttYXJnaW5Cb3R0b206IDIwfX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIDogbnVsbFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgICAgICk6IG51bGxcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgICAgICA8Qm94PlxuICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzR29vZ2xlTWVldEF2YWlsYWJsZVxuICAgICAgICAgICAgICAgICAgICAgICAgPyAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxCb3ggcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8VGV4dCB2YXJpYW50PVwib3B0aW9uSGVhZGVyXCIgcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbmFibGUgYSBHb29nbGUgTWVldCBmb3IgdGhpcyBldmVudD9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LWVuZFwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFN3aXRjaDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17Z29vZ2xlTWVldH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25WYWx1ZUNoYW5nZT17b25Hb29nbGVNZWV0fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17e21hcmdpbkJvdHRvbTogMjB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgICAgICAgICApIDogbnVsbFxuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICApIDogbnVsbFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICApXG4gICAgICAgIH1cbiAgICAgIDwvQm94PlxuICAgIDwvQm94PlxuICApXG59XG5cbmV4cG9ydCBkZWZhdWx0IENyZWF0ZUV2ZW50VmlydHVhbE1lZXRcblxuLyoqIGVuZCAqL1xuIl19