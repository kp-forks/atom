"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const Switch_1 = __importDefault(require("@components/Switch"));
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("../../../config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
function EditEventBaseStep3(props) {
    const [modifiable, setModifiable] = (0, react_1.useState)(props?.modifiable ?? true);
    const [isMeeting, setIsMeeting] = (0, react_1.useState)(props?.isMeeting);
    const [isExternalMeeting, setIsExternalMeeting] = (0, react_1.useState)(props?.isExternalMeeting);
    const [transparency, setTransparency] = (0, react_1.useState)(props?.transparency ?? 'opaque');
    const setParentModifiable = props?.setParentModifiable;
    const setParentIsMeeting = props?.setParentIsMeeting;
    const setParentIsExternalMeeting = props?.setParentIsExternalMeeting;
    const setParentTransparency = props?.setParentTransparency;
    const changeTransparency = (value) => {
        setTransparency(value === true ? 'transparent' : 'opaque');
        setParentTransparency(value === true ? 'transparent' : 'opaque');
    };
    const changeModifiable = (value) => {
        setModifiable(value);
        setParentModifiable(value);
    };
    const changeIsMeeting = (value) => {
        setIsMeeting(value);
        setParentIsMeeting(value);
        if (value) {
            setIsExternalMeeting(false);
            setParentIsExternalMeeting(false);
        }
    };
    const changeIsExternalMeeting = (value) => {
        setIsExternalMeeting(value);
        setParentIsExternalMeeting(value);
        if (value) {
            setIsMeeting(false);
            setParentIsMeeting(false);
        }
    };
    return ((0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: [(0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, style: { width: '90%' }, p: { phone: 's', tablet: 'm' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, flexDirection: "row", justifyContent: "flex-start", alignItems: "center", children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", pt: { phone: 'm', tablet: 's' }, children: "Make this event transparent?" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: transparency === 'opaque' ? false : true, onValueChange: changeTransparency, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, style: { width: '90%' }, p: { phone: 's', tablet: 'm' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", alignItems: "center", children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Is the start time of this event modifiable for scheduling assists?" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: modifiable, onValueChange: changeModifiable, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, style: { width: '90%' }, p: { phone: 's', tablet: 'm' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", alignItems: "center", children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Classify this event as a meeting type event?" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: isMeeting, onValueChange: changeIsMeeting, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, style: { width: '90%' }, p: { phone: 's', tablet: 'm' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", alignItems: "center", children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Classify this event as an external meeting type ie meeting that is outside your organization or team?" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: isExternalMeeting, onValueChange: changeIsExternalMeeting, style: { marginBottom: 20 } }) })] })] }));
}
exports.default = EditEventBaseStep3;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWRpdEV2ZW50QmFzZVN0ZXAzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiRWRpdEV2ZW50QmFzZVN0ZXAzLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQWVBLGdEQXFDQzs7QUFwREQsaUNBSWM7QUFFZCxnRUFBd0M7QUFDeEMsaUVBQXdDO0FBQ3hDLG1FQUEwQztBQUcxQyx3RUFBOEM7QUFDOUMsaUVBQTZEO0FBQzdELDhFQUFxRDtBQUU5QyxLQUFLLFVBQVUsa0JBQWtCLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFpRDtJQUNsRywwRkFBMEY7SUFDMUYsc0NBQXNDO0lBQ3RDLHlFQUF5RTtJQUN6RSwwQkFBZSxDQUFDLElBQUksQ0FBQyxJQUFBLDZCQUFhLEdBQUUsQ0FBQyxDQUFBO0lBQ3JDLElBQUksT0FBTyxDQUFBO0lBQ1gsSUFBSSxDQUFDO1FBQ0gsT0FBTyxHQUFHLE1BQU0saUJBQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRTtZQUMzQyw2QkFBNkIsRUFBRSxLQUFLO2dCQUNsQyxPQUFPLEVBQUUsQ0FBQTtZQUNYLENBQUM7U0FDRixDQUFDLENBQUE7SUFDSixDQUFDO0lBQUMsT0FBTyxHQUFRLEVBQUUsQ0FBQztRQUNsQixJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssaUJBQU8sQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUNqRCxPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsZUFBZSxFQUFFLGVBQWUsRUFBRSxFQUFFLENBQUE7UUFDeEQsQ0FBQzthQUFNLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxpQkFBTyxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUNuRCxrRUFBa0U7WUFDbEUscUVBQXFFO1lBQ3JFLE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLEVBQUUsQ0FBQTtRQUN4RCxDQUFDO1FBQ0QsTUFBTSxHQUFHLENBQUE7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QUFjLHNIQUE2RyxHQUN2SSxFQUNOLHVCQUFDLGFBQUcsSUFBRSxhQUFhLEVBQUMsS0FBSyxFQUFDLGNBQWMsRUFBQyxVQUFVLEVBQUMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLFlBQy9FLHVCQUFDLGdCQUFPLElBQ0osT0FBTyxFQUFFLGlCQUFpQixFQUMxQixhQUFhLEVBQUUsdUJBQXVCLEVBQ3RDLEtBQUssRUFBRSxFQUFFLFlBQVksRUFBRSxFQUFFLEVBQUUsR0FDN0IsR0FDQSxJQUNKLElBQ0osQ0FDVCxDQUFBO0FBRUwsQ0FBQztBQUVELGtCQUFlLGtCQUFrQixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7XG4gIHVzZVN0YXRlLFxuICBEaXNwYXRjaCxcbiAgU2V0U3RhdGVBY3Rpb24sXG59IGZyb20gJ3JlYWN0J1xuXG5pbXBvcnQgU3dpdGNoMSBmcm9tICdAY29tcG9uZW50cy9Td2l0Y2gnXG5pbXBvcnQgQm94IGZyb20gJ0Bjb21wb25lbnRzL2NvbW1vbi9Cb3gnXG5pbXBvcnQgVGV4dCBmcm9tICdAY29tcG9uZW50cy9jb21tb24vVGV4dCdcbmltcG9ydCB7IFRyYW5zcGFyZW5jeVR5cGUgfSBmcm9tICdAbGliL2NhbGVuZGFyTGliL3R5cGVzJ1xuaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xuaW1wb3J0IHN1cGVydG9rZW5zTm9kZSBmcm9tICdzdXBlcnRva2Vucy1ub2RlJ1xuaW1wb3J0IHsgYmFja2VuZENvbmZpZyB9IGZyb20gJy4uLy4uLy4uL2NvbmZpZy9iYWNrZW5kQ29uZmlnJ1xuaW1wb3J0IFNlc3Npb24gZnJvbSAnc3VwZXJ0b2tlbnMtbm9kZS9yZWNpcGUvc2Vzc2lvbidcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNlcnZlclNpZGVQcm9wcyh7IHJlcSwgcmVzIH06IHsgcmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UgfSkge1xuICAvLyBOb3RpY2UgaG93IHRoZSBzZXJ2ZXIgdXNlcyBgQVBJYCBmcm9tIGB3aXRoU1NSQ29udGV4dGAsIGluc3RlYWQgb2YgdGhlIHRvcC1sZXZlbCBgQVBJYC5cbiAgLy8gY29uc3QgU1NSID0gd2l0aFNTUkNvbnRleHQoeyByZXEgfSlcbiAgLy8gdGhpcyBydW5zIG9uIHRoZSBiYWNrZW5kLCBzbyB3ZSBtdXN0IGNhbGwgaW5pdCBvbiBzdXBlcnRva2Vucy1ub2RlIFNES1xuICBzdXBlcnRva2Vuc05vZGUuaW5pdChiYWNrZW5kQ29uZmlnKCkpXG4gIGxldCBzZXNzaW9uXG4gIHRyeSB7XG4gICAgc2Vzc2lvbiA9IGF3YWl0IFNlc3Npb24uZ2V0U2Vzc2lvbihyZXEsIHJlcywge1xuICAgICAgb3ZlcnJpZGVHbG9iYWxDbGFpbVZhbGlkYXRvcnM6IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFtdXG4gICAgICB9LFxuICAgIH0pXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgaWYgKGVyci50eXBlID09PSBTZXNzaW9uLkVycm9yLlRSWV9SRUZSRVNIX1RPS0VOKSB7XG4gICAgICByZXR1cm4geyBwcm9wczogeyBmcm9tU3VwZXJ0b2tlbnM6ICduZWVkcy1yZWZyZXNoJyB9IH1cbiAgICB9IGVsc2UgaWYgKGVyci50eXBlID09PSBTZXNzaW9uLkVycm9yLlVOQVVUSE9SSVNFRCkge1xuICAgICAgLy8gdGhpcyB3aWxsIGZvcmNlIHRoZSBmcm9udGVuZCB0byB0cnkgYW5kIHJlZnJlc2ggd2hpY2ggd2lsbCBmYWlsXG4gICAgICAvLyBjbGVhcmluZyBhbGwgY29va2llcyBhbmQgcmVkaXJlY3RpbmcgdGhlIHVzZXIgdG8gdGhlIGxvZ2luIHNjcmVlbi5cbiAgICAgIHJldHVybiB7IHByb3BzOiB7IGZyb21TdXBlcnRva2VuczogJ25lZWRzLXJlZnJlc2gnIH0gfVxuICAgIH1cbiAgICB0aHJvdyBlcnJcbiAgfVxuXG4gIGlmICghc2Vzc2lvbj8uZ2V0VXNlcklkKCkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcmVkaXJlY3Q6IHtcbiAgICAgICAgZGVzdGluYXRpb246ICcvVXNlci9Mb2dpbi9Vc2VyTG9naW4nLFxuICAgICAgICBwZXJtYW5lbnQ6IGZhbHNlLFxuICAgICAgfSxcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHByb3BzOiB7XG4gICAgICBzdWI6IHNlc3Npb24uZ2V0VXNlcklkKCksXG4gICAgfVxuICB9XG59XG5cbnR5cGUgUHJvcHMgPSB7XG4gICAgbW9kaWZpYWJsZTogYm9vbGVhbixcbiAgICBpc01lZXRpbmc6IGJvb2xlYW4sXG4gICAgaXNFeHRlcm5hbE1lZXRpbmc6IGJvb2xlYW4sXG4gICAgdHJhbnNwYXJlbmN5OiBUcmFuc3BhcmVuY3lUeXBlLFxuICAgIHNldFBhcmVudE1vZGlmaWFibGU6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPGJvb2xlYW4+PixcbiAgICBzZXRQYXJlbnRJc01lZXRpbmc6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPGJvb2xlYW4+PixcbiAgICBzZXRQYXJlbnRJc0V4dGVybmFsTWVldGluZzogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248Ym9vbGVhbj4+LFxuICAgIHNldFBhcmVudFRyYW5zcGFyZW5jeTogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248VHJhbnNwYXJlbmN5VHlwZT4+XG59ICAgXG5cbmZ1bmN0aW9uIEVkaXRFdmVudEJhc2VTdGVwMyhwcm9wczogUHJvcHMpIHtcbiAgICBjb25zdCBbbW9kaWZpYWJsZSwgc2V0TW9kaWZpYWJsZV0gPSB1c2VTdGF0ZTxib29sZWFuPihwcm9wcz8ubW9kaWZpYWJsZSA/PyB0cnVlKVxuICAgIGNvbnN0IFtpc01lZXRpbmcsIHNldElzTWVldGluZ10gPSB1c2VTdGF0ZTxib29sZWFuPihwcm9wcz8uaXNNZWV0aW5nKVxuICAgIGNvbnN0IFtpc0V4dGVybmFsTWVldGluZywgc2V0SXNFeHRlcm5hbE1lZXRpbmddID0gdXNlU3RhdGU8Ym9vbGVhbj4ocHJvcHM/LmlzRXh0ZXJuYWxNZWV0aW5nKVxuICAgIGNvbnN0IFt0cmFuc3BhcmVuY3ksIHNldFRyYW5zcGFyZW5jeV0gPSB1c2VTdGF0ZTxUcmFuc3BhcmVuY3lUeXBlPihwcm9wcz8udHJhbnNwYXJlbmN5ID8/ICdvcGFxdWUnKVxuXG4gICAgY29uc3Qgc2V0UGFyZW50TW9kaWZpYWJsZSA9IHByb3BzPy5zZXRQYXJlbnRNb2RpZmlhYmxlXG4gICAgY29uc3Qgc2V0UGFyZW50SXNNZWV0aW5nID0gcHJvcHM/LnNldFBhcmVudElzTWVldGluZ1xuICAgIGNvbnN0IHNldFBhcmVudElzRXh0ZXJuYWxNZWV0aW5nID0gcHJvcHM/LnNldFBhcmVudElzRXh0ZXJuYWxNZWV0aW5nXG4gICAgY29uc3Qgc2V0UGFyZW50VHJhbnNwYXJlbmN5ID0gcHJvcHM/LnNldFBhcmVudFRyYW5zcGFyZW5jeVxuICAgIFxuICAgIGNvbnN0IGNoYW5nZVRyYW5zcGFyZW5jeSA9ICh2YWx1ZTogYm9vbGVhbikgPT4ge1xuICAgICAgICBzZXRUcmFuc3BhcmVuY3kodmFsdWUgPT09IHRydWUgPyAndHJhbnNwYXJlbnQnIDogJ29wYXF1ZScpXG4gICAgICAgIHNldFBhcmVudFRyYW5zcGFyZW5jeSh2YWx1ZSA9PT0gdHJ1ZSA/ICd0cmFuc3BhcmVudCcgOiAnb3BhcXVlJylcbiAgICB9XG5cbiAgICBjb25zdCBjaGFuZ2VNb2RpZmlhYmxlID0gKHZhbHVlOiBib29sZWFuKSA9PiB7XG4gICAgICAgIHNldE1vZGlmaWFibGUodmFsdWUpXG4gICAgICAgIHNldFBhcmVudE1vZGlmaWFibGUodmFsdWUpXG4gICAgfVxuXG4gICAgY29uc3QgY2hhbmdlSXNNZWV0aW5nID0gKHZhbHVlOiBib29sZWFuKSA9PiB7XG4gICAgICAgIHNldElzTWVldGluZyh2YWx1ZSlcbiAgICAgICAgc2V0UGFyZW50SXNNZWV0aW5nKHZhbHVlKVxuXG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgc2V0SXNFeHRlcm5hbE1lZXRpbmcoZmFsc2UpXG4gICAgICAgICAgICBzZXRQYXJlbnRJc0V4dGVybmFsTWVldGluZyhmYWxzZSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGNoYW5nZUlzRXh0ZXJuYWxNZWV0aW5nID0gKHZhbHVlOiBib29sZWFuKSA9PiB7XG4gICAgICAgIHNldElzRXh0ZXJuYWxNZWV0aW5nKHZhbHVlKVxuICAgICAgICBzZXRQYXJlbnRJc0V4dGVybmFsTWVldGluZyh2YWx1ZSlcbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICBzZXRJc01lZXRpbmcoZmFsc2UpXG4gICAgICAgICAgICBzZXRQYXJlbnRJc01lZXRpbmcoZmFsc2UpXG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIHJldHVybiAoXG4gICAgICAgIDxCb3ggZmxleD17MX0ganVzdGlmeUNvbnRlbnQ9XCJjZW50ZXJcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIgc3R5bGU9e3sgd2lkdGg6ICcxMDAlJ319PlxuICAgICAgICAgICAgPEJveCBmbGV4PXsxfSBzdHlsZT17eyB3aWR0aDogJzkwJScgfX0gcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fT5cbiAgICAgICAgICAgICAgICA8Qm94IGZsZXg9ezF9IGZsZXhEaXJlY3Rpb249XCJyb3dcIiBqdXN0aWZ5Q29udGVudD1cImZsZXgtc3RhcnRcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCI+ICBcbiAgICAgICAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD1cIm9wdGlvbkhlYWRlclwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19PlxuICAgICAgICAgICAgICAgICAgICAgICAgTWFrZSB0aGlzIGV2ZW50IHRyYW5zcGFyZW50P1xuICAgICAgICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgPEJveCBmbGV4PXsxfSBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LWVuZFwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19PlxuICAgICAgICAgICAgICAgICAgICA8U3dpdGNoMVxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17dHJhbnNwYXJlbmN5ID09PSAnb3BhcXVlJyA/IGZhbHNlIDogdHJ1ZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uVmFsdWVDaGFuZ2U9e2NoYW5nZVRyYW5zcGFyZW5jeX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7bWFyZ2luQm90dG9tOiAyMH19XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgIDxCb3ggZmxleD17MX0gc3R5bGU9e3sgd2lkdGg6ICc5MCUnIH19IHA9e3sgcGhvbmU6ICdzJywgdGFibGV0OiAnbScgfX0+XG4gICAgICAgICAgICAgICAgPEJveCAgZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1zdGFydFwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIj4gIFxuICAgICAgICAgICAgICAgICAgICA8VGV4dCB2YXJpYW50PVwib3B0aW9uSGVhZGVyXCI+SXMgdGhlIHN0YXJ0IHRpbWUgb2YgdGhpcyBldmVudCBtb2RpZmlhYmxlIGZvciBzY2hlZHVsaW5nIGFzc2lzdHM/PC9UZXh0PlxuICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgIDxCb3ggIGZsZXhEaXJlY3Rpb249XCJyb3dcIiBqdXN0aWZ5Q29udGVudD1cImZsZXgtZW5kXCIgcHQ9e3sgcGhvbmU6ICdtJywgdGFibGV0OiAncycgfX0+XG4gICAgICAgICAgICAgICAgICAgIDxTd2l0Y2gxXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkPXttb2RpZmlhYmxlfVxuICAgICAgICAgICAgICAgICAgICAgICAgb25WYWx1ZUNoYW5nZT17Y2hhbmdlTW9kaWZpYWJsZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7bWFyZ2luQm90dG9tOiAyMH19XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgIDxCb3ggZmxleD17MX0gc3R5bGU9e3sgd2lkdGg6ICc5MCUnIH19IHA9e3sgcGhvbmU6ICdzJywgdGFibGV0OiAnbScgfX0+XG4gICAgICAgICAgICAgICAgPEJveCAgZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1zdGFydFwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIj4gIFxuICAgICAgICAgICAgICAgICAgICA8VGV4dCB2YXJpYW50PVwib3B0aW9uSGVhZGVyXCI+Q2xhc3NpZnkgdGhpcyBldmVudCBhcyBhIG1lZXRpbmcgdHlwZSBldmVudD88L1RleHQ+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgPEJveCAgZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1lbmRcIiBwdD17eyBwaG9uZTogJ20nLCB0YWJsZXQ6ICdzJyB9fT5cbiAgICAgICAgICAgICAgICAgICAgPFN3aXRjaDFcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e2lzTWVldGluZ31cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uVmFsdWVDaGFuZ2U9e2NoYW5nZUlzTWVldGluZ31cbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7IG1hcmdpbkJvdHRvbTogMjAgfX1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgPEJveCBmbGV4PXsxfSBzdHlsZT17eyB3aWR0aDogJzkwJScgfX0gcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fT5cbiAgICAgICAgICAgICAgICA8Qm94ICBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LXN0YXJ0XCIgYWxpZ25JdGVtcz1cImNlbnRlclwiPiAgXG4gICAgICAgICAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJvcHRpb25IZWFkZXJcIj5DbGFzc2lmeSB0aGlzIGV2ZW50IGFzIGFuIGV4dGVybmFsIG1lZXRpbmcgdHlwZSBpZSBtZWV0aW5nIHRoYXQgaXMgb3V0c2lkZSB5b3VyIG9yZ2FuaXphdGlvbiBvciB0ZWFtPzwvVGV4dD5cbiAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICA8Qm94ICBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LWVuZFwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19PlxuICAgICAgICAgICAgICAgICAgICA8U3dpdGNoMVxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17aXNFeHRlcm5hbE1lZXRpbmd9XG4gICAgICAgICAgICAgICAgICAgICAgICBvblZhbHVlQ2hhbmdlPXtjaGFuZ2VJc0V4dGVybmFsTWVldGluZ31cbiAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXt7IG1hcmdpbkJvdHRvbTogMjAgfX1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgIDwvQm94PlxuICAgICAgICA8L0JveD5cbiAgICApXG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgRWRpdEV2ZW50QmFzZVN0ZXAzXG4iXX0=