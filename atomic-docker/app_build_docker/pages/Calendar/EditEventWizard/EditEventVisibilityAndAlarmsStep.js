"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const react_native_1 = require("react-native");
const TextField_1 = __importDefault(require("@components/TextField"));
const io_1 = require("react-icons/io");
const picker_1 = require("@react-native-picker/picker");
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const theme_1 = require("@lib/theme/theme");
const wizardHelper_1 = require("@lib/Calendar/CreateEventWizard/wizardHelper");
const lodash_1 = __importDefault(require("lodash"));
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("../../../config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
function EditEventVisibilityAndAlarmsStep(props) {
    const [visibility, setVisibility] = (0, react_1.useState)(props?.visibility);
    const [alarms, setAlarms] = (0, react_1.useState)(props?.alarms || []);
    const [alarm, setAlarm] = (0, react_1.useState)(0);
    const [pageOffset, setPageOffset] = (0, react_1.useState)(0);
    const { height: fullHeight } = react_native_1.Dimensions.get('window');
    const dark = (0, react_native_1.useColorScheme)() === 'dark';
    const setParentVisibility = props?.setParentVisibility;
    const setParentAlarms = props?.setParentAlarms;
    console.log(props?.alarms, ' props?.alarms');
    (0, react_1.useEffect)(() => {
        if (props?.visibility !== visibility) {
            setVisibility(props?.visibility);
        }
        if (!lodash_1.default.isEqual(props?.alarms, alarms)) {
            setAlarms(props?.alarms);
        }
    }, [visibility, alarms, props?.visibility, props?.alarms]);
    const onVisibilityChange = (value) => {
        setVisibility(value);
        setParentVisibility(value);
    };
    return ((0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, style: { width: '100%' }, children: (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Make this event private or public" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 3, justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsxs)(picker_1.Picker, { selectedValue: visibility, onValueChange: onVisibilityChange, children: [(0, jsx_runtime_1.jsx)(picker_1.Picker.Item, { color: dark ? theme_1.palette.white : theme_1.palette.textBlack, value: "default", label: "Default" }, "default"), (0, jsx_runtime_1.jsx)(picker_1.Picker.Item, { color: dark ? theme_1.palette.white : theme_1.palette.textBlack, value: "public", label: "Public" }, "public"), (0, jsx_runtime_1.jsx)(picker_1.Picker.Item, { color: dark ? theme_1.palette.white : theme_1.palette.textBlack, value: "private", label: "Private" }, "private")] }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 3, justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsx)(react_native_1.FlatList, { data: alarms, renderItem: ({ item, index }) => ((0, jsx_runtime_1.jsx)(Box_1.default, { justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsxs)(Box_1.default, { flexDirection: "row", justifyContent: "space-between", style: { width: '70%' }, children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: `${item} minutes before` }), (0, jsx_runtime_1.jsx)(react_native_1.Pressable, { hitSlop: 15, onPress: () => (0, wizardHelper_1.removeItemFromAlarms)(index, alarms, setAlarms, setParentAlarms), children: (0, jsx_runtime_1.jsx)(io_1.IoIosClose, { size: "3em", color: theme_1.palette.red }) })] }) })), keyExtractor: (item, index) => `${item}-${index}` }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, flexDirection: "row", justifyContent: "space-between", alignItems: "center", style: { width: '40%' }, children: [(0, jsx_runtime_1.jsx)("div", { className: "mr-2", children: (0, jsx_runtime_1.jsx)(TextField_1.default, { type: "number", onChange: (e) => setAlarm(parseInt(e?.target?.value.replace(/[^0-9.]/g, ''), 10)), value: `${alarm}`, placeholder: "0" }) }), (0, jsx_runtime_1.jsx)("div", { className: "ml-4", children: (0, jsx_runtime_1.jsx)(react_native_1.Pressable, { onPress: () => (0, wizardHelper_1.addItemToAlarms)(alarm, alarms, setAlarms, setParentAlarms, setAlarm), children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "buttonLink", children: "Add Reminder" }) }) })] }) })] }) }));
}
exports.default = EditEventVisibilityAndAlarmsStep;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWRpdEV2ZW50VmlzaWJpbGl0eUFuZEFsYXJtc1N0ZXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJFZGl0RXZlbnRWaXNpYmlsaXR5QW5kQWxhcm1zU3RlcC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUE2QkEsZ0RBcUNDOztBQWxFRCxpQ0FLZTtBQUNmLCtDQU1zQjtBQUN0QixzRUFBNkM7QUFDN0MsdUNBQTRDO0FBQzVDLHdEQUFrRDtBQUNsRCxpRUFBd0M7QUFDeEMsbUVBQTBDO0FBRzFDLDRDQUEwQztBQUUxQywrRUFBb0c7QUFDcEcsb0RBQXNCO0FBRXRCLHdFQUE4QztBQUM5QyxpRUFBNkQ7QUFDN0QsOEVBQXFEO0FBRTlDLEtBQUssVUFBVSxrQkFBa0IsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQWlEO0lBQ2xHLDBGQUEwRjtJQUMxRixzQ0FBc0M7SUFDdEMseUVBQXlFO0lBQ3pFLDBCQUFlLENBQUMsSUFBSSxDQUFDLElBQUEsNkJBQWEsR0FBRSxDQUFDLENBQUE7SUFDckMsSUFBSSxPQUFPLENBQUE7SUFDWCxJQUFJLENBQUM7UUFDSCxPQUFPLEdBQUcsTUFBTSxpQkFBTyxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFO1lBQzNDLDZCQUE2QixFQUFFLEtBQUs7Z0JBQ2xDLE9BQU8sRUFBRSxDQUFBO1lBQ1gsQ0FBQztTQUNGLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFBQyxPQUFPLEdBQVEsRUFBRSxDQUFDO1FBQ2xCLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxpQkFBTyxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ2pELE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLEVBQUUsQ0FBQTtRQUN4RCxDQUFDO2FBQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLGlCQUFPLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ25ELGtFQUFr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RSxDQUFDLENBQWdDLEVBQUUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUNoSCxLQUFLLEVBQUUsR0FBRyxLQUFLLEVBQUUsRUFDakIsV0FBVyxFQUFDLEdBQUcsR0FFYixHQUVBLEVBQ04sZ0NBQUssU0FBUyxFQUFDLE1BQU0sWUFDakIsdUJBQUMsd0JBQVMsSUFBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBQSw4QkFBZSxFQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLGVBQWUsRUFBRSxRQUFRLENBQUMsWUFDNUYsdUJBQUMsY0FBSSxJQUFDLE9BQU8sRUFBQyxZQUFZLDZCQUVuQixHQUNHLEdBQ1IsSUFDSixHQUNGLElBQ0YsR0FDTixDQUNQLENBQUE7QUFDSCxDQUFDO0FBRUQsa0JBQWUsZ0NBQWdDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtcbiAgdXNlU3RhdGUsXG4gIERpc3BhdGNoLFxuICBTZXRTdGF0ZUFjdGlvbixcbiAgdXNlRWZmZWN0LFxuIH0gZnJvbSAncmVhY3QnXG5pbXBvcnQge1xuICBEaW1lbnNpb25zLFxuICBGbGF0TGlzdCxcbiAgUHJlc3NhYmxlLFxuICBTdHlsZVNoZWV0LFxuICB1c2VDb2xvclNjaGVtZSxcbiB9IGZyb20gJ3JlYWN0LW5hdGl2ZSdcbmltcG9ydCBUZXh0RmllbGQgZnJvbSAnQGNvbXBvbmVudHMvVGV4dEZpZWxkJ1xuaW1wb3J0IHsgSW9Jb3NDbG9zZSB9IGZyb20gXCJyZWFjdC1pY29ucy9pb1wiO1xuaW1wb3J0IHtQaWNrZXJ9IGZyb20gJ0ByZWFjdC1uYXRpdmUtcGlja2VyL3BpY2tlcidcbmltcG9ydCBCb3ggZnJvbSAnQGNvbXBvbmVudHMvY29tbW9uL0JveCdcbmltcG9ydCBUZXh0IGZyb20gJ0Bjb21wb25lbnRzL2NvbW1vbi9UZXh0J1xuaW1wb3J0IEJ1dHRvbiBmcm9tICdAY29tcG9uZW50cy9CdXR0b24nXG5cbmltcG9ydCB7IHBhbGV0dGUgfSBmcm9tICdAbGliL3RoZW1lL3RoZW1lJ1xuaW1wb3J0IHsgVmlzaWJpbGl0eVR5cGUgfSBmcm9tICdAbGliL2NhbGVuZGFyTGliL3R5cGVzJ1xuaW1wb3J0IHsgYWRkSXRlbVRvQWxhcm1zLCByZW1vdmVJdGVtRnJvbUFsYXJtcyB9IGZyb20gJ0BsaWIvQ2FsZW5kYXIvQ3JlYXRlRXZlbnRXaXphcmQvd2l6YXJkSGVscGVyJ1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJ1xuaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xuaW1wb3J0IHN1cGVydG9rZW5zTm9kZSBmcm9tICdzdXBlcnRva2Vucy1ub2RlJ1xuaW1wb3J0IHsgYmFja2VuZENvbmZpZyB9IGZyb20gJy4uLy4uLy4uL2NvbmZpZy9iYWNrZW5kQ29uZmlnJ1xuaW1wb3J0IFNlc3Npb24gZnJvbSAnc3VwZXJ0b2tlbnMtbm9kZS9yZWNpcGUvc2Vzc2lvbidcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNlcnZlclNpZGVQcm9wcyh7IHJlcSwgcmVzIH06IHsgcmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UgfSkge1xuICAvLyBOb3RpY2UgaG93IHRoZSBzZXJ2ZXIgdXNlcyBgQVBJYCBmcm9tIGB3aXRoU1NSQ29udGV4dGAsIGluc3RlYWQgb2YgdGhlIHRvcC1sZXZlbCBgQVBJYC5cbiAgLy8gY29uc3QgU1NSID0gd2l0aFNTUkNvbnRleHQoeyByZXEgfSlcbiAgLy8gdGhpcyBydW5zIG9uIHRoZSBiYWNrZW5kLCBzbyB3ZSBtdXN0IGNhbGwgaW5pdCBvbiBzdXBlcnRva2Vucy1ub2RlIFNES1xuICBzdXBlcnRva2Vuc05vZGUuaW5pdChiYWNrZW5kQ29uZmlnKCkpXG4gIGxldCBzZXNzaW9uXG4gIHRyeSB7XG4gICAgc2Vzc2lvbiA9IGF3YWl0IFNlc3Npb24uZ2V0U2Vzc2lvbihyZXEsIHJlcywge1xuICAgICAgb3ZlcnJpZGVHbG9iYWxDbGFpbVZhbGlkYXRvcnM6IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFtdXG4gICAgICB9LFxuICAgIH0pXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgaWYgKGVyci50eXBlID09PSBTZXNzaW9uLkVycm9yLlRSWV9SRUZSRVNIX1RPS0VOKSB7XG4gICAgICByZXR1cm4geyBwcm9wczogeyBmcm9tU3VwZXJ0b2tlbnM6ICduZWVkcy1yZWZyZXNoJyB9IH1cbiAgICB9IGVsc2UgaWYgKGVyci50eXBlID09PSBTZXNzaW9uLkVycm9yLlVOQVVUSE9SSVNFRCkge1xuICAgICAgLy8gdGhpcyB3aWxsIGZvcmNlIHRoZSBmcm9udGVuZCB0byB0cnkgYW5kIHJlZnJlc2ggd2hpY2ggd2lsbCBmYWlsXG4gICAgICAvLyBjbGVhcmluZyBhbGwgY29va2llcyBhbmQgcmVkaXJlY3RpbmcgdGhlIHVzZXIgdG8gdGhlIGxvZ2luIHNjcmVlbi5cbiAgICAgIHJldHVybiB7IHByb3BzOiB7IGZyb21TdXBlcnRva2VuczogJ25lZWRzLXJlZnJlc2gnIH0gfVxuICAgIH1cbiAgICB0aHJvdyBlcnJcbiAgfVxuXG4gIGlmICghc2Vzc2lvbj8uZ2V0VXNlcklkKCkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcmVkaXJlY3Q6IHtcbiAgICAgICAgZGVzdGluYXRpb246ICcvVXNlci9Mb2dpbi9Vc2VyTG9naW4nLFxuICAgICAgICBwZXJtYW5lbnQ6IGZhbHNlLFxuICAgICAgfSxcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHByb3BzOiB7XG4gICAgICBzdWI6IHNlc3Npb24uZ2V0VXNlcklkKCksXG4gICAgfVxuICB9XG59XG5cbnR5cGUgUHJvcHMgPSB7XG4gIHNldFBhcmVudFZpc2liaWxpdHk6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPFZpc2liaWxpdHlUeXBlPj4sXG4gIHVzZXJJZDogc3RyaW5nLFxuICB2aXNpYmlsaXR5OiBWaXNpYmlsaXR5VHlwZSxcbiAgYWxhcm1zOiBudW1iZXJbXSxcbiAgc2V0UGFyZW50QWxhcm1zOiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxudW1iZXJbXT4+LFxufVxuXG5mdW5jdGlvbiBFZGl0RXZlbnRWaXNpYmlsaXR5QW5kQWxhcm1zU3RlcChwcm9wczogUHJvcHMpIHtcbiAgY29uc3QgW3Zpc2liaWxpdHksIHNldFZpc2liaWxpdHldID0gdXNlU3RhdGU8VmlzaWJpbGl0eVR5cGU+KHByb3BzPy52aXNpYmlsaXR5KVxuICBjb25zdCBbYWxhcm1zLCBzZXRBbGFybXNdID0gdXNlU3RhdGU8bnVtYmVyW10+KHByb3BzPy5hbGFybXMgfHwgW10pXG4gIGNvbnN0IFthbGFybSwgc2V0QWxhcm1dID0gdXNlU3RhdGU8bnVtYmVyPigwKVxuICBjb25zdCBbcGFnZU9mZnNldCwgc2V0UGFnZU9mZnNldF0gPSB1c2VTdGF0ZTxudW1iZXI+KDApXG5cbiAgY29uc3Qge2hlaWdodDogZnVsbEhlaWdodH0gPSBEaW1lbnNpb25zLmdldCgnd2luZG93JylcblxuICBjb25zdCBkYXJrID0gdXNlQ29sb3JTY2hlbWUoKSA9PT0gJ2RhcmsnXG4gIGNvbnN0IHNldFBhcmVudFZpc2liaWxpdHkgPSBwcm9wcz8uc2V0UGFyZW50VmlzaWJpbGl0eVxuICBjb25zdCBzZXRQYXJlbnRBbGFybXMgPSBwcm9wcz8uc2V0UGFyZW50QWxhcm1zXG5cbiAgY29uc29sZS5sb2cocHJvcHM/LmFsYXJtcywgJyBwcm9wcz8uYWxhcm1zJylcblxuICB1c2VFZmZlY3QoKCk6IHZvaWQgPT4ge1xuICAgIGlmIChwcm9wcz8udmlzaWJpbGl0eSAhPT0gdmlzaWJpbGl0eSkge1xuICAgICAgc2V0VmlzaWJpbGl0eShwcm9wcz8udmlzaWJpbGl0eSlcbiAgICB9XG5cbiAgICBpZiAoIV8uaXNFcXVhbChwcm9wcz8uYWxhcm1zLCBhbGFybXMpKSB7XG4gICAgICBzZXRBbGFybXMocHJvcHM/LmFsYXJtcylcbiAgICB9XG4gIH0sIFt2aXNpYmlsaXR5LCBhbGFybXMsIHByb3BzPy52aXNpYmlsaXR5LCBwcm9wcz8uYWxhcm1zXSlcblxuICBjb25zdCBvblZpc2liaWxpdHlDaGFuZ2UgPSAodmFsdWU6IFZpc2liaWxpdHlUeXBlKSA9PiB7XG4gICAgc2V0VmlzaWJpbGl0eSh2YWx1ZSlcbiAgICBzZXRQYXJlbnRWaXNpYmlsaXR5KHZhbHVlKVxuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8Qm94IGZsZXg9ezF9IHN0eWxlPXt7IHdpZHRoOiAnMTAwJScgfX0+XG5cbiAgICAgICAgICA8Qm94IGZsZXg9ezF9IGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnMTAwJSd9fT5cbiAgICAgICAgICAgIDxCb3ggZmxleD17MX0gIGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnMTAwJSd9fT5cbiAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD1cIm9wdGlvbkhlYWRlclwiPlxuICAgICAgICAgICAgICAgIE1ha2UgdGhpcyBldmVudCBwcml2YXRlIG9yIHB1YmxpY1xuICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgIDxCb3ggZmxleD17M30gIGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnMTAwJSd9fT5cbiAgICAgICAgICAgICAgPFBpY2tlclxuICAgICAgICAgICAgICAgIHNlbGVjdGVkVmFsdWU9e3Zpc2liaWxpdHl9XG4gICAgICAgICAgICAgICAgb25WYWx1ZUNoYW5nZT17b25WaXNpYmlsaXR5Q2hhbmdlfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICA8UGlja2VyLkl0ZW0gY29sb3I9e2RhcmsgPyBwYWxldHRlLndoaXRlIDogcGFsZXR0ZS50ZXh0QmxhY2t9ICBrZXk9XCJkZWZhdWx0XCIgdmFsdWU9XCJkZWZhdWx0XCIgbGFiZWw9XCJEZWZhdWx0XCIgLz5cbiAgICAgICAgICAgICAgICAgIDxQaWNrZXIuSXRlbSBjb2xvcj17ZGFyayA/IHBhbGV0dGUud2hpdGUgOiBwYWxldHRlLnRleHRCbGFja30gIGtleT1cInB1YmxpY1wiIHZhbHVlPVwicHVibGljXCIgbGFiZWw9XCJQdWJsaWNcIiAvPlxuICAgICAgICAgICAgICAgICAgPFBpY2tlci5JdGVtIGNvbG9yPXtkYXJrID8gcGFsZXR0ZS53aGl0ZSA6IHBhbGV0dGUudGV4dEJsYWNrfSAga2V5PVwicHJpdmF0ZVwiIHZhbHVlPVwicHJpdmF0ZVwiIGxhYmVsPVwiUHJpdmF0ZVwiIC8+XG4gICAgICAgICAgICAgIDwvUGlja2VyPlxuICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICA8Qm94IGZsZXg9ezN9ICBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBzdHlsZT17eyB3aWR0aDogJzEwMCUnfX0+XG4gICAgICAgICAgICAgIDxGbGF0TGlzdFxuICAgICAgICAgICAgICAgIGRhdGE9e2FsYXJtc31cbiAgICAgICAgICAgICAgICByZW5kZXJJdGVtPXsoeyBpdGVtLCBpbmRleCB9KSA9PiAoXG4gICAgICAgICAgICAgICAgICA8Qm94IGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnMTAwJSd9fT5cbiAgICAgICAgICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJzcGFjZS1iZXR3ZWVuXCIgc3R5bGU9e3sgd2lkdGg6ICc3MCUnfX0+XG4gICAgICAgICAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD1cIm9wdGlvbkhlYWRlclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAge2Ake2l0ZW19IG1pbnV0ZXMgYmVmb3JlYH1cbiAgICAgICAgICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICAgICAgICAgICAgPFByZXNzYWJsZSBoaXRTbG9wPXsxNX0gb25QcmVzcz17KCkgPT4gcmVtb3ZlSXRlbUZyb21BbGFybXMoaW5kZXgsIGFsYXJtcywgc2V0QWxhcm1zLCBzZXRQYXJlbnRBbGFybXMpfT5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxJb0lvc0Nsb3NlIHNpemU9XCIzZW1cIiBjb2xvcj17cGFsZXR0ZS5yZWR9IC8+XG4gICAgICAgICAgICAgICAgICAgICAgPC9QcmVzc2FibGU+XG4gICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICBrZXlFeHRyYWN0b3I9eyhpdGVtLCBpbmRleCkgPT4gYCR7aXRlbX0tJHtpbmRleH1gfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICA8Qm94IGZsZXg9ezF9IGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnMTAwJSd9fT5cbiAgICAgICAgICAgICAgPEJveCBmbGV4PXsxfSAgZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwic3BhY2UtYmV0d2VlblwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBzdHlsZT17eyB3aWR0aDogJzQwJSd9fT5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm1yLTJcIj5cblxuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICA8VGV4dEZpZWxkXG4gICAgICAgICAgICAgICAgICAgIHR5cGU9XCJudW1iZXJcIlxuICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGU6IHsgdGFyZ2V0OiB7IHZhbHVlOiBzdHJpbmcgfSB9KSA9PiBzZXRBbGFybShwYXJzZUludChlPy50YXJnZXQ/LnZhbHVlLnJlcGxhY2UoL1teMC05Ll0vZywgJycpLCAxMCkpfVxuICAgICAgICAgICAgICAgICAgICB2YWx1ZT17YCR7YWxhcm19YH1cbiAgICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCIwXCJcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8+XG5cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cIm1sLTRcIj5cbiAgICAgICAgICAgICAgICAgICAgPFByZXNzYWJsZSBvblByZXNzPXsoKSA9PiBhZGRJdGVtVG9BbGFybXMoYWxhcm0sIGFsYXJtcywgc2V0QWxhcm1zLCBzZXRQYXJlbnRBbGFybXMsIHNldEFsYXJtKX0+XG4gICAgICAgICAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD1cImJ1dHRvbkxpbmtcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIEFkZCBSZW1pbmRlclxuICAgICAgICAgICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgICAgICAgICAgPC9QcmVzc2FibGU+XG4gICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICA8L0JveD5cbiAgICA8L0JveD5cbiAgKVxufVxuXG5leHBvcnQgZGVmYXVsdCBFZGl0RXZlbnRWaXNpYmlsaXR5QW5kQWxhcm1zU3RlcFxuIC8qKiBlbmQgKi9cbiJdfQ==