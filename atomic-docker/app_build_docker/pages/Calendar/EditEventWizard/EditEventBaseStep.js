"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
// import DatePicker from 'react-native-date-picker'
// import DateTimePicker from 'react-datetime-picker/dist/entry.nostyle'
const date_utils_1 = require("@lib/date-utils");
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const TextField_1 = __importDefault(require("@components/TextField"));
const react_2 = require("@chakra-ui/react");
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("../../../config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
function EditEventBaseStep(props) {
    const [title, setTitle] = (0, react_1.useState)(props?.title);
    const [notes, setNotes] = (0, react_1.useState)(props?.notes);
    const [location, setLocation] = (0, react_1.useState)(props?.location);
    const [startDate, setStartDate] = (0, react_1.useState)(props?.startDate);
    const [endDate, setEndDate] = (0, react_1.useState)(props?.endDate);
    const setParentTitle = props?.setParentTitle;
    const setParentNotes = props?.setParentNotes;
    const setParentLocation = props?.setParentLocation;
    const setParentStartDate = props?.setParentStartDate;
    const setParentEndDate = props?.setParentEndDate;
    console.log(props?.title, ' props?.title inside EditEventBaseStep');
    console.log(props?.startDate, ' props?.startDate inside editeventbasestep');
    console.log(props?.endDate, ' props?.endDate inside editeventbasestep');
    (0, react_1.useEffect)(() => {
        if (props?.title) {
            setTitle(props?.title);
        }
        if (props?.notes) {
            setNotes(props?.notes);
        }
        if (props?.location) {
            setLocation(props?.location);
        }
        if (props?.startDate) {
            setStartDate(props?.startDate);
        }
        if (props?.endDate) {
            setEndDate(props?.endDate);
        }
    }, [props?.title, props?.notes, props?.location, props?.startDate, props?.endDate]);
    const changeTitle = (value) => {
        setTitle(value);
        setParentTitle(value);
    };
    const changeNotes = (value) => {
        setNotes(value);
        setParentNotes(value);
    };
    const changeLocation = (value) => {
        setLocation(value);
        setParentLocation(value);
    };
    const changeStartDate = (value) => {
        setStartDate(value);
        setParentStartDate(value);
    };
    const changeEndDate = (value) => {
        setEndDate(value);
        setParentEndDate(value);
    };
    return ((0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, justifyContent: "center", alignItems: "center", style: { width: '100%', height: '100%' }, minHeight: "70vh", children: [(0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, m: { phone: 's', tablet: 'm' }, style: { width: '60%' }, children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Start" }), (0, jsx_runtime_1.jsx)(react_2.Input, { placeholder: "Select Date and Time", size: "md", type: "datetime-local", onChange: (e) => {
                            const durationMinutes = date_utils_1.dayjs.duration((0, date_utils_1.dayjs)(endDate).diff((0, date_utils_1.dayjs)(startDate))).asMinutes();
                            const newEndDate = (0, date_utils_1.dayjs)(e?.target?.value, "YYYY-MM-DDTHH:mm").add(durationMinutes, 'minutes').toDate();
                            changeStartDate((0, date_utils_1.dayjs)(e?.target?.value, "YYYY-MM-DDTHH:mm").toDate());
                            changeEndDate(newEndDate);
                        }, value: (0, date_utils_1.dayjs)(startDate).format("YYYY-MM-DDTHH:mm") })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, m: { phone: 's', tablet: 'm' }, style: { width: '60%' }, children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "End" }), (0, jsx_runtime_1.jsx)(react_2.Input, { placeholder: "Select Date and Time", size: "md", type: "datetime-local", onChange: (e) => {
                            changeEndDate((0, date_utils_1.dayjs)(e?.target?.value, "YYYY-MM-DDTHH:mm").toDate());
                        }, value: (0, date_utils_1.dayjs)(endDate).format("YYYY-MM-DDTHH:mm") })] }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, m: { phone: 's', tablet: 'm' }, flexDirection: "row", justifyContent: "flex-start", alignItems: "center", style: { width: '60%' }, children: (0, jsx_runtime_1.jsx)(Box_1.default, { children: (0, jsx_runtime_1.jsx)(TextField_1.default, { label: "Title", placeholder: "title", onChange: (e) => changeTitle(e?.target?.value), value: title || props?.title, style: { width: '100%' } }) }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, m: { phone: 's', tablet: 'm' }, flexDirection: "row", justifyContent: "flex-start", alignItems: "center", style: { width: '60%' }, children: (0, jsx_runtime_1.jsx)(TextField_1.default, { label: "Notes", onChange: (e) => changeNotes(e?.target?.value), value: notes || props?.notes, style: { width: '100%' }, multiline: true }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, m: { phone: 's', tablet: 'm' }, flexDirection: "row", justifyContent: "flex-start", alignItems: "center", style: { width: '60%' }, children: (0, jsx_runtime_1.jsx)(TextField_1.default, { label: "Location", placeholder: "location if any", onChange: (e) => changeLocation(e?.target?.value), value: location || props?.location, style: { width: '100%' } }) })] }));
}
exports.default = EditEventBaseStep;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWRpdEV2ZW50QmFzZVN0ZXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJFZGl0RXZlbnRCYXNlU3RlcC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFtQkEsZ0RBcUNDOztBQXhERCxpQ0FLYztBQUNkLG9EQUFvRDtBQUNwRCx3RUFBd0U7QUFDeEUsZ0RBQXVDO0FBRXZDLGlFQUF3QztBQUN4QyxtRUFBMEM7QUFDMUMsc0VBQTZDO0FBQzdDLDRDQUF3QztBQUV4Qyx3RUFBOEM7QUFDOUMsaUVBQTZEO0FBQzdELDhFQUFxRDtBQUU5QyxLQUFLLFVBQVUsa0JBQWtCLENBQUMsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFpRDtJQUNsRywwRkFBMEY7SUFDMUYsc0NBQXNDO0lBQ3RDLHlFQUF5RTtJQUN6RSwwQkFBZSxDQUFDLElBQUksQ0FBQyxJQUFBLDZCQUFhLEdBQUUsQ0FBQyxDQUFBO0lBQ3JDLElBQUksT0FBTyxDQUFBO0lBQ1gsSUFBSSxDQUFDO1FBQ0gsT0FBTyxHQUFHLE1BQU0saUJBQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRTtZQUMzQyw2QkFBNkIsRUFBRSxLQUFLO2dCQUNsQyxPQUFPLEVBQUUsQ0FBQTtZQUNYLENBQUM7U0FDRixDQUFDLENBQUE7SUFDSixDQUFDO0lBQUMsT0FBTyxHQUFRLEVBQUUsQ0FBQztRQUNsQixJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssaUJBQU8sQ0FBQyxLQUFLLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUNqRCxPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsZUFBZSxFQUFFLGVBQWUsRUFBRSxFQUFFLENBQUE7UUFDeEQsQ0FBQzthQUFNLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxpQkFBTyxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUNuRCxrRUFBa0U7WUFDbEUscUVBQXFFO1lBQ3JFLE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxlQUFlLEVBQUUs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QVcsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLEtBQUssQ0FBQyxFQUM3RSxLQUFLLEVBQUUsS0FBSyxJQUFJLEtBQUssRUFBRSxLQUFLLEVBQzVCLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUMsRUFDdkIsU0FBUyxTQUNULEdBQ0UsRUFDTix1QkFBQyxhQUFHLElBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsRUFBRSxhQUFhLEVBQUMsS0FBSyxFQUFDLGNBQWMsRUFBQyxZQUFZLEVBQUMsVUFBVSxFQUFDLFFBQVEsRUFBQyxLQUFLLEVBQUUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFDLFlBQ3RJLHVCQUFDLG1CQUFTLElBQ1IsS0FBSyxFQUFDLFVBQVUsRUFDaEIsV0FBVyxFQUFDLGlCQUFpQixFQUM3QixRQUFRLEVBQUUsQ0FBQyxDQUFnQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxLQUFLLENBQUMsRUFDaEYsS0FBSyxFQUFFLFFBQVEsSUFBSSxLQUFLLEVBQUUsUUFBUSxFQUNsQyxLQUFLLEVBQUUsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFDLEdBQ3ZCLEdBQ0UsSUFDRixDQUNULENBQUE7QUFDSCxDQUFDO0FBRUQsa0JBQWUsaUJBQWlCLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtcbiAgdXNlU3RhdGUsXG4gIERpc3BhdGNoLFxuICBTZXRTdGF0ZUFjdGlvbixcbiAgdXNlRWZmZWN0LFxufSBmcm9tICdyZWFjdCdcbi8vIGltcG9ydCBEYXRlUGlja2VyIGZyb20gJ3JlYWN0LW5hdGl2ZS1kYXRlLXBpY2tlcidcbi8vIGltcG9ydCBEYXRlVGltZVBpY2tlciBmcm9tICdyZWFjdC1kYXRldGltZS1waWNrZXIvZGlzdC9lbnRyeS5ub3N0eWxlJ1xuaW1wb3J0IHsgZGF5anMgfSBmcm9tICdAbGliL2RhdGUtdXRpbHMnXG5cbmltcG9ydCBCb3ggZnJvbSAnQGNvbXBvbmVudHMvY29tbW9uL0JveCdcbmltcG9ydCBUZXh0IGZyb20gJ0Bjb21wb25lbnRzL2NvbW1vbi9UZXh0J1xuaW1wb3J0IFRleHRGaWVsZCBmcm9tICdAY29tcG9uZW50cy9UZXh0RmllbGQnXG5pbXBvcnQgeyBJbnB1dCB9IGZyb20gJ0BjaGFrcmEtdWkvcmVhY3QnXG5pbXBvcnQgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSAnbmV4dCc7XG5pbXBvcnQgc3VwZXJ0b2tlbnNOb2RlIGZyb20gJ3N1cGVydG9rZW5zLW5vZGUnXG5pbXBvcnQgeyBiYWNrZW5kQ29uZmlnIH0gZnJvbSAnLi4vLi4vLi4vY29uZmlnL2JhY2tlbmRDb25maWcnXG5pbXBvcnQgU2Vzc2lvbiBmcm9tICdzdXBlcnRva2Vucy1ub2RlL3JlY2lwZS9zZXNzaW9uJ1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U2VydmVyU2lkZVByb3BzKHsgcmVxLCByZXMgfTogeyByZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSB9KSB7XG4gIC8vIE5vdGljZSBob3cgdGhlIHNlcnZlciB1c2VzIGBBUElgIGZyb20gYHdpdGhTU1JDb250ZXh0YCwgaW5zdGVhZCBvZiB0aGUgdG9wLWxldmVsIGBBUElgLlxuICAvLyBjb25zdCBTU1IgPSB3aXRoU1NSQ29udGV4dCh7IHJlcSB9KVxuICAvLyB0aGlzIHJ1bnMgb24gdGhlIGJhY2tlbmQsIHNvIHdlIG11c3QgY2FsbCBpbml0IG9uIHN1cGVydG9rZW5zLW5vZGUgU0RLXG4gIHN1cGVydG9rZW5zTm9kZS5pbml0KGJhY2tlbmRDb25maWcoKSlcbiAgbGV0IHNlc3Npb25cbiAgdHJ5IHtcbiAgICBzZXNzaW9uID0gYXdhaXQgU2Vzc2lvbi5nZXRTZXNzaW9uKHJlcSwgcmVzLCB7XG4gICAgICBvdmVycmlkZUdsb2JhbENsYWltVmFsaWRhdG9yczogYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gW11cbiAgICAgIH0sXG4gICAgfSlcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICBpZiAoZXJyLnR5cGUgPT09IFNlc3Npb24uRXJyb3IuVFJZX1JFRlJFU0hfVE9LRU4pIHtcbiAgICAgIHJldHVybiB7IHByb3BzOiB7IGZyb21TdXBlcnRva2VuczogJ25lZWRzLXJlZnJlc2gnIH0gfVxuICAgIH0gZWxzZSBpZiAoZXJyLnR5cGUgPT09IFNlc3Npb24uRXJyb3IuVU5BVVRIT1JJU0VEKSB7XG4gICAgICAvLyB0aGlzIHdpbGwgZm9yY2UgdGhlIGZyb250ZW5kIHRvIHRyeSBhbmQgcmVmcmVzaCB3aGljaCB3aWxsIGZhaWxcbiAgICAgIC8vIGNsZWFyaW5nIGFsbCBjb29raWVzIGFuZCByZWRpcmVjdGluZyB0aGUgdXNlciB0byB0aGUgbG9naW4gc2NyZWVuLlxuICAgICAgcmV0dXJuIHsgcHJvcHM6IHsgZnJvbVN1cGVydG9rZW5zOiAnbmVlZHMtcmVmcmVzaCcgfSB9XG4gICAgfVxuICAgIHRocm93IGVyclxuICB9XG5cbiAgaWYgKCFzZXNzaW9uPy5nZXRVc2VySWQoKSkge1xuICAgIHJldHVybiB7XG4gICAgICByZWRpcmVjdDoge1xuICAgICAgICBkZXN0aW5hdGlvbjogJy9Vc2VyL0xvZ2luL1VzZXJMb2dpbicsXG4gICAgICAgIHBlcm1hbmVudDogZmFsc2UsXG4gICAgICB9LFxuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgcHJvcHM6IHtcbiAgICAgIHN1Yjogc2Vzc2lvbi5nZXRVc2VySWQoKSxcbiAgICB9XG4gIH1cbn1cblxudHlwZSBQcm9wcyA9IHtcbiAgdGl0bGU6IHN0cmluZyxcbiAgbm90ZXM6IHN0cmluZyxcbiAgbG9jYXRpb246IHN0cmluZyxcbiAgc3RhcnREYXRlOiBEYXRlLFxuICBlbmREYXRlOiBEYXRlLFxuICBzZXRQYXJlbnRUaXRsZTogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248c3RyaW5nPj4sXG4gIHNldFBhcmVudE5vdGVzOiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxzdHJpbmc+PixcbiAgc2V0UGFyZW50TG9jYXRpb246IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPHN0cmluZz4+LFxuICBzZXRQYXJlbnRTdGFydERhdGU6IERpc3BhdGNoPFNldFN0YXRlQWN0aW9uPERhdGU+PixcbiAgc2V0UGFyZW50RW5kRGF0ZTogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248RGF0ZT4+LFxufVxuXG5cbmZ1bmN0aW9uIEVkaXRFdmVudEJhc2VTdGVwKHByb3BzOiBQcm9wcykge1xuICBjb25zdCBbdGl0bGUsIHNldFRpdGxlXSA9IHVzZVN0YXRlPHN0cmluZz4ocHJvcHM/LnRpdGxlKVxuICBjb25zdCBbbm90ZXMsIHNldE5vdGVzXSA9IHVzZVN0YXRlPHN0cmluZz4ocHJvcHM/Lm5vdGVzKVxuICBjb25zdCBbbG9jYXRpb24sIHNldExvY2F0aW9uXSA9IHVzZVN0YXRlPHN0cmluZz4ocHJvcHM/LmxvY2F0aW9uKVxuICBjb25zdCBbc3RhcnREYXRlLCBzZXRTdGFydERhdGVdID0gdXNlU3RhdGU8RGF0ZT4ocHJvcHM/LnN0YXJ0RGF0ZSlcbiAgY29uc3QgW2VuZERhdGUsIHNldEVuZERhdGVdID0gdXNlU3RhdGU8RGF0ZT4ocHJvcHM/LmVuZERhdGUpXG5cbiAgY29uc3Qgc2V0UGFyZW50VGl0bGUgPSBwcm9wcz8uc2V0UGFyZW50VGl0bGVcbiAgY29uc3Qgc2V0UGFyZW50Tm90ZXMgPSBwcm9wcz8uc2V0UGFyZW50Tm90ZXNcbiAgY29uc3Qgc2V0UGFyZW50TG9jYXRpb24gPSBwcm9wcz8uc2V0UGFyZW50TG9jYXRpb25cbiAgY29uc3Qgc2V0UGFyZW50U3RhcnREYXRlID0gcHJvcHM/LnNldFBhcmVudFN0YXJ0RGF0ZVxuICBjb25zdCBzZXRQYXJlbnRFbmREYXRlID0gcHJvcHM/LnNldFBhcmVudEVuZERhdGVcbiAgY29uc29sZS5sb2cocHJvcHM/LnRpdGxlLCAnIHByb3BzPy50aXRsZSBpbnNpZGUgRWRpdEV2ZW50QmFzZVN0ZXAnKVxuICBjb25zb2xlLmxvZyhwcm9wcz8uc3RhcnREYXRlLCAnIHByb3BzPy5zdGFydERhdGUgaW5zaWRlIGVkaXRldmVudGJhc2VzdGVwJylcbiAgY29uc29sZS5sb2cocHJvcHM/LmVuZERhdGUsICcgcHJvcHM/LmVuZERhdGUgaW5zaWRlIGVkaXRldmVudGJhc2VzdGVwJylcblxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHByb3BzPy50aXRsZSkge1xuICAgICAgc2V0VGl0bGUocHJvcHM/LnRpdGxlKVxuICAgIH1cblxuICAgIGlmIChwcm9wcz8ubm90ZXMpIHtcbiAgICAgIHNldE5vdGVzKHByb3BzPy5ub3RlcylcbiAgICB9XG5cbiAgICBpZiAocHJvcHM/LmxvY2F0aW9uKSB7XG4gICAgICBzZXRMb2NhdGlvbihwcm9wcz8ubG9jYXRpb24pXG4gICAgfVxuXG4gICAgaWYgKHByb3BzPy5zdGFydERhdGUpIHtcbiAgICAgIHNldFN0YXJ0RGF0ZShwcm9wcz8uc3RhcnREYXRlKVxuICAgIH1cblxuICAgIGlmIChwcm9wcz8uZW5kRGF0ZSkge1xuICAgICAgc2V0RW5kRGF0ZShwcm9wcz8uZW5kRGF0ZSlcbiAgICB9XG5cbiAgfSwgW3Byb3BzPy50aXRsZSwgcHJvcHM/Lm5vdGVzLCBwcm9wcz8ubG9jYXRpb24sIHByb3BzPy5zdGFydERhdGUsIHByb3BzPy5lbmREYXRlXSlcblxuXG4gIGNvbnN0IGNoYW5nZVRpdGxlID0gKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICBzZXRUaXRsZSh2YWx1ZSlcbiAgICBzZXRQYXJlbnRUaXRsZSh2YWx1ZSlcbiAgfVxuXG4gIGNvbnN0IGNoYW5nZU5vdGVzID0gKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICBzZXROb3Rlcyh2YWx1ZSlcbiAgICBzZXRQYXJlbnROb3Rlcyh2YWx1ZSlcbiAgfVxuXG4gIGNvbnN0IGNoYW5nZUxvY2F0aW9uID0gKHZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICBzZXRMb2NhdGlvbih2YWx1ZSlcbiAgICBzZXRQYXJlbnRMb2NhdGlvbih2YWx1ZSlcbiAgfVxuXG4gIGNvbnN0IGNoYW5nZVN0YXJ0RGF0ZSA9ICh2YWx1ZTogRGF0ZSkgPT4ge1xuICAgIHNldFN0YXJ0RGF0ZSh2YWx1ZSlcbiAgICBzZXRQYXJlbnRTdGFydERhdGUodmFsdWUpXG4gIH1cblxuICBjb25zdCBjaGFuZ2VFbmREYXRlID0gKHZhbHVlOiBEYXRlKSA9PiB7XG4gICAgc2V0RW5kRGF0ZSh2YWx1ZSlcbiAgICBzZXRQYXJlbnRFbmREYXRlKHZhbHVlKVxuICB9XG5cblxuXG5cblxuICByZXR1cm4gKFxuXG4gICAgICA8Qm94IGZsZXg9ezF9ICBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBzdHlsZT17eyB3aWR0aDogJzEwMCUnLCBoZWlnaHQ6ICcxMDAlJyB9fSBtaW5IZWlnaHQ9XCI3MHZoXCI+XG4gICAgICAgIDxCb3ggZmxleD17MX0gIG09e3sgcGhvbmU6ICdzJywgdGFibGV0OiAnbScgfX0gc3R5bGU9e3sgd2lkdGg6ICc2MCUnfX0+XG4gICAgICAgICAgICA8VGV4dCB2YXJpYW50PVwib3B0aW9uSGVhZGVyXCI+XG4gICAgICAgICAgICAgIFN0YXJ0XG4gICAgICAgICAgICA8L1RleHQ+XG5cbiAgICAgICAgPElucHV0XG4gICAgICAgICAgICBwbGFjZWhvbGRlcj1cIlNlbGVjdCBEYXRlIGFuZCBUaW1lXCJcbiAgICAgICAgICAgIHNpemU9XCJtZFwiXG4gICAgICAgICAgICB0eXBlPVwiZGF0ZXRpbWUtbG9jYWxcIlxuICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uTWludXRlcyA9IGRheWpzLmR1cmF0aW9uKGRheWpzKGVuZERhdGUpLmRpZmYoZGF5anMoc3RhcnREYXRlKSkpLmFzTWludXRlcygpXG4gICAgICAgICAgICAgIGNvbnN0IG5ld0VuZERhdGUgPSBkYXlqcyhlPy50YXJnZXQ/LnZhbHVlLCBcIllZWVktTU0tRERUSEg6bW1cIikuYWRkKGR1cmF0aW9uTWludXRlcywgJ21pbnV0ZXMnKS50b0RhdGUoKVxuICAgICAgICAgICAgICBjaGFuZ2VTdGFydERhdGUoZGF5anMoZT8udGFyZ2V0Py52YWx1ZSwgXCJZWVlZLU1NLUREVEhIOm1tXCIpLnRvRGF0ZSgpKVxuICAgICAgICAgICAgICBjaGFuZ2VFbmREYXRlKG5ld0VuZERhdGUpXG4gICAgICAgICAgICB9fVxuICAgICAgICAgICAgdmFsdWU9e2RheWpzKHN0YXJ0RGF0ZSkuZm9ybWF0KFwiWVlZWS1NTS1ERFRISDptbVwiKX1cbiAgICAgICAgICAvPlxuICAgICAgICA8L0JveD5cbiAgICAgICAgPEJveCBmbGV4PXsxfSAgbT17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fSBzdHlsZT17eyB3aWR0aDogJzYwJSd9fT5cbiAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJvcHRpb25IZWFkZXJcIj5cbiAgICAgICAgICAgICAgRW5kXG4gICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgPElucHV0XG4gICAgICAgICAgICBwbGFjZWhvbGRlcj1cIlNlbGVjdCBEYXRlIGFuZCBUaW1lXCJcbiAgICAgICAgICAgIHNpemU9XCJtZFwiXG4gICAgICAgICAgICB0eXBlPVwiZGF0ZXRpbWUtbG9jYWxcIlxuICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiB7XG4gICAgICAgICAgICAgIGNoYW5nZUVuZERhdGUoZGF5anMoZT8udGFyZ2V0Py52YWx1ZSwgXCJZWVlZLU1NLUREVEhIOm1tXCIpLnRvRGF0ZSgpKVxuICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIHZhbHVlPXtkYXlqcyhlbmREYXRlKS5mb3JtYXQoXCJZWVlZLU1NLUREVEhIOm1tXCIpfVxuICAgICAgICAgIC8+XG4gICAgICAgIDwvQm94PlxuICAgICAgICA8Qm94IGZsZXg9ezF9IG09e3sgcGhvbmU6ICdzJywgdGFibGV0OiAnbScgfX0gZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1zdGFydFwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBzdHlsZT17eyB3aWR0aDogJzYwJSd9fT5cbiAgICAgICAgICA8Qm94PlxuICAgICAgICAgICAgPFRleHRGaWVsZFxuICAgICAgICAgICAgICBsYWJlbD1cIlRpdGxlXCJcbiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJ0aXRsZVwiXG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZTogeyB0YXJnZXQ6IHsgdmFsdWU6IHN0cmluZyB9IH0pID0+IGNoYW5nZVRpdGxlKGU/LnRhcmdldD8udmFsdWUpfVxuICAgICAgICAgICAgICB2YWx1ZT17dGl0bGUgfHwgcHJvcHM/LnRpdGxlfVxuICAgICAgICAgICAgICBzdHlsZT17eyB3aWR0aDogJzEwMCUnfX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9Cb3g+XG4gICAgICAgIDwvQm94PlxuICAgICAgICA8Qm94IGZsZXg9ezF9IG09e3sgcGhvbmU6ICdzJywgdGFibGV0OiAnbScgfX0gZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1zdGFydFwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIiBzdHlsZT17eyB3aWR0aDogJzYwJSd9fT5cbiAgICAgICAgICA8VGV4dEZpZWxkXG4gICAgICAgICAgICBsYWJlbD1cIk5vdGVzXCJcbiAgICAgICAgICAgIG9uQ2hhbmdlPXsoZTogeyB0YXJnZXQ6IHsgdmFsdWU6IHN0cmluZyB9IH0pID0+IGNoYW5nZU5vdGVzKGU/LnRhcmdldD8udmFsdWUpfVxuICAgICAgICAgICAgdmFsdWU9e25vdGVzIHx8IHByb3BzPy5ub3Rlc31cbiAgICAgICAgICAgIHN0eWxlPXt7IHdpZHRoOiAnMTAwJSd9fVxuICAgICAgICAgICAgbXVsdGlsaW5lXG4gICAgICAgICAgLz5cbiAgICAgICAgPC9Cb3g+XG4gICAgICAgIDxCb3ggZmxleD17MX0gbT17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fSBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LXN0YXJ0XCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnNjAlJ319PlxuICAgICAgICAgIDxUZXh0RmllbGRcbiAgICAgICAgICAgIGxhYmVsPVwiTG9jYXRpb25cIlxuICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJsb2NhdGlvbiBpZiBhbnlcIlxuICAgICAgICAgICAgb25DaGFuZ2U9eyhlOiB7IHRhcmdldDogeyB2YWx1ZTogc3RyaW5nIH0gfSkgPT4gY2hhbmdlTG9jYXRpb24oZT8udGFyZ2V0Py52YWx1ZSl9XG4gICAgICAgICAgICB2YWx1ZT17bG9jYXRpb24gfHwgcHJvcHM/LmxvY2F0aW9ufVxuICAgICAgICAgICAgc3R5bGU9e3sgd2lkdGg6ICcxMDAlJ319XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9Cb3g+ICBcbiAgICAgIDwvQm94PlxuICApXG59XG5cbmV4cG9ydCBkZWZhdWx0IEVkaXRFdmVudEJhc2VTdGVwXG4iXX0=