"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const react_native_1 = require("react-native");
const io_1 = require("react-icons/io");
const picker_1 = require("@react-native-picker/picker");
const react_2 = require("@chakra-ui/react");
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const Button_1 = __importDefault(require("@components/Button"));
const theme_1 = require("@lib/theme/theme");
const lodash_1 = __importDefault(require("lodash"));
const CategoryHelper_1 = require("@lib/Category/CategoryHelper");
const getEventById_1 = __importDefault(require("@lib/apollo/gql/getEventById"));
const updateEventForUserModifiedCategories_1 = __importDefault(require("@lib/apollo/gql/updateEventForUserModifiedCategories"));
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("../../config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
function UserEditCategoryEventModal(props) {
    const [selectedTag, setSelectedTag] = (0, react_1.useState)(null);
    const [eventTags, setEventTags] = (0, react_1.useState)([]);
    const [categories, setCategories] = (0, react_1.useState)([]);
    const [selectedTagId, setSelectedTagId] = (0, react_1.useState)('');
    // const dark = useColorScheme() === 'dark'
    const client = props?.client;
    const eventId = props?.eventId;
    const toast = (0, react_2.useToast)();
    // get categories
    (0, react_1.useEffect)(() => {
        (async () => {
            try {
                const userCategories = await (0, CategoryHelper_1.listUserCategories)(client, props?.sub);
                setCategories(userCategories);
                setSelectedTag(userCategories?.[0]);
                setSelectedTagId(userCategories?.[0]?.id);
            }
            catch (e) {
                console.log(e, ' error in useEffect for UserEditcategory_event');
            }
        })();
    }, [client, props?.sub]);
    // get event categories
    (0, react_1.useEffect)(() => {
        (async () => {
            try {
                const existingCategories = await (0, CategoryHelper_1.listCategoriesForEvent)(client, eventId);
                console.log(existingCategories, ' existingCategories in useEffect for UserEditcategory_event');
                setEventTags(existingCategories);
            }
            catch (e) {
                console.log(e, 'error for get categories');
            }
        })();
    }, [client, eventId]);
    const addItemToTags = async () => {
        try {
            if (!selectedTag?.id) {
                toast({
                    status: 'error',
                    title: 'Select a tag',
                    description: 'Please select a tag',
                    duration: 9000,
                    isClosable: true,
                });
                return null;
            }
            const newCategories = lodash_1.default.uniqWith(eventTags?.concat([selectedTag]), lodash_1.default.isEqual);
            setEventTags(newCategories);
            const foundIndex = eventTags?.findIndex((cat) => cat?.id === selectedTag?.id);
            if (foundIndex === -1) {
                await (0, CategoryHelper_1.upsertCategoryEventConnection)(client, props.sub, selectedTag.id, eventId);
                // update Event
                const existingEvent = (await client.query({
                    query: getEventById_1.default,
                    variables: {
                        id: eventId,
                    },
                })).data?.Event_by_pk;
                if (existingEvent?.id) {
                    await client.mutate({
                        mutation: updateEventForUserModifiedCategories_1.default,
                        variables: {
                            id: existingEvent.id,
                        },
                    });
                }
            }
        }
        catch (e) {
            console.log(e, 'error in addItemToTags');
        }
    };
    const removeItemFromTags = async (categoryId) => {
        try {
            const newCategories = eventTags.filter((cat) => cat.id !== categoryId);
            setEventTags(newCategories);
            await (0, CategoryHelper_1.removeCategoryConnectionForEvent)(client, categoryId, eventId);
            // update Event
            const existingEvent = (await client.query({
                query: getEventById_1.default,
                variables: {
                    id: eventId,
                },
            })).data?.Event_by_pk;
            if (existingEvent?.id) {
                await client.mutate({
                    mutation: updateEventForUserModifiedCategories_1.default,
                    variables: {
                        id: existingEvent.id,
                    },
                });
            }
        }
        catch (e) {
            console.log(e, 'error in removeItemFromTags');
        }
    };
    const changeSelectedTag = (id) => {
        const foundCategory = categories.find((cat) => (cat.id === id));
        if (foundCategory) {
            setSelectedTag(foundCategory);
            setSelectedTagId(id);
        }
    };
    return ((0, jsx_runtime_1.jsxs)(Box_1.default, { width: "100%", children: [(0, jsx_runtime_1.jsx)(Box_1.default, { p: { phone: 'm', tablet: 'l' }, justifyContent: "center", alignItems: "center", children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Manage tags to this event" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, justifyContent: "center", alignItems: "center", width: "100%", children: (0, jsx_runtime_1.jsx)(react_native_1.FlatList, { data: eventTags, renderItem: ({ item }) => ((0, jsx_runtime_1.jsx)(Box_1.default, { justifyContent: "center", alignItems: "center", children: (0, jsx_runtime_1.jsxs)(Box_1.default, { flexDirection: "row", alignItems: "center", justifyContent: "space-between", style: { width: '60%' }, children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: item.name }), (0, jsx_runtime_1.jsx)(react_native_1.Pressable, { hitSlop: 15, onPress: () => removeItemFromTags(item?.id), children: (0, jsx_runtime_1.jsx)(io_1.IoIosClose, { size: "3em", color: theme_1.palette.red }) })] }) })), keyExtractor: (item) => item.id }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 3, justifyContent: "center", alignItems: "center", children: (0, jsx_runtime_1.jsx)(picker_1.Picker, { selectedValue: selectedTagId, onValueChange: changeSelectedTag, children: categories.map((category) => ((0, jsx_runtime_1.jsx)(picker_1.Picker.Item, { color: theme_1.palette.textBlack, value: category?.id, label: category?.name }, category?.id))) }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { pt: { phone: 'm', tablet: 's' }, justifyContent: "center", alignItems: "center", children: (0, jsx_runtime_1.jsx)(Button_1.default, { onClick: addItemToTags, children: "Add" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { pt: { phone: 'm', tablet: 's' }, justifyContent: "center", alignItems: "center", children: (0, jsx_runtime_1.jsx)(Button_1.default, { onClick: props.hideTags, children: "Done" }) })] }));
}
exports.default = UserEditCategoryEventModal;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlckVkaXRDYXRlZ29yeUV2ZW50TW9kYWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJVc2VyRWRpdENhdGVnb3J5RXZlbnRNb2RhbC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFvQ0EsZ0RBcUNDOztBQXpFRCxpQ0FHYztBQUNkLCtDQUlxQjtBQUVyQix1Q0FBMkM7QUFDM0Msd0RBQW9EO0FBQ3BELDRDQUEyQztBQUUzQyxpRUFBd0M7QUFDeEMsbUVBQTBDO0FBQzFDLGdFQUF1QztBQUd2Qyw0Q0FBMEM7QUFNMUMsb0RBQXNCO0FBRXRCLGlFQUEwSjtBQUMxSixnRkFBdUQ7QUFDdkQsZ0lBQXVHO0FBR3ZHLHdFQUE4QztBQUM5Qyw4REFBMEQ7QUFDMUQsOEVBQXFEO0FBRTlDLEtBQUssVUFBVSxrQkFBa0IsQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQWlEO0lBQ2xHLDBGQUEwRjtJQUMxRixzQ0FBc0M7SUFDdEMseUVBQXlFO0lBQ3pFLDBCQUFlLENBQUMsSUFBSSxDQUFDLElBQUEsNkJBQWEsR0FBRSxDQUFDLENBQUE7SUFDckMsSUFBSSxPQUFPLENBQUE7SUFDWCxJQUFJLENBQUM7UUFDSCxPQUFPLEdBQUcsTUFBTSxpQkFBTyxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFO1lBQzNDLDZCQUE2QixFQUFFLEtBQUs7Z0JBQ2xDLE9BQU8sRUFBRSxDQUFBO1lBQ1gsQ0FBQztTQUNGLENBQUMsQ0FBQTtJQUNKLENBQUM7SUFBQyxPQUFPLEdBQVEsRUFBRSxDQUFDO1FBQ2xCLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxpQkFBTyxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ2pELE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLEVBQUUsQ0FBQTtRQUN4RCxDQUFDO2FBQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLGlCQUFPLENBQUMsS0FBSyxDQUFD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T0FBTyxFQUFFLEtBQUssQ0FBQyxRQUFRLHFCQUV0QixHQUNILElBQ0osQ0FDVCxDQUFBO0FBQ0wsQ0FBQztBQUVELGtCQUFlLDBCQUEwQixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7XG4gICAgdXNlU3RhdGUsXG4gICAgdXNlRWZmZWN0LFxufSBmcm9tICdyZWFjdCdcbmltcG9ydCB7XG4gICBGbGF0TGlzdCxcbiAgIFByZXNzYWJsZSxcbiAgIHVzZUNvbG9yU2NoZW1lLFxufSBmcm9tICdyZWFjdC1uYXRpdmUnXG5cbmltcG9ydCB7IElvSW9zQ2xvc2UgfSBmcm9tIFwicmVhY3QtaWNvbnMvaW9cIlxuaW1wb3J0IHsgUGlja2VyIH0gZnJvbSAnQHJlYWN0LW5hdGl2ZS1waWNrZXIvcGlja2VyJ1xuaW1wb3J0IHsgdXNlVG9hc3QgfSBmcm9tICdAY2hha3JhLXVpL3JlYWN0J1xuXG5pbXBvcnQgQm94IGZyb20gJ0Bjb21wb25lbnRzL2NvbW1vbi9Cb3gnXG5pbXBvcnQgVGV4dCBmcm9tICdAY29tcG9uZW50cy9jb21tb24vVGV4dCdcbmltcG9ydCBCdXR0b24gZnJvbSAnQGNvbXBvbmVudHMvQnV0dG9uJ1xuXG5cbmltcG9ydCB7IHBhbGV0dGUgfSBmcm9tICdAbGliL3RoZW1lL3RoZW1lJ1xuaW1wb3J0IHtcbiAgQ2F0ZWdvcnlUeXBlXG59IGZyb20gJ0BsaWIvZGF0YVR5cGVzL0NhdGVnb3J5VHlwZSdcblxuXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnXG5pbXBvcnQgeyBBcG9sbG9DbGllbnQsIE5vcm1hbGl6ZWRDYWNoZU9iamVjdCB9IGZyb20gJ0BhcG9sbG8vY2xpZW50J1xuaW1wb3J0IHsgbGlzdENhdGVnb3JpZXNGb3JFdmVudCwgbGlzdFVzZXJDYXRlZ29yaWVzLCByZW1vdmVDYXRlZ29yeUNvbm5lY3Rpb25Gb3JFdmVudCwgdXBzZXJ0Q2F0ZWdvcnlFdmVudENvbm5lY3Rpb24gfSBmcm9tICdAbGliL0NhdGVnb3J5L0NhdGVnb3J5SGVscGVyJ1xuaW1wb3J0IGdldEV2ZW50QnlJZCBmcm9tICdAbGliL2Fwb2xsby9ncWwvZ2V0RXZlbnRCeUlkJ1xuaW1wb3J0IHVwZGF0ZUV2ZW50Rm9yVXNlck1vZGlmaWVkQ2F0ZWdvcmllcyBmcm9tICdAbGliL2Fwb2xsby9ncWwvdXBkYXRlRXZlbnRGb3JVc2VyTW9kaWZpZWRDYXRlZ29yaWVzJ1xuaW1wb3J0IHsgRXZlbnRUeXBlIH0gZnJvbSAnQGxpYi9kYXRhVHlwZXMvRXZlbnRUeXBlJ1xuaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xuaW1wb3J0IHN1cGVydG9rZW5zTm9kZSBmcm9tICdzdXBlcnRva2Vucy1ub2RlJ1xuaW1wb3J0IHsgYmFja2VuZENvbmZpZyB9IGZyb20gJy4uLy4uL2NvbmZpZy9iYWNrZW5kQ29uZmlnJ1xuaW1wb3J0IFNlc3Npb24gZnJvbSAnc3VwZXJ0b2tlbnMtbm9kZS9yZWNpcGUvc2Vzc2lvbidcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNlcnZlclNpZGVQcm9wcyh7IHJlcSwgcmVzIH06IHsgcmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UgfSkge1xuICAvLyBOb3RpY2UgaG93IHRoZSBzZXJ2ZXIgdXNlcyBgQVBJYCBmcm9tIGB3aXRoU1NSQ29udGV4dGAsIGluc3RlYWQgb2YgdGhlIHRvcC1sZXZlbCBgQVBJYC5cbiAgLy8gY29uc3QgU1NSID0gd2l0aFNTUkNvbnRleHQoeyByZXEgfSlcbiAgLy8gdGhpcyBydW5zIG9uIHRoZSBiYWNrZW5kLCBzbyB3ZSBtdXN0IGNhbGwgaW5pdCBvbiBzdXBlcnRva2Vucy1ub2RlIFNES1xuICBzdXBlcnRva2Vuc05vZGUuaW5pdChiYWNrZW5kQ29uZmlnKCkpXG4gIGxldCBzZXNzaW9uXG4gIHRyeSB7XG4gICAgc2Vzc2lvbiA9IGF3YWl0IFNlc3Npb24uZ2V0U2Vzc2lvbihyZXEsIHJlcywge1xuICAgICAgb3ZlcnJpZGVHbG9iYWxDbGFpbVZhbGlkYXRvcnM6IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFtdXG4gICAgICB9LFxuICAgIH0pXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgaWYgKGVyci50eXBlID09PSBTZXNzaW9uLkVycm9yLlRSWV9SRUZSRVNIX1RPS0VOKSB7XG4gICAgICByZXR1cm4geyBwcm9wczogeyBmcm9tU3VwZXJ0b2tlbnM6ICduZWVkcy1yZWZyZXNoJyB9IH1cbiAgICB9IGVsc2UgaWYgKGVyci50eXBlID09PSBTZXNzaW9uLkVycm9yLlVOQVVUSE9SSVNFRCkge1xuICAgICAgLy8gdGhpcyB3aWxsIGZvcmNlIHRoZSBmcm9udGVuZCB0byB0cnkgYW5kIHJlZnJlc2ggd2hpY2ggd2lsbCBmYWlsXG4gICAgICAvLyBjbGVhcmluZyBhbGwgY29va2llcyBhbmQgcmVkaXJlY3RpbmcgdGhlIHVzZXIgdG8gdGhlIGxvZ2luIHNjcmVlbi5cbiAgICAgIHJldHVybiB7IHByb3BzOiB7IGZyb21TdXBlcnRva2VuczogJ25lZWRzLXJlZnJlc2gnIH0gfVxuICAgIH1cbiAgICB0aHJvdyBlcnJcbiAgfVxuXG4gIGlmICghc2Vzc2lvbj8uZ2V0VXNlcklkKCkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcmVkaXJlY3Q6IHtcbiAgICAgICAgZGVzdGluYXRpb246ICcvVXNlci9Mb2dpbi9Vc2VyTG9naW4nLFxuICAgICAgICBwZXJtYW5lbnQ6IGZhbHNlLFxuICAgICAgfSxcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHByb3BzOiB7XG4gICAgICBzdWI6IHNlc3Npb24uZ2V0VXNlcklkKCksXG4gICAgfVxuICB9XG59XG5cblxudHlwZSBQcm9wcyA9IHtcbiAgICBldmVudElkOiBzdHJpbmcsXG4gICAgc3ViOiBzdHJpbmcsXG4gICAgaGlkZVRhZ3M6ICgpID0+IHZvaWQsIC8vIFRPRE86IC8vICAgICBhZGQgZW5hYmxlIHRvIGVkaXRcbiAgICBjbGllbnQ6IEFwb2xsb0NsaWVudDxOb3JtYWxpemVkQ2FjaGVPYmplY3Q+LFxufVxuXG5mdW5jdGlvbiBVc2VyRWRpdENhdGVnb3J5RXZlbnRNb2RhbChwcm9wczogUHJvcHMpIHtcbiAgICBjb25zdCBbc2VsZWN0ZWRUYWcsIHNldFNlbGVjdGVkVGFnXSA9IHVzZVN0YXRlPENhdGVnb3J5VHlwZT4obnVsbClcbiAgICBjb25zdCBbZXZlbnRUYWdzLCBzZXRFdmVudFRhZ3NdID0gdXNlU3RhdGU8Q2F0ZWdvcnlUeXBlW10+KFtdKVxuICAgIGNvbnN0IFtjYXRlZ29yaWVzLCBzZXRDYXRlZ29yaWVzXSA9IHVzZVN0YXRlPENhdGVnb3J5VHlwZVtdPihbXSlcbiAgICBjb25zdCBbc2VsZWN0ZWRUYWdJZCwgc2V0U2VsZWN0ZWRUYWdJZF0gPSB1c2VTdGF0ZTxzdHJpbmc+KCcnKVxuXG4gICAgLy8gY29uc3QgZGFyayA9IHVzZUNvbG9yU2NoZW1lKCkgPT09ICdkYXJrJ1xuXG4gICAgY29uc3QgY2xpZW50ID0gcHJvcHM/LmNsaWVudFxuICAgIGNvbnN0IGV2ZW50SWQgPSBwcm9wcz8uZXZlbnRJZFxuICAgIGNvbnN0IHRvYXN0ID0gdXNlVG9hc3QoKVxuXG4gICAgLy8gZ2V0IGNhdGVnb3JpZXNcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICAoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCB1c2VyQ2F0ZWdvcmllcyA9IGF3YWl0IGxpc3RVc2VyQ2F0ZWdvcmllcyhjbGllbnQsIHByb3BzPy5zdWIpXG4gICAgICAgICAgICAgICAgc2V0Q2F0ZWdvcmllcyh1c2VyQ2F0ZWdvcmllcylcbiAgICAgICAgICAgICAgICBzZXRTZWxlY3RlZFRhZyh1c2VyQ2F0ZWdvcmllcz8uWzBdKVxuICAgICAgICAgICAgICAgIHNldFNlbGVjdGVkVGFnSWQodXNlckNhdGVnb3JpZXM/LlswXT8uaWQpXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSwgJyBlcnJvciBpbiB1c2VFZmZlY3QgZm9yIFVzZXJFZGl0Y2F0ZWdvcnlfZXZlbnQnKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KSgpXG4gICAgfSwgW2NsaWVudCwgcHJvcHM/LnN1Yl0pXG5cbiAgICAvLyBnZXQgZXZlbnQgY2F0ZWdvcmllc1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nQ2F0ZWdvcmllcyA9IGF3YWl0IGxpc3RDYXRlZ29yaWVzRm9yRXZlbnQoY2xpZW50LCBldmVudElkKVxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGV4aXN0aW5nQ2F0ZWdvcmllcywgJyBleGlzdGluZ0NhdGVnb3JpZXMgaW4gdXNlRWZmZWN0IGZvciBVc2VyRWRpdGNhdGVnb3J5X2V2ZW50JylcbiAgICAgICAgICAgICAgICBzZXRFdmVudFRhZ3MoZXhpc3RpbmdDYXRlZ29yaWVzKVxuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGUsICdlcnJvciBmb3IgZ2V0IGNhdGVnb3JpZXMnKVxuICAgICAgICAgICAgfVxuICAgICAgICB9KSgpXG4gICAgfSwgW2NsaWVudCwgZXZlbnRJZF0pXG5cbiAgICBjb25zdCBhZGRJdGVtVG9UYWdzID0gYXN5bmMgKCk6IFByb21pc2U8YW55PiA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoIXNlbGVjdGVkVGFnPy5pZCkge1xuICAgICAgICAgICAgICAgIHRvYXN0KHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ1NlbGVjdCBhIHRhZycsXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnUGxlYXNlIHNlbGVjdCBhIHRhZycsXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA5MDAwLFxuICAgICAgICAgICAgICAgICAgICBpc0Nsb3NhYmxlOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG5ld0NhdGVnb3JpZXMgPSBfLnVuaXFXaXRoKGV2ZW50VGFncz8uY29uY2F0KFtzZWxlY3RlZFRhZ10pLCBfLmlzRXF1YWwpXG4gICAgICAgICAgICBzZXRFdmVudFRhZ3MobmV3Q2F0ZWdvcmllcylcblxuICAgICAgICAgICAgY29uc3QgZm91bmRJbmRleCA9IGV2ZW50VGFncz8uZmluZEluZGV4KChjYXQpID0+IGNhdD8uaWQgPT09IHNlbGVjdGVkVGFnPy5pZClcbiAgICAgICAgICAgIGlmIChmb3VuZEluZGV4ID09PSAtMSkge1xuXG4gICAgICAgICAgICAgICAgYXdhaXQgdXBzZXJ0Q2F0ZWdvcnlFdmVudENvbm5lY3Rpb24oY2xpZW50LCBwcm9wcy5zdWIsIHNlbGVjdGVkVGFnLmlkLCBldmVudElkKVxuXG4gICAgICAgICAgICAgICAgLy8gdXBkYXRlIEV2ZW50XG4gICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdFdmVudCA9IChhd2FpdCBjbGllbnQucXVlcnk8eyBFdmVudF9ieV9wazogRXZlbnRUeXBlIH0+KHtcbiAgICAgICAgICAgICAgICAgICAgcXVlcnk6IGdldEV2ZW50QnlJZCxcbiAgICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogZXZlbnRJZCxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KSkuZGF0YT8uRXZlbnRfYnlfcGtcbiAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdFdmVudD8uaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgY2xpZW50Lm11dGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBtdXRhdGlvbjogdXBkYXRlRXZlbnRGb3JVc2VyTW9kaWZpZWRDYXRlZ29yaWVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGV4aXN0aW5nRXZlbnQuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZSwgJ2Vycm9yIGluIGFkZEl0ZW1Ub1RhZ3MnKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgcmVtb3ZlSXRlbUZyb21UYWdzID0gYXN5bmMgKGNhdGVnb3J5SWQ6IHN0cmluZykgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgbmV3Q2F0ZWdvcmllcyA9IGV2ZW50VGFncy5maWx0ZXIoKGNhdCkgPT4gY2F0LmlkICE9PSBjYXRlZ29yeUlkKVxuICAgICAgICAgICAgc2V0RXZlbnRUYWdzKG5ld0NhdGVnb3JpZXMpXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IHJlbW92ZUNhdGVnb3J5Q29ubmVjdGlvbkZvckV2ZW50KGNsaWVudCwgY2F0ZWdvcnlJZCwgZXZlbnRJZClcblxuICAgICAgICAgICAgLy8gdXBkYXRlIEV2ZW50XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0V2ZW50ID0gKGF3YWl0IGNsaWVudC5xdWVyeTx7IEV2ZW50X2J5X3BrOiBFdmVudFR5cGUgfT4oe1xuICAgICAgICAgICAgICAgIHF1ZXJ5OiBnZXRFdmVudEJ5SWQsXG4gICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7XG4gICAgICAgICAgICAgICAgICAgIGlkOiBldmVudElkLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KSkuZGF0YT8uRXZlbnRfYnlfcGtcbiAgICAgICAgICAgIGlmIChleGlzdGluZ0V2ZW50Py5pZCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IGNsaWVudC5tdXRhdGUoe1xuICAgICAgICAgICAgICAgICAgICBtdXRhdGlvbjogdXBkYXRlRXZlbnRGb3JVc2VyTW9kaWZpZWRDYXRlZ29yaWVzLFxuICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBleGlzdGluZ0V2ZW50LmlkLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGUsICdlcnJvciBpbiByZW1vdmVJdGVtRnJvbVRhZ3MnKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgY2hhbmdlU2VsZWN0ZWRUYWcgPSAoaWQ6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCBmb3VuZENhdGVnb3J5ID0gY2F0ZWdvcmllcy5maW5kKChjYXQpID0+IChjYXQuaWQgPT09IGlkKSlcbiAgICAgICAgaWYgKGZvdW5kQ2F0ZWdvcnkpIHtcbiAgICAgICAgICAgIHNldFNlbGVjdGVkVGFnKGZvdW5kQ2F0ZWdvcnkpXG4gICAgICAgICAgICBzZXRTZWxlY3RlZFRhZ0lkKGlkKVxuICAgICAgICB9XG4gICAgfVxuICAgIFxuXG4gICAgcmV0dXJuIChcbiAgICAgICAgPEJveCB3aWR0aD1cIjEwMCVcIj5cbiAgICAgICAgICAgIDxCb3ggcD17eyBwaG9uZTogJ20nLCB0YWJsZXQ6ICdsJyB9fSBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIj5cbiAgICAgICAgICAgICAgICA8VGV4dCB2YXJpYW50PVwib3B0aW9uSGVhZGVyXCI+XG4gICAgICAgICAgICAgICAgICAgIE1hbmFnZSB0YWdzIHRvIHRoaXMgZXZlbnRcbiAgICAgICAgICAgICAgICA8L1RleHQ+XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICA8Qm94IGZsZXg9ezF9IGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHdpZHRoPVwiMTAwJVwiPlxuICAgICAgICAgICAgICAgIDxGbGF0TGlzdFxuICAgICAgICAgICAgICAgICAgICBkYXRhPXtldmVudFRhZ3N9XG4gICAgICAgICAgICAgICAgICAgIHJlbmRlckl0ZW09eyh7IGl0ZW0gfSkgPT4gKFxuICAgICAgICAgICAgICAgICAgICAgICAgPEJveCBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiIGFsaWduSXRlbXM9XCJjZW50ZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Qm94IGZsZXhEaXJlY3Rpb249XCJyb3dcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCIganVzdGlmeUNvbnRlbnQ9XCJzcGFjZS1iZXR3ZWVuXCIgc3R5bGU9e3sgd2lkdGg6ICc2MCUnfX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJvcHRpb25IZWFkZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtpdGVtLm5hbWV9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFByZXNzYWJsZSBoaXRTbG9wPXsxNX0gb25QcmVzcz17KCkgPT4gcmVtb3ZlSXRlbUZyb21UYWdzKGl0ZW0/LmlkKX0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8SW9Jb3NDbG9zZSBzaXplPVwiM2VtXCIgY29sb3I9e3BhbGV0dGUucmVkfSAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L1ByZXNzYWJsZT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgICBrZXlFeHRyYWN0b3I9eyhpdGVtKSA9PiBpdGVtLmlkfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgIDxCb3ggZmxleD17M30ganVzdGlmeUNvbnRlbnQ9XCJjZW50ZXJcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCI+XG4gICAgICAgICAgICAgICAgPFBpY2tlclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZFZhbHVlPXtzZWxlY3RlZFRhZ0lkfVxuICAgICAgICAgICAgICAgICAgICBvblZhbHVlQ2hhbmdlPXtjaGFuZ2VTZWxlY3RlZFRhZ31cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIHtjYXRlZ29yaWVzLm1hcCgoY2F0ZWdvcnkpID0+ICggICBcbiAgICAgICAgICAgICAgICAgICAgICAgIDxQaWNrZXIuSXRlbSBjb2xvcj17cGFsZXR0ZS50ZXh0QmxhY2t9IGtleT17Y2F0ZWdvcnk/LmlkfSB2YWx1ZT17Y2F0ZWdvcnk/LmlkfSBsYWJlbD17Y2F0ZWdvcnk/Lm5hbWV9IC8+XG4gICAgICAgICAgICAgICAgICAgICkpfVxuICAgICAgICAgICAgICAgIDwvUGlja2VyPlxuICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICA8Qm94IHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19IGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiPlxuICAgICAgICAgICAgICAgIDxCdXR0b24gb25DbGljaz17YWRkSXRlbVRvVGFnc30+XG4gICAgICAgICAgICAgICAgICAgIEFkZFxuICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICA8Qm94IHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19IGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiPlxuICAgICAgICAgICAgPEJ1dHRvbiBvbkNsaWNrPXtwcm9wcy5oaWRlVGFnc30+XG4gICAgICAgICAgICAgICAgRG9uZVxuICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgPC9Cb3g+XG4gICAgKVxufVxuXG5leHBvcnQgZGVmYXVsdCBVc2VyRWRpdENhdGVnb3J5RXZlbnRNb2RhbFxuXG5cbiJdfQ==