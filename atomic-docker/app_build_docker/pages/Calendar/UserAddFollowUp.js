"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const react_2 = require("@chakra-ui/react");
const date_utils_1 = require("@lib/date-utils");
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const Button_1 = __importDefault(require("@components/Button"));
const UserCreateCalendarHelper_1 = require("@lib/Calendar/UserCreateCalendarHelper");
const TextField_1 = __importDefault(require("@components/TextField"));
const react_native_1 = require("react-native");
// import DatePicker from 'react-native-date-picker';
// import DateTimePicker from 'react-datetime-picker/dist/entry.nostyle'
const react_3 = require("@chakra-ui/react");
const listCategoriesForEventId_1 = __importDefault(require("@lib/apollo/gql/listCategoriesForEventId"));
const listRemindersForEventId_1 = __importDefault(require("@lib/apollo/gql/listRemindersForEventId"));
const getConferenceById_1 = __importDefault(require("@lib/apollo/gql/getConferenceById"));
const listAttendeesByEventId_1 = __importDefault(require("@lib/apollo/gql/listAttendeesByEventId"));
const calendarDbHelper_1 = require("@lib/calendarLib/calendarDbHelper");
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("../../config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
function UserAddFollowUp(props) {
    const [event, setEvent] = (0, react_1.useState)();
    const [title, setTitle] = (0, react_1.useState)('');
    const [description, setDescription] = (0, react_1.useState)('');
    const [startDate, setStartDate] = (0, react_1.useState)(new Date());
    const [duration, setDuration] = (0, react_1.useState)(0);
    const [isStartDatePicker, setIsStartDatePicker] = (0, react_1.useState)(false);
    const [pageOffset, setPageOffset] = (0, react_1.useState)(0);
    const { height: fullHeight } = react_native_1.Dimensions.get('window');
    const client = props?.client;
    const userId = props?.sub;
    const eventId = props?.id;
    const toast = (0, react_2.useToast)();
    // const dark = useColorScheme() === 'dark'
    const closeAddFollowUp = props?.closeAddFollowUp;
    (0, react_1.useEffect)(() => {
        (async () => {
            try {
                if (!eventId) {
                    toast({
                        title: 'Something went wrong',
                        description: 'Please try again',
                        status: 'error',
                        duration: 9000,
                        isClosable: true,
                    });
                    console.log('no eventId inside UserAddFollowUp');
                    return;
                }
                const event = await (0, calendarDbHelper_1.getEventWithId)(client, eventId);
                if (event?.id) {
                    setEvent(event);
                    setTitle('Follow up to ' + (event.title || event?.summary));
                    setDescription(event.notes);
                    if (event?.duration) {
                        setDuration(duration);
                    }
                    else {
                        const duration = (0, date_utils_1.dayjs)(event.endDate).diff((0, date_utils_1.dayjs)(event.startDate), 'minute');
                        setDuration(duration);
                    }
                    setStartDate(new Date(event.endDate));
                }
                else {
                    toast({
                        status: 'error',
                        title: 'Event not found',
                        description: 'Please try again',
                        duration: 9000,
                        isClosable: true,
                    });
                }
            }
            catch (e) {
                console.log(e, 'error getting event inside useEffect of UserAddFollowUp');
                toast({
                    status: 'error',
                    title: 'Error getting event',
                    description: 'Please try again',
                    duration: 9000,
                    isClosable: true,
                });
            }
        })();
    }, [client, duration, eventId]);
    const hideStartDatePicker = () => {
        setIsStartDatePicker(false);
    };
    const showStartDatePicker = () => {
        setIsStartDatePicker(true);
    };
    const handleSubmit = async () => {
        try {
            // validate
            if (!startDate || !duration) {
                toast({
                    status: 'error',
                    title: 'All fields required',
                    description: 'Please fill in all fields',
                    duration: 9000,
                    isClosable: true,
                });
                return;
            }
            if (!event?.id) {
                toast({
                    status: 'error',
                    title: 'Event not found',
                    description: 'Please try again',
                    duration: 9000,
                    isClosable: true,
                });
                return;
            }
            const categoryIds = (await client.query({
                query: listCategoriesForEventId_1.default,
                variables: {
                    eventId: event.id,
                },
            })).data?.Category?.map(c => c.id);
            const reminders = (await client.query({
                query: listRemindersForEventId_1.default,
                variables: {
                    eventId: event.id,
                },
            })).data?.Reminder?.map(r => r.minutes);
            let conference;
            if (event?.conferenceId) {
                conference = (await client.query({
                    query: getConferenceById_1.default,
                    variables: {
                        id: event.conferenceId,
                    },
                })).data?.Conference_by_pk;
            }
            const attendees = (await client.query({
                query: listAttendeesByEventId_1.default,
                variables: {
                    eventId: event.id,
                },
            })).data?.Attendee;
            await (0, UserCreateCalendarHelper_1.createNewEvent)((0, date_utils_1.dayjs)(startDate).toISOString(), (0, date_utils_1.dayjs)(startDate).add(duration, 'minute').toISOString(), event?.userId, client, event?.calendarId, categoryIds, title, event?.allDay, undefined, undefined, undefined, reminders, description, event?.location, true, event?.isPreEvent, event?.isPostEvent, event?.modifiable, event?.anyoneCanAddSelf, event?.guestsCanInviteOthers, event?.guestsCanSeeOtherGuests, event?.originalAllDay, event?.timezone, event?.taskId, event?.taskType, event?.followUpEventId, event?.preEventId, event?.postEventId, event?.forEventId, conference?.app === 'zoom', conference?.app === 'google', conference?.type, (conference?.app === 'zoom') && conference?.entryPoints?.find((e) => e?.entryPointType === 'video')?.password, conference?.zoomPrivateMeeting, attendees, event?.conferenceId, event?.maxAttendees, event?.sendUpdates, event?.status, event?.summary || title, event?.transparency, event?.visibility, undefined, undefined, event?.htmlLink, event?.colorId, event?.originalTimezone, event?.backgroundColor, event?.foregroundColor, event?.useDefaultAlarms, event?.positiveImpactScore, event?.negativeImpactScore, event?.positiveImpactDayOfWeek, event?.positiveImpactTime, event?.negativeImpactDayOfWeek, event?.negativeImpactTime, event?.preferredDayOfWeek, event?.preferredTime, event?.isExternalMeeting, event?.isExternalMeeting, event?.isMeetingModifiable, event?.isMeeting, event?.dailyTaskList, event?.weeklyTaskList, event?.isBreak, event?.preferredStartTimeRange, event?.preferredEndTimeRange, event?.copyAvailability, event?.copyTimeBlocking, event?.copyTimePreference, event?.copyReminders, event?.copyPriorityLevel, event?.copyModifiable, event?.copyCategories, event?.copyIsBreak, event?.timeBlocking, event?.userModifiedAvailability, event?.userModifiedTimeBlocking, event?.userModifiedTimePreference, event?.userModifiedReminders, event?.userModifiedPriorityLevel, event?.userModifiedCategories, event?.userModifiedModifiable, event?.userModifiedIsBreak, event?.hardDeadline, event?.softDeadline, event?.copyIsMeeting, event?.copyIsExternalMeeting, event?.userModifiedIsMeeting, event?.userModifiedIsExternalMeeting, event?.duration, event?.copyDuration, event?.userModifiedDuration, event?.method, event?.unlink, event?.byWeekDay);
            toast({
                status: 'success',
                title: 'Follow up event created',
                description: title || event?.summary || '',
                duration: 9000,
                isClosable: true,
            });
            closeAddFollowUp();
        }
        catch (e) {
            console.log(e, 'error in handleSubmit of UserAddFollowUp');
            toast({
                status: 'error',
                title: 'Error adding follow up',
                description: 'Please try again',
                duration: 9000,
                isClosable: true,
            });
        }
    };
    return ((0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, style: { width: '100%' }, children: (0, jsx_runtime_1.jsxs)(Box_1.default, { style: { flex: 1, width: '100%' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, alignItems: "flex-start", children: (0, jsx_runtime_1.jsx)(TextField_1.default, { label: "Title", placeholder: "title", onChange: (e) => setTitle(e?.target?.value), value: title || '' }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, alignItems: "flex-start", children: (0, jsx_runtime_1.jsx)(TextField_1.default, { label: "Notes", onChange: (e) => setDescription(e?.target?.value), value: description || '', numberOfLines: 3, multiline: true }) }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, alignItems: "flex-start", children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Start" }), (0, jsx_runtime_1.jsx)(react_3.Input, { placeholder: "Select Date and Time", size: "md", type: "datetime-local", onChange: (e) => {
                                setStartDate((0, date_utils_1.dayjs)(e?.target?.value, "YYYY-MM-DDTHH:mm").toDate());
                            }, value: (0, date_utils_1.dayjs)(startDate).format("YYYY-MM-DDTHH:mm") })] }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, alignItems: "flex-start", children: (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "center", alignItems: "center", children: (0, jsx_runtime_1.jsx)(Box_1.default, { children: (0, jsx_runtime_1.jsx)(TextField_1.default, { label: "Duration (minutes)", type: "number", onChange: (e) => setDuration(parseInt(e?.target?.value.replace(/[^0-9.]/g, ''), 10)), value: `${duration}`, placeholder: "1" }) }) }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flex: 1, justifyContent: "center", alignItems: "center", children: (0, jsx_runtime_1.jsxs)(Box_1.default, { children: [(0, jsx_runtime_1.jsx)(Button_1.default, { onClick: handleSubmit, children: "Submit" }), (0, jsx_runtime_1.jsx)("button", { className: "btn btn-link no-underline hover:no-underline", onClick: closeAddFollowUp, children: "Close" })] }) })] }) }));
}
exports.default = UserAddFollowUp;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlckFkZEZvbGxvd1VwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiVXNlckFkZEZvbGxvd1VwLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQXVDQSxnREFxQ0M7O0FBNUVELGlDQUErRDtBQUUvRCw0Q0FBMkM7QUFDM0MsZ0RBQXVDO0FBR3ZDLGlFQUF3QztBQUN4QyxtRUFBMEM7QUFDMUMsZ0VBQXVDO0FBRXZDLHFGQUE4RjtBQUs5RixzRUFBNkM7QUFDN0MsK0NBQTZGO0FBQzdGLHFEQUFxRDtBQUNyRCx3RUFBd0U7QUFDeEUsNENBQXdDO0FBS3hDLHdHQUErRTtBQUcvRSxzR0FBNkU7QUFDN0UsMEZBQWlFO0FBQ2pFLG9HQUE0RTtBQUM1RSx3RUFBa0U7QUFLbEUsd0VBQThDO0FBQzlDLDhEQUEwRDtBQUMxRCw4RUFBcUQ7QUFFOUMsS0FBSyxVQUFVLGtCQUFrQixDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBaUQ7SUFDbEcsMEZBQTBGO0lBQzFGLHNDQUFzQztJQUN0Qyx5RUFBeUU7SUFDekUsMEJBQWUsQ0FBQyxJQUFJLENBQUMsSUFBQSw2QkFBYSxHQUFFLENBQUMsQ0FBQTtJQUNyQyxJQUFJLE9BQU8sQ0FBQTtJQUNYLElBQUksQ0FBQztRQUNILE9BQU8sR0FBRyxNQUFNLGlCQUFPLENBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUU7WUFDM0MsNkJBQTZCLEVBQUUsS0FBSztnQkFDbEMsT0FBTyxFQUFFLENBQUE7WUFDWCxDQUFDO1NBQ0YsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUFDLE9BQU8sR0FBUSxFQUFFLENBQUM7UUFDbEIsSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLGlCQUFPLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDakQsT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFLGVBQWUsRUFBRSxlQUFlLEVBQUUsRUFBRSxDQUFBO1FBQ3hELENBQUM7YUFBTSxJQUFJLEdBQUcsQ0FB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QUUsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFDbkgsS0FBSyxFQUFFLEdBQUcsUUFBUSxFQUFFLEVBQ3BCLFdBQVcsRUFBQyxHQUFHLEdBRWpCLEdBQ0EsR0FFSixHQUNKLEVBQ04sdUJBQUMsYUFBRyxJQUFDLElBQUksRUFBRSxDQUFDLEVBQUcsY0FBYyxFQUFDLFFBQVEsRUFBQyxVQUFVLEVBQUMsUUFBUSxZQUN0RCx3QkFBQyxhQUFHLGVBQ0osdUJBQUMsZ0JBQU0sSUFBQyxPQUFPLEVBQUUsWUFBWSx1QkFFcEIsRUFDVCxtQ0FBUSxTQUFTLEVBQUMsOENBQThDLEVBQUMsT0FBTyxFQUFFLGdCQUFnQixzQkFFakYsSUFFUCxHQUNBLElBQ0osR0FDSixDQUNULENBQUE7QUFDTCxDQUFDO0FBRUQsa0JBQWUsZUFBZSxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnXG5cbmltcG9ydCB7IHVzZVRvYXN0IH0gZnJvbSAnQGNoYWtyYS11aS9yZWFjdCdcbmltcG9ydCB7IGRheWpzIH0gZnJvbSAnQGxpYi9kYXRlLXV0aWxzJ1xuaW1wb3J0IHV0YyBmcm9tICdkYXlqcy9wbHVnaW4vdXRjJ1xuXG5pbXBvcnQgQm94IGZyb20gJ0Bjb21wb25lbnRzL2NvbW1vbi9Cb3gnXG5pbXBvcnQgVGV4dCBmcm9tICdAY29tcG9uZW50cy9jb21tb24vVGV4dCdcbmltcG9ydCBCdXR0b24gZnJvbSAnQGNvbXBvbmVudHMvQnV0dG9uJ1xuXG5pbXBvcnQgeyBjcmVhdGVOZXdFdmVudCwgbWVldGluZ1R5cGVTdHJpbmdUeXBlIH0gZnJvbSAnQGxpYi9DYWxlbmRhci9Vc2VyQ3JlYXRlQ2FsZW5kYXJIZWxwZXInXG5cbmltcG9ydCB7RXZlbnRUeXBlfSBmcm9tICdAbGliL2RhdGFUeXBlcy9FdmVudFR5cGUnO1xuaW1wb3J0IHsgQ29uZmVyZW5jZVR5cGUgfSBmcm9tICdAbGliL2RhdGFUeXBlcy9Db25mZXJlbmNlVHlwZSdcbmltcG9ydCB7IEF0dGVuZGVlVHlwZSB9IGZyb20gJ0BsaWIvZGF0YVR5cGVzL0F0dGVuZGVlVHlwZSdcbmltcG9ydCBUZXh0RmllbGQgZnJvbSAnQGNvbXBvbmVudHMvVGV4dEZpZWxkJ1xuaW1wb3J0IHsgUHJlc3NhYmxlLCBTdHlsZVNoZWV0LCB1c2VDb2xvclNjaGVtZSwgRGltZW5zaW9ucywgU2Nyb2xsVmlldyB9IGZyb20gJ3JlYWN0LW5hdGl2ZSc7XG4vLyBpbXBvcnQgRGF0ZVBpY2tlciBmcm9tICdyZWFjdC1uYXRpdmUtZGF0ZS1waWNrZXInO1xuLy8gaW1wb3J0IERhdGVUaW1lUGlja2VyIGZyb20gJ3JlYWN0LWRhdGV0aW1lLXBpY2tlci9kaXN0L2VudHJ5Lm5vc3R5bGUnXG5pbXBvcnQgeyBJbnB1dCB9IGZyb20gJ0BjaGFrcmEtdWkvcmVhY3QnXG5pbXBvcnQgeyBwYWxldHRlIH0gZnJvbSAnQGxpYi90aGVtZS90aGVtZSdcblxuaW1wb3J0IHsgQXBvbGxvQ2xpZW50LCBOb3JtYWxpemVkQ2FjaGVPYmplY3QgfSBmcm9tICdAYXBvbGxvL2NsaWVudCdcbmltcG9ydCBnZXRFdmVudEJ5SWQgZnJvbSAnQGxpYi9hcG9sbG8vZ3FsL2dldEV2ZW50QnlJZCdcbmltcG9ydCBsaXN0Q2F0ZWdvcmllc0ZvckV2ZW50SWQgZnJvbSAnQGxpYi9hcG9sbG8vZ3FsL2xpc3RDYXRlZ29yaWVzRm9yRXZlbnRJZCdcbmltcG9ydCB7IENhdGVnb3J5VHlwZSB9IGZyb20gJ0BsaWIvZGF0YVR5cGVzL0NhdGVnb3J5VHlwZSdcbmltcG9ydCB7IFJlbWluZGVyVHlwZSB9IGZyb20gJ0BsaWIvZGF0YVR5cGVzL1JlbWluZGVyVHlwZSc7XG5pbXBvcnQgbGlzdFJlbWluZGVyc0ZvckV2ZW50SWQgZnJvbSAnQGxpYi9hcG9sbG8vZ3FsL2xpc3RSZW1pbmRlcnNGb3JFdmVudElkJ1xuaW1wb3J0IGdldENvbmZlcmVuY2VCeUlkIGZyb20gJ0BsaWIvYXBvbGxvL2dxbC9nZXRDb25mZXJlbmNlQnlJZCdcbmltcG9ydCBsaXN0QXR0ZW5kZWVzQnlFdmVudElkIGZyb20gJ0BsaWIvYXBvbGxvL2dxbC9saXN0QXR0ZW5kZWVzQnlFdmVudElkJztcbmltcG9ydCB7IGdldEV2ZW50V2l0aElkIH0gZnJvbSAnQGxpYi9jYWxlbmRhckxpYi9jYWxlbmRhckRiSGVscGVyJ1xuaW1wb3J0IHsgdXNlUm91dGVyIH0gZnJvbSAnbmV4dC9yb3V0ZXInXG5cbmltcG9ydCB7IHVzZUFwcENvbnRleHQgfSBmcm9tICdAbGliL3VzZXItY29udGV4dCdcbmltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcbmltcG9ydCBzdXBlcnRva2Vuc05vZGUgZnJvbSAnc3VwZXJ0b2tlbnMtbm9kZSdcbmltcG9ydCB7IGJhY2tlbmRDb25maWcgfSBmcm9tICcuLi8uLi9jb25maWcvYmFja2VuZENvbmZpZydcbmltcG9ydCBTZXNzaW9uIGZyb20gJ3N1cGVydG9rZW5zLW5vZGUvcmVjaXBlL3Nlc3Npb24nXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRTZXJ2ZXJTaWRlUHJvcHMoeyByZXEsIHJlcyB9OiB7IHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlIH0pIHtcbiAgLy8gTm90aWNlIGhvdyB0aGUgc2VydmVyIHVzZXMgYEFQSWAgZnJvbSBgd2l0aFNTUkNvbnRleHRgLCBpbnN0ZWFkIG9mIHRoZSB0b3AtbGV2ZWwgYEFQSWAuXG4gIC8vIGNvbnN0IFNTUiA9IHdpdGhTU1JDb250ZXh0KHsgcmVxIH0pXG4gIC8vIHRoaXMgcnVucyBvbiB0aGUgYmFja2VuZCwgc28gd2UgbXVzdCBjYWxsIGluaXQgb24gc3VwZXJ0b2tlbnMtbm9kZSBTREtcbiAgc3VwZXJ0b2tlbnNOb2RlLmluaXQoYmFja2VuZENvbmZpZygpKVxuICBsZXQgc2Vzc2lvblxuICB0cnkge1xuICAgIHNlc3Npb24gPSBhd2FpdCBTZXNzaW9uLmdldFNlc3Npb24ocmVxLCByZXMsIHtcbiAgICAgIG92ZXJyaWRlR2xvYmFsQ2xhaW1WYWxpZGF0b3JzOiBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBbXVxuICAgICAgfSxcbiAgICB9KVxuICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgIGlmIChlcnIudHlwZSA9PT0gU2Vzc2lvbi5FcnJvci5UUllfUkVGUkVTSF9UT0tFTikge1xuICAgICAgcmV0dXJuIHsgcHJvcHM6IHsgZnJvbVN1cGVydG9rZW5zOiAnbmVlZHMtcmVmcmVzaCcgfSB9XG4gICAgfSBlbHNlIGlmIChlcnIudHlwZSA9PT0gU2Vzc2lvbi5FcnJvci5VTkFVVEhPUklTRUQpIHtcbiAgICAgIC8vIHRoaXMgd2lsbCBmb3JjZSB0aGUgZnJvbnRlbmQgdG8gdHJ5IGFuZCByZWZyZXNoIHdoaWNoIHdpbGwgZmFpbFxuICAgICAgLy8gY2xlYXJpbmcgYWxsIGNvb2tpZXMgYW5kIHJlZGlyZWN0aW5nIHRoZSB1c2VyIHRvIHRoZSBsb2dpbiBzY3JlZW4uXG4gICAgICByZXR1cm4geyBwcm9wczogeyBmcm9tU3VwZXJ0b2tlbnM6ICduZWVkcy1yZWZyZXNoJyB9IH1cbiAgICB9XG4gICAgdGhyb3cgZXJyXG4gIH1cblxuICBpZiAoIXNlc3Npb24/LmdldFVzZXJJZCgpKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlZGlyZWN0OiB7XG4gICAgICAgIGRlc3RpbmF0aW9uOiAnL1VzZXIvTG9naW4vVXNlckxvZ2luJyxcbiAgICAgICAgcGVybWFuZW50OiBmYWxzZSxcbiAgICAgIH0sXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBwcm9wczoge1xuICAgICAgc3ViOiBzZXNzaW9uLmdldFVzZXJJZCgpLFxuICAgIH1cbiAgfVxufVxuXG50eXBlIFByb3BzID0ge1xuICAgIGlkOiBzdHJpbmcsXG4gICAgY2xvc2VBZGRGb2xsb3dVcDogKCkgPT4gdm9pZCxcbiAgICBjbGllbnQ6IEFwb2xsb0NsaWVudDxOb3JtYWxpemVkQ2FjaGVPYmplY3Q+LFxuICAgIHN1Yjogc3RyaW5nLFxufVxuXG5mdW5jdGlvbiBVc2VyQWRkRm9sbG93VXAocHJvcHM6IFByb3BzKSB7XG4gICAgY29uc3QgW2V2ZW50LCBzZXRFdmVudF0gPSB1c2VTdGF0ZTxFdmVudFR5cGU+KClcbiAgICBjb25zdCBbdGl0bGUsIHNldFRpdGxlXSA9IHVzZVN0YXRlKCcnKVxuICAgIGNvbnN0IFtkZXNjcmlwdGlvbiwgc2V0RGVzY3JpcHRpb25dID0gdXNlU3RhdGUoJycpXG4gICAgY29uc3QgW3N0YXJ0RGF0ZSwgc2V0U3RhcnREYXRlXSA9IHVzZVN0YXRlPERhdGU+KG5ldyBEYXRlKCkpXG4gICAgY29uc3QgW2R1cmF0aW9uLCBzZXREdXJhdGlvbl0gPSB1c2VTdGF0ZTxudW1iZXI+KDApXG4gICAgY29uc3QgW2lzU3RhcnREYXRlUGlja2VyLCBzZXRJc1N0YXJ0RGF0ZVBpY2tlcl0gPSB1c2VTdGF0ZShmYWxzZSlcbiAgICBjb25zdCBbcGFnZU9mZnNldCwgc2V0UGFnZU9mZnNldF0gPSB1c2VTdGF0ZTxudW1iZXI+KDApXG5cbiAgICBjb25zdCB7IGhlaWdodDogZnVsbEhlaWdodCB9ID0gRGltZW5zaW9ucy5nZXQoJ3dpbmRvdycpXG5cbiAgICBjb25zdCBjbGllbnQgPSBwcm9wcz8uY2xpZW50XG4gICAgY29uc3QgdXNlcklkID0gcHJvcHM/LnN1YlxuICAgIGNvbnN0IGV2ZW50SWQgPSBwcm9wcz8uaWRcbiAgICBjb25zdCB0b2FzdCA9IHVzZVRvYXN0KClcbiAgICAvLyBjb25zdCBkYXJrID0gdXNlQ29sb3JTY2hlbWUoKSA9PT0gJ2RhcmsnXG4gXG4gICAgY29uc3QgY2xvc2VBZGRGb2xsb3dVcCA9IHByb3BzPy5jbG9zZUFkZEZvbGxvd1VwXG4gICAgXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgaWYgKCFldmVudElkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnU29tZXRoaW5nIHdlbnQgd3JvbmcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdQbGVhc2UgdHJ5IGFnYWluJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ2Vycm9yJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA5MDAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNDbG9zYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25vIGV2ZW50SWQgaW5zaWRlIFVzZXJBZGRGb2xsb3dVcCcpXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBldmVudCA9IGF3YWl0IGdldEV2ZW50V2l0aElkKGNsaWVudCwgZXZlbnRJZClcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQ/LmlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldEV2ZW50KGV2ZW50KVxuICAgICAgICAgICAgICAgICAgICBzZXRUaXRsZSgnRm9sbG93IHVwIHRvICcgKyAoZXZlbnQudGl0bGUgfHwgZXZlbnQ/LnN1bW1hcnkpKVxuICAgICAgICAgICAgICAgICAgICBzZXREZXNjcmlwdGlvbihldmVudC5ub3RlcylcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50Py5kdXJhdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0RHVyYXRpb24oZHVyYXRpb24pXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkdXJhdGlvbiA9IGRheWpzKGV2ZW50LmVuZERhdGUpLmRpZmYoZGF5anMoZXZlbnQuc3RhcnREYXRlKSwgJ21pbnV0ZScpXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXREdXJhdGlvbihkdXJhdGlvbilcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzZXRTdGFydERhdGUobmV3IERhdGUoZXZlbnQuZW5kRGF0ZSkpXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3Qoe1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdFdmVudCBub3QgZm91bmQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdQbGVhc2UgdHJ5IGFnYWluJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA5MDAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXNDbG9zYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSwgJ2Vycm9yIGdldHRpbmcgZXZlbnQgaW5zaWRlIHVzZUVmZmVjdCBvZiBVc2VyQWRkRm9sbG93VXAnKVxuICAgICAgICAgICAgICAgIHRvYXN0KHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgICAgICB0aXRsZTogJ0Vycm9yIGdldHRpbmcgZXZlbnQnLFxuICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1BsZWFzZSB0cnkgYWdhaW4nLFxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogOTAwMCxcbiAgICAgICAgICAgICAgICAgICAgaXNDbG9zYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9KSgpXG4gICAgfSwgW2NsaWVudCwgZHVyYXRpb24sIGV2ZW50SWRdKVxuXG5cbiAgICBjb25zdCBoaWRlU3RhcnREYXRlUGlja2VyID0gKCkgPT4geyBcbiAgICAgICAgc2V0SXNTdGFydERhdGVQaWNrZXIoZmFsc2UpXG4gICAgfVxuICAgIFxuICAgIGNvbnN0IHNob3dTdGFydERhdGVQaWNrZXIgPSAoKSA9PiB7XG4gICAgICAgIHNldElzU3RhcnREYXRlUGlja2VyKHRydWUpXG4gICAgfVxuXG4gICAgY29uc3QgaGFuZGxlU3VibWl0ID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgIC8vIHZhbGlkYXRlXG4gICAgICAgICAgICBpZiAoIXN0YXJ0RGF0ZSB8fCAhZHVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICB0b2FzdCh7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogJ2Vycm9yJyxcbiAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICdBbGwgZmllbGRzIHJlcXVpcmVkJyxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdQbGVhc2UgZmlsbCBpbiBhbGwgZmllbGRzJyxcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDkwMDAsXG4gICAgICAgICAgICAgICAgICAgIGlzQ2xvc2FibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghZXZlbnQ/LmlkKSB7XG4gICAgICAgICAgICAgICAgdG9hc3Qoe1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6ICdlcnJvcicsXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnRXZlbnQgbm90IGZvdW5kJyxcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdQbGVhc2UgdHJ5IGFnYWluJyxcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDkwMDAsXG4gICAgICAgICAgICAgICAgICAgIGlzQ2xvc2FibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBjb25zdCBjYXRlZ29yeUlkcyA9IChhd2FpdCBjbGllbnQucXVlcnk8eyBDYXRlZ29yeTogQ2F0ZWdvcnlUeXBlW10gfT4oe1xuICAgICAgICAgICAgICAgIHF1ZXJ5OiBsaXN0Q2F0ZWdvcmllc0ZvckV2ZW50SWQsXG4gICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50SWQ6IGV2ZW50LmlkLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KSkuZGF0YT8uQ2F0ZWdvcnk/Lm1hcChjID0+IGMuaWQpXG4gICAgICAgICAgICBjb25zdCByZW1pbmRlcnMgPSAoYXdhaXQgY2xpZW50LnF1ZXJ5PHsgUmVtaW5kZXI6IFJlbWluZGVyVHlwZVtdIH0+KHtcbiAgICAgICAgICAgICAgICBxdWVyeTogbGlzdFJlbWluZGVyc0ZvckV2ZW50SWQsXG4gICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50SWQ6IGV2ZW50LmlkLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KSkuZGF0YT8uUmVtaW5kZXI/Lm1hcChyID0+IHIubWludXRlcylcbiAgICAgICAgICAgIGxldCBjb25mZXJlbmNlOiBDb25mZXJlbmNlVHlwZVxuICAgICAgICAgICAgaWYgKGV2ZW50Py5jb25mZXJlbmNlSWQpIHtcbiAgICAgICAgICAgICAgICBjb25mZXJlbmNlID0gKGF3YWl0IGNsaWVudC5xdWVyeTx7IENvbmZlcmVuY2VfYnlfcGs6IENvbmZlcmVuY2VUeXBlIH0+KHtcbiAgICAgICAgICAgICAgICAgICAgcXVlcnk6IGdldENvbmZlcmVuY2VCeUlkLFxuICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBldmVudC5jb25mZXJlbmNlSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9KSkuZGF0YT8uQ29uZmVyZW5jZV9ieV9wa1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGF0dGVuZGVlczogQXR0ZW5kZWVUeXBlW10gPSAoYXdhaXQgY2xpZW50LnF1ZXJ5PHsgQXR0ZW5kZWU6IEF0dGVuZGVlVHlwZVtdIH0+KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeTogbGlzdEF0dGVuZGVlc0J5RXZlbnRJZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRJZDogZXZlbnQuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKS5kYXRhPy5BdHRlbmRlZVxuXG4gICAgICAgICAgICBhd2FpdCBjcmVhdGVOZXdFdmVudChcbiAgICAgICAgICAgICAgICBkYXlqcyhzdGFydERhdGUpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgZGF5anMoc3RhcnREYXRlKS5hZGQoZHVyYXRpb24sICdtaW51dGUnKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGV2ZW50Py51c2VySWQsXG4gICAgICAgICAgICAgICAgY2xpZW50LFxuICAgICAgICAgICAgICAgIGV2ZW50Py5jYWxlbmRhcklkLFxuICAgICAgICAgICAgICAgIGNhdGVnb3J5SWRzLFxuICAgICAgICAgICAgICAgIHRpdGxlLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5hbGxEYXksXG4gICAgICAgICAgICAgICAgdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgcmVtaW5kZXJzLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5sb2NhdGlvbixcbiAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5pc1ByZUV2ZW50LFxuICAgICAgICAgICAgICAgIGV2ZW50Py5pc1Bvc3RFdmVudCxcbiAgICAgICAgICAgICAgICBldmVudD8ubW9kaWZpYWJsZSxcbiAgICAgICAgICAgICAgICBldmVudD8uYW55b25lQ2FuQWRkU2VsZixcbiAgICAgICAgICAgICAgICBldmVudD8uZ3Vlc3RzQ2FuSW52aXRlT3RoZXJzLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5ndWVzdHNDYW5TZWVPdGhlckd1ZXN0cyxcbiAgICAgICAgICAgICAgICBldmVudD8ub3JpZ2luYWxBbGxEYXksXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnRpbWV6b25lLFxuICAgICAgICAgICAgICAgIGV2ZW50Py50YXNrSWQsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnRhc2tUeXBlLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5mb2xsb3dVcEV2ZW50SWQsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnByZUV2ZW50SWQsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnBvc3RFdmVudElkLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5mb3JFdmVudElkLFxuICAgICAgICAgICAgICAgIGNvbmZlcmVuY2U/LmFwcCA9PT0gJ3pvb20nLFxuICAgICAgICAgICAgICAgIGNvbmZlcmVuY2U/LmFwcCA9PT0gJ2dvb2dsZScsXG4gICAgICAgICAgICAgICAgY29uZmVyZW5jZT8udHlwZSBhcyBtZWV0aW5nVHlwZVN0cmluZ1R5cGUsXG4gICAgICAgICAgICAgICAgKGNvbmZlcmVuY2U/LmFwcCA9PT0gJ3pvb20nKSAmJiBjb25mZXJlbmNlPy5lbnRyeVBvaW50cz8uZmluZCgoZSkgPT4gZT8uZW50cnlQb2ludFR5cGUgPT09ICd2aWRlbycpPy5wYXNzd29yZCxcbiAgICAgICAgICAgICAgICBjb25mZXJlbmNlPy56b29tUHJpdmF0ZU1lZXRpbmcsXG4gICAgICAgICAgICAgICAgYXR0ZW5kZWVzLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5jb25mZXJlbmNlSWQsXG4gICAgICAgICAgICAgICAgZXZlbnQ/Lm1heEF0dGVuZGVlcyxcbiAgICAgICAgICAgICAgICBldmVudD8uc2VuZFVwZGF0ZXMsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnN0YXR1cyxcbiAgICAgICAgICAgICAgICBldmVudD8uc3VtbWFyeSB8fCB0aXRsZSxcbiAgICAgICAgICAgICAgICBldmVudD8udHJhbnNwYXJlbmN5LFxuICAgICAgICAgICAgICAgIGV2ZW50Py52aXNpYmlsaXR5LFxuICAgICAgICAgICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgZXZlbnQ/Lmh0bWxMaW5rLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5jb2xvcklkLCBcbiAgICAgICAgICAgICAgICBldmVudD8ub3JpZ2luYWxUaW1lem9uZSxcbiAgICAgICAgICAgICAgICBldmVudD8uYmFja2dyb3VuZENvbG9yLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5mb3JlZ3JvdW5kQ29sb3IsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnVzZURlZmF1bHRBbGFybXMsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnBvc2l0aXZlSW1wYWN0U2NvcmUsXG4gICAgICAgICAgICAgICAgZXZlbnQ/Lm5lZ2F0aXZlSW1wYWN0U2NvcmUsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnBvc2l0aXZlSW1wYWN0RGF5T2ZXZWVrLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5wb3NpdGl2ZUltcGFjdFRpbWUsXG4gICAgICAgICAgICAgICAgZXZlbnQ/Lm5lZ2F0aXZlSW1wYWN0RGF5T2ZXZWVrLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5uZWdhdGl2ZUltcGFjdFRpbWUsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnByZWZlcnJlZERheU9mV2VlayxcbiAgICAgICAgICAgICAgICBldmVudD8ucHJlZmVycmVkVGltZSxcbiAgICAgICAgICAgICAgICBldmVudD8uaXNFeHRlcm5hbE1lZXRpbmcsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LmlzRXh0ZXJuYWxNZWV0aW5nLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5pc01lZXRpbmdNb2RpZmlhYmxlLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5pc01lZXRpbmcsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LmRhaWx5VGFza0xpc3QsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LndlZWtseVRhc2tMaXN0LFxuICAgICAgICAgICAgICAgIGV2ZW50Py5pc0JyZWFrLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5wcmVmZXJyZWRTdGFydFRpbWVSYW5nZSxcbiAgICAgICAgICAgICAgICBldmVudD8ucHJlZmVycmVkRW5kVGltZVJhbmdlLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5jb3B5QXZhaWxhYmlsaXR5LFxuICAgICAgICAgICAgICAgIGV2ZW50Py5jb3B5VGltZUJsb2NraW5nLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5jb3B5VGltZVByZWZlcmVuY2UsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LmNvcHlSZW1pbmRlcnMsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LmNvcHlQcmlvcml0eUxldmVsLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5jb3B5TW9kaWZpYWJsZSxcbiAgICAgICAgICAgICAgICBldmVudD8uY29weUNhdGVnb3JpZXMsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LmNvcHlJc0JyZWFrLFxuICAgICAgICAgICAgICAgIGV2ZW50Py50aW1lQmxvY2tpbmcsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnVzZXJNb2RpZmllZEF2YWlsYWJpbGl0eSxcbiAgICAgICAgICAgICAgICBldmVudD8udXNlck1vZGlmaWVkVGltZUJsb2NraW5nLFxuICAgICAgICAgICAgICAgIGV2ZW50Py51c2VyTW9kaWZpZWRUaW1lUHJlZmVyZW5jZSxcbiAgICAgICAgICAgICAgICBldmVudD8udXNlck1vZGlmaWVkUmVtaW5kZXJzLFxuICAgICAgICAgICAgICAgIGV2ZW50Py51c2VyTW9kaWZpZWRQcmlvcml0eUxldmVsLFxuICAgICAgICAgICAgICAgIGV2ZW50Py51c2VyTW9kaWZpZWRDYXRlZ29yaWVzLFxuICAgICAgICAgICAgICAgIGV2ZW50Py51c2VyTW9kaWZpZWRNb2RpZmlhYmxlLFxuICAgICAgICAgICAgICAgIGV2ZW50Py51c2VyTW9kaWZpZWRJc0JyZWFrLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5oYXJkRGVhZGxpbmUsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnNvZnREZWFkbGluZSxcbiAgICAgICAgICAgICAgICBldmVudD8uY29weUlzTWVldGluZyxcbiAgICAgICAgICAgICAgICBldmVudD8uY29weUlzRXh0ZXJuYWxNZWV0aW5nLFxuICAgICAgICAgICAgICAgIGV2ZW50Py51c2VyTW9kaWZpZWRJc01lZXRpbmcsXG4gICAgICAgICAgICAgICAgZXZlbnQ/LnVzZXJNb2RpZmllZElzRXh0ZXJuYWxNZWV0aW5nLFxuICAgICAgICAgICAgICAgIGV2ZW50Py5kdXJhdGlvbixcbiAgICAgICAgICAgICAgICBldmVudD8uY29weUR1cmF0aW9uLFxuICAgICAgICAgICAgICAgIGV2ZW50Py51c2VyTW9kaWZpZWREdXJhdGlvbixcbiAgICAgICAgICAgICAgICBldmVudD8ubWV0aG9kLFxuICAgICAgICAgICAgICAgIGV2ZW50Py51bmxpbmssXG4gICAgICAgICAgICAgICAgZXZlbnQ/LmJ5V2Vla0RheSBhcyBEYXlbXSxcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIHRvYXN0KHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6ICdzdWNjZXNzJyxcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0ZvbGxvdyB1cCBldmVudCBjcmVhdGVkJyxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdGl0bGUgfHwgZXZlbnQ/LnN1bW1hcnkgfHwgJycsXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDkwMDAsXG4gICAgICAgICAgICAgICAgaXNDbG9zYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIGNsb3NlQWRkRm9sbG93VXAoKVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlLCAnZXJyb3IgaW4gaGFuZGxlU3VibWl0IG9mIFVzZXJBZGRGb2xsb3dVcCcpXG4gICAgICAgICAgICB0b2FzdCh7XG4gICAgICAgICAgICAgICAgc3RhdHVzOiAnZXJyb3InLFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnRXJyb3IgYWRkaW5nIGZvbGxvdyB1cCcsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdQbGVhc2UgdHJ5IGFnYWluJyxcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogOTAwMCxcbiAgICAgICAgICAgICAgICBpc0Nsb3NhYmxlOiB0cnVlLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiAoXG4gICAgICAgIDxCb3ggZmxleD17MX0gc3R5bGU9e3sgd2lkdGg6ICcxMDAlJyB9fT5cbiAgICAgICAgICAgIDxCb3ggc3R5bGU9e3sgZmxleDogMSwgd2lkdGg6ICcxMDAlJyB9fT4gXG4gICAgICAgICAgICAgICAgPEJveCBmbGV4PXsxfSBhbGlnbkl0ZW1zPVwiZmxleC1zdGFydFwiPlxuICAgICAgICAgICAgICAgICAgICA8VGV4dEZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbD1cIlRpdGxlXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwidGl0bGVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlOiB7IHRhcmdldDogeyB2YWx1ZTogc3RyaW5nIH0gfSkgPT4gc2V0VGl0bGUoZT8udGFyZ2V0Py52YWx1ZSl9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT17dGl0bGUgfHwgJyd9XG4gICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgIDxCb3ggZmxleD17MX0gYWxpZ25JdGVtcz1cImZsZXgtc3RhcnRcIj5cbiAgICAgICAgICAgICAgICAgICAgPFRleHRGaWVsZFxuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw9XCJOb3Rlc1wiXG4gICAgICAgICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGU6IHsgdGFyZ2V0OiB7IHZhbHVlOiBzdHJpbmcgfSB9KSA9PiBzZXREZXNjcmlwdGlvbihlPy50YXJnZXQ/LnZhbHVlKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXtkZXNjcmlwdGlvbiB8fCAnJ31cbiAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlck9mTGluZXM9ezN9XG4gICAgICAgICAgICAgICAgICAgICAgICBtdWx0aWxpbmVcbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICA8Qm94IGZsZXg9ezF9IGFsaWduSXRlbXM9XCJmbGV4LXN0YXJ0XCI+XG4gICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJvcHRpb25IZWFkZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgIFN0YXJ0XG4gICAgICAgICAgICAgICAgICAgIDwvVGV4dD5cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgPElucHV0XG4gICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIlNlbGVjdCBEYXRlIGFuZCBUaW1lXCJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU9XCJtZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlPVwiZGF0ZXRpbWUtbG9jYWxcIlxuICAgICAgICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0U3RhcnREYXRlKGRheWpzKGU/LnRhcmdldD8udmFsdWUsIFwiWVlZWS1NTS1ERFRISDptbVwiKS50b0RhdGUoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU9e2RheWpzKHN0YXJ0RGF0ZSkuZm9ybWF0KFwiWVlZWS1NTS1ERFRISDptbVwiKX1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgICAgICA8Qm94IGZsZXg9ezF9IGFsaWduSXRlbXM9XCJmbGV4LXN0YXJ0XCI+XG4gICAgICAgICAgICAgICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPEJveD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8VGV4dEZpZWxkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsPVwiRHVyYXRpb24gKG1pbnV0ZXMpXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZT1cIm51bWJlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZTogeyB0YXJnZXQ6IHsgdmFsdWU6IHN0cmluZyB9IH0pID0+IHNldER1cmF0aW9uKHBhcnNlSW50KGU/LnRhcmdldD8udmFsdWUucmVwbGFjZSgvW14wLTkuXS9nLCAnJyksIDEwKSl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPXtgJHtkdXJhdGlvbn1gfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIjFcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgPEJveCBmbGV4PXsxfSAganVzdGlmeUNvbnRlbnQ9XCJjZW50ZXJcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCI+XG4gICAgICAgICAgICAgICAgICAgIDxCb3g+XG4gICAgICAgICAgICAgICAgICAgIDxCdXR0b24gb25DbGljaz17aGFuZGxlU3VibWl0fT5cbiAgICAgICAgICAgICAgICAgICAgICAgIFN1Ym1pdFxuICAgICAgICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzc05hbWU9XCJidG4gYnRuLWxpbmsgbm8tdW5kZXJsaW5lIGhvdmVyOm5vLXVuZGVybGluZVwiIG9uQ2xpY2s9e2Nsb3NlQWRkRm9sbG93VXB9PlxuICAgICAgICAgICAgICAgICAgICAgICAgQ2xvc2VcbiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgIDwvQm94PlxuICAgIClcbn1cblxuZXhwb3J0IGRlZmF1bHQgVXNlckFkZEZvbGxvd1VwXG5cblxuIl19