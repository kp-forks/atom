"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getServerSideProps = getServerSideProps;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const react_2 = require("@chakra-ui/react");
const Switch_1 = __importDefault(require("@components/Switch"));
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const supertokens_node_1 = __importDefault(require("supertokens-node"));
const backendConfig_1 = require("../../../config/backendConfig");
const session_1 = __importDefault(require("supertokens-node/recipe/session"));
async function getServerSideProps({ req, res }) {
    // Notice how the server uses `API` from `withSSRContext`, instead of the top-level `API`.
    // const SSR = withSSRContext({ req })
    // this runs on the backend, so we must call init on supertokens-node SDK
    supertokens_node_1.default.init((0, backendConfig_1.backendConfig)());
    let session;
    try {
        session = await session_1.default.getSession(req, res, {
            overrideGlobalClaimValidators: async function () {
                return [];
            },
        });
    }
    catch (err) {
        if (err.type === session_1.default.Error.TRY_REFRESH_TOKEN) {
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        else if (err.type === session_1.default.Error.UNAUTHORISED) {
            // this will force the frontend to try and refresh which will fail
            // clearing all cookies and redirecting the user to the login screen.
            return { props: { fromSupertokens: 'needs-refresh' } };
        }
        throw err;
    }
    if (!session?.getUserId()) {
        return {
            redirect: {
                destination: '/User/Login/UserLogin',
                permanent: false,
            },
        };
    }
    return {
        props: {
            sub: session.getUserId(),
        }
    };
}
function TrainEventBaseStep(props) {
    const [copyAvailability, setCopyAvailability] = (0, react_1.useState)(props?.copyAvailability ?? false);
    const [copyTimeBlocking, setCopyTimeBlocking] = (0, react_1.useState)(props?.copyTimeBlocking ?? false);
    const [copyTimePreference, setCopyTimePreference] = (0, react_1.useState)(props?.copyTimePreference ?? false);
    // const [enablePreferredTime, setEnablePreferredTime] = useState<boolean>(props?.enablePreferredTime ?? false)
    const [isMessage1, setIsMessage1] = (0, react_1.useState)(false);
    const [isMessage2, setIsMessage2] = (0, react_1.useState)(false);
    const setParentCopyAvailability = props?.setParentCopyAvailability;
    const setParentCopyTimeBlocking = props?.setParentCopyTimeBlocking;
    const setParentCopyTimePreference = props?.setParentCopyTimePreference;
    // const setParentEnablePreferredTime = props?.setParentEnablePreferredTime
    // console.log(props?.enablePreferredTime, '   props?.enablePreferredTime')
    const changeCopyAvailability = (value) => {
        setCopyAvailability(value);
        setParentCopyAvailability(value);
    };
    const changeCopyTimeBlocking = (value) => {
        setCopyTimeBlocking(value);
        setParentCopyTimeBlocking(value);
    };
    const changeCopyTimePreference = (value) => {
        setCopyTimePreference(value);
        setParentCopyTimePreference(value);
    };
    // const changeEnablePreferredTime = (value: boolean) => {
    //     setEnablePreferredTime(value)
    //     setParentEnablePreferredTime(value)
    // }
    return ((0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, justifyContent: "center", alignItems: "center", style: { width: '100%' }, children: [(0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, style: { width: '95%' }, p: { phone: 's', tablet: 'm' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", alignItems: "center", children: (0, jsx_runtime_1.jsx)(react_2.Tooltip, { hasArrow: true, label: 'Event availability shown in your calendar will be copied over to any new events whose details are similar to this one. Helpful for task events that are synced or created inside Atomic.', bg: 'purple.700', color: 'white', children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "buttonLink", children: "Copy over transparency of event to any new events whose details have similar context? (Hint)" }) }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: copyAvailability || props?.copyAvailability, onValueChange: changeCopyAvailability, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, style: { width: '95%' }, p: { phone: 's', tablet: 'm' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", alignItems: "center", children: (0, jsx_runtime_1.jsx)(react_2.Tooltip, { hasArrow: true, label: 'Blocked time for before and after the event will be copied over to new events whose details are similar to this one.', bg: 'purple.700', color: 'white', children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "buttonLink", children: "Copy over buffer times to any new events whose details have similar context? (Hint)" }) }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: copyTimeBlocking || props?.copyTimeBlocking, onValueChange: changeCopyTimeBlocking, style: { marginBottom: 20 } }) })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flex: 1, style: { width: '95%' }, p: { phone: 's', tablet: 'm' }, children: [(0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-start", alignItems: "center", children: (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "optionHeader", children: "Copy over time preference to any new events whose details have similar context for scheduling assists?" }) }), (0, jsx_runtime_1.jsx)(Box_1.default, { flexDirection: "row", justifyContent: "flex-end", pt: { phone: 'm', tablet: 's' }, children: (0, jsx_runtime_1.jsx)(Switch_1.default, { checked: copyTimePreference || props?.copyTimePreference, onValueChange: changeCopyTimePreference, style: { marginBottom: 20 } }) })] })] }));
}
exports.default = TrainEventBaseStep;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVHJhaW5FdmVudEJhc2VTdGVwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiVHJhaW5FdmVudEJhc2VTdGVwLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQWVBLGdEQXFDQzs7QUFwREQsaUNBSWM7QUFFZCw0Q0FBMEM7QUFDMUMsZ0VBQXdDO0FBQ3hDLGlFQUF3QztBQUN4QyxtRUFBMEM7QUFFMUMsd0VBQThDO0FBQzlDLGlFQUE2RDtBQUM3RCw4RUFBcUQ7QUFFOUMsS0FBSyxVQUFVLGtCQUFrQixDQUFDLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBaUQ7SUFDbEcsMEZBQTBGO0lBQzFGLHNDQUFzQztJQUN0Qyx5RUFBeUU7SUFDekUsMEJBQWUsQ0FBQyxJQUFJLENBQUMsSUFBQSw2QkFBYSxHQUFFLENBQUMsQ0FBQTtJQUNyQyxJQUFJLE9BQU8sQ0FBQTtJQUNYLElBQUksQ0FBQztRQUNILE9BQU8sR0FBRyxNQUFNLGlCQUFPLENBQUMsVUFBVSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUU7WUFDM0MsNkJBQTZCLEVBQUUsS0FBSztnQkFDbEMsT0FBTyxFQUFFLENBQUE7WUFDWCxDQUFDO1NBQ0YsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUFDLE9BQU8sR0FBUSxFQUFFLENBQUM7UUFDbEIsSUFBSSxHQUFHLENBQUMsSUFBSSxLQUFLLGlCQUFPLENBQUMsS0FBSyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDakQsT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFLGVBQWUsRUFBRSxlQUFlLEVBQUUsRUFBRSxDQUFBO1FBQ3hELENBQUM7YUFBTSxJQUFJLEdBQUcsQ0FBQyxJQUFJLEtBQUssaUJBQU8sQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDbkQsa0VBQWtFO1lBQ2xFLHFFQUFxRTtZQUNyRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEVBQUUsZUFBZSxFQUFFLGVBQWUsRUFBRSxFQUFFLENBQUE7UUFDeEQsQ0FBQztRQUNELE1B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Q0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsYUFDakUsdUJBQUMsYUFBRyxJQUFDLGFBQWEsRUFBQyxLQUFLLEVBQUMsY0FBYyxFQUFDLFlBQVksRUFBQyxVQUFVLEVBQUMsUUFBUSxZQUNwRSx1QkFBQyxjQUFJLElBQUMsT0FBTyxFQUFDLGNBQWMsdUhBQThHLEdBQ3hJLEVBQ04sdUJBQUMsYUFBRyxJQUFDLGFBQWEsRUFBQyxLQUFLLEVBQUMsY0FBYyxFQUFDLFVBQVUsRUFBQyxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsWUFDOUUsdUJBQUMsZ0JBQU8sSUFDSixPQUFPLEVBQUUsa0JBQWtCLElBQUksS0FBSyxFQUFFLGtCQUFrQixFQUN4RCxhQUFhLEVBQUUsd0JBQXdCLEVBQ3ZDLEtBQUssRUFBRSxFQUFFLFlBQVksRUFBRSxFQUFFLEVBQUUsR0FDN0IsR0FDQSxJQUNKLElBQ0osQ0FDVCxDQUFBO0FBQ0wsQ0FBQztBQUVELGtCQUFlLGtCQUFrQixDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7XG4gIHVzZVN0YXRlLFxuICBEaXNwYXRjaCxcbiAgU2V0U3RhdGVBY3Rpb24sXG59IGZyb20gJ3JlYWN0J1xuXG5pbXBvcnQgeyBUb29sdGlwIH0gZnJvbSAnQGNoYWtyYS11aS9yZWFjdCdcbmltcG9ydCBTd2l0Y2gxIGZyb20gJ0Bjb21wb25lbnRzL1N3aXRjaCdcbmltcG9ydCBCb3ggZnJvbSAnQGNvbXBvbmVudHMvY29tbW9uL0JveCdcbmltcG9ydCBUZXh0IGZyb20gJ0Bjb21wb25lbnRzL2NvbW1vbi9UZXh0J1xuaW1wb3J0IHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xuaW1wb3J0IHN1cGVydG9rZW5zTm9kZSBmcm9tICdzdXBlcnRva2Vucy1ub2RlJ1xuaW1wb3J0IHsgYmFja2VuZENvbmZpZyB9IGZyb20gJy4uLy4uLy4uL2NvbmZpZy9iYWNrZW5kQ29uZmlnJ1xuaW1wb3J0IFNlc3Npb24gZnJvbSAnc3VwZXJ0b2tlbnMtbm9kZS9yZWNpcGUvc2Vzc2lvbidcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNlcnZlclNpZGVQcm9wcyh7IHJlcSwgcmVzIH06IHsgcmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UgfSkge1xuICAvLyBOb3RpY2UgaG93IHRoZSBzZXJ2ZXIgdXNlcyBgQVBJYCBmcm9tIGB3aXRoU1NSQ29udGV4dGAsIGluc3RlYWQgb2YgdGhlIHRvcC1sZXZlbCBgQVBJYC5cbiAgLy8gY29uc3QgU1NSID0gd2l0aFNTUkNvbnRleHQoeyByZXEgfSlcbiAgLy8gdGhpcyBydW5zIG9uIHRoZSBiYWNrZW5kLCBzbyB3ZSBtdXN0IGNhbGwgaW5pdCBvbiBzdXBlcnRva2Vucy1ub2RlIFNES1xuICBzdXBlcnRva2Vuc05vZGUuaW5pdChiYWNrZW5kQ29uZmlnKCkpXG4gIGxldCBzZXNzaW9uXG4gIHRyeSB7XG4gICAgc2Vzc2lvbiA9IGF3YWl0IFNlc3Npb24uZ2V0U2Vzc2lvbihyZXEsIHJlcywge1xuICAgICAgb3ZlcnJpZGVHbG9iYWxDbGFpbVZhbGlkYXRvcnM6IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIFtdXG4gICAgICB9LFxuICAgIH0pXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgaWYgKGVyci50eXBlID09PSBTZXNzaW9uLkVycm9yLlRSWV9SRUZSRVNIX1RPS0VOKSB7XG4gICAgICByZXR1cm4geyBwcm9wczogeyBmcm9tU3VwZXJ0b2tlbnM6ICduZWVkcy1yZWZyZXNoJyB9IH1cbiAgICB9IGVsc2UgaWYgKGVyci50eXBlID09PSBTZXNzaW9uLkVycm9yLlVOQVVUSE9SSVNFRCkge1xuICAgICAgLy8gdGhpcyB3aWxsIGZvcmNlIHRoZSBmcm9udGVuZCB0byB0cnkgYW5kIHJlZnJlc2ggd2hpY2ggd2lsbCBmYWlsXG4gICAgICAvLyBjbGVhcmluZyBhbGwgY29va2llcyBhbmQgcmVkaXJlY3RpbmcgdGhlIHVzZXIgdG8gdGhlIGxvZ2luIHNjcmVlbi5cbiAgICAgIHJldHVybiB7IHByb3BzOiB7IGZyb21TdXBlcnRva2VuczogJ25lZWRzLXJlZnJlc2gnIH0gfVxuICAgIH1cbiAgICB0aHJvdyBlcnJcbiAgfVxuXG4gIGlmICghc2Vzc2lvbj8uZ2V0VXNlcklkKCkpIHtcbiAgICByZXR1cm4ge1xuICAgICAgcmVkaXJlY3Q6IHtcbiAgICAgICAgZGVzdGluYXRpb246ICcvVXNlci9Mb2dpbi9Vc2VyTG9naW4nLFxuICAgICAgICBwZXJtYW5lbnQ6IGZhbHNlLFxuICAgICAgfSxcbiAgICB9XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHByb3BzOiB7XG4gICAgICBzdWI6IHNlc3Npb24uZ2V0VXNlcklkKCksXG4gICAgfVxuICB9XG59XG5cbnR5cGUgUHJvcHMgPSB7XG4gICAgY29weUF2YWlsYWJpbGl0eTogYm9vbGVhbixcbiAgICBzZXRQYXJlbnRDb3B5QXZhaWxhYmlsaXR5OiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxib29sZWFuPj4sXG4gICAgY29weVRpbWVCbG9ja2luZzogYm9vbGVhbixcbiAgICBzZXRQYXJlbnRDb3B5VGltZUJsb2NraW5nOiBEaXNwYXRjaDxTZXRTdGF0ZUFjdGlvbjxib29sZWFuPj4sXG4gICAgY29weVRpbWVQcmVmZXJlbmNlOiBib29sZWFuLFxuICAgIHNldFBhcmVudENvcHlUaW1lUHJlZmVyZW5jZTogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248Ym9vbGVhbj4+LFxuICAgIC8vIGVuYWJsZVByZWZlcnJlZFRpbWU6IGJvb2xlYW4sXG4gICAgLy8gc2V0UGFyZW50RW5hYmxlUHJlZmVycmVkVGltZTogRGlzcGF0Y2g8U2V0U3RhdGVBY3Rpb248Ym9vbGVhbj4+LFxufVxuXG5mdW5jdGlvbiBUcmFpbkV2ZW50QmFzZVN0ZXAocHJvcHM6IFByb3BzKSB7XG4gICAgY29uc3QgW2NvcHlBdmFpbGFiaWxpdHksIHNldENvcHlBdmFpbGFiaWxpdHldID0gdXNlU3RhdGU8Ym9vbGVhbj4ocHJvcHM/LmNvcHlBdmFpbGFiaWxpdHkgPz8gZmFsc2UpXG4gICAgY29uc3QgW2NvcHlUaW1lQmxvY2tpbmcsIHNldENvcHlUaW1lQmxvY2tpbmddID0gdXNlU3RhdGU8Ym9vbGVhbj4ocHJvcHM/LmNvcHlUaW1lQmxvY2tpbmcgPz8gZmFsc2UpXG4gICAgY29uc3QgW2NvcHlUaW1lUHJlZmVyZW5jZSwgc2V0Q29weVRpbWVQcmVmZXJlbmNlXSA9IHVzZVN0YXRlPGJvb2xlYW4+KHByb3BzPy5jb3B5VGltZVByZWZlcmVuY2UgPz8gZmFsc2UpXG4gICAgLy8gY29uc3QgW2VuYWJsZVByZWZlcnJlZFRpbWUsIHNldEVuYWJsZVByZWZlcnJlZFRpbWVdID0gdXNlU3RhdGU8Ym9vbGVhbj4ocHJvcHM/LmVuYWJsZVByZWZlcnJlZFRpbWUgPz8gZmFsc2UpXG4gICAgY29uc3QgW2lzTWVzc2FnZTEsIHNldElzTWVzc2FnZTFdID0gdXNlU3RhdGU8Ym9vbGVhbj4oZmFsc2UpXG4gICAgY29uc3QgW2lzTWVzc2FnZTIsIHNldElzTWVzc2FnZTJdID0gdXNlU3RhdGU8Ym9vbGVhbj4oZmFsc2UpXG5cbiAgICBjb25zdCBzZXRQYXJlbnRDb3B5QXZhaWxhYmlsaXR5ID0gcHJvcHM/LnNldFBhcmVudENvcHlBdmFpbGFiaWxpdHlcbiAgICBjb25zdCBzZXRQYXJlbnRDb3B5VGltZUJsb2NraW5nID0gcHJvcHM/LnNldFBhcmVudENvcHlUaW1lQmxvY2tpbmdcbiAgICBjb25zdCBzZXRQYXJlbnRDb3B5VGltZVByZWZlcmVuY2UgPSBwcm9wcz8uc2V0UGFyZW50Q29weVRpbWVQcmVmZXJlbmNlXG4gICAgLy8gY29uc3Qgc2V0UGFyZW50RW5hYmxlUHJlZmVycmVkVGltZSA9IHByb3BzPy5zZXRQYXJlbnRFbmFibGVQcmVmZXJyZWRUaW1lXG5cbiAgICAvLyBjb25zb2xlLmxvZyhwcm9wcz8uZW5hYmxlUHJlZmVycmVkVGltZSwgJyAgIHByb3BzPy5lbmFibGVQcmVmZXJyZWRUaW1lJylcblxuICAgIGNvbnN0IGNoYW5nZUNvcHlBdmFpbGFiaWxpdHkgPSAodmFsdWU6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgc2V0Q29weUF2YWlsYWJpbGl0eSh2YWx1ZSlcbiAgICAgICAgc2V0UGFyZW50Q29weUF2YWlsYWJpbGl0eSh2YWx1ZSlcbiAgICB9XG5cbiAgICBjb25zdCBjaGFuZ2VDb3B5VGltZUJsb2NraW5nID0gKHZhbHVlOiBib29sZWFuKSA9PiB7XG4gICAgICAgIHNldENvcHlUaW1lQmxvY2tpbmcodmFsdWUpXG4gICAgICAgIHNldFBhcmVudENvcHlUaW1lQmxvY2tpbmcodmFsdWUpXG4gICAgfVxuXG4gICAgY29uc3QgY2hhbmdlQ29weVRpbWVQcmVmZXJlbmNlID0gKHZhbHVlOiBib29sZWFuKSA9PiB7XG4gICAgICAgIHNldENvcHlUaW1lUHJlZmVyZW5jZSh2YWx1ZSlcbiAgICAgICAgc2V0UGFyZW50Q29weVRpbWVQcmVmZXJlbmNlKHZhbHVlKVxuICAgIH1cblxuICAgIC8vIGNvbnN0IGNoYW5nZUVuYWJsZVByZWZlcnJlZFRpbWUgPSAodmFsdWU6IGJvb2xlYW4pID0+IHtcbiAgICAvLyAgICAgc2V0RW5hYmxlUHJlZmVycmVkVGltZSh2YWx1ZSlcbiAgICAvLyAgICAgc2V0UGFyZW50RW5hYmxlUHJlZmVycmVkVGltZSh2YWx1ZSlcbiAgICAvLyB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgICA8Qm94IGZsZXg9ezF9IGp1c3RpZnlDb250ZW50PVwiY2VudGVyXCIgYWxpZ25JdGVtcz1cImNlbnRlclwiIHN0eWxlPXt7IHdpZHRoOiAnMTAwJSd9fT5cbiAgICAgICAgICAgIDxCb3ggZmxleD17MX0gc3R5bGU9e3sgd2lkdGg6ICc5NSUnIH19IHA9e3sgcGhvbmU6ICdzJywgdGFibGV0OiAnbScgfX0+XG4gICAgICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LXN0YXJ0XCIgYWxpZ25JdGVtcz1cImNlbnRlclwiPlxuXG4gICAgICAgICAgICAgICAgICAgIDxUb29sdGlwIGhhc0Fycm93IGxhYmVsPSdFdmVudCBhdmFpbGFiaWxpdHkgc2hvd24gaW4geW91ciBjYWxlbmRhciB3aWxsIGJlIGNvcGllZCBvdmVyIHRvIGFueSBuZXcgZXZlbnRzIHdob3NlIGRldGFpbHMgYXJlIHNpbWlsYXIgdG8gdGhpcyBvbmUuIEhlbHBmdWwgZm9yIHRhc2sgZXZlbnRzIHRoYXQgYXJlIHN5bmNlZCBvciBjcmVhdGVkIGluc2lkZSBBdG9taWMuJyBiZz0ncHVycGxlLjcwMCcgY29sb3I9J3doaXRlJz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJidXR0b25MaW5rXCI+Q29weSBvdmVyIHRyYW5zcGFyZW5jeSBvZiBldmVudCB0byBhbnkgbmV3IGV2ZW50cyB3aG9zZSBkZXRhaWxzIGhhdmUgc2ltaWxhciBjb250ZXh0PyAoSGludCk8L1RleHQ+XG4gICAgICAgICAgICAgICAgICAgIDwvVG9vbHRpcD5cblxuICAgICAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgICAgIDxCb3ggZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwiZmxleC1lbmRcIiBwdD17eyBwaG9uZTogJ20nLCB0YWJsZXQ6ICdzJyB9fT5cbiAgICAgICAgICAgICAgICAgICAgPFN3aXRjaDFcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZWQ9e2NvcHlBdmFpbGFiaWxpdHkgfHwgcHJvcHM/LmNvcHlBdmFpbGFiaWxpdHl9XG4gICAgICAgICAgICAgICAgICAgICAgICBvblZhbHVlQ2hhbmdlPXtjaGFuZ2VDb3B5QXZhaWxhYmlsaXR5fVxuICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9e3ttYXJnaW5Cb3R0b206IDIwfX1cbiAgICAgICAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgIDwvQm94PlxuICAgICAgICAgICAgPEJveCBmbGV4PXsxfSBzdHlsZT17eyB3aWR0aDogJzk1JScgfX0gcD17eyBwaG9uZTogJ3MnLCB0YWJsZXQ6ICdtJyB9fT5cbiAgICAgICAgICAgICAgICA8Qm94IGZsZXhEaXJlY3Rpb249XCJyb3dcIiBqdXN0aWZ5Q29udGVudD1cImZsZXgtc3RhcnRcIiBhbGlnbkl0ZW1zPVwiY2VudGVyXCI+XG4gICAgICAgICAgICAgICAgICAgIDxUb29sdGlwIGhhc0Fycm93IGxhYmVsPSdCbG9ja2VkIHRpbWUgZm9yIGJlZm9yZSBhbmQgYWZ0ZXIgdGhlIGV2ZW50IHdpbGwgYmUgY29waWVkIG92ZXIgdG8gbmV3IGV2ZW50cyB3aG9zZSBkZXRhaWxzIGFyZSBzaW1pbGFyIHRvIHRoaXMgb25lLicgYmc9J3B1cnBsZS43MDAnIGNvbG9yPSd3aGl0ZSc+XG4gICAgICAgICAgICAgICAgICAgICAgICA8VGV4dCB2YXJpYW50PVwiYnV0dG9uTGlua1wiPkNvcHkgb3ZlciBidWZmZXIgdGltZXMgdG8gYW55IG5ldyBldmVudHMgd2hvc2UgZGV0YWlscyBoYXZlIHNpbWlsYXIgY29udGV4dD8gKEhpbnQpPC9UZXh0PlxuICAgICAgICAgICAgICAgICAgICA8L1Rvb2x0aXA+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LWVuZFwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19PlxuICAgICAgICAgICAgICAgICAgICA8U3dpdGNoMVxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17Y29weVRpbWVCbG9ja2luZyB8fCBwcm9wcz8uY29weVRpbWVCbG9ja2luZ31cbiAgICAgICAgICAgICAgICAgICAgICAgIG9uVmFsdWVDaGFuZ2U9e2NoYW5nZUNvcHlUaW1lQmxvY2tpbmd9XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17eyBtYXJnaW5Cb3R0b206IDIwIH19XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgICAgIDxCb3ggZmxleD17MX0gc3R5bGU9e3sgd2lkdGg6ICc5NSUnIH19IHA9e3sgcGhvbmU6ICdzJywgdGFibGV0OiAnbScgfX0+XG4gICAgICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LXN0YXJ0XCIgYWxpZ25JdGVtcz1cImNlbnRlclwiPiAgXG4gICAgICAgICAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJvcHRpb25IZWFkZXJcIj5Db3B5IG92ZXIgdGltZSBwcmVmZXJlbmNlIHRvIGFueSBuZXcgZXZlbnRzIHdob3NlIGRldGFpbHMgaGF2ZSBzaW1pbGFyIGNvbnRleHQgZm9yIHNjaGVkdWxpbmcgYXNzaXN0cz88L1RleHQ+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICAgICAgPEJveCBmbGV4RGlyZWN0aW9uPVwicm93XCIganVzdGlmeUNvbnRlbnQ9XCJmbGV4LWVuZFwiIHB0PXt7IHBob25lOiAnbScsIHRhYmxldDogJ3MnIH19PlxuICAgICAgICAgICAgICAgICAgICA8U3dpdGNoMVxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tlZD17Y29weVRpbWVQcmVmZXJlbmNlIHx8IHByb3BzPy5jb3B5VGltZVByZWZlcmVuY2V9XG4gICAgICAgICAgICAgICAgICAgICAgICBvblZhbHVlQ2hhbmdlPXtjaGFuZ2VDb3B5VGltZVByZWZlcmVuY2V9XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17eyBtYXJnaW5Cb3R0b206IDIwIH19XG4gICAgICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPC9Cb3g+XG4gICAgICAgICAgICA8L0JveD5cbiAgICAgICAgPC9Cb3g+XG4gICAgKVxufVxuXG5leHBvcnQgZGVmYXVsdCBUcmFpbkV2ZW50QmFzZVN0ZXAiXX0=