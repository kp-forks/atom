"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const api_backend_helper_1 = require("../api-backend-helper");
const constants_1 = require("../constants");
const got_1 = __importDefault(require("got"));
const logger_1 = require("../logger"); // Import the actual logger
// Mock 'got'
jest.mock('got');
// Spy on the logger methods
jest.mock('../logger', () => ({
    appServiceLogger: {
        info: jest.fn(),
        warn: jest.fn(),
        error: jest.fn(),
        debug: jest.fn(),
        fatal: jest.fn(), // Ensure all used methods are mocked
    },
}));
const mockedGot = got_1.default;
const mockedLogger = logger_1.appServiceLogger;
describe('api-backend-helper', () => {
    // Reset mocks before each test in the suite
    beforeEach(() => {
        mockedGot.post.mockReset();
        mockedGot.get.mockReset(); // If other methods are used by resilientGot
        // Reset all logger spies
        Object.values(mockedLogger).forEach((mockFn) => mockFn.mockReset());
    });
    describe('scheduleMeeting (testing resilientGot indirectly)', () => {
        const mockPayload = {
            participantNames: ['Alice', 'Bob'],
            durationMinutes: 30,
            preferredDate: '2024-07-25',
            preferredStartTimeFrom: '10:00:00',
            preferredStartTimeTo: '11:00:00',
        };
        const expectedUrl = `${constants_1.SCHEDULER_API_URL}/timeTable/user/scheduleMeeting`;
        const operationName = 'scheduleMeeting'; // As used in the main code
        // No longer need beforeEach for mockGot.post.mockClear() as it's in the global beforeEach
        it('should succeed on the first attempt, calling resilientGot correctly', async () => {
            const mockApiResponse = { meetingId: '123', status: 'SCHEDULED' };
            mockedGot.post.mockResolvedValueOnce({ body: mockApiResponse }); // resilientGot expects response.body
            const result = await (0, api_backend_helper_1.scheduleMeeting)(mockPayload);
            expect(result).toEqual(mockApiResponse);
            expect(mockedGot.post).toHaveBeenCalledTimes(1);
            expect(mockedGot.post).toHaveBeenCalledWith(expectedUrl, expect.objectContaining({
                json: mockPayload,
                timeout: { request: 15000 }, // Default from resilientGot
                retry: { limit: 0 }, // resilientGot handles retries
                responseType: 'json',
                headers: { 'Content-Type': 'application/json' },
            }));
            expect(mockedLogger.info).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Called.`), expect.anything());
            expect(mockedLogger.info).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Attempt 1/3 - POST ${expectedUrl}`), expect.anything());
            expect(mockedLogger.info).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Attempt 1 successful.`), expect.anything());
            expect(mockedLogger.info).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Successfully scheduled meeting.`), expect.anything());
        });
        it('should succeed on the second attempt after a 503 error', async () => {
            const mockApiResponse = { meetingId: '123', status: 'SCHEDULED' };
            mockedGot.post
                .mockRejectedValueOnce({
                response: { statusCode: 503 },
                message: 'Service Unavailable',
                isGotError: true,
            })
                .mockResolvedValueOnce({ body: mockApiResponse });
            const result = await (0, api_backend_helper_1.scheduleMeeting)(mockPayload);
            expect(result).toEqual(mockApiResponse);
            expect(mockedGot.post).toHaveBeenCalledTimes(2);
            expect(mockedLogger.warn).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}_SchedulerAPI] Attempt 1/3 failed.`), expect.anything()); // resilientGot's internal opName
            expect(mockedLogger.info).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}_SchedulerAPI] Waiting 1000ms before retry 2/3.`), expect.anything());
            expect(mockedLogger.info).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Successfully scheduled meeting.`), expect.anything());
        });
        it('should fail after all retries for persistent 500 errors', async () => {
            mockedGot.post.mockRejectedValue({
                response: { statusCode: 500 },
                message: 'Internal Server Error',
                isGotError: true,
            });
            await expect((0, api_backend_helper_1.scheduleMeeting)(mockPayload)).rejects.toThrow('Internal Server Error');
            expect(mockedGot.post).toHaveBeenCalledTimes(3);
            expect(mockedLogger.error).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}_SchedulerAPI] Failed after 3 attempts.`), expect.anything()); // resilientGot log
            expect(mockedLogger.error).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Error calling scheduleMeeting API.`), expect.anything()); // scheduleMeeting log
        });
        it('should fail immediately on a non-retryable 400 error from resilientGot', async () => {
            const apiError = {
                response: {
                    statusCode: 400,
                    body: JSON.stringify({ message: 'Invalid participants' }),
                },
                message: 'Bad Request',
                isGotError: true,
            };
            mockedGot.post.mockRejectedValueOnce(apiError);
            await expect((0, api_backend_helper_1.scheduleMeeting)(mockPayload)).rejects.toThrow('API Error from scheduleMeeting_SchedulerAPI: Invalid participants');
            expect(mockedGot.post).toHaveBeenCalledTimes(1);
            expect(mockedLogger.error).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}_SchedulerAPI] Non-retryable error encountered. Aborting retries.`), expect.anything());
            expect(mockedLogger.error).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Error calling scheduleMeeting API.`), expect.anything());
        });
        it('should handle timeout from resilientGot (ETIMEDOUT)', async () => {
            const mockApiResponse = { meetingId: '123', status: 'SCHEDULED' };
            mockedGot.post
                .mockRejectedValueOnce({
                code: 'ETIMEDOUT',
                message: 'Connection timed out',
                isGotError: true,
            })
                .mockResolvedValueOnce({ body: mockApiResponse });
            const result = await (0, api_backend_helper_1.scheduleMeeting)(mockPayload);
            expect(result).toEqual(mockApiResponse);
            expect(mockedGot.post).toHaveBeenCalledTimes(2);
            expect(mockedLogger.warn).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}_SchedulerAPI] Attempt 1/3 failed.`), expect.objectContaining({ errorCode: 'ETIMEDOUT' }));
        });
        // Test the specific error message construction in scheduleMeeting's catch block
        it('should throw correctly structured error when resilientGot rethrows a got error with JSON body', async () => {
            const errorBody = { message: 'Specific API error message' };
            const gotError = {
                response: {
                    statusCode: 422,
                    body: JSON.stringify(errorBody),
                },
                message: 'Request failed with status code 422',
                isGotError: true,
            };
            mockedGot.post.mockRejectedValueOnce(gotError);
            await expect((0, api_backend_helper_1.scheduleMeeting)(mockPayload)).rejects.toThrow(`API Error from ${operationName}_SchedulerAPI: Specific API error message`);
        });
        it('should throw correctly structured error when resilientGot rethrows a got error with non-JSON body', async () => {
            const errorBodyText = 'A plain text error from server';
            const gotError = {
                response: {
                    statusCode: 503,
                    body: errorBodyText,
                },
                message: 'Service unavailable',
                isGotError: true,
            };
            // resilientGot will retry 503s, so make all attempts fail
            mockedGot.post.mockRejectedValue(gotError);
            await expect((0, api_backend_helper_1.scheduleMeeting)(mockPayload)).rejects.toThrow(`API Error from ${operationName}_SchedulerAPI: ${errorBodyText}`);
        });
    });
    describe('exchangeCodeForTokens', () => {
        const mockCode = 'auth-code-123';
        const mockTokens = {
            access_token: 'acc_token',
            refresh_token: 'ref_token',
            expiry_date: Date.now() + 3600000,
        };
        // Mock the googleapis auth client
        const mockGetToken = jest.fn();
        // Original: const oauth2Client = new google.auth.OAuth2(...)
        // We need to mock the globally instantiated oauth2Client or google.auth.OAuth2 itself.
        // For simplicity, let's assume we can mock the instance's method used in the actual code.
        // This requires careful setup if the instance is created at module scope.
        // A common way is to mock the 'googleapis' module.
        let originalGoogleAuth;
        beforeAll(() => {
            originalGoogleAuth = jest.requireActual('googleapis').google.auth;
            const { google } = jest.requireActual('googleapis');
            google.auth = {
                OAuth2: jest.fn(() => ({
                    getToken: mockGetToken,
                    setCredentials: jest.fn(), // Mock this if it's called
                    generateAuthUrl: jest.fn(), // Mock this if it's called by other tested funcs
                })),
            };
            // This re-imports with the google.auth mocked.
            // It's a bit tricky; ensure api-backend-helper uses this mocked version.
            // Alternative: Directly mock the oauth2Client instance if it's exported or accessible.
        });
        afterAll(() => {
            // Restore original googleapis auth
            const { google } = jest.requireActual('googleapis');
            google.auth = originalGoogleAuth;
        });
        beforeEach(() => {
            mockGetToken.mockReset();
        });
        it('should exchange code for tokens successfully and log info', async () => {
            mockGetToken.mockResolvedValueOnce({ tokens: mockTokens });
            const { exchangeCodeForTokens: exchangeCodeFunc, } = require('../api-backend-helper'); // Re-require to get potentially mocked version
            const result = await exchangeCodeFunc(mockCode);
            expect(result).toEqual(mockTokens);
            expect(mockGetToken).toHaveBeenCalledWith(mockCode);
            expect(mockedLogger.info).toHaveBeenCalledWith('[exchangeCodeForTokens] Successfully exchanged code for tokens.', expect.objectContaining({ codePrefix: mockCode.substring(0, 10) }));
        });
        it('should log error and re-throw if token exchange fails', async () => {
            const error = new Error('Exchange failed');
            mockGetToken.mockRejectedValueOnce(error);
            const { exchangeCodeForTokens: exchangeCodeFunc, } = require('../api-backend-helper');
            await expect(exchangeCodeFunc(mockCode)).rejects.toThrow('Exchange failed');
            expect(mockGetToken).toHaveBeenCalledWith(mockCode);
            expect(mockedLogger.error).toHaveBeenCalledWith('[exchangeCodeForTokens] Unable to exchange code for tokens.', expect.objectContaining({ error: error.message }));
        });
    });
    // Add tests for getMinimalCalendarIntegrationByResource (as another resilientGot consumer)
    describe('getMinimalCalendarIntegrationByResource (testing resilientGot for Hasura)', () => {
        const userId = 'test-user-hasura';
        const resource = 'google_calendar';
        const operationName = 'getCalendarIntegration'; // Internal operation name
        const mockIntegration = {
            id: 'integ-1',
            resource: 'google_calendar',
            token: 'token',
        };
        it('should fetch integration successfully using resilientGot', async () => {
            mockedGot.post.mockResolvedValueOnce({
                body: { data: { Calendar_Integration: [mockIntegration] } },
            });
            const { getMinimalCalendarIntegrationByResource: getIntegFunc, } = require('../api-backend-helper');
            const result = await getIntegFunc(userId, resource);
            expect(result).toEqual(mockIntegration);
            expect(mockedGot.post).toHaveBeenCalledTimes(1);
            expect(mockedGot.post).toHaveBeenCalledWith(hasuraGraphUrl, expect.objectContaining({
                json: expect.objectContaining({ operationName }),
            }));
            expect(mockedLogger.info).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Attempt 1/3`), expect.anything());
        });
        it('should return undefined and log info if no integration found', async () => {
            mockedGot.post.mockResolvedValueOnce({
                body: { data: { Calendar_Integration: [] } },
            });
            const { getMinimalCalendarIntegrationByResource: getIntegFunc, } = require('../api-backend-helper');
            const result = await getIntegFunc(userId, resource);
            expect(result).toBeUndefined();
            expect(mockedLogger.info).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] No integration found`), expect.anything());
        });
        it('should re-throw error from resilientGot if Hasura call fails after retries', async () => {
            mockedGot.post.mockRejectedValue(new Error('Hasura down')); // All attempts fail
            const { getMinimalCalendarIntegrationByResource: getIntegFunc, } = require('../api-backend-helper');
            await expect(getIntegFunc(userId, resource)).rejects.toThrow('Hasura down');
            expect(mockedLogger.error).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Failed after 3 attempts`), expect.anything()); // from resilientGot
            expect(mockedLogger.error).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Unable to get calendar integration.`), expect.anything()); // from getMinimalCalendarIntegrationByResource
        });
    });
    describe('refreshGoogleToken (atomic-web path using resilientGot)', () => {
        const refreshToken = 'google-refresh-token';
        const clientType = 'atomic-web';
        const operationName = 'refreshGoogleToken'; // As used in the main code for this specific call path
        const mockGoogleSuccessResponse = {
            access_token: 'new_google_token',
            expires_in: 3599,
            scope: 'test_scope',
            token_type: 'Bearer',
        };
        const googleTokenUrl = 'https://oauth2.googleapis.com/token'; // from constants
        it('should refresh token successfully via resilientGot for atomic-web', async () => {
            mockedGot.post.mockResolvedValueOnce({
                body: mockGoogleSuccessResponse,
            });
            const { refreshGoogleToken: refreshFunc, } = require('../api-backend-helper');
            const result = await refreshFunc(refreshToken, clientType);
            expect(result).toEqual(mockGoogleSuccessResponse);
            expect(mockedGot.post).toHaveBeenCalledTimes(1);
            expect(mockedGot.post).toHaveBeenCalledWith(googleTokenUrl, expect.objectContaining({
                form: expect.objectContaining({
                    grant_type: 'refresh_token',
                    refresh_token: refreshToken,
                }),
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                responseType: 'json',
            }));
            expect(mockedLogger.info).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Called.`), { clientType });
            expect(mockedLogger.info).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Attempt 1/3`), expect.anything()); // from resilientGot
            expect(mockedLogger.info).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Token refresh successful for clientType: ${clientType}.`), expect.anything());
        });
        it('should retry and succeed for atomic-web if resilientGot handles retryable error', async () => {
            mockedGot.post
                .mockRejectedValueOnce({
                response: { statusCode: 500 },
                message: 'Server Error',
                isGotError: true,
            })
                .mockResolvedValueOnce({ body: mockGoogleSuccessResponse });
            const { refreshGoogleToken: refreshFunc, } = require('../api-backend-helper');
            const result = await refreshFunc(refreshToken, clientType);
            expect(result).toEqual(mockGoogleSuccessResponse);
            expect(mockedGot.post).toHaveBeenCalledTimes(2);
            expect(mockedLogger.warn).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Attempt 1/3 failed.`), expect.anything()); // from resilientGot
        });
        it('should throw error if resilientGot fails after all retries for atomic-web', async () => {
            mockedGot.post.mockRejectedValue(new Error('Token endpoint down'));
            const { refreshGoogleToken: refreshFunc, } = require('../api-backend-helper');
            await expect(refreshFunc(refreshToken, clientType)).rejects.toThrow('Token endpoint down');
            expect(mockedGot.post).toHaveBeenCalledTimes(3);
            expect(mockedLogger.error).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Failed after 3 attempts`), expect.anything()); // from resilientGot
            expect(mockedLogger.error).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Unable to refresh Google token.`), expect.anything()); // from refreshGoogleToken
        });
        it('should return undefined if clientType is not atomic-web and not configured for got', async () => {
            const { refreshGoogleToken: refreshFunc, } = require('../api-backend-helper');
            const result = await refreshFunc(refreshToken, 'web'); // 'web' is not configured for direct got call in this func
            expect(result).toBeUndefined();
            expect(mockedLogger.warn).toHaveBeenCalledWith(expect.stringContaining(`[${operationName}] Client type 'web' not configured for direct got-based token refresh in this function.`));
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLWJhY2tlbmQtaGVscGVyLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhcGktYmFja2VuZC1oZWxwZXIudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLDhEQUF3RDtBQUV4RCw0Q0FBaUQ7QUFDakQsOENBQXNCO0FBQ3RCLHNDQUE2QyxDQUFDLDJCQUEyQjtBQUV6RSxhQUFhO0FBQ2IsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNqQiw0QkFBNEI7QUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUM1QixnQkFBZ0IsRUFBRTtRQUNoQixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2YsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDaEIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDaEIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRSxxQ0FBcUM7S0FDeEQ7Q0FDRixDQUFDLENBQUMsQ0FBQztBQUVKLE1BQU0sU0FBUyxHQUFHLGFBQThCLENBQUM7QUFDakQsTUFBTSxZQUFZLEdBQUcseUJBQXdELENBQUM7QUFFOUUsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNsQyw0Q0FBNEM7SUFDNUMsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLFNBQVMsQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDM0IsU0FBUyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLDRDQUE0QztRQUN2RSx5QkFBeUI7UUFDekIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxD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TSxDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDL0IsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxvQkFBb0IsQ0FDNUMsTUFBTSxDQUFDLGdCQUFnQixDQUNyQixJQUFJLGFBQWEseUZBQXlGLENBQzNHLENBQ0YsQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHNjaGVkdWxlTWVldGluZyB9IGZyb20gJy4uL2FwaS1iYWNrZW5kLWhlbHBlcic7XG5pbXBvcnQgeyBTY2hlZHVsZU1lZXRpbmdSZXF1ZXN0VHlwZSB9IGZyb20gJy4uL2RhdGFUeXBlcy9TY2hlZHVsZU1lZXRpbmdSZXF1ZXN0VHlwZSc7XG5pbXBvcnQgeyBTQ0hFRFVMRVJfQVBJX1VSTCB9IGZyb20gJy4uL2NvbnN0YW50cyc7XG5pbXBvcnQgZ290IGZyb20gJ2dvdCc7XG5pbXBvcnQgeyBhcHBTZXJ2aWNlTG9nZ2VyIH0gZnJvbSAnLi4vbG9nZ2VyJzsgLy8gSW1wb3J0IHRoZSBhY3R1YWwgbG9nZ2VyXG5cbi8vIE1vY2sgJ2dvdCdcbmplc3QubW9jaygnZ290Jyk7XG4vLyBTcHkgb24gdGhlIGxvZ2dlciBtZXRob2RzXG5qZXN0Lm1vY2soJy4uL2xvZ2dlcicsICgpID0+ICh7XG4gIGFwcFNlcnZpY2VMb2dnZXI6IHtcbiAgICBpbmZvOiBqZXN0LmZuKCksXG4gICAgd2FybjogamVzdC5mbigpLFxuICAgIGVycm9yOiBqZXN0LmZuKCksXG4gICAgZGVidWc6IGplc3QuZm4oKSxcbiAgICBmYXRhbDogamVzdC5mbigpLCAvLyBFbnN1cmUgYWxsIHVzZWQgbWV0aG9kcyBhcmUgbW9ja2VkXG4gIH0sXG59KSk7XG5cbmNvbnN0IG1vY2tlZEdvdCA9IGdvdCBhcyBqZXN0Lk1vY2tlZDx0eXBlb2YgZ290PjtcbmNvbnN0IG1vY2tlZExvZ2dlciA9IGFwcFNlcnZpY2VMb2dnZXIgYXMgamVzdC5Nb2NrZWQ8dHlwZW9mIGFwcFNlcnZpY2VMb2dnZXI+O1xuXG5kZXNjcmliZSgnYXBpLWJhY2tlbmQtaGVscGVyJywgKCkgPT4ge1xuICAvLyBSZXNldCBtb2NrcyBiZWZvcmUgZWFjaCB0ZXN0IGluIHRoZSBzdWl0ZVxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBtb2NrZWRHb3QucG9zdC5tb2NrUmVzZXQoKTtcbiAgICBtb2NrZWRHb3QuZ2V0Lm1vY2tSZXNldCgpOyAvLyBJZiBvdGhlciBtZXRob2RzIGFyZSB1c2VkIGJ5IHJlc2lsaWVudEdvdFxuICAgIC8vIFJlc2V0IGFsbCBsb2dnZXIgc3BpZXNcbiAgICBPYmplY3QudmFsdWVzKG1vY2tlZExvZ2dlcikuZm9yRWFjaCgobW9ja0ZuKSA9PiBtb2NrRm4ubW9ja1Jlc2V0KCkpO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2NoZWR1bGVNZWV0aW5nICh0ZXN0aW5nIHJlc2lsaWVudEdvdCBpbmRpcmVjdGx5KScsICgpID0+IHtcbiAgICBjb25zdCBtb2NrUGF5bG9hZDogU2NoZWR1bGVNZWV0aW5nUmVxdWVzdFR5cGUgPSB7XG4gICAgICBwYXJ0aWNpcGFudE5hbWVzOiBbJ0FsaWNlJywgJ0JvYiddLFxuICAgICAgZHVyYXRpb25NaW51dGVzOiAzMCxcbiAgICAgIHByZWZlcnJlZERhdGU6ICcyMDI0LTA3LTI1JyxcbiAgICAgIHByZWZlcnJlZFN0YXJ0VGltZUZyb206ICcxMDowMDowMCcsXG4gICAgICBwcmVmZXJyZWRTdGFydFRpbWVUbzogJzExOjAwOjAwJyxcbiAgICB9O1xuICAgIGNvbnN0IGV4cGVjdGVkVXJsID0gYCR7U0NIRURVTEVSX0FQSV9VUkx9L3RpbWVUYWJsZS91c2VyL3NjaGVkdWxlTWVldGluZ2A7XG4gICAgY29uc3Qgb3BlcmF0aW9uTmFtZSA9ICdzY2hlZHVsZU1lZXRpbmcnOyAvLyBBcyB1c2VkIGluIHRoZSBtYWluIGNvZGVcblxuICAgIC8vIE5vIGxvbmdlciBuZWVkIGJlZm9yZUVhY2ggZm9yIG1vY2tHb3QucG9zdC5tb2NrQ2xlYXIoKSBhcyBpdCdzIGluIHRoZSBnbG9iYWwgYmVmb3JlRWFjaFxuXG4gICAgaXQoJ3Nob3VsZCBzdWNjZWVkIG9uIHRoZSBmaXJzdCBhdHRlbXB0LCBjYWxsaW5nIHJlc2lsaWVudEdvdCBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQXBpUmVzcG9uc2UgPSB7IG1lZXRpbmdJZDogJzEyMycsIHN0YXR1czogJ1NDSEVEVUxFRCcgfTtcbiAgICAgIG1vY2tlZEdvdC5wb3N0Lm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7IGJvZHk6IG1vY2tBcGlSZXNwb25zZSB9IGFzIGFueSk7IC8vIHJlc2lsaWVudEdvdCBleHBlY3RzIHJlc3BvbnNlLmJvZHlcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2NoZWR1bGVNZWV0aW5nKG1vY2tQYXlsb2FkKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQXBpUmVzcG9uc2UpO1xuICAgICAgZXhwZWN0KG1vY2tlZEdvdC5wb3N0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICBleHBlY3QobW9ja2VkR290LnBvc3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3RlZFVybCxcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIGpzb246IG1vY2tQYXlsb2FkLFxuICAgICAgICAgIHRpbWVvdXQ6IHsgcmVxdWVzdDogMTUwMDAgfSwgLy8gRGVmYXVsdCBmcm9tIHJlc2lsaWVudEdvdFxuICAgICAgICAgIHJldHJ5OiB7IGxpbWl0OiAwIH0sIC8vIHJlc2lsaWVudEdvdCBoYW5kbGVzIHJldHJpZXNcbiAgICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJyxcbiAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgICBleHBlY3QobW9ja2VkTG9nZ2VyLmluZm8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZyhgWyR7b3BlcmF0aW9uTmFtZX1dIENhbGxlZC5gKSxcbiAgICAgICAgZXhwZWN0LmFueXRoaW5nKClcbiAgICAgICk7XG4gICAgICBleHBlY3QobW9ja2VkTG9nZ2VyLmluZm8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZyhcbiAgICAgICAgICBgWyR7b3BlcmF0aW9uTmFtZX1dIEF0dGVtcHQgMS8zIC0gUE9TVCAke2V4cGVjdGVkVXJsfWBcbiAgICAgICAgKSxcbiAgICAgICAgZXhwZWN0LmFueXRoaW5nKClcbiAgICAgICk7XG4gICAgICBleHBlY3QobW9ja2VkTG9nZ2VyLmluZm8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZyhgWyR7b3BlcmF0aW9uTmFtZX1dIEF0dGVtcHQgMSBzdWNjZXNzZnVsLmApLFxuICAgICAgICBleHBlY3QuYW55dGhpbmcoKVxuICAgICAgKTtcbiAgICAgIGV4cGVjdChtb2NrZWRMb2dnZXIuaW5mbykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKFxuICAgICAgICAgIGBbJHtvcGVyYXRpb25OYW1lfV0gU3VjY2Vzc2Z1bGx5IHNjaGVkdWxlZCBtZWV0aW5nLmBcbiAgICAgICAgKSxcbiAgICAgICAgZXhwZWN0LmFueXRoaW5nKClcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHN1Y2NlZWQgb24gdGhlIHNlY29uZCBhdHRlbXB0IGFmdGVyIGEgNTAzIGVycm9yJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0FwaVJlc3BvbnNlID0geyBtZWV0aW5nSWQ6ICcxMjMnLCBzdGF0dXM6ICdTQ0hFRFVMRUQnIH07XG4gICAgICBtb2NrZWRHb3QucG9zdFxuICAgICAgICAubW9ja1JlamVjdGVkVmFsdWVPbmNlKHtcbiAgICAgICAgICByZXNwb25zZTogeyBzdGF0dXNDb2RlOiA1MDMgfSxcbiAgICAgICAgICBtZXNzYWdlOiAnU2VydmljZSBVbmF2YWlsYWJsZScsXG4gICAgICAgICAgaXNHb3RFcnJvcjogdHJ1ZSxcbiAgICAgICAgfSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7IGJvZHk6IG1vY2tBcGlSZXNwb25zZSB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNjaGVkdWxlTWVldGluZyhtb2NrUGF5bG9hZCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tBcGlSZXNwb25zZSk7XG4gICAgICBleHBlY3QobW9ja2VkR290LnBvc3QpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICAgIGV4cGVjdChtb2NrZWRMb2dnZXIud2FybikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKFxuICAgICAgICAgIGBbJHtvcGVyYXRpb25OYW1lfV9TY2hlZHVsZXJBUEldIEF0dGVtcHQgMS8zIGZhaWxlZC5gXG4gICAgICAgICksXG4gICAgICAgIGV4cGVjdC5hbnl0aGluZygpXG4gICAgICApOyAvLyByZXNpbGllbnRHb3QncyBpbnRlcm5hbCBvcE5hbWVcbiAgICAgIGV4cGVjdChtb2NrZWRMb2dnZXIuaW5mbykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKFxuICAgICAgICAgIGBbJHtvcGVyYXRpb25OYW1lfV9TY2hlZHVsZXJBUEldIFdhaXRpbmcgMTAwMG1zIGJlZm9yZSByZXRyeSAyLzMuYFxuICAgICAgICApLFxuICAgICAgICBleHBlY3QuYW55dGhpbmcoKVxuICAgICAgKTtcbiAgICAgIGV4cGVjdChtb2NrZWRMb2dnZXIuaW5mbykudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKFxuICAgICAgICAgIGBbJHtvcGVyYXRpb25OYW1lfV0gU3VjY2Vzc2Z1bGx5IHNjaGVkdWxlZCBtZWV0aW5nLmBcbiAgICAgICAgKSxcbiAgICAgICAgZXhwZWN0LmFueXRoaW5nKClcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZhaWwgYWZ0ZXIgYWxsIHJldHJpZXMgZm9yIHBlcnNpc3RlbnQgNTAwIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tlZEdvdC5wb3N0Lm1vY2tSZWplY3RlZFZhbHVlKHtcbiAgICAgICAgcmVzcG9uc2U6IHsgc3RhdHVzQ29kZTogNTAwIH0sXG4gICAgICAgIG1lc3NhZ2U6ICdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InLFxuICAgICAgICBpc0dvdEVycm9yOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzY2hlZHVsZU1lZXRpbmcobW9ja1BheWxvYWQpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InXG4gICAgICApO1xuICAgICAgZXhwZWN0KG1vY2tlZEdvdC5wb3N0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMyk7XG4gICAgICBleHBlY3QobW9ja2VkTG9nZ2VyLmVycm9yKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoXG4gICAgICAgICAgYFske29wZXJhdGlvbk5hbWV9X1NjaGVkdWxlckFQSV0gRmFpbGVkIGFmdGVyIDMgYXR0ZW1wdHMuYFxuICAgICAgICApLFxuICAgICAgICBleHBlY3QuYW55dGhpbmcoKVxuICAgICAgKTsgLy8gcmVzaWxpZW50R290IGxvZ1xuICAgICAgZXhwZWN0KG1vY2tlZExvZ2dlci5lcnJvcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKFxuICAgICAgICAgIGBbJHtvcGVyYXRpb25OYW1lfV0gRXJyb3IgY2FsbGluZyBzY2hlZHVsZU1lZXRpbmcgQVBJLmBcbiAgICAgICAgKSxcbiAgICAgICAgZXhwZWN0LmFueXRoaW5nKClcbiAgICAgICk7IC8vIHNjaGVkdWxlTWVldGluZyBsb2dcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmFpbCBpbW1lZGlhdGVseSBvbiBhIG5vbi1yZXRyeWFibGUgNDAwIGVycm9yIGZyb20gcmVzaWxpZW50R290JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgYXBpRXJyb3IgPSB7XG4gICAgICAgIHJlc3BvbnNlOiB7XG4gICAgICAgICAgc3RhdHVzQ29kZTogNDAwLFxuICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZTogJ0ludmFsaWQgcGFydGljaXBhbnRzJyB9KSxcbiAgICAgICAgfSxcbiAgICAgICAgbWVzc2FnZTogJ0JhZCBSZXF1ZXN0JyxcbiAgICAgICAgaXNHb3RFcnJvcjogdHJ1ZSxcbiAgICAgIH07XG4gICAgICBtb2NrZWRHb3QucG9zdC5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UoYXBpRXJyb3IpO1xuXG4gICAgICBhd2FpdCBleHBlY3Qoc2NoZWR1bGVNZWV0aW5nKG1vY2tQYXlsb2FkKSkucmVqZWN0cy50b1Rocm93KFxuICAgICAgICAnQVBJIEVycm9yIGZyb20gc2NoZWR1bGVNZWV0aW5nX1NjaGVkdWxlckFQSTogSW52YWxpZCBwYXJ0aWNpcGFudHMnXG4gICAgICApO1xuICAgICAgZXhwZWN0KG1vY2tlZEdvdC5wb3N0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICBleHBlY3QobW9ja2VkTG9nZ2VyLmVycm9yKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoXG4gICAgICAgICAgYFske29wZXJhdGlvbk5hbWV9X1NjaGVkdWxlckFQSV0gTm9uLXJldHJ5YWJsZSBlcnJvciBlbmNvdW50ZXJlZC4gQWJvcnRpbmcgcmV0cmllcy5gXG4gICAgICAgICksXG4gICAgICAgIGV4cGVjdC5hbnl0aGluZygpXG4gICAgICApO1xuICAgICAgZXhwZWN0KG1vY2tlZExvZ2dlci5lcnJvcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKFxuICAgICAgICAgIGBbJHtvcGVyYXRpb25OYW1lfV0gRXJyb3IgY2FsbGluZyBzY2hlZHVsZU1lZXRpbmcgQVBJLmBcbiAgICAgICAgKSxcbiAgICAgICAgZXhwZWN0LmFueXRoaW5nKClcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB0aW1lb3V0IGZyb20gcmVzaWxpZW50R290IChFVElNRURPVVQpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0FwaVJlc3BvbnNlID0geyBtZWV0aW5nSWQ6ICcxMjMnLCBzdGF0dXM6ICdTQ0hFRFVMRUQnIH07XG4gICAgICBtb2NrZWRHb3QucG9zdFxuICAgICAgICAubW9ja1JlamVjdGVkVmFsdWVPbmNlKHtcbiAgICAgICAgICBjb2RlOiAnRVRJTUVET1VUJyxcbiAgICAgICAgICBtZXNzYWdlOiAnQ29ubmVjdGlvbiB0aW1lZCBvdXQnLFxuICAgICAgICAgIGlzR290RXJyb3I6IHRydWUsXG4gICAgICAgIH0pXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoeyBib2R5OiBtb2NrQXBpUmVzcG9uc2UgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzY2hlZHVsZU1lZXRpbmcobW9ja1BheWxvYWQpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrQXBpUmVzcG9uc2UpO1xuICAgICAgZXhwZWN0KG1vY2tlZEdvdC5wb3N0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMik7XG4gICAgICBleHBlY3QobW9ja2VkTG9nZ2VyLndhcm4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZyhcbiAgICAgICAgICBgWyR7b3BlcmF0aW9uTmFtZX1fU2NoZWR1bGVyQVBJXSBBdHRlbXB0IDEvMyBmYWlsZWQuYFxuICAgICAgICApLFxuICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7IGVycm9yQ29kZTogJ0VUSU1FRE9VVCcgfSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICAvLyBUZXN0IHRoZSBzcGVjaWZpYyBlcnJvciBtZXNzYWdlIGNvbnN0cnVjdGlvbiBpbiBzY2hlZHVsZU1lZXRpbmcncyBjYXRjaCBibG9ja1xuICAgIGl0KCdzaG91bGQgdGhyb3cgY29ycmVjdGx5IHN0cnVjdHVyZWQgZXJyb3Igd2hlbiByZXNpbGllbnRHb3QgcmV0aHJvd3MgYSBnb3QgZXJyb3Igd2l0aCBKU09OIGJvZHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvckJvZHkgPSB7IG1lc3NhZ2U6ICdTcGVjaWZpYyBBUEkgZXJyb3IgbWVzc2FnZScgfTtcbiAgICAgIGNvbnN0IGdvdEVycm9yID0ge1xuICAgICAgICByZXNwb25zZToge1xuICAgICAgICAgIHN0YXR1c0NvZGU6IDQyMixcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShlcnJvckJvZHkpLFxuICAgICAgICB9LFxuICAgICAgICBtZXNzYWdlOiAnUmVxdWVzdCBmYWlsZWQgd2l0aCBzdGF0dXMgY29kZSA0MjInLFxuICAgICAgICBpc0dvdEVycm9yOiB0cnVlLFxuICAgICAgfTtcbiAgICAgIG1vY2tlZEdvdC5wb3N0Lm1vY2tSZWplY3RlZFZhbHVlT25jZShnb3RFcnJvcik7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChzY2hlZHVsZU1lZXRpbmcobW9ja1BheWxvYWQpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgIGBBUEkgRXJyb3IgZnJvbSAke29wZXJhdGlvbk5hbWV9X1NjaGVkdWxlckFQSTogU3BlY2lmaWMgQVBJIGVycm9yIG1lc3NhZ2VgXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBjb3JyZWN0bHkgc3RydWN0dXJlZCBlcnJvciB3aGVuIHJlc2lsaWVudEdvdCByZXRocm93cyBhIGdvdCBlcnJvciB3aXRoIG5vbi1KU09OIGJvZHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvckJvZHlUZXh0ID0gJ0EgcGxhaW4gdGV4dCBlcnJvciBmcm9tIHNlcnZlcic7XG4gICAgICBjb25zdCBnb3RFcnJvciA9IHtcbiAgICAgICAgcmVzcG9uc2U6IHtcbiAgICAgICAgICBzdGF0dXNDb2RlOiA1MDMsXG4gICAgICAgICAgYm9keTogZXJyb3JCb2R5VGV4dCxcbiAgICAgICAgfSxcbiAgICAgICAgbWVzc2FnZTogJ1NlcnZpY2UgdW5hdmFpbGFibGUnLFxuICAgICAgICBpc0dvdEVycm9yOiB0cnVlLFxuICAgICAgfTtcbiAgICAgIC8vIHJlc2lsaWVudEdvdCB3aWxsIHJldHJ5IDUwM3MsIHNvIG1ha2UgYWxsIGF0dGVtcHRzIGZhaWxcbiAgICAgIG1vY2tlZEdvdC5wb3N0Lm1vY2tSZWplY3RlZFZhbHVlKGdvdEVycm9yKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KHNjaGVkdWxlTWVldGluZyhtb2NrUGF5bG9hZCkpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgYEFQSSBFcnJvciBmcm9tICR7b3BlcmF0aW9uTmFtZX1fU2NoZWR1bGVyQVBJOiAke2Vycm9yQm9keVRleHR9YFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2V4Y2hhbmdlQ29kZUZvclRva2VucycsICgpID0+IHtcbiAgICBjb25zdCBtb2NrQ29kZSA9ICdhdXRoLWNvZGUtMTIzJztcbiAgICBjb25zdCBtb2NrVG9rZW5zID0ge1xuICAgICAgYWNjZXNzX3Rva2VuOiAnYWNjX3Rva2VuJyxcbiAgICAgIHJlZnJlc2hfdG9rZW46ICdyZWZfdG9rZW4nLFxuICAgICAgZXhwaXJ5X2RhdGU6IERhdGUubm93KCkgKyAzNjAwMDAwLFxuICAgIH07XG5cbiAgICAvLyBNb2NrIHRoZSBnb29nbGVhcGlzIGF1dGggY2xpZW50XG4gICAgY29uc3QgbW9ja0dldFRva2VuID0gamVzdC5mbigpO1xuICAgIC8vIE9yaWdpbmFsOiBjb25zdCBvYXV0aDJDbGllbnQgPSBuZXcgZ29vZ2xlLmF1dGguT0F1dGgyKC4uLilcbiAgICAvLyBXZSBuZWVkIHRvIG1vY2sgdGhlIGdsb2JhbGx5IGluc3RhbnRpYXRlZCBvYXV0aDJDbGllbnQgb3IgZ29vZ2xlLmF1dGguT0F1dGgyIGl0c2VsZi5cbiAgICAvLyBGb3Igc2ltcGxpY2l0eSwgbGV0J3MgYXNzdW1lIHdlIGNhbiBtb2NrIHRoZSBpbnN0YW5jZSdzIG1ldGhvZCB1c2VkIGluIHRoZSBhY3R1YWwgY29kZS5cbiAgICAvLyBUaGlzIHJlcXVpcmVzIGNhcmVmdWwgc2V0dXAgaWYgdGhlIGluc3RhbmNlIGlzIGNyZWF0ZWQgYXQgbW9kdWxlIHNjb3BlLlxuICAgIC8vIEEgY29tbW9uIHdheSBpcyB0byBtb2NrIHRoZSAnZ29vZ2xlYXBpcycgbW9kdWxlLlxuXG4gICAgbGV0IG9yaWdpbmFsR29vZ2xlQXV0aDogYW55O1xuXG4gICAgYmVmb3JlQWxsKCgpID0+IHtcbiAgICAgIG9yaWdpbmFsR29vZ2xlQXV0aCA9IGplc3QucmVxdWlyZUFjdHVhbCgnZ29vZ2xlYXBpcycpLmdvb2dsZS5hdXRoO1xuICAgICAgY29uc3QgeyBnb29nbGUgfSA9IGplc3QucmVxdWlyZUFjdHVhbCgnZ29vZ2xlYXBpcycpO1xuICAgICAgZ29vZ2xlLmF1dGggPSB7XG4gICAgICAgIE9BdXRoMjogamVzdC5mbigoKSA9PiAoe1xuICAgICAgICAgIGdldFRva2VuOiBtb2NrR2V0VG9rZW4sXG4gICAgICAgICAgc2V0Q3JlZGVudGlhbHM6IGplc3QuZm4oKSwgLy8gTW9jayB0aGlzIGlmIGl0J3MgY2FsbGVkXG4gICAgICAgICAgZ2VuZXJhdGVBdXRoVXJsOiBqZXN0LmZuKCksIC8vIE1vY2sgdGhpcyBpZiBpdCdzIGNhbGxlZCBieSBvdGhlciB0ZXN0ZWQgZnVuY3NcbiAgICAgICAgfSkpLFxuICAgICAgfTtcbiAgICAgIC8vIFRoaXMgcmUtaW1wb3J0cyB3aXRoIHRoZSBnb29nbGUuYXV0aCBtb2NrZWQuXG4gICAgICAvLyBJdCdzIGEgYml0IHRyaWNreTsgZW5zdXJlIGFwaS1iYWNrZW5kLWhlbHBlciB1c2VzIHRoaXMgbW9ja2VkIHZlcnNpb24uXG4gICAgICAvLyBBbHRlcm5hdGl2ZTogRGlyZWN0bHkgbW9jayB0aGUgb2F1dGgyQ2xpZW50IGluc3RhbmNlIGlmIGl0J3MgZXhwb3J0ZWQgb3IgYWNjZXNzaWJsZS5cbiAgICB9KTtcblxuICAgIGFmdGVyQWxsKCgpID0+IHtcbiAgICAgIC8vIFJlc3RvcmUgb3JpZ2luYWwgZ29vZ2xlYXBpcyBhdXRoXG4gICAgICBjb25zdCB7IGdvb2dsZSB9ID0gamVzdC5yZXF1aXJlQWN0dWFsKCdnb29nbGVhcGlzJyk7XG4gICAgICBnb29nbGUuYXV0aCA9IG9yaWdpbmFsR29vZ2xlQXV0aDtcbiAgICB9KTtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgbW9ja0dldFRva2VuLm1vY2tSZXNldCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleGNoYW5nZSBjb2RlIGZvciB0b2tlbnMgc3VjY2Vzc2Z1bGx5IGFuZCBsb2cgaW5mbycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tHZXRUb2tlbi5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoeyB0b2tlbnM6IG1vY2tUb2tlbnMgfSk7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGV4Y2hhbmdlQ29kZUZvclRva2VuczogZXhjaGFuZ2VDb2RlRnVuYyxcbiAgICAgIH0gPSByZXF1aXJlKCcuLi9hcGktYmFja2VuZC1oZWxwZXInKTsgLy8gUmUtcmVxdWlyZSB0byBnZXQgcG90ZW50aWFsbHkgbW9ja2VkIHZlcnNpb25cblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXhjaGFuZ2VDb2RlRnVuYyhtb2NrQ29kZSk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1Rva2Vucyk7XG4gICAgICBleHBlY3QobW9ja0dldFRva2VuKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChtb2NrQ29kZSk7XG4gICAgICBleHBlY3QobW9ja2VkTG9nZ2VyLmluZm8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAnW2V4Y2hhbmdlQ29kZUZvclRva2Vuc10gU3VjY2Vzc2Z1bGx5IGV4Y2hhbmdlZCBjb2RlIGZvciB0b2tlbnMuJyxcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoeyBjb2RlUHJlZml4OiBtb2NrQ29kZS5zdWJzdHJpbmcoMCwgMTApIH0pXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBsb2cgZXJyb3IgYW5kIHJlLXRocm93IGlmIHRva2VuIGV4Y2hhbmdlIGZhaWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ0V4Y2hhbmdlIGZhaWxlZCcpO1xuICAgICAgbW9ja0dldFRva2VuLm1vY2tSZWplY3RlZFZhbHVlT25jZShlcnJvcik7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGV4Y2hhbmdlQ29kZUZvclRva2VuczogZXhjaGFuZ2VDb2RlRnVuYyxcbiAgICAgIH0gPSByZXF1aXJlKCcuLi9hcGktYmFja2VuZC1oZWxwZXInKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGV4Y2hhbmdlQ29kZUZ1bmMobW9ja0NvZGUpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICdFeGNoYW5nZSBmYWlsZWQnXG4gICAgICApO1xuICAgICAgZXhwZWN0KG1vY2tHZXRUb2tlbikudG9IYXZlQmVlbkNhbGxlZFdpdGgobW9ja0NvZGUpO1xuICAgICAgZXhwZWN0KG1vY2tlZExvZ2dlci5lcnJvcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICdbZXhjaGFuZ2VDb2RlRm9yVG9rZW5zXSBVbmFibGUgdG8gZXhjaGFuZ2UgY29kZSBmb3IgdG9rZW5zLicsXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSlcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIEFkZCB0ZXN0cyBmb3IgZ2V0TWluaW1hbENhbGVuZGFySW50ZWdyYXRpb25CeVJlc291cmNlIChhcyBhbm90aGVyIHJlc2lsaWVudEdvdCBjb25zdW1lcilcbiAgZGVzY3JpYmUoJ2dldE1pbmltYWxDYWxlbmRhckludGVncmF0aW9uQnlSZXNvdXJjZSAodGVzdGluZyByZXNpbGllbnRHb3QgZm9yIEhhc3VyYSknLCAoKSA9PiB7XG4gICAgY29uc3QgdXNlcklkID0gJ3Rlc3QtdXNlci1oYXN1cmEnO1xuICAgIGNvbnN0IHJlc291cmNlID0gJ2dvb2dsZV9jYWxlbmRhcic7XG4gICAgY29uc3Qgb3BlcmF0aW9uTmFtZSA9ICdnZXRDYWxlbmRhckludGVncmF0aW9uJzsgLy8gSW50ZXJuYWwgb3BlcmF0aW9uIG5hbWVcbiAgICBjb25zdCBtb2NrSW50ZWdyYXRpb24gPSB7XG4gICAgICBpZDogJ2ludGVnLTEnLFxuICAgICAgcmVzb3VyY2U6ICdnb29nbGVfY2FsZW5kYXInLFxuICAgICAgdG9rZW46ICd0b2tlbicsXG4gICAgfTtcblxuICAgIGl0KCdzaG91bGQgZmV0Y2ggaW50ZWdyYXRpb24gc3VjY2Vzc2Z1bGx5IHVzaW5nIHJlc2lsaWVudEdvdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tlZEdvdC5wb3N0Lm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgIGJvZHk6IHsgZGF0YTogeyBDYWxlbmRhcl9JbnRlZ3JhdGlvbjogW21vY2tJbnRlZ3JhdGlvbl0gfSB9LFxuICAgICAgfSBhcyBhbnkpO1xuICAgICAgY29uc3Qge1xuICAgICAgICBnZXRNaW5pbWFsQ2FsZW5kYXJJbnRlZ3JhdGlvbkJ5UmVzb3VyY2U6IGdldEludGVnRnVuYyxcbiAgICAgIH0gPSByZXF1aXJlKCcuLi9hcGktYmFja2VuZC1oZWxwZXInKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0SW50ZWdGdW5jKHVzZXJJZCwgcmVzb3VyY2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrSW50ZWdyYXRpb24pO1xuICAgICAgZXhwZWN0KG1vY2tlZEdvdC5wb3N0KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICBleHBlY3QobW9ja2VkR290LnBvc3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBoYXN1cmFHcmFwaFVybCxcbiAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgIGpzb246IGV4cGVjdC5vYmplY3RDb250YWluaW5nKHsgb3BlcmF0aW9uTmFtZSB9KSxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgICBleHBlY3QobW9ja2VkTG9nZ2VyLmluZm8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZyhgWyR7b3BlcmF0aW9uTmFtZX1dIEF0dGVtcHQgMS8zYCksXG4gICAgICAgIGV4cGVjdC5hbnl0aGluZygpXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdW5kZWZpbmVkIGFuZCBsb2cgaW5mbyBpZiBubyBpbnRlZ3JhdGlvbiBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tlZEdvdC5wb3N0Lm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgIGJvZHk6IHsgZGF0YTogeyBDYWxlbmRhcl9JbnRlZ3JhdGlvbjogW10gfSB9LFxuICAgICAgfSBhcyBhbnkpO1xuICAgICAgY29uc3Qge1xuICAgICAgICBnZXRNaW5pbWFsQ2FsZW5kYXJJbnRlZ3JhdGlvbkJ5UmVzb3VyY2U6IGdldEludGVnRnVuYyxcbiAgICAgIH0gPSByZXF1aXJlKCcuLi9hcGktYmFja2VuZC1oZWxwZXInKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0SW50ZWdGdW5jKHVzZXJJZCwgcmVzb3VyY2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KG1vY2tlZExvZ2dlci5pbmZvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoYFske29wZXJhdGlvbk5hbWV9XSBObyBpbnRlZ3JhdGlvbiBmb3VuZGApLFxuICAgICAgICBleHBlY3QuYW55dGhpbmcoKVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmUtdGhyb3cgZXJyb3IgZnJvbSByZXNpbGllbnRHb3QgaWYgSGFzdXJhIGNhbGwgZmFpbHMgYWZ0ZXIgcmV0cmllcycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tlZEdvdC5wb3N0Lm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignSGFzdXJhIGRvd24nKSk7IC8vIEFsbCBhdHRlbXB0cyBmYWlsXG4gICAgICBjb25zdCB7XG4gICAgICAgIGdldE1pbmltYWxDYWxlbmRhckludGVncmF0aW9uQnlSZXNvdXJjZTogZ2V0SW50ZWdGdW5jLFxuICAgICAgfSA9IHJlcXVpcmUoJy4uL2FwaS1iYWNrZW5kLWhlbHBlcicpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoZ2V0SW50ZWdGdW5jKHVzZXJJZCwgcmVzb3VyY2UpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICdIYXN1cmEgZG93bidcbiAgICAgICk7XG4gICAgICBleHBlY3QobW9ja2VkTG9nZ2VyLmVycm9yKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoYFske29wZXJhdGlvbk5hbWV9XSBGYWlsZWQgYWZ0ZXIgMyBhdHRlbXB0c2ApLFxuICAgICAgICBleHBlY3QuYW55dGhpbmcoKVxuICAgICAgKTsgLy8gZnJvbSByZXNpbGllbnRHb3RcbiAgICAgIGV4cGVjdChtb2NrZWRMb2dnZXIuZXJyb3IpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZyhcbiAgICAgICAgICBgWyR7b3BlcmF0aW9uTmFtZX1dIFVuYWJsZSB0byBnZXQgY2FsZW5kYXIgaW50ZWdyYXRpb24uYFxuICAgICAgICApLFxuICAgICAgICBleHBlY3QuYW55dGhpbmcoKVxuICAgICAgKTsgLy8gZnJvbSBnZXRNaW5pbWFsQ2FsZW5kYXJJbnRlZ3JhdGlvbkJ5UmVzb3VyY2VcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3JlZnJlc2hHb29nbGVUb2tlbiAoYXRvbWljLXdlYiBwYXRoIHVzaW5nIHJlc2lsaWVudEdvdCknLCAoKSA9PiB7XG4gICAgY29uc3QgcmVmcmVzaFRva2VuID0gJ2dvb2dsZS1yZWZyZXNoLXRva2VuJztcbiAgICBjb25zdCBjbGllbnRUeXBlID0gJ2F0b21pYy13ZWInO1xuICAgIGNvbnN0IG9wZXJhdGlvbk5hbWUgPSAncmVmcmVzaEdvb2dsZVRva2VuJzsgLy8gQXMgdXNlZCBpbiB0aGUgbWFpbiBjb2RlIGZvciB0aGlzIHNwZWNpZmljIGNhbGwgcGF0aFxuICAgIGNvbnN0IG1vY2tHb29nbGVTdWNjZXNzUmVzcG9uc2UgPSB7XG4gICAgICBhY2Nlc3NfdG9rZW46ICduZXdfZ29vZ2xlX3Rva2VuJyxcbiAgICAgIGV4cGlyZXNfaW46IDM1OTksXG4gICAgICBzY29wZTogJ3Rlc3Rfc2NvcGUnLFxuICAgICAgdG9rZW5fdHlwZTogJ0JlYXJlcicsXG4gICAgfTtcbiAgICBjb25zdCBnb29nbGVUb2tlblVybCA9ICdodHRwczovL29hdXRoMi5nb29nbGVhcGlzLmNvbS90b2tlbic7IC8vIGZyb20gY29uc3RhbnRzXG5cbiAgICBpdCgnc2hvdWxkIHJlZnJlc2ggdG9rZW4gc3VjY2Vzc2Z1bGx5IHZpYSByZXNpbGllbnRHb3QgZm9yIGF0b21pYy13ZWInLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrZWRHb3QucG9zdC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICBib2R5OiBtb2NrR29vZ2xlU3VjY2Vzc1Jlc3BvbnNlLFxuICAgICAgfSBhcyBhbnkpO1xuICAgICAgY29uc3Qge1xuICAgICAgICByZWZyZXNoR29vZ2xlVG9rZW46IHJlZnJlc2hGdW5jLFxuICAgICAgfSA9IHJlcXVpcmUoJy4uL2FwaS1iYWNrZW5kLWhlbHBlcicpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZyZXNoRnVuYyhyZWZyZXNoVG9rZW4sIGNsaWVudFR5cGUpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrR29vZ2xlU3VjY2Vzc1Jlc3BvbnNlKTtcbiAgICAgIGV4cGVjdChtb2NrZWRHb3QucG9zdCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KG1vY2tlZEdvdC5wb3N0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZ29vZ2xlVG9rZW5VcmwsXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBmb3JtOiBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XG4gICAgICAgICAgICBncmFudF90eXBlOiAncmVmcmVzaF90b2tlbicsXG4gICAgICAgICAgICByZWZyZXNoX3Rva2VuOiByZWZyZXNoVG9rZW4sXG4gICAgICAgICAgfSksXG4gICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcgfSxcbiAgICAgICAgICByZXNwb25zZVR5cGU6ICdqc29uJyxcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgICBleHBlY3QobW9ja2VkTG9nZ2VyLmluZm8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZyhgWyR7b3BlcmF0aW9uTmFtZX1dIENhbGxlZC5gKSxcbiAgICAgICAgeyBjbGllbnRUeXBlIH1cbiAgICAgICk7XG4gICAgICBleHBlY3QobW9ja2VkTG9nZ2VyLmluZm8pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZyhgWyR7b3BlcmF0aW9uTmFtZX1dIEF0dGVtcHQgMS8zYCksXG4gICAgICAgIGV4cGVjdC5hbnl0aGluZygpXG4gICAgICApOyAvLyBmcm9tIHJlc2lsaWVudEdvdFxuICAgICAgZXhwZWN0KG1vY2tlZExvZ2dlci5pbmZvKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoXG4gICAgICAgICAgYFske29wZXJhdGlvbk5hbWV9XSBUb2tlbiByZWZyZXNoIHN1Y2Nlc3NmdWwgZm9yIGNsaWVudFR5cGU6ICR7Y2xpZW50VHlwZX0uYFxuICAgICAgICApLFxuICAgICAgICBleHBlY3QuYW55dGhpbmcoKVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0cnkgYW5kIHN1Y2NlZWQgZm9yIGF0b21pYy13ZWIgaWYgcmVzaWxpZW50R290IGhhbmRsZXMgcmV0cnlhYmxlIGVycm9yJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja2VkR290LnBvc3RcbiAgICAgICAgLm1vY2tSZWplY3RlZFZhbHVlT25jZSh7XG4gICAgICAgICAgcmVzcG9uc2U6IHsgc3RhdHVzQ29kZTogNTAwIH0sXG4gICAgICAgICAgbWVzc2FnZTogJ1NlcnZlciBFcnJvcicsXG4gICAgICAgICAgaXNHb3RFcnJvcjogdHJ1ZSxcbiAgICAgICAgfSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7IGJvZHk6IG1vY2tHb29nbGVTdWNjZXNzUmVzcG9uc2UgfSBhcyBhbnkpO1xuICAgICAgY29uc3Qge1xuICAgICAgICByZWZyZXNoR29vZ2xlVG9rZW46IHJlZnJlc2hGdW5jLFxuICAgICAgfSA9IHJlcXVpcmUoJy4uL2FwaS1iYWNrZW5kLWhlbHBlcicpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZWZyZXNoRnVuYyhyZWZyZXNoVG9rZW4sIGNsaWVudFR5cGUpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrR29vZ2xlU3VjY2Vzc1Jlc3BvbnNlKTtcbiAgICAgIGV4cGVjdChtb2NrZWRHb3QucG9zdCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDIpO1xuICAgICAgZXhwZWN0KG1vY2tlZExvZ2dlci53YXJuKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoYFske29wZXJhdGlvbk5hbWV9XSBBdHRlbXB0IDEvMyBmYWlsZWQuYCksXG4gICAgICAgIGV4cGVjdC5hbnl0aGluZygpXG4gICAgICApOyAvLyBmcm9tIHJlc2lsaWVudEdvdFxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBpZiByZXNpbGllbnRHb3QgZmFpbHMgYWZ0ZXIgYWxsIHJldHJpZXMgZm9yIGF0b21pYy13ZWInLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrZWRHb3QucG9zdC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1Rva2VuIGVuZHBvaW50IGRvd24nKSk7XG4gICAgICBjb25zdCB7XG4gICAgICAgIHJlZnJlc2hHb29nbGVUb2tlbjogcmVmcmVzaEZ1bmMsXG4gICAgICB9ID0gcmVxdWlyZSgnLi4vYXBpLWJhY2tlbmQtaGVscGVyJyk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChyZWZyZXNoRnVuYyhyZWZyZXNoVG9rZW4sIGNsaWVudFR5cGUpKS5yZWplY3RzLnRvVGhyb3coXG4gICAgICAgICdUb2tlbiBlbmRwb2ludCBkb3duJ1xuICAgICAgKTtcbiAgICAgIGV4cGVjdChtb2NrZWRHb3QucG9zdCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDMpO1xuICAgICAgZXhwZWN0KG1vY2tlZExvZ2dlci5lcnJvcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKGBbJHtvcGVyYXRpb25OYW1lfV0gRmFpbGVkIGFmdGVyIDMgYXR0ZW1wdHNgKSxcbiAgICAgICAgZXhwZWN0LmFueXRoaW5nKClcbiAgICAgICk7IC8vIGZyb20gcmVzaWxpZW50R290XG4gICAgICBleHBlY3QobW9ja2VkTG9nZ2VyLmVycm9yKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoXG4gICAgICAgICAgYFske29wZXJhdGlvbk5hbWV9XSBVbmFibGUgdG8gcmVmcmVzaCBHb29nbGUgdG9rZW4uYFxuICAgICAgICApLFxuICAgICAgICBleHBlY3QuYW55dGhpbmcoKVxuICAgICAgKTsgLy8gZnJvbSByZWZyZXNoR29vZ2xlVG9rZW5cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHVuZGVmaW5lZCBpZiBjbGllbnRUeXBlIGlzIG5vdCBhdG9taWMtd2ViIGFuZCBub3QgY29uZmlndXJlZCBmb3IgZ290JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qge1xuICAgICAgICByZWZyZXNoR29vZ2xlVG9rZW46IHJlZnJlc2hGdW5jLFxuICAgICAgfSA9IHJlcXVpcmUoJy4uL2FwaS1iYWNrZW5kLWhlbHBlcicpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVmcmVzaEZ1bmMocmVmcmVzaFRva2VuLCAnd2ViJyk7IC8vICd3ZWInIGlzIG5vdCBjb25maWd1cmVkIGZvciBkaXJlY3QgZ290IGNhbGwgaW4gdGhpcyBmdW5jXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICBleHBlY3QobW9ja2VkTG9nZ2VyLndhcm4pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZyhcbiAgICAgICAgICBgWyR7b3BlcmF0aW9uTmFtZX1dIENsaWVudCB0eXBlICd3ZWInIG5vdCBjb25maWd1cmVkIGZvciBkaXJlY3QgZ290LWJhc2VkIHRva2VuIHJlZnJlc2ggaW4gdGhpcyBmdW5jdGlvbi5gXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=