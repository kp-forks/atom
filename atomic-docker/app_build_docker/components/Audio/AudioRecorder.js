"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const AgentAudioControlContext_1 = require("../../contexts/AgentAudioControlContext"); // Adjusted path
// Placeholder Icons (replace with your actual icon components)
const MicIcon = () => (0, jsx_runtime_1.jsxs)("svg", { xmlns: "http://www.w3.org/2000/svg", height: "24px", viewBox: "0 0 24 24", width: "24px", fill: "#000000", children: [(0, jsx_runtime_1.jsx)("path", { d: "M0 0h24v24H0z", fill: "none" }), (0, jsx_runtime_1.jsx)("path", { d: "M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z" })] });
const StopIcon = () => (0, jsx_runtime_1.jsxs)("svg", { xmlns: "http://www.w3.org/2000/svg", height: "24px", viewBox: "0 0 24 24", width: "24px", fill: "#000000", children: [(0, jsx_runtime_1.jsx)("path", { d: "M0 0h24v24H0z", fill: "none" }), (0, jsx_runtime_1.jsx)("path", { d: "M6 6h12v12H6z" })] });
const CancelIcon = () => (0, jsx_runtime_1.jsxs)("svg", { xmlns: "http://www.w3.org/2000/svg", height: "24px", viewBox: "0 0 24 24", width: "24px", fill: "#000000", children: [(0, jsx_runtime_1.jsx)("path", { d: "M0 0h24v24H0z", fill: "none" }), (0, jsx_runtime_1.jsx)("path", { d: "M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" })] });
const PROCESS_AUDIO_NOTE_ENDPOINT = "/api/process-recorded-audio-note";
const AudioRecorder = ({ userId, initialLinkedEventId, initialSuggestedTitle, onRecordingComplete, onRecordingError, }) => {
    const [status, setStatus] = (0, react_1.useState)('idle');
    const [noteTitle, setNoteTitle] = (0, react_1.useState)(initialSuggestedTitle || '');
    const [currentLinkedEventId, setCurrentLinkedEventId] = (0, react_1.useState)(initialLinkedEventId);
    const [elapsedTime, setElapsedTime] = (0, react_1.useState)(0);
    const [errorMessage, setErrorMessage] = (0, react_1.useState)(undefined);
    const [audioBlob, setAudioBlob] = (0, react_1.useState)(undefined);
    const mediaRecorderRef = (0, react_1.useRef)(null);
    const audioChunksRef = (0, react_1.useRef)([]);
    const streamRef = (0, react_1.useRef)(null);
    const timerIntervalRef = (0, react_1.useRef)(null);
    const actualMimeTypeRef = (0, react_1.useRef)('');
    // Consume Agent Audio Control Context
    const { latestCommand, clearLastCommand } = (0, AgentAudioControlContext_1.useAgentAudioControl)();
    (0, react_1.useEffect)(() => {
        if (initialSuggestedTitle && status === 'idle') {
            setNoteTitle(initialSuggestedTitle);
        }
    }, [initialSuggestedTitle, status]);
    const formatTime = (timeInSeconds) => {
        const minutes = Math.floor(timeInSeconds / 60).toString().padStart(2, '0');
        const seconds = (timeInSeconds % 60).toString().padStart(2, '0');
        return `${minutes}:${seconds}`;
    };
    const cleanupRecordingResources = (0, react_1.useCallback)((preserveTitleOnError = false) => {
        if (timerIntervalRef.current) {
            clearInterval(timerIntervalRef.current);
            timerIntervalRef.current = null;
        }
        if (streamRef.current) {
            streamRef.current.getTracks().forEach(track => track.stop());
            streamRef.current = null;
        }
        if (mediaRecorderRef.current) {
            mediaRecorderRef.current.ondataavailable = null;
            mediaRecorderRef.current.onstop = null;
            mediaRecorderRef.current.onerror = null;
            if (mediaRecorderRef.current.state === 'recording') {
                try {
                    mediaRecorderRef.current.stop();
                }
                catch (e) {
                    console.warn("Error stopping MediaRecorder during cleanup:", e);
                }
            }
        }
        mediaRecorderRef.current = null;
        audioChunksRef.current = [];
        if (!preserveTitleOnError) { // Only reset title if not preserving on error
            setNoteTitle(initialSuggestedTitle || ''); // Reset to initial or empty
        }
    }, [initialSuggestedTitle]);
    (0, react_1.useEffect)(() => {
        return () => {
            cleanupRecordingResources();
        };
    }, [cleanupRecordingResources]);
    // Abstracted start recording logic to be callable by user action or agent command
    const startRecordingSession = (0, react_1.useCallback)(async (titleFromCommand, eventIdFromCommand) => {
        if (status !== 'idle' && status !== 'error') {
            console.warn("Recording session cannot start, current status:", status);
            return; // Don't start if already busy, unless it's an error state we want to override
        }
        setStatus('permissionPending');
        setErrorMessage(undefined);
        setAudioBlob(undefined);
        audioChunksRef.current = [];
        if (titleFromCommand)
            setNoteTitle(titleFromCommand);
        if (eventIdFromCommand)
            setCurrentLinkedEventId(eventIdFromCommand);
        if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            const errorMsg = "Microphone access is not supported by your browser.";
            setErrorMessage(errorMsg);
            setStatus('error');
            onRecordingError(errorMsg);
            return;
        }
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            streamRef.current = stream;
            const options = { mimeType: 'audio/webm;codecs=opus' };
            if (MediaRecorder.isTypeSupported(options.mimeType)) {
                actualMimeTypeRef.current = options.mimeType;
            }
            else if (MediaRecorder.isTypeSupported('audio/wav')) {
                actualMimeTypeRef.current = 'audio/wav';
            }
            else {
                actualMimeTypeRef.current = '';
            }
            console.log("Using MIME type:", actualMimeTypeRef.current);
            const recorder = new MediaRecorder(stream, actualMimeTypeRef.current ? { mimeType: actualMimeTypeRef.current } : undefined);
            mediaRecorderRef.current = recorder;
            recorder.ondataavailable = (event) => {
                if (event.data.size > 0) {
                    audioChunksRef.current.push(event.data);
                }
            };
            recorder.onstop = () => {
                const completeBlob = new Blob(audioChunksRef.current, { type: actualMimeTypeRef.current || audioChunksRef.current[0]?.type || 'application/octet-stream' });
                setAudioBlob(completeBlob);
                setStatus('stopped'); // This will trigger the useEffect for upload
                // Cleanup is now part of the onstop logic before setting status to 'stopped' or handled by it.
                // No, cleanup should happen *after* blob is formed and set, or when explicitly cancelled.
                // Let's ensure cleanup happens after blob is processed or on cancel.
                // The timer and stream tracks are stopped here.
                if (timerIntervalRef.current)
                    clearInterval(timerIntervalRef.current);
                if (streamRef.current)
                    streamRef.current.getTracks().forEach(track => track.stop());
            };
            recorder.onerror = (event) => {
                const errorEvent = event;
                const errorMsg = `MediaRecorder error: ${errorEvent.error?.name || 'Unknown error'}`;
                setErrorMessage(errorMsg);
                setStatus('error');
                onRecordingError(errorMsg);
                cleanupRecordingResources(true); // Preserve title on media recorder error
            };
            recorder.start();
            setStatus('recording');
            setElapsedTime(0);
            if (timerIntervalRef.current)
                clearInterval(timerIntervalRef.current);
            timerIntervalRef.current = setInterval(() => {
                setElapsedTime(prevTime => prevTime + 1);
            }, 1000);
        }
        catch (err) {
            let errorMsg = "Failed to access microphone.";
            if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                errorMsg = "Microphone permission denied. Please enable microphone access in your browser settings.";
            }
            else if (err.name === 'NotFoundError' || err.name === 'DevicesNotFoundError') {
                errorMsg = "No microphone found. Please ensure a microphone is connected and enabled.";
            }
            else {
                errorMsg = `Error accessing microphone: ${err.message || err.name}`;
            }
            setErrorMessage(errorMsg);
            setStatus('error');
            onRecordingError(errorMsg);
        }
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [status, onRecordingError]); // Removed cleanupRecordingResources from deps as it's stable
    // Abstracted stop recording logic
    const stopRecordingSession = (0, react_1.useCallback)(() => {
        if (mediaRecorderRef.current && mediaRecorderRef.current.state === 'recording') {
            mediaRecorderRef.current.stop(); // onstop handler will create blob and set status to 'stopped'
        }
        else {
            console.warn("Stop called but not in recording state or no mediaRecorder.");
        }
        // Timer is cleared in onstop or cancel
    }, []);
    // Abstracted cancel recording logic
    const cancelRecordingSession = (0, react_1.useCallback)(() => {
        cleanupRecordingResources();
        setAudioBlob(undefined);
        setElapsedTime(0);
        setStatus('idle');
        setNoteTitle(initialSuggestedTitle || '');
        setErrorMessage(undefined);
        setCurrentLinkedEventId(initialLinkedEventId);
    }, [cleanupRecordingResources, initialSuggestedTitle, initialLinkedEventId]);
    // Effect to handle commands from AgentAudioControlContext
    (0, react_1.useEffect)(() => {
        if (latestCommand) {
            console.log("AudioRecorder reacting to agent command:", latestCommand);
            const { action, payload } = latestCommand;
            switch (action) {
                case 'START_RECORDING_SESSION':
                    // Optionally, ask user for confirmation before starting via agent.
                    // For now, directly start.
                    if (status === 'idle' || status === 'error') { // Only start if not already doing something
                        setNoteTitle(payload?.suggestedTitle || initialSuggestedTitle || 'Agent Audio Note');
                        setCurrentLinkedEventId(payload?.linkedEventId || initialLinkedEventId);
                        startRecordingSession(payload?.suggestedTitle, payload?.linkedEventId);
                    }
                    else {
                        console.warn(`Agent commanded START_RECORDING_SESSION but current status is ${status}. Ignoring.`);
                        // TODO: Optionally send a NACK or BUSY status back to agent
                    }
                    break;
                case 'STOP_RECORDING_SESSION':
                    if (status === 'recording') {
                        stopRecordingSession();
                    }
                    else {
                        console.warn(`Agent commanded STOP_RECORDING_SESSION but current status is ${status}. Ignoring.`);
                    }
                    break;
                case 'CANCEL_RECORDING_SESSION':
                    if (status === 'recording' || status === 'permissionPending' || status === 'stopped') { // Can cancel even if stopped but not yet uploaded
                        cancelRecordingSession();
                    }
                    else {
                        console.warn(`Agent commanded CANCEL_RECORDING_SESSION but current status is ${status}. Ignoring.`);
                    }
                    break;
                default:
                    console.warn("Received unknown agent audio command action:", action);
            }
            clearLastCommand(); // Consume the command
        }
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [latestCommand, clearLastCommand, startRecordingSession, stopRecordingSession, cancelRecordingSession, status, initialSuggestedTitle, initialLinkedEventId]);
    const handleUploadAudio = (0, react_1.useCallback)(async () => {
        if (!audioBlob) { /* ... (rest of the upload logic remains largely the same) ... */
            const errorMsg = "No audio data available to upload.";
            setErrorMessage(errorMsg);
            setStatus('error');
            onRecordingError(errorMsg);
            return;
        }
        if (!userId) { /* ... */
            const errorMsg = "User ID is missing.";
            setErrorMessage(errorMsg);
            setStatus('error');
            onRecordingError(errorMsg);
            return;
        }
        setStatus('uploading');
        setErrorMessage(undefined);
        const formData = new FormData();
        const fileName = (noteTitle || 'audio_note').replace(/[^a-zA-Z0-9_-\s]/g, '_') + (actualMimeTypeRef.current.includes('wav') ? '.wav' : '.webm');
        formData.append('audio_file', audioBlob, fileName);
        formData.append('title', noteTitle || 'Audio Note - ' + new Date().toLocaleString());
        formData.append('user_id', userId);
        if (currentLinkedEventId) { // Use currentLinkedEventId from state
            formData.append('linked_event_id', currentLinkedEventId);
        }
        try {
            const response = await fetch(PROCESS_AUDIO_NOTE_ENDPOINT, {
                method: 'POST',
                body: formData,
            });
            const responseData = await response.json();
            if (response.ok && responseData.ok && responseData.data) {
                onRecordingComplete(responseData.data.notion_page_url, responseData.data.title, responseData.data.summary_preview);
                setStatus('idle');
                setNoteTitle(initialSuggestedTitle || '');
                setAudioBlob(undefined);
                setElapsedTime(0);
                setCurrentLinkedEventId(initialLinkedEventId);
            }
            else {
                const errorMsg = responseData.error?.message || responseData.message || `Failed to process audio note (HTTP ${response.status}).`;
                setErrorMessage(errorMsg);
                setStatus('error');
                onRecordingError(errorMsg);
            }
        }
        catch (err) {
            const errorMsg = `Network error or server unavailable: ${err.message || 'Unknown error'}`;
            setErrorMessage(errorMsg);
            setStatus('error');
            onRecordingError(errorMsg);
        }
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [audioBlob, noteTitle, userId, currentLinkedEventId, onRecordingComplete, onRecordingError, initialSuggestedTitle, initialLinkedEventId]);
    (0, react_1.useEffect)(() => {
        if (status === 'stopped' && audioBlob) {
            handleUploadAudio();
        }
    }, [status, audioBlob, handleUploadAudio]);
    // --- UI Event Handlers (for manual button clicks) ---
    const handleManualStart = () => {
        // When user clicks the UI button, start with current title and eventId from props/state
        startRecordingSession(noteTitle || initialSuggestedTitle, currentLinkedEventId || initialLinkedEventId);
    };
    const handleManualStopAndSave = () => {
        stopRecordingSession();
    };
    const handleManualCancel = () => {
        cancelRecordingSession();
    };
    // Basic styling (inline for simplicity, should be moved to CSS/SCSS modules or styled-components)
    // ... (styles object remains the same) ...
    const styles = {
        container: { border: '1px solid #ccc', padding: '20px', borderRadius: '8px', maxWidth: '500px', margin: '20px auto', fontFamily: 'Arial, sans-serif' },
        titleInput: { width: 'calc(100% - 22px)', padding: '10px', marginBottom: '10px', border: '1px solid #ddd', borderRadius: '4px' },
        statusMessage: { margin: '10px 0', padding: '10px', borderRadius: '4px', backgroundColor: '#f0f0f0' },
        errorMessage: { backgroundColor: '#ffe0e0', color: '#d00000', border: '1px solid #d00000' },
        recordingIndicator: { display: 'flex', alignItems: 'center', margin: '10px 0' },
        dot: { height: '12px', width: '12px', borderRadius: '50%', marginRight: '8px', backgroundColor: 'grey' },
        recordingDot: { backgroundColor: 'red', animation: 'pulse 1.5s infinite' },
        timer: { marginLeft: 'auto', fontVariantNumeric: 'tabular-nums' },
        buttonsContainer: { display: 'flex', justifyContent: 'space-around', marginTop: '15px' },
        button: { padding: '10px 15px', border: 'none', borderRadius: '4px', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '8px' },
        recordButton: { backgroundColor: '#4CAF50', color: 'white' },
        stopButton: { backgroundColor: '#f44336', color: 'white' },
        cancelButton: { backgroundColor: '#e0e0e0', color: 'black' },
    };
    return ((0, jsx_runtime_1.jsxs)("div", { style: styles.container, children: [(0, jsx_runtime_1.jsx)("h3", { children: "In-Person Audio Note" }), (status === 'idle' || status === 'recording' || status === 'error') && ((0, jsx_runtime_1.jsx)("input", { type: "text", style: styles.titleInput, value: noteTitle, onChange: (e) => setNoteTitle(e.target.value), placeholder: "Optional title for your audio note", disabled: status === 'recording' || status === 'uploading' || status === 'permissionPending' })), status === 'permissionPending' && (0, jsx_runtime_1.jsx)("p", { style: styles.statusMessage, children: "Requesting microphone permission..." }), status === 'uploading' && (0, jsx_runtime_1.jsx)("p", { style: styles.statusMessage, children: "Processing and saving your note..." }), errorMessage && status === 'error' && (0, jsx_runtime_1.jsx)("p", { style: { ...styles.statusMessage, ...styles.errorMessage }, children: errorMessage }), (status === 'recording') && ((0, jsx_runtime_1.jsxs)("div", { style: styles.recordingIndicator, children: [(0, jsx_runtime_1.jsx)("span", { style: { ...styles.dot, ...styles.recordingDot, animation: 'pulse 1.5s infinite' } }), (0, jsx_runtime_1.jsx)("span", { children: "Recording" }), (0, jsx_runtime_1.jsx)("span", { style: styles.timer, children: formatTime(elapsedTime) })] })), (0, jsx_runtime_1.jsxs)("div", { style: styles.buttonsContainer, children: [(status === 'idle' || status === 'error') && ( // User can manually start if idle or after an error
                    (0, jsx_runtime_1.jsxs)("button", { style: { ...styles.button, ...styles.recordButton }, onClick: handleManualStart, disabled: status === 'permissionPending', children: [(0, jsx_runtime_1.jsx)(MicIcon, {}), " Record"] })), status === 'recording' && ( // User can manually stop/cancel if they started it or if agent started it
                    (0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsxs)("button", { style: { ...styles.button, ...styles.stopButton }, onClick: handleManualStopAndSave, children: [(0, jsx_runtime_1.jsx)(StopIcon, {}), " Stop & Save"] }), (0, jsx_runtime_1.jsxs)("button", { style: { ...styles.button, ...styles.cancelButton }, onClick: handleManualCancel, children: [(0, jsx_runtime_1.jsx)(CancelIcon, {}), " Cancel"] })] }))] })] }));
};
exports.default = AudioRecorder;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXVkaW9SZWNvcmRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkF1ZGlvUmVjb3JkZXIudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLGlDQUF3RTtBQUN4RSxzRkFBa0csQ0FBQyxnQkFBZ0I7QUFFbkgsK0RBQStEO0FBQy9ELE1BQU0sT0FBTyxHQUFHLEdBQUcsRUFBRSxDQUFDLGlDQUFLLEtBQUssRUFBQyw0QkFBNEIsRUFBQyxNQUFNLEVBQUMsTUFBTSxFQUFDLE9BQU8sRUFBQyxXQUFXLEVBQUMsS0FBSyxFQUFDLE1BQU0sRUFBQyxJQUFJLEVBQUMsU0FBUyxhQUFDLGlDQUFNLENBQUMsRUFBQyxlQUFlLEVBQUMsSUFBSSxFQUFDLE1BQU0sR0FBRSxFQUFBLGlDQUFNLENBQUMsRUFBQyxpTUFBaU0sR0FBRSxJQUFNLENBQUM7QUFDblgsTUFBTSxRQUFRLEdBQUcsR0FBRyxFQUFFLENBQUMsaUNBQUssS0FBSyxFQUFDLDRCQUE0QixFQUFDLE1BQU0sRUFBQyxNQUFNLEVBQUMsT0FBTyxFQUFDLFdBQVcsRUFBQyxLQUFLLEVBQUMsTUFBTSxFQUFDLElBQUksRUFBQyxTQUFTLGFBQUMsaUNBQU0sQ0FBQyxFQUFDLGVBQWUsRUFBQyxJQUFJLEVBQUMsTUFBTSxHQUFFLEVBQUEsaUNBQU0sQ0FBQyxFQUFDLGVBQWUsR0FBRSxJQUFNLENBQUM7QUFDbE0sTUFBTSxVQUFVLEdBQUcsR0FBRyxFQUFFLENBQUMsaUNBQUssS0FBSyxFQUFDLDRCQUE0QixFQUFDLE1BQU0sRUFBQyxNQUFNLEVBQUMsT0FBTyxFQUFDLFdBQVcsRUFBQyxLQUFLLEVBQUMsTUFBTSxFQUFDLElBQUksRUFBQyxTQUFTLGFBQUMsaUNBQU0sQ0FBQyxFQUFDLGVBQWUsRUFBQyxJQUFJLEVBQUMsTUFBTSxHQUFFLEVBQUEsaUNBQU0sQ0FBQyxFQUFDLHVHQUF1RyxHQUFFLElBQU0sQ0FBQztBQWU1UixNQUFNLDJCQUEyQixHQUFHLGtDQUFrQyxDQUFDO0FBRXZF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QUFXLENBQUMsR0FBUSxJQUN2RCxDQUNQLEVBRUQsaUNBQUssS0FBSyxFQUFFLE1BQU0sQ0FBQyxnQkFBZ0IsYUFDaEMsQ0FBQyxNQUFNLEtBQUssTUFBTSxJQUFJLE1BQU0sS0FBSyxPQUFPLENBQUMsSUFBSSxFQUFFLG9EQUFvRDtvQkFDbEcsb0NBQVEsS0FBSyxFQUFFLEVBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxFQUFFLEdBQUcsTUFBTSxDQUFDLFlBQVksRUFBQyxFQUFFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxRQUFRLEVBQUUsTUFBTSxLQUFLLG1CQUFtQixhQUM3SCx1QkFBQyxPQUFPLEtBQUcsZUFDSixDQUNWLEVBRUEsTUFBTSxLQUFLLFdBQVcsSUFBSSxFQUFFLDBFQUEwRTtvQkFDckcsNkRBQ0Usb0NBQVEsS0FBSyxFQUFFLEVBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxFQUFFLEdBQUcsTUFBTSxDQUFDLFVBQVUsRUFBQyxFQUFFLE9BQU8sRUFBRSx1QkFBdUIsYUFDdkYsdUJBQUMsUUFBUSxLQUFHLG9CQUNMLEVBQ1Qsb0NBQVEsS0FBSyxFQUFFLEVBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxFQUFFLEdBQUcsTUFBTSxDQUFDLFlBQVksRUFBQyxFQUFFLE9BQU8sRUFBRSxrQkFBa0IsYUFDcEYsdUJBQUMsVUFBVSxLQUFHLGVBQ1AsSUFDUixDQUNKLElBQ0csSUFDRixDQUNQLENBQUM7QUFDSixDQUFDLENBQUM7QUFFRixrQkFBZSxhQUFhLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlU3RhdGUsIHVzZVJlZiwgdXNlRWZmZWN0LCB1c2VDYWxsYmFjayB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHVzZUFnZW50QXVkaW9Db250cm9sLCBBZ2VudEF1ZGlvQ29tbWFuZCB9IGZyb20gJy4uLy4uL2NvbnRleHRzL0FnZW50QXVkaW9Db250cm9sQ29udGV4dCc7IC8vIEFkanVzdGVkIHBhdGhcblxuLy8gUGxhY2Vob2xkZXIgSWNvbnMgKHJlcGxhY2Ugd2l0aCB5b3VyIGFjdHVhbCBpY29uIGNvbXBvbmVudHMpXG5jb25zdCBNaWNJY29uID0gKCkgPT4gPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgaGVpZ2h0PVwiMjRweFwiIHZpZXdCb3g9XCIwIDAgMjQgMjRcIiB3aWR0aD1cIjI0cHhcIiBmaWxsPVwiIzAwMDAwMFwiPjxwYXRoIGQ9XCJNMCAwaDI0djI0SDB6XCIgZmlsbD1cIm5vbmVcIi8+PHBhdGggZD1cIk0xMiAxNGMxLjY2IDAgMi45OS0xLjM0IDIuOTktM0wxNSA1YzAtMS42Ni0xLjM0LTMtMy0zUzkgMy4zNCA5IDV2NmMwIDEuNjYgMS4zNCAzIDMgM3ptNS4zLTNjMCAzLTIuNTQgNS4xLTUuMyA1LjFTNi43IDE0IDYuNyAxMUg1YzAgMy40MSAyLjcyIDYuMjMgNiA2LjcyVjIxaDJ2LTMuMjhjMy4yOC0uNDggNi0zLjMgNi02LjcyaC0xLjd6XCIvPjwvc3ZnPjtcbmNvbnN0IFN0b3BJY29uID0gKCkgPT4gPHN2ZyB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIgaGVpZ2h0PVwiMjRweFwiIHZpZXdCb3g9XCIwIDAgMjQgMjRcIiB3aWR0aD1cIjI0cHhcIiBmaWxsPVwiIzAwMDAwMFwiPjxwYXRoIGQ9XCJNMCAwaDI0djI0SDB6XCIgZmlsbD1cIm5vbmVcIi8+PHBhdGggZD1cIk02IDZoMTJ2MTJINnpcIi8+PC9zdmc+O1xuY29uc3QgQ2FuY2VsSWNvbiA9ICgpID0+IDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIGhlaWdodD1cIjI0cHhcIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgd2lkdGg9XCIyNHB4XCIgZmlsbD1cIiMwMDAwMDBcIj48cGF0aCBkPVwiTTAgMGgyNHYyNEgwelwiIGZpbGw9XCJub25lXCIvPjxwYXRoIGQ9XCJNMTkgNi40MUwxNy41OSA1IDEyIDEwLjU5IDYuNDEgNSA1IDYuNDEgMTAuNTkgMTIgNSAxNy41OSA2LjQxIDE5IDEyIDEzLjQxIDE3LjU5IDE5IDE5IDE3LjU5IDEzLjQxIDEyelwiLz48L3N2Zz47XG5cbmludGVyZmFjZSBBdWRpb1JlY29yZGVyUHJvcHMge1xuICB1c2VySWQ6IHN0cmluZztcbiAgLy8gbGlua2VkRXZlbnRJZCBpcyBub3cgcHJpbWFyaWx5IHNldCB2aWEgYWdlbnQgY29tbWFuZCBwYXlsb2FkIG9yIGlmIGNvbXBvbmVudCBpcyB1c2VkIGluIGEgc3BlY2lmaWMgZXZlbnQgY29udGV4dFxuICBpbml0aWFsTGlua2VkRXZlbnRJZD86IHN0cmluZztcbiAgaW5pdGlhbFN1Z2dlc3RlZFRpdGxlPzogc3RyaW5nOyAvLyBSZW5hbWVkIGZyb20gc3VnZ2VzdGVkVGl0bGUgdG8gaW5pdGlhbFN1Z2dlc3RlZFRpdGxlIGZvciBjbGFyaXR5XG4gIG9uUmVjb3JkaW5nQ29tcGxldGU6IChub3Rpb25QYWdlVXJsOiBzdHJpbmcsIHRpdGxlOiBzdHJpbmcsIHN1bW1hcnlQcmV2aWV3Pzogc3RyaW5nKSA9PiB2b2lkO1xuICBvblJlY29yZGluZ0Vycm9yOiAoZXJyb3JNZXNzYWdlOiBzdHJpbmcpID0+IHZvaWQ7XG4gIC8vIFRoaXMgY29tcG9uZW50IHdpbGwgbm93IHByaW1hcmlseSBiZSBjb250cm9sbGVkIGJ5IGFnZW50IGNvbW1hbmRzIHZpYSBjb250ZXh0LFxuICAvLyBidXQgY2FuIGFsc28gYmUgdXNlZCBzdGFuZGFsb25lICh1c2VyIGNsaWNrcyByZWNvcmQgYnV0dG9uKS5cbn1cblxudHlwZSBSZWNvcmRpbmdTdGF0dXMgPSAnaWRsZScgfCAncGVybWlzc2lvblBlbmRpbmcnIHwgJ3JlY29yZGluZycgfCAnc3RvcHBlZCcgfCAndXBsb2FkaW5nJyB8ICdlcnJvcic7XG5cbmNvbnN0IFBST0NFU1NfQVVESU9fTk9URV9FTkRQT0lOVCA9IFwiL2FwaS9wcm9jZXNzLXJlY29yZGVkLWF1ZGlvLW5vdGVcIjtcblxuY29uc3QgQXVkaW9SZWNvcmRlcjogUmVhY3QuRkM8QXVkaW9SZWNvcmRlclByb3BzPiA9ICh7XG4gIHVzZXJJZCxcbiAgaW5pdGlhbExpbmtlZEV2ZW50SWQsXG4gIGluaXRpYWxTdWdnZXN0ZWRUaXRsZSxcbiAgb25SZWNvcmRpbmdDb21wbGV0ZSxcbiAgb25SZWNvcmRpbmdFcnJvcixcbn0pID0+IHtcbiAgY29uc3QgW3N0YXR1cywgc2V0U3RhdHVzXSA9IHVzZVN0YXRlPFJlY29yZGluZ1N0YXR1cz4oJ2lkbGUnKTtcbiAgY29uc3QgW25vdGVUaXRsZSwgc2V0Tm90ZVRpdGxlXSA9IHVzZVN0YXRlPHN0cmluZz4oaW5pdGlhbFN1Z2dlc3RlZFRpdGxlIHx8ICcnKTtcbiAgY29uc3QgW2N1cnJlbnRMaW5rZWRFdmVudElkLCBzZXRDdXJyZW50TGlua2VkRXZlbnRJZF0gPSB1c2VTdGF0ZTxzdHJpbmcgfCB1bmRlZmluZWQ+KGluaXRpYWxMaW5rZWRFdmVudElkKTtcbiAgY29uc3QgW2VsYXBzZWRUaW1lLCBzZXRFbGFwc2VkVGltZV0gPSB1c2VTdGF0ZTxudW1iZXI+KDApO1xuICBjb25zdCBbZXJyb3JNZXNzYWdlLCBzZXRFcnJvck1lc3NhZ2VdID0gdXNlU3RhdGU8c3RyaW5nIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpO1xuICBjb25zdCBbYXVkaW9CbG9iLCBzZXRBdWRpb0Jsb2JdID0gdXNlU3RhdGU8QmxvYiB8IHVuZGVmaW5lZD4odW5kZWZpbmVkKTtcblxuICBjb25zdCBtZWRpYVJlY29yZGVyUmVmID0gdXNlUmVmPE1lZGlhUmVjb3JkZXIgfCBudWxsPihudWxsKTtcbiAgY29uc3QgYXVkaW9DaHVua3NSZWYgPSB1c2VSZWY8QmxvYltdPihbXSk7XG4gIGNvbnN0IHN0cmVhbVJlZiA9IHVzZVJlZjxNZWRpYVN0cmVhbSB8IG51bGw+KG51bGwpO1xuICBjb25zdCB0aW1lckludGVydmFsUmVmID0gdXNlUmVmPE5vZGVKUy5UaW1lb3V0IHwgbnVsbD4obnVsbCk7XG4gIGNvbnN0IGFjdHVhbE1pbWVUeXBlUmVmID0gdXNlUmVmPHN0cmluZz4oJycpO1xuXG4gIC8vIENvbnN1bWUgQWdlbnQgQXVkaW8gQ29udHJvbCBDb250ZXh0XG4gIGNvbnN0IHsgbGF0ZXN0Q29tbWFuZCwgY2xlYXJMYXN0Q29tbWFuZCB9ID0gdXNlQWdlbnRBdWRpb0NvbnRyb2woKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChpbml0aWFsU3VnZ2VzdGVkVGl0bGUgJiYgc3RhdHVzID09PSAnaWRsZScpIHtcbiAgICAgIHNldE5vdGVUaXRsZShpbml0aWFsU3VnZ2VzdGVkVGl0bGUpO1xuICAgIH1cbiAgfSwgW2luaXRpYWxTdWdnZXN0ZWRUaXRsZSwgc3RhdHVzXSk7XG5cbiAgY29uc3QgZm9ybWF0VGltZSA9ICh0aW1lSW5TZWNvbmRzOiBudW1iZXIpOiBzdHJpbmcgPT4ge1xuICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKHRpbWVJblNlY29uZHMgLyA2MCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpO1xuICAgIGNvbnN0IHNlY29uZHMgPSAodGltZUluU2Vjb25kcyAlIDYwKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7XG4gICAgcmV0dXJuIGAke21pbnV0ZXN9OiR7c2Vjb25kc31gO1xuICB9O1xuXG4gIGNvbnN0IGNsZWFudXBSZWNvcmRpbmdSZXNvdXJjZXMgPSB1c2VDYWxsYmFjaygocHJlc2VydmVUaXRsZU9uRXJyb3IgPSBmYWxzZSkgPT4ge1xuICAgIGlmICh0aW1lckludGVydmFsUmVmLmN1cnJlbnQpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGltZXJJbnRlcnZhbFJlZi5jdXJyZW50KTtcbiAgICAgIHRpbWVySW50ZXJ2YWxSZWYuY3VycmVudCA9IG51bGw7XG4gICAgfVxuICAgIGlmIChzdHJlYW1SZWYuY3VycmVudCkge1xuICAgICAgc3RyZWFtUmVmLmN1cnJlbnQuZ2V0VHJhY2tzKCkuZm9yRWFjaCh0cmFjayA9PiB0cmFjay5zdG9wKCkpO1xuICAgICAgc3RyZWFtUmVmLmN1cnJlbnQgPSBudWxsO1xuICAgIH1cbiAgICBpZiAobWVkaWFSZWNvcmRlclJlZi5jdXJyZW50KSB7XG4gICAgICAgIG1lZGlhUmVjb3JkZXJSZWYuY3VycmVudC5vbmRhdGFhdmFpbGFibGUgPSBudWxsO1xuICAgICAgICBtZWRpYVJlY29yZGVyUmVmLmN1cnJlbnQub25zdG9wID0gbnVsbDtcbiAgICAgICAgbWVkaWFSZWNvcmRlclJlZi5jdXJyZW50Lm9uZXJyb3IgPSBudWxsO1xuICAgICAgICBpZiAobWVkaWFSZWNvcmRlclJlZi5jdXJyZW50LnN0YXRlID09PSAncmVjb3JkaW5nJykge1xuICAgICAgICAgICAgdHJ5IHsgbWVkaWFSZWNvcmRlclJlZi5jdXJyZW50LnN0b3AoKTsgfSBjYXRjaCAoZSkgeyBjb25zb2xlLndhcm4oXCJFcnJvciBzdG9wcGluZyBNZWRpYVJlY29yZGVyIGR1cmluZyBjbGVhbnVwOlwiLCBlKTsgfVxuICAgICAgICB9XG4gICAgfVxuICAgIG1lZGlhUmVjb3JkZXJSZWYuY3VycmVudCA9IG51bGw7XG4gICAgYXVkaW9DaHVua3NSZWYuY3VycmVudCA9IFtdO1xuICAgIGlmICghcHJlc2VydmVUaXRsZU9uRXJyb3IpIHsgLy8gT25seSByZXNldCB0aXRsZSBpZiBub3QgcHJlc2VydmluZyBvbiBlcnJvclxuICAgICAgICBzZXROb3RlVGl0bGUoaW5pdGlhbFN1Z2dlc3RlZFRpdGxlIHx8ICcnKTsgLy8gUmVzZXQgdG8gaW5pdGlhbCBvciBlbXB0eVxuICAgIH1cbiAgfSwgW2luaXRpYWxTdWdnZXN0ZWRUaXRsZV0pO1xuXG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgY2xlYW51cFJlY29yZGluZ1Jlc291cmNlcygpO1xuICAgIH07XG4gIH0sIFtjbGVhbnVwUmVjb3JkaW5nUmVzb3VyY2VzXSk7XG5cbiAgLy8gQWJzdHJhY3RlZCBzdGFydCByZWNvcmRpbmcgbG9naWMgdG8gYmUgY2FsbGFibGUgYnkgdXNlciBhY3Rpb24gb3IgYWdlbnQgY29tbWFuZFxuICBjb25zdCBzdGFydFJlY29yZGluZ1Nlc3Npb24gPSB1c2VDYWxsYmFjayhhc3luYyAodGl0bGVGcm9tQ29tbWFuZD86IHN0cmluZywgZXZlbnRJZEZyb21Db21tYW5kPzogc3RyaW5nKSA9PiB7XG4gICAgaWYgKHN0YXR1cyAhPT0gJ2lkbGUnICYmIHN0YXR1cyAhPT0gJ2Vycm9yJykge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJSZWNvcmRpbmcgc2Vzc2lvbiBjYW5ub3Qgc3RhcnQsIGN1cnJlbnQgc3RhdHVzOlwiLCBzdGF0dXMpO1xuICAgICAgICByZXR1cm47IC8vIERvbid0IHN0YXJ0IGlmIGFscmVhZHkgYnVzeSwgdW5sZXNzIGl0J3MgYW4gZXJyb3Igc3RhdGUgd2Ugd2FudCB0byBvdmVycmlkZVxuICAgIH1cbiAgICBzZXRTdGF0dXMoJ3Blcm1pc3Npb25QZW5kaW5nJyk7XG4gICAgc2V0RXJyb3JNZXNzYWdlKHVuZGVmaW5lZCk7XG4gICAgc2V0QXVkaW9CbG9iKHVuZGVmaW5lZCk7XG4gICAgYXVkaW9DaHVua3NSZWYuY3VycmVudCA9IFtdO1xuICAgIGlmICh0aXRsZUZyb21Db21tYW5kKSBzZXROb3RlVGl0bGUodGl0bGVGcm9tQ29tbWFuZCk7XG4gICAgaWYgKGV2ZW50SWRGcm9tQ29tbWFuZCkgc2V0Q3VycmVudExpbmtlZEV2ZW50SWQoZXZlbnRJZEZyb21Db21tYW5kKTtcblxuXG4gICAgaWYgKCFuYXZpZ2F0b3IubWVkaWFEZXZpY2VzIHx8ICFuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSkge1xuICAgICAgY29uc3QgZXJyb3JNc2cgPSBcIk1pY3JvcGhvbmUgYWNjZXNzIGlzIG5vdCBzdXBwb3J0ZWQgYnkgeW91ciBicm93c2VyLlwiO1xuICAgICAgc2V0RXJyb3JNZXNzYWdlKGVycm9yTXNnKTtcbiAgICAgIHNldFN0YXR1cygnZXJyb3InKTtcbiAgICAgIG9uUmVjb3JkaW5nRXJyb3IoZXJyb3JNc2cpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdHJlYW0gPSBhd2FpdCBuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSh7IGF1ZGlvOiB0cnVlIH0pO1xuICAgICAgc3RyZWFtUmVmLmN1cnJlbnQgPSBzdHJlYW07XG5cbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB7IG1pbWVUeXBlOiAnYXVkaW8vd2VibTtjb2RlY3M9b3B1cycgfTtcbiAgICAgIGlmIChNZWRpYVJlY29yZGVyLmlzVHlwZVN1cHBvcnRlZChvcHRpb25zLm1pbWVUeXBlKSkge1xuICAgICAgICBhY3R1YWxNaW1lVHlwZVJlZi5jdXJyZW50ID0gb3B0aW9ucy5taW1lVHlwZTtcbiAgICAgIH0gZWxzZSBpZiAoTWVkaWFSZWNvcmRlci5pc1R5cGVTdXBwb3J0ZWQoJ2F1ZGlvL3dhdicpKSB7XG4gICAgICAgIGFjdHVhbE1pbWVUeXBlUmVmLmN1cnJlbnQgPSAnYXVkaW8vd2F2JztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFjdHVhbE1pbWVUeXBlUmVmLmN1cnJlbnQgPSAnJztcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKFwiVXNpbmcgTUlNRSB0eXBlOlwiLCBhY3R1YWxNaW1lVHlwZVJlZi5jdXJyZW50KTtcblxuICAgICAgY29uc3QgcmVjb3JkZXIgPSBuZXcgTWVkaWFSZWNvcmRlcihzdHJlYW0sIGFjdHVhbE1pbWVUeXBlUmVmLmN1cnJlbnQgPyB7IG1pbWVUeXBlOiBhY3R1YWxNaW1lVHlwZVJlZi5jdXJyZW50IH0gOiB1bmRlZmluZWQpO1xuICAgICAgbWVkaWFSZWNvcmRlclJlZi5jdXJyZW50ID0gcmVjb3JkZXI7XG5cbiAgICAgIHJlY29yZGVyLm9uZGF0YWF2YWlsYWJsZSA9IChldmVudDogQmxvYkV2ZW50KSA9PiB7XG4gICAgICAgIGlmIChldmVudC5kYXRhLnNpemUgPiAwKSB7XG4gICAgICAgICAgYXVkaW9DaHVua3NSZWYuY3VycmVudC5wdXNoKGV2ZW50LmRhdGEpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICByZWNvcmRlci5vbnN0b3AgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGNvbXBsZXRlQmxvYiA9IG5ldyBCbG9iKGF1ZGlvQ2h1bmtzUmVmLmN1cnJlbnQsIHsgdHlwZTogYWN0dWFsTWltZVR5cGVSZWYuY3VycmVudCB8fCBhdWRpb0NodW5rc1JlZi5jdXJyZW50WzBdPy50eXBlIHx8ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nIH0pO1xuICAgICAgICBzZXRBdWRpb0Jsb2IoY29tcGxldGVCbG9iKTtcbiAgICAgICAgc2V0U3RhdHVzKCdzdG9wcGVkJyk7IC8vIFRoaXMgd2lsbCB0cmlnZ2VyIHRoZSB1c2VFZmZlY3QgZm9yIHVwbG9hZFxuICAgICAgICAvLyBDbGVhbnVwIGlzIG5vdyBwYXJ0IG9mIHRoZSBvbnN0b3AgbG9naWMgYmVmb3JlIHNldHRpbmcgc3RhdHVzIHRvICdzdG9wcGVkJyBvciBoYW5kbGVkIGJ5IGl0LlxuICAgICAgICAvLyBObywgY2xlYW51cCBzaG91bGQgaGFwcGVuICphZnRlciogYmxvYiBpcyBmb3JtZWQgYW5kIHNldCwgb3Igd2hlbiBleHBsaWNpdGx5IGNhbmNlbGxlZC5cbiAgICAgICAgLy8gTGV0J3MgZW5zdXJlIGNsZWFudXAgaGFwcGVucyBhZnRlciBibG9iIGlzIHByb2Nlc3NlZCBvciBvbiBjYW5jZWwuXG4gICAgICAgIC8vIFRoZSB0aW1lciBhbmQgc3RyZWFtIHRyYWNrcyBhcmUgc3RvcHBlZCBoZXJlLlxuICAgICAgICBpZiAodGltZXJJbnRlcnZhbFJlZi5jdXJyZW50KSBjbGVhckludGVydmFsKHRpbWVySW50ZXJ2YWxSZWYuY3VycmVudCk7XG4gICAgICAgIGlmIChzdHJlYW1SZWYuY3VycmVudCkgc3RyZWFtUmVmLmN1cnJlbnQuZ2V0VHJhY2tzKCkuZm9yRWFjaCh0cmFjayA9PiB0cmFjay5zdG9wKCkpO1xuXG4gICAgICB9O1xuXG4gICAgICByZWNvcmRlci5vbmVycm9yID0gKGV2ZW50OiBFdmVudCkgPT4ge1xuICAgICAgICBjb25zdCBlcnJvckV2ZW50ID0gZXZlbnQgYXMgYW55O1xuICAgICAgICBjb25zdCBlcnJvck1zZyA9IGBNZWRpYVJlY29yZGVyIGVycm9yOiAke2Vycm9yRXZlbnQuZXJyb3I/Lm5hbWUgfHwgJ1Vua25vd24gZXJyb3InfWA7XG4gICAgICAgIHNldEVycm9yTWVzc2FnZShlcnJvck1zZyk7XG4gICAgICAgIHNldFN0YXR1cygnZXJyb3InKTtcbiAgICAgICAgb25SZWNvcmRpbmdFcnJvcihlcnJvck1zZyk7XG4gICAgICAgIGNsZWFudXBSZWNvcmRpbmdSZXNvdXJjZXModHJ1ZSk7IC8vIFByZXNlcnZlIHRpdGxlIG9uIG1lZGlhIHJlY29yZGVyIGVycm9yXG4gICAgICB9O1xuXG4gICAgICByZWNvcmRlci5zdGFydCgpO1xuICAgICAgc2V0U3RhdHVzKCdyZWNvcmRpbmcnKTtcbiAgICAgIHNldEVsYXBzZWRUaW1lKDApO1xuICAgICAgaWYgKHRpbWVySW50ZXJ2YWxSZWYuY3VycmVudCkgY2xlYXJJbnRlcnZhbCh0aW1lckludGVydmFsUmVmLmN1cnJlbnQpO1xuICAgICAgdGltZXJJbnRlcnZhbFJlZi5jdXJyZW50ID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICBzZXRFbGFwc2VkVGltZShwcmV2VGltZSA9PiBwcmV2VGltZSArIDEpO1xuICAgICAgfSwgMTAwMCk7XG5cbiAgICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgICAgbGV0IGVycm9yTXNnID0gXCJGYWlsZWQgdG8gYWNjZXNzIG1pY3JvcGhvbmUuXCI7XG4gICAgICBpZiAoZXJyLm5hbWUgPT09ICdOb3RBbGxvd2VkRXJyb3InIHx8IGVyci5uYW1lID09PSAnUGVybWlzc2lvbkRlbmllZEVycm9yJykge1xuICAgICAgICBlcnJvck1zZyA9IFwiTWljcm9waG9uZSBwZXJtaXNzaW9uIGRlbmllZC4gUGxlYXNlIGVuYWJsZSBtaWNyb3Bob25lIGFjY2VzcyBpbiB5b3VyIGJyb3dzZXIgc2V0dGluZ3MuXCI7XG4gICAgICB9IGVsc2UgaWYgKGVyci5uYW1lID09PSAnTm90Rm91bmRFcnJvcicgfHwgZXJyLm5hbWUgPT09ICdEZXZpY2VzTm90Rm91bmRFcnJvcicpIHtcbiAgICAgICAgZXJyb3JNc2cgPSBcIk5vIG1pY3JvcGhvbmUgZm91bmQuIFBsZWFzZSBlbnN1cmUgYSBtaWNyb3Bob25lIGlzIGNvbm5lY3RlZCBhbmQgZW5hYmxlZC5cIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVycm9yTXNnID0gYEVycm9yIGFjY2Vzc2luZyBtaWNyb3Bob25lOiAke2Vyci5tZXNzYWdlIHx8IGVyci5uYW1lfWA7XG4gICAgICB9XG4gICAgICBzZXRFcnJvck1lc3NhZ2UoZXJyb3JNc2cpO1xuICAgICAgc2V0U3RhdHVzKCdlcnJvcicpO1xuICAgICAgb25SZWNvcmRpbmdFcnJvcihlcnJvck1zZyk7XG4gICAgfVxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gIH0sIFtzdGF0dXMsIG9uUmVjb3JkaW5nRXJyb3JdKTsgLy8gUmVtb3ZlZCBjbGVhbnVwUmVjb3JkaW5nUmVzb3VyY2VzIGZyb20gZGVwcyBhcyBpdCdzIHN0YWJsZVxuXG4gIC8vIEFic3RyYWN0ZWQgc3RvcCByZWNvcmRpbmcgbG9naWNcbiAgY29uc3Qgc3RvcFJlY29yZGluZ1Nlc3Npb24gPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgaWYgKG1lZGlhUmVjb3JkZXJSZWYuY3VycmVudCAmJiBtZWRpYVJlY29yZGVyUmVmLmN1cnJlbnQuc3RhdGUgPT09ICdyZWNvcmRpbmcnKSB7XG4gICAgICBtZWRpYVJlY29yZGVyUmVmLmN1cnJlbnQuc3RvcCgpOyAvLyBvbnN0b3AgaGFuZGxlciB3aWxsIGNyZWF0ZSBibG9iIGFuZCBzZXQgc3RhdHVzIHRvICdzdG9wcGVkJ1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIlN0b3AgY2FsbGVkIGJ1dCBub3QgaW4gcmVjb3JkaW5nIHN0YXRlIG9yIG5vIG1lZGlhUmVjb3JkZXIuXCIpO1xuICAgIH1cbiAgICAvLyBUaW1lciBpcyBjbGVhcmVkIGluIG9uc3RvcCBvciBjYW5jZWxcbiAgfSwgW10pO1xuXG4gIC8vIEFic3RyYWN0ZWQgY2FuY2VsIHJlY29yZGluZyBsb2dpY1xuICBjb25zdCBjYW5jZWxSZWNvcmRpbmdTZXNzaW9uID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGNsZWFudXBSZWNvcmRpbmdSZXNvdXJjZXMoKTtcbiAgICBzZXRBdWRpb0Jsb2IodW5kZWZpbmVkKTtcbiAgICBzZXRFbGFwc2VkVGltZSgwKTtcbiAgICBzZXRTdGF0dXMoJ2lkbGUnKTtcbiAgICBzZXROb3RlVGl0bGUoaW5pdGlhbFN1Z2dlc3RlZFRpdGxlIHx8ICcnKTtcbiAgICBzZXRFcnJvck1lc3NhZ2UodW5kZWZpbmVkKTtcbiAgICBzZXRDdXJyZW50TGlua2VkRXZlbnRJZChpbml0aWFsTGlua2VkRXZlbnRJZCk7XG4gIH0sIFtjbGVhbnVwUmVjb3JkaW5nUmVzb3VyY2VzLCBpbml0aWFsU3VnZ2VzdGVkVGl0bGUsIGluaXRpYWxMaW5rZWRFdmVudElkXSk7XG5cblxuICAvLyBFZmZlY3QgdG8gaGFuZGxlIGNvbW1hbmRzIGZyb20gQWdlbnRBdWRpb0NvbnRyb2xDb250ZXh0XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGxhdGVzdENvbW1hbmQpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiQXVkaW9SZWNvcmRlciByZWFjdGluZyB0byBhZ2VudCBjb21tYW5kOlwiLCBsYXRlc3RDb21tYW5kKTtcbiAgICAgIGNvbnN0IHsgYWN0aW9uLCBwYXlsb2FkIH0gPSBsYXRlc3RDb21tYW5kO1xuICAgICAgc3dpdGNoIChhY3Rpb24pIHtcbiAgICAgICAgY2FzZSAnU1RBUlRfUkVDT1JESU5HX1NFU1NJT04nOlxuICAgICAgICAgIC8vIE9wdGlvbmFsbHksIGFzayB1c2VyIGZvciBjb25maXJtYXRpb24gYmVmb3JlIHN0YXJ0aW5nIHZpYSBhZ2VudC5cbiAgICAgICAgICAvLyBGb3Igbm93LCBkaXJlY3RseSBzdGFydC5cbiAgICAgICAgICBpZiAoc3RhdHVzID09PSAnaWRsZScgfHwgc3RhdHVzID09PSAnZXJyb3InKSB7IC8vIE9ubHkgc3RhcnQgaWYgbm90IGFscmVhZHkgZG9pbmcgc29tZXRoaW5nXG4gICAgICAgICAgICBzZXROb3RlVGl0bGUocGF5bG9hZD8uc3VnZ2VzdGVkVGl0bGUgfHwgaW5pdGlhbFN1Z2dlc3RlZFRpdGxlIHx8ICdBZ2VudCBBdWRpbyBOb3RlJyk7XG4gICAgICAgICAgICBzZXRDdXJyZW50TGlua2VkRXZlbnRJZChwYXlsb2FkPy5saW5rZWRFdmVudElkIHx8IGluaXRpYWxMaW5rZWRFdmVudElkKTtcbiAgICAgICAgICAgIHN0YXJ0UmVjb3JkaW5nU2Vzc2lvbihwYXlsb2FkPy5zdWdnZXN0ZWRUaXRsZSwgcGF5bG9hZD8ubGlua2VkRXZlbnRJZCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgQWdlbnQgY29tbWFuZGVkIFNUQVJUX1JFQ09SRElOR19TRVNTSU9OIGJ1dCBjdXJyZW50IHN0YXR1cyBpcyAke3N0YXR1c30uIElnbm9yaW5nLmApO1xuICAgICAgICAgICAgLy8gVE9ETzogT3B0aW9uYWxseSBzZW5kIGEgTkFDSyBvciBCVVNZIHN0YXR1cyBiYWNrIHRvIGFnZW50XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdTVE9QX1JFQ09SRElOR19TRVNTSU9OJzpcbiAgICAgICAgICBpZiAoc3RhdHVzID09PSAncmVjb3JkaW5nJykge1xuICAgICAgICAgICAgc3RvcFJlY29yZGluZ1Nlc3Npb24oKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgIGNvbnNvbGUud2FybihgQWdlbnQgY29tbWFuZGVkIFNUT1BfUkVDT1JESU5HX1NFU1NJT04gYnV0IGN1cnJlbnQgc3RhdHVzIGlzICR7c3RhdHVzfS4gSWdub3JpbmcuYCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdDQU5DRUxfUkVDT1JESU5HX1NFU1NJT04nOlxuICAgICAgICAgIGlmIChzdGF0dXMgPT09ICdyZWNvcmRpbmcnIHx8IHN0YXR1cyA9PT0gJ3Blcm1pc3Npb25QZW5kaW5nJyB8fCBzdGF0dXMgPT09ICdzdG9wcGVkJykgeyAvLyBDYW4gY2FuY2VsIGV2ZW4gaWYgc3RvcHBlZCBidXQgbm90IHlldCB1cGxvYWRlZFxuICAgICAgICAgICAgY2FuY2VsUmVjb3JkaW5nU2Vzc2lvbigpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYEFnZW50IGNvbW1hbmRlZCBDQU5DRUxfUkVDT1JESU5HX1NFU1NJT04gYnV0IGN1cnJlbnQgc3RhdHVzIGlzICR7c3RhdHVzfS4gSWdub3JpbmcuYCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGNvbnNvbGUud2FybihcIlJlY2VpdmVkIHVua25vd24gYWdlbnQgYXVkaW8gY29tbWFuZCBhY3Rpb246XCIsIGFjdGlvbik7XG4gICAgICB9XG4gICAgICBjbGVhckxhc3RDb21tYW5kKCk7IC8vIENvbnN1bWUgdGhlIGNvbW1hbmRcbiAgICB9XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgfSwgW2xhdGVzdENvbW1hbmQsIGNsZWFyTGFzdENvbW1hbmQsIHN0YXJ0UmVjb3JkaW5nU2Vzc2lvbiwgc3RvcFJlY29yZGluZ1Nlc3Npb24sIGNhbmNlbFJlY29yZGluZ1Nlc3Npb24sIHN0YXR1cywgaW5pdGlhbFN1Z2dlc3RlZFRpdGxlLCBpbml0aWFsTGlua2VkRXZlbnRJZF0pO1xuXG5cbiAgY29uc3QgaGFuZGxlVXBsb2FkQXVkaW8gPSB1c2VDYWxsYmFjayhhc3luYyAoKSA9PiB7XG4gICAgaWYgKCFhdWRpb0Jsb2IpIHsgLyogLi4uIChyZXN0IG9mIHRoZSB1cGxvYWQgbG9naWMgcmVtYWlucyBsYXJnZWx5IHRoZSBzYW1lKSAuLi4gKi9cbiAgICAgIGNvbnN0IGVycm9yTXNnID0gXCJObyBhdWRpbyBkYXRhIGF2YWlsYWJsZSB0byB1cGxvYWQuXCI7XG4gICAgICBzZXRFcnJvck1lc3NhZ2UoZXJyb3JNc2cpO1xuICAgICAgc2V0U3RhdHVzKCdlcnJvcicpO1xuICAgICAgb25SZWNvcmRpbmdFcnJvcihlcnJvck1zZyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghdXNlcklkKSB7IC8qIC4uLiAqL1xuICAgICAgY29uc3QgZXJyb3JNc2cgPSBcIlVzZXIgSUQgaXMgbWlzc2luZy5cIjtcbiAgICAgIHNldEVycm9yTWVzc2FnZShlcnJvck1zZyk7XG4gICAgICBzZXRTdGF0dXMoJ2Vycm9yJyk7XG4gICAgICBvblJlY29yZGluZ0Vycm9yKGVycm9yTXNnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzZXRTdGF0dXMoJ3VwbG9hZGluZycpO1xuICAgIHNldEVycm9yTWVzc2FnZSh1bmRlZmluZWQpO1xuXG4gICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICBjb25zdCBmaWxlTmFtZSA9IChub3RlVGl0bGUgfHwgJ2F1ZGlvX25vdGUnKS5yZXBsYWNlKC9bXmEtekEtWjAtOV8tXFxzXS9nLCAnXycpICsgKGFjdHVhbE1pbWVUeXBlUmVmLmN1cnJlbnQuaW5jbHVkZXMoJ3dhdicpID8gJy53YXYnIDogJy53ZWJtJyk7XG4gICAgZm9ybURhdGEuYXBwZW5kKCdhdWRpb19maWxlJywgYXVkaW9CbG9iLCBmaWxlTmFtZSk7XG4gICAgZm9ybURhdGEuYXBwZW5kKCd0aXRsZScsIG5vdGVUaXRsZSB8fCAnQXVkaW8gTm90ZSAtICcgKyBuZXcgRGF0ZSgpLnRvTG9jYWxlU3RyaW5nKCkpO1xuICAgIGZvcm1EYXRhLmFwcGVuZCgndXNlcl9pZCcsIHVzZXJJZCk7XG4gICAgaWYgKGN1cnJlbnRMaW5rZWRFdmVudElkKSB7IC8vIFVzZSBjdXJyZW50TGlua2VkRXZlbnRJZCBmcm9tIHN0YXRlXG4gICAgICBmb3JtRGF0YS5hcHBlbmQoJ2xpbmtlZF9ldmVudF9pZCcsIGN1cnJlbnRMaW5rZWRFdmVudElkKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChQUk9DRVNTX0FVRElPX05PVEVfRU5EUE9JTlQsIHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGJvZHk6IGZvcm1EYXRhLFxuICAgICAgfSk7XG4gICAgICBjb25zdCByZXNwb25zZURhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG5cbiAgICAgIGlmIChyZXNwb25zZS5vayAmJiByZXNwb25zZURhdGEub2sgJiYgcmVzcG9uc2VEYXRhLmRhdGEpIHtcbiAgICAgICAgb25SZWNvcmRpbmdDb21wbGV0ZShyZXNwb25zZURhdGEuZGF0YS5ub3Rpb25fcGFnZV91cmwsIHJlc3BvbnNlRGF0YS5kYXRhLnRpdGxlLCByZXNwb25zZURhdGEuZGF0YS5zdW1tYXJ5X3ByZXZpZXcpO1xuICAgICAgICBzZXRTdGF0dXMoJ2lkbGUnKTtcbiAgICAgICAgc2V0Tm90ZVRpdGxlKGluaXRpYWxTdWdnZXN0ZWRUaXRsZSB8fCAnJyk7XG4gICAgICAgIHNldEF1ZGlvQmxvYih1bmRlZmluZWQpO1xuICAgICAgICBzZXRFbGFwc2VkVGltZSgwKTtcbiAgICAgICAgc2V0Q3VycmVudExpbmtlZEV2ZW50SWQoaW5pdGlhbExpbmtlZEV2ZW50SWQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgZXJyb3JNc2cgPSByZXNwb25zZURhdGEuZXJyb3I/Lm1lc3NhZ2UgfHwgcmVzcG9uc2VEYXRhLm1lc3NhZ2UgfHwgYEZhaWxlZCB0byBwcm9jZXNzIGF1ZGlvIG5vdGUgKEhUVFAgJHtyZXNwb25zZS5zdGF0dXN9KS5gO1xuICAgICAgICBzZXRFcnJvck1lc3NhZ2UoZXJyb3JNc2cpO1xuICAgICAgICBzZXRTdGF0dXMoJ2Vycm9yJyk7XG4gICAgICAgIG9uUmVjb3JkaW5nRXJyb3IoZXJyb3JNc2cpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICBjb25zdCBlcnJvck1zZyA9IGBOZXR3b3JrIGVycm9yIG9yIHNlcnZlciB1bmF2YWlsYWJsZTogJHtlcnIubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcid9YDtcbiAgICAgIHNldEVycm9yTWVzc2FnZShlcnJvck1zZyk7XG4gICAgICBzZXRTdGF0dXMoJ2Vycm9yJyk7XG4gICAgICBvblJlY29yZGluZ0Vycm9yKGVycm9yTXNnKTtcbiAgICB9XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgfSwgW2F1ZGlvQmxvYiwgbm90ZVRpdGxlLCB1c2VySWQsIGN1cnJlbnRMaW5rZWRFdmVudElkLCBvblJlY29yZGluZ0NvbXBsZXRlLCBvblJlY29yZGluZ0Vycm9yLCBpbml0aWFsU3VnZ2VzdGVkVGl0bGUsIGluaXRpYWxMaW5rZWRFdmVudElkXSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoc3RhdHVzID09PSAnc3RvcHBlZCcgJiYgYXVkaW9CbG9iKSB7XG4gICAgICBoYW5kbGVVcGxvYWRBdWRpbygpO1xuICAgIH1cbiAgfSwgW3N0YXR1cywgYXVkaW9CbG9iLCBoYW5kbGVVcGxvYWRBdWRpb10pO1xuXG4gIC8vIC0tLSBVSSBFdmVudCBIYW5kbGVycyAoZm9yIG1hbnVhbCBidXR0b24gY2xpY2tzKSAtLS1cbiAgY29uc3QgaGFuZGxlTWFudWFsU3RhcnQgPSAoKSA9PiB7XG4gICAgLy8gV2hlbiB1c2VyIGNsaWNrcyB0aGUgVUkgYnV0dG9uLCBzdGFydCB3aXRoIGN1cnJlbnQgdGl0bGUgYW5kIGV2ZW50SWQgZnJvbSBwcm9wcy9zdGF0ZVxuICAgIHN0YXJ0UmVjb3JkaW5nU2Vzc2lvbihub3RlVGl0bGUgfHwgaW5pdGlhbFN1Z2dlc3RlZFRpdGxlLCBjdXJyZW50TGlua2VkRXZlbnRJZCB8fCBpbml0aWFsTGlua2VkRXZlbnRJZCk7XG4gIH07XG5cbiAgY29uc3QgaGFuZGxlTWFudWFsU3RvcEFuZFNhdmUgPSAoKSA9PiB7XG4gICAgc3RvcFJlY29yZGluZ1Nlc3Npb24oKTtcbiAgfTtcblxuICBjb25zdCBoYW5kbGVNYW51YWxDYW5jZWwgPSAoKSA9PiB7XG4gICAgY2FuY2VsUmVjb3JkaW5nU2Vzc2lvbigpO1xuICB9O1xuXG5cbiAgLy8gQmFzaWMgc3R5bGluZyAoaW5saW5lIGZvciBzaW1wbGljaXR5LCBzaG91bGQgYmUgbW92ZWQgdG8gQ1NTL1NDU1MgbW9kdWxlcyBvciBzdHlsZWQtY29tcG9uZW50cylcbiAgLy8gLi4uIChzdHlsZXMgb2JqZWN0IHJlbWFpbnMgdGhlIHNhbWUpIC4uLlxuICBjb25zdCBzdHlsZXMgPSB7XG4gICAgY29udGFpbmVyOiB7IGJvcmRlcjogJzFweCBzb2xpZCAjY2NjJywgcGFkZGluZzogJzIwcHgnLCBib3JkZXJSYWRpdXM6ICc4cHgnLCBtYXhXaWR0aDogJzUwMHB4JywgbWFyZ2luOiAnMjBweCBhdXRvJywgZm9udEZhbWlseTogJ0FyaWFsLCBzYW5zLXNlcmlmJyB9LFxuICAgIHRpdGxlSW5wdXQ6IHsgd2lkdGg6ICdjYWxjKDEwMCUgLSAyMnB4KScsIHBhZGRpbmc6ICcxMHB4JywgbWFyZ2luQm90dG9tOiAnMTBweCcsIGJvcmRlcjogJzFweCBzb2xpZCAjZGRkJywgYm9yZGVyUmFkaXVzOiAnNHB4JyB9LFxuICAgIHN0YXR1c01lc3NhZ2U6IHsgbWFyZ2luOiAnMTBweCAwJywgcGFkZGluZzogJzEwcHgnLCBib3JkZXJSYWRpdXM6ICc0cHgnLCBiYWNrZ3JvdW5kQ29sb3I6ICcjZjBmMGYwJyB9LFxuICAgIGVycm9yTWVzc2FnZTogeyBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZlMGUwJywgY29sb3I6ICcjZDAwMDAwJywgYm9yZGVyOiAnMXB4IHNvbGlkICNkMDAwMDAnIH0sXG4gICAgcmVjb3JkaW5nSW5kaWNhdG9yOiB7IGRpc3BsYXk6ICdmbGV4JywgYWxpZ25JdGVtczogJ2NlbnRlcicsIG1hcmdpbjogJzEwcHggMCcgfSxcbiAgICBkb3Q6IHsgaGVpZ2h0OiAnMTJweCcsIHdpZHRoOiAnMTJweCcsIGJvcmRlclJhZGl1czogJzUwJScsIG1hcmdpblJpZ2h0OiAnOHB4JywgYmFja2dyb3VuZENvbG9yOiAnZ3JleScgfSxcbiAgICByZWNvcmRpbmdEb3Q6IHsgYmFja2dyb3VuZENvbG9yOiAncmVkJywgYW5pbWF0aW9uOiAncHVsc2UgMS41cyBpbmZpbml0ZScgfSxcbiAgICB0aW1lcjogeyBtYXJnaW5MZWZ0OiAnYXV0bycsIGZvbnRWYXJpYW50TnVtZXJpYzogJ3RhYnVsYXItbnVtcycgYXMgJ3RhYnVsYXItbnVtcycgfSxcbiAgICBidXR0b25zQ29udGFpbmVyOiB7IGRpc3BsYXk6ICdmbGV4JywganVzdGlmeUNvbnRlbnQ6ICdzcGFjZS1hcm91bmQnLCBtYXJnaW5Ub3A6ICcxNXB4JyB9LFxuICAgIGJ1dHRvbjogeyBwYWRkaW5nOiAnMTBweCAxNXB4JywgYm9yZGVyOiAnbm9uZScsIGJvcmRlclJhZGl1czogJzRweCcsIGN1cnNvcjogJ3BvaW50ZXInLCBkaXNwbGF5OiAnZmxleCcsIGFsaWduSXRlbXM6ICdjZW50ZXInLCBnYXA6ICc4cHgnIH0sXG4gICAgcmVjb3JkQnV0dG9uOiB7IGJhY2tncm91bmRDb2xvcjogJyM0Q0FGNTAnLCBjb2xvcjogJ3doaXRlJyB9LFxuICAgIHN0b3BCdXR0b246IHsgYmFja2dyb3VuZENvbG9yOiAnI2Y0NDMzNicsIGNvbG9yOiAnd2hpdGUnIH0sXG4gICAgY2FuY2VsQnV0dG9uOiB7IGJhY2tncm91bmRDb2xvcjogJyNlMGUwZTAnLCBjb2xvcjogJ2JsYWNrJyB9LFxuICB9O1xuXG4gIHJldHVybiAoXG4gICAgPGRpdiBzdHlsZT17c3R5bGVzLmNvbnRhaW5lcn0+XG4gICAgICA8aDM+SW4tUGVyc29uIEF1ZGlvIE5vdGU8L2gzPlxuICAgICAgeyhzdGF0dXMgPT09ICdpZGxlJyB8fCBzdGF0dXMgPT09ICdyZWNvcmRpbmcnIHx8IHN0YXR1cyA9PT0gJ2Vycm9yJykgJiYgKFxuICAgICAgICA8aW5wdXRcbiAgICAgICAgICB0eXBlPVwidGV4dFwiXG4gICAgICAgICAgc3R5bGU9e3N0eWxlcy50aXRsZUlucHV0fVxuICAgICAgICAgIHZhbHVlPXtub3RlVGl0bGV9XG4gICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXROb3RlVGl0bGUoZS50YXJnZXQudmFsdWUpfVxuICAgICAgICAgIHBsYWNlaG9sZGVyPVwiT3B0aW9uYWwgdGl0bGUgZm9yIHlvdXIgYXVkaW8gbm90ZVwiXG4gICAgICAgICAgZGlzYWJsZWQ9e3N0YXR1cyA9PT0gJ3JlY29yZGluZycgfHwgc3RhdHVzID09PSAndXBsb2FkaW5nJyB8fCBzdGF0dXMgPT09ICdwZXJtaXNzaW9uUGVuZGluZyd9XG4gICAgICAgIC8+XG4gICAgICApfVxuXG4gICAgICB7c3RhdHVzID09PSAncGVybWlzc2lvblBlbmRpbmcnICYmIDxwIHN0eWxlPXtzdHlsZXMuc3RhdHVzTWVzc2FnZX0+UmVxdWVzdGluZyBtaWNyb3Bob25lIHBlcm1pc3Npb24uLi48L3A+fVxuICAgICAge3N0YXR1cyA9PT0gJ3VwbG9hZGluZycgJiYgPHAgc3R5bGU9e3N0eWxlcy5zdGF0dXNNZXNzYWdlfT5Qcm9jZXNzaW5nIGFuZCBzYXZpbmcgeW91ciBub3RlLi4uPC9wPn1cbiAgICAgIHtlcnJvck1lc3NhZ2UgJiYgc3RhdHVzID09PSAnZXJyb3InICYmIDxwIHN0eWxlPXt7Li4uc3R5bGVzLnN0YXR1c01lc3NhZ2UsIC4uLnN0eWxlcy5lcnJvck1lc3NhZ2V9fT57ZXJyb3JNZXNzYWdlfTwvcD59XG5cbiAgICAgIHsoc3RhdHVzID09PSAncmVjb3JkaW5nJykgJiYgKFxuICAgICAgICA8ZGl2IHN0eWxlPXtzdHlsZXMucmVjb3JkaW5nSW5kaWNhdG9yfT5cbiAgICAgICAgICA8c3BhbiBzdHlsZT17ey4uLnN0eWxlcy5kb3QsIC4uLnN0eWxlcy5yZWNvcmRpbmdEb3QsIGFuaW1hdGlvbjogJ3B1bHNlIDEuNXMgaW5maW5pdGUnfX0+PC9zcGFuPlxuICAgICAgICAgIDxzcGFuPlJlY29yZGluZzwvc3Bhbj5cbiAgICAgICAgICA8c3BhbiBzdHlsZT17c3R5bGVzLnRpbWVyfT57Zm9ybWF0VGltZShlbGFwc2VkVGltZSl9PC9zcGFuPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICl9XG5cbiAgICAgIDxkaXYgc3R5bGU9e3N0eWxlcy5idXR0b25zQ29udGFpbmVyfT5cbiAgICAgICAgeyhzdGF0dXMgPT09ICdpZGxlJyB8fCBzdGF0dXMgPT09ICdlcnJvcicpICYmICggLy8gVXNlciBjYW4gbWFudWFsbHkgc3RhcnQgaWYgaWRsZSBvciBhZnRlciBhbiBlcnJvclxuICAgICAgICAgIDxidXR0b24gc3R5bGU9e3suLi5zdHlsZXMuYnV0dG9uLCAuLi5zdHlsZXMucmVjb3JkQnV0dG9ufX0gb25DbGljaz17aGFuZGxlTWFudWFsU3RhcnR9IGRpc2FibGVkPXtzdGF0dXMgPT09ICdwZXJtaXNzaW9uUGVuZGluZyd9PlxuICAgICAgICAgICAgPE1pY0ljb24gLz4gUmVjb3JkXG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICl9XG5cbiAgICAgICAge3N0YXR1cyA9PT0gJ3JlY29yZGluZycgJiYgKCAvLyBVc2VyIGNhbiBtYW51YWxseSBzdG9wL2NhbmNlbCBpZiB0aGV5IHN0YXJ0ZWQgaXQgb3IgaWYgYWdlbnQgc3RhcnRlZCBpdFxuICAgICAgICAgIDw+XG4gICAgICAgICAgICA8YnV0dG9uIHN0eWxlPXt7Li4uc3R5bGVzLmJ1dHRvbiwgLi4uc3R5bGVzLnN0b3BCdXR0b259fSBvbkNsaWNrPXtoYW5kbGVNYW51YWxTdG9wQW5kU2F2ZX0+XG4gICAgICAgICAgICAgIDxTdG9wSWNvbiAvPiBTdG9wICYgU2F2ZVxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICA8YnV0dG9uIHN0eWxlPXt7Li4uc3R5bGVzLmJ1dHRvbiwgLi4uc3R5bGVzLmNhbmNlbEJ1dHRvbn19IG9uQ2xpY2s9e2hhbmRsZU1hbnVhbENhbmNlbH0+XG4gICAgICAgICAgICAgIDxDYW5jZWxJY29uIC8+IENhbmNlbFxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgPC8+XG4gICAgICAgICl9XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEF1ZGlvUmVjb3JkZXI7XG5cbi8vIEFkZCBrZXlmcmFtZXMgZm9yIHB1bHNlIGFuaW1hdGlvbiBpbiB5b3VyIGdsb2JhbCBDU1Mgb3IgY29tcG9uZW50LXNwZWNpZmljIENTUyBzb2x1dGlvbjpcbi8qXG5Aa2V5ZnJhbWVzIHB1bHNlIHtcbiAgMCUge1xuICAgIG9wYWNpdHk6IDE7XG4gIH1cbiAgNTAlIHtcbiAgICBvcGFjaXR5OiAwLjQ7XG4gIH1cbiAgMTAwJSB7XG4gICAgb3BhY2l0eTogMTtcbiAgfVxufVxuKi9cbiJdfQ==