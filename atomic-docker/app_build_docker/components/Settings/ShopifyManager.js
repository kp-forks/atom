"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const shopifySkills_1 = require("../../../../src/skills/shopifySkills"); // Adjust path as needed
const constants_1 = require("../../../functions/atom-agent/_libs/constants");
const react_2 = require("@chakra-ui/react");
const react_3 = require("@chakra-ui/react");
const ShopifyManager = () => {
    const [userId] = (0, react_1.useState)("test-user-123"); // Placeholder
    const [connectionStatus, setConnectionStatus] = (0, react_1.useState)(null);
    const [isLoadingStatus, setIsLoadingStatus] = (0, react_1.useState)(true);
    const [shopName, setShopName] = (0, react_1.useState)('');
    const [errorMessages, setErrorMessages] = (0, react_1.useState)({});
    const toast = (0, react_2.useToast)();
    const fetchConnectionStatus = (0, react_1.useCallback)(async () => {
        if (!userId)
            return;
        setIsLoadingStatus(true);
        setErrorMessages(prev => ({ ...prev, status: undefined }));
        try {
            const response = await (0, shopifySkills_1.getShopifyConnectionStatus)(userId);
            if (response.ok && response.data) {
                setConnectionStatus(response.data);
            }
            else {
                setConnectionStatus({ isConnected: false, reason: response.error?.message || 'Failed to get status' });
                setErrorMessages(prev => ({ ...prev, status: response.error?.message || 'Failed to get status' }));
            }
        }
        catch (error) {
            setConnectionStatus({ isConnected: false, reason: 'Exception while fetching status' });
            setErrorMessages(prev => ({ ...prev, status: error.message || 'Exception while fetching status' }));
        }
        finally {
            setIsLoadingStatus(false);
        }
    }, [userId]);
    const handleConnectShopify = () => {
        if (!userId) {
            setErrorMessages(prev => ({ ...prev, general: "User ID is missing." }));
            return;
        }
        if (!shopName.trim()) {
            toast({
                title: 'Shop Name Required',
                description: 'Please enter your Shopify shop name (e.g., my-great-store).',
                status: 'warning',
                duration: 5000,
                isClosable: true,
            });
            return;
        }
        // Redirect to the backend OAuth initiation URL for Shopify
        window.location.href = `${constants_1.PYTHON_API_SERVICE_BASE_URL}/api/shopify/auth?user_id=${userId}&shop_name=${shopName}`;
    };
    const handleDisconnectShopify = (0, react_1.useCallback)(async () => {
        if (!userId)
            return;
        setErrorMessages(prev => ({ ...prev, general: undefined }));
        try {
            const response = await (0, shopifySkills_1.disconnectShopify)(userId);
            if (response.ok) {
                await fetchConnectionStatus();
            }
            else {
                setErrorMessages(prev => ({ ...prev, general: response.error?.message || 'Failed to disconnect' }));
            }
        }
        catch (error) {
            setErrorMessages(prev => ({ ...prev, general: error.message || 'Exception during disconnect' }));
        }
    }, [userId, fetchConnectionStatus]);
    (0, react_1.useEffect)(() => {
        if (userId)
            fetchConnectionStatus();
    }, [userId, fetchConnectionStatus]);
    return ((0, jsx_runtime_1.jsxs)("div", { style: { fontFamily: 'Arial, sans-serif', padding: '20px', maxWidth: '800px', margin: 'auto', border: '1px solid #e0e0e0', borderRadius: '8px', boxShadow: '0 2px 4px rgba(0,0,0,0.1)', marginTop: '20px' }, children: [(0, jsx_runtime_1.jsx)("h2", { style: { borderBottom: '1px solid #eee', paddingBottom: '10px', marginBottom: '20px' }, children: "Shopify Management" }), errorMessages.general && (0, jsx_runtime_1.jsxs)("p", { style: { color: 'red' }, children: ["Error: ", errorMessages.general] }), (0, jsx_runtime_1.jsxs)("div", { style: { marginBottom: '20px' }, children: [(0, jsx_runtime_1.jsx)("h3", { children: "Connection Status" }), isLoadingStatus ? (0, jsx_runtime_1.jsx)("p", { children: "Loading status..." }) : connectionStatus?.isConnected ? ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsxs)("p", { style: { color: 'green' }, children: ["Connected to: ", connectionStatus.shopUrl || 'N/A'] }), (0, jsx_runtime_1.jsx)("button", { onClick: handleDisconnectShopify, children: "Disconnect Shopify" })] })) : ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("p", { style: { color: 'orange' }, children: "Not Connected." }), errorMessages.status && (0, jsx_runtime_1.jsx)("p", { style: { color: 'red' }, children: errorMessages.status }), (0, jsx_runtime_1.jsx)(react_3.Input, { placeholder: "your-store-name", value: shopName, onChange: (e) => setShopName(e.target.value), style: { marginBottom: '10px' } }), (0, jsx_runtime_1.jsx)("button", { onClick: handleConnectShopify, children: "Connect Shopify" })] }))] })] }));
};
exports.default = ShopifyManager;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2hvcGlmeU1hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJTaG9waWZ5TWFuYWdlci50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsaUNBQWdFO0FBQ2hFLHdFQUk4QyxDQUFDLHdCQUF3QjtBQUN2RSw2RUFBNEY7QUFFNUYsNENBQTRDO0FBQzVDLDRDQUErRTtBQUUvRSxNQUFNLGNBQWMsR0FBYSxHQUFHLEVBQUU7SUFDcEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBZ0IsZUFBZSxDQUFDLENBQUMsQ0FBQyxjQUFjO0lBQ3pFLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSxtQkFBbUIsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBcUMsSUFBSSxDQUFDLENBQUM7SUFDbkcsTUFBTSxDQUFDLGVBQWUsRUFBRSxrQkFBa0IsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBVSxJQUFJLENBQUMsQ0FBQztJQUN0RSxNQUFNLENBQUMsUUFBUSxFQUFFLFdBQVcsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBUyxFQUFFLENBQUMsQ0FBQztJQUNyRCxNQUFNLENBQUMsYUFBYSxFQUFFLGdCQUFnQixDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUF3QyxFQUFFLENBQUMsQ0FBQztJQUM5RixNQUFNLEtBQUssR0FBRyxJQUFBLGdCQUFRLEdBQUUsQ0FBQztJQUV6QixNQUFNLHFCQUFxQixHQUFHLElBQUEsbUJBQVcsRUFBQyxLQUFLLElBQUksRUFBRTtRQUNuRCxJQUFJLENBQUMsTUFBTTtZQUFFLE9BQU87UUFDcEIsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekIsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsR0FBRyxJQUFJLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUMzRCxJQUFJLENBQUM7WUFDSCxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsMENB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QXVCLG1DQUE2QixJQUNqRSxDQUNQLENBQUMsQ0FBQyxDQUFDLENBQ0YsNENBQ0UsOEJBQUcsS0FBSyxFQUFFLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSwrQkFBb0IsRUFDaEQsYUFBYSxDQUFDLE1BQU0sSUFBSSw4QkFBRyxLQUFLLEVBQUUsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFlBQUcsYUFBYSxDQUFDLE1BQU0sR0FBSyxFQUMvRSx1QkFBQyxhQUFLLElBQ0osV0FBVyxFQUFDLGlCQUFpQixFQUM3QixLQUFLLEVBQUUsUUFBUSxFQUNmLFFBQVEsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQzVDLEtBQUssRUFBRSxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsR0FDL0IsRUFDRixtQ0FBUSxPQUFPLEVBQUUsb0JBQW9CLGdDQUEwQixJQUMzRCxDQUNQLElBQ0csSUFDRixDQUNQLENBQUM7QUFDSixDQUFDLENBQUM7QUFFRixrQkFBZSxjQUFjLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQge1xuICBnZXRTaG9waWZ5Q29ubmVjdGlvblN0YXR1cyxcbiAgZGlzY29ubmVjdFNob3BpZnksXG4gIFNob3BpZnlDb25uZWN0aW9uU3RhdHVzSW5mb1xufSBmcm9tICcuLi8uLi8uLi8uLi9zcmMvc2tpbGxzL3Nob3BpZnlTa2lsbHMnOyAvLyBBZGp1c3QgcGF0aCBhcyBuZWVkZWRcbmltcG9ydCB7IFBZVEhPTl9BUElfU0VSVklDRV9CQVNFX1VSTCB9IGZyb20gJy4uLy4uLy4uL2Z1bmN0aW9ucy9hdG9tLWFnZW50L19saWJzL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi8uLi8uLi9mdW5jdGlvbnMvX3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyB1c2VUb2FzdCB9IGZyb20gJ0BjaGFrcmEtdWkvcmVhY3QnO1xuaW1wb3J0IHsgQm94LCBCdXR0b24sIElucHV0LCBUZXh0LCBBY3Rpdml0eUluZGljYXRvciB9IGZyb20gJ0BjaGFrcmEtdWkvcmVhY3QnO1xuXG5jb25zdCBTaG9waWZ5TWFuYWdlcjogUmVhY3QuRkMgPSAoKSA9PiB7XG4gIGNvbnN0IFt1c2VySWRdID0gdXNlU3RhdGU8c3RyaW5nIHwgbnVsbD4oXCJ0ZXN0LXVzZXItMTIzXCIpOyAvLyBQbGFjZWhvbGRlclxuICBjb25zdCBbY29ubmVjdGlvblN0YXR1cywgc2V0Q29ubmVjdGlvblN0YXR1c10gPSB1c2VTdGF0ZTxTaG9waWZ5Q29ubmVjdGlvblN0YXR1c0luZm8gfCBudWxsPihudWxsKTtcbiAgY29uc3QgW2lzTG9hZGluZ1N0YXR1cywgc2V0SXNMb2FkaW5nU3RhdHVzXSA9IHVzZVN0YXRlPGJvb2xlYW4+KHRydWUpO1xuICBjb25zdCBbc2hvcE5hbWUsIHNldFNob3BOYW1lXSA9IHVzZVN0YXRlPHN0cmluZz4oJycpO1xuICBjb25zdCBbZXJyb3JNZXNzYWdlcywgc2V0RXJyb3JNZXNzYWdlc10gPSB1c2VTdGF0ZTx7IGdlbmVyYWw/OiBzdHJpbmc7IHN0YXR1cz86IHN0cmluZyB9Pih7fSk7XG4gIGNvbnN0IHRvYXN0ID0gdXNlVG9hc3QoKTtcblxuICBjb25zdCBmZXRjaENvbm5lY3Rpb25TdGF0dXMgPSB1c2VDYWxsYmFjayhhc3luYyAoKSA9PiB7XG4gICAgaWYgKCF1c2VySWQpIHJldHVybjtcbiAgICBzZXRJc0xvYWRpbmdTdGF0dXModHJ1ZSk7XG4gICAgc2V0RXJyb3JNZXNzYWdlcyhwcmV2ID0+ICh7IC4uLnByZXYsIHN0YXR1czogdW5kZWZpbmVkIH0pKTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBnZXRTaG9waWZ5Q29ubmVjdGlvblN0YXR1cyh1c2VySWQpO1xuICAgICAgaWYgKHJlc3BvbnNlLm9rICYmIHJlc3BvbnNlLmRhdGEpIHtcbiAgICAgICAgc2V0Q29ubmVjdGlvblN0YXR1cyhyZXNwb25zZS5kYXRhKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNldENvbm5lY3Rpb25TdGF0dXMoeyBpc0Nvbm5lY3RlZDogZmFsc2UsIHJlYXNvbjogcmVzcG9uc2UuZXJyb3I/Lm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBnZXQgc3RhdHVzJyB9KTtcbiAgICAgICAgc2V0RXJyb3JNZXNzYWdlcyhwcmV2ID0+ICh7IC4uLnByZXYsIHN0YXR1czogcmVzcG9uc2UuZXJyb3I/Lm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBnZXQgc3RhdHVzJyB9KSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgc2V0Q29ubmVjdGlvblN0YXR1cyh7IGlzQ29ubmVjdGVkOiBmYWxzZSwgcmVhc29uOiAnRXhjZXB0aW9uIHdoaWxlIGZldGNoaW5nIHN0YXR1cycgfSk7XG4gICAgICBzZXRFcnJvck1lc3NhZ2VzKHByZXYgPT4gKHsgLi4ucHJldiwgc3RhdHVzOiBlcnJvci5tZXNzYWdlIHx8ICdFeGNlcHRpb24gd2hpbGUgZmV0Y2hpbmcgc3RhdHVzJyB9KSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHNldElzTG9hZGluZ1N0YXR1cyhmYWxzZSk7XG4gICAgfVxuICB9LCBbdXNlcklkXSk7XG5cbiAgY29uc3QgaGFuZGxlQ29ubmVjdFNob3BpZnkgPSAoKSA9PiB7XG4gICAgaWYgKCF1c2VySWQpIHtcbiAgICAgIHNldEVycm9yTWVzc2FnZXMocHJldiA9PiAoeyAuLi5wcmV2LCBnZW5lcmFsOiBcIlVzZXIgSUQgaXMgbWlzc2luZy5cIn0pKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFzaG9wTmFtZS50cmltKCkpIHtcbiAgICAgIHRvYXN0KHtcbiAgICAgICAgdGl0bGU6ICdTaG9wIE5hbWUgUmVxdWlyZWQnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1BsZWFzZSBlbnRlciB5b3VyIFNob3BpZnkgc2hvcCBuYW1lIChlLmcuLCBteS1ncmVhdC1zdG9yZSkuJyxcbiAgICAgICAgc3RhdHVzOiAnd2FybmluZycsXG4gICAgICAgIGR1cmF0aW9uOiA1MDAwLFxuICAgICAgICBpc0Nsb3NhYmxlOiB0cnVlLFxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIFJlZGlyZWN0IHRvIHRoZSBiYWNrZW5kIE9BdXRoIGluaXRpYXRpb24gVVJMIGZvciBTaG9waWZ5XG4gICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBgJHtQWVRIT05fQVBJX1NFUlZJQ0VfQkFTRV9VUkx9L2FwaS9zaG9waWZ5L2F1dGg/dXNlcl9pZD0ke3VzZXJJZH0mc2hvcF9uYW1lPSR7c2hvcE5hbWV9YDtcbiAgfTtcblxuICBjb25zdCBoYW5kbGVEaXNjb25uZWN0U2hvcGlmeSA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcbiAgICBpZiAoIXVzZXJJZCkgcmV0dXJuO1xuICAgIHNldEVycm9yTWVzc2FnZXMocHJldiA9PiAoeyAuLi5wcmV2LCBnZW5lcmFsOiB1bmRlZmluZWQgfSkpO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGRpc2Nvbm5lY3RTaG9waWZ5KHVzZXJJZCk7XG4gICAgICBpZiAocmVzcG9uc2Uub2spIHtcbiAgICAgICAgYXdhaXQgZmV0Y2hDb25uZWN0aW9uU3RhdHVzKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZXRFcnJvck1lc3NhZ2VzKHByZXYgPT4gKHsgLi4ucHJldiwgZ2VuZXJhbDogcmVzcG9uc2UuZXJyb3I/Lm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBkaXNjb25uZWN0JyB9KSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgc2V0RXJyb3JNZXNzYWdlcyhwcmV2ID0+ICh7IC4uLnByZXYsIGdlbmVyYWw6IGVycm9yLm1lc3NhZ2UgfHwgJ0V4Y2VwdGlvbiBkdXJpbmcgZGlzY29ubmVjdCcgfSkpO1xuICAgIH1cbiAgfSwgW3VzZXJJZCwgZmV0Y2hDb25uZWN0aW9uU3RhdHVzXSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAodXNlcklkKSBmZXRjaENvbm5lY3Rpb25TdGF0dXMoKTtcbiAgfSwgW3VzZXJJZCwgZmV0Y2hDb25uZWN0aW9uU3RhdHVzXSk7XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2IHN0eWxlPXt7IGZvbnRGYW1pbHk6ICdBcmlhbCwgc2Fucy1zZXJpZicsIHBhZGRpbmc6ICcyMHB4JywgbWF4V2lkdGg6ICc4MDBweCcsIG1hcmdpbjogJ2F1dG8nLCBib3JkZXI6ICcxcHggc29saWQgI2UwZTBlMCcsIGJvcmRlclJhZGl1czogJzhweCcsIGJveFNoYWRvdzogJzAgMnB4IDRweCByZ2JhKDAsMCwwLDAuMSknLCBtYXJnaW5Ub3A6ICcyMHB4JyB9fT5cbiAgICAgIDxoMiBzdHlsZT17eyBib3JkZXJCb3R0b206ICcxcHggc29saWQgI2VlZScsIHBhZGRpbmdCb3R0b206ICcxMHB4JywgbWFyZ2luQm90dG9tOiAnMjBweCcgfX0+U2hvcGlmeSBNYW5hZ2VtZW50PC9oMj5cblxuICAgICAge2Vycm9yTWVzc2FnZXMuZ2VuZXJhbCAmJiA8cCBzdHlsZT17eyBjb2xvcjogJ3JlZCcgfX0+RXJyb3I6IHtlcnJvck1lc3NhZ2VzLmdlbmVyYWx9PC9wPn1cblxuICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Cb3R0b206ICcyMHB4JyB9fT5cbiAgICAgICAgPGgzPkNvbm5lY3Rpb24gU3RhdHVzPC9oMz5cbiAgICAgICAge2lzTG9hZGluZ1N0YXR1cyA/IDxwPkxvYWRpbmcgc3RhdHVzLi4uPC9wPiA6IGNvbm5lY3Rpb25TdGF0dXM/LmlzQ29ubmVjdGVkID8gKFxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICA8cCBzdHlsZT17eyBjb2xvcjogJ2dyZWVuJyB9fT5Db25uZWN0ZWQgdG86IHtjb25uZWN0aW9uU3RhdHVzLnNob3BVcmwgfHwgJ04vQSd9PC9wPlxuICAgICAgICAgICAgPGJ1dHRvbiBvbkNsaWNrPXtoYW5kbGVEaXNjb25uZWN0U2hvcGlmeX0+RGlzY29ubmVjdCBTaG9waWZ5PC9idXR0b24+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICkgOiAoXG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIDxwIHN0eWxlPXt7IGNvbG9yOiAnb3JhbmdlJyB9fT5Ob3QgQ29ubmVjdGVkLjwvcD5cbiAgICAgICAgICAgIHtlcnJvck1lc3NhZ2VzLnN0YXR1cyAmJiA8cCBzdHlsZT17eyBjb2xvcjogJ3JlZCcgfX0+e2Vycm9yTWVzc2FnZXMuc3RhdHVzfTwvcD59XG4gICAgICAgICAgICA8SW5wdXRcbiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJ5b3VyLXN0b3JlLW5hbWVcIlxuICAgICAgICAgICAgICB2YWx1ZT17c2hvcE5hbWV9XG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0U2hvcE5hbWUoZS50YXJnZXQudmFsdWUpfVxuICAgICAgICAgICAgICBzdHlsZT17eyBtYXJnaW5Cb3R0b206ICcxMHB4JyB9fVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDxidXR0b24gb25DbGljaz17aGFuZGxlQ29ubmVjdFNob3BpZnl9PkNvbm5lY3QgU2hvcGlmeTwvYnV0dG9uPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApfVxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBTaG9waWZ5TWFuYWdlcjtcbiJdfQ==