"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const Box_1 = __importDefault(require("@components/common/Box"));
const Text_1 = __importDefault(require("@components/common/Text"));
const Button_1 = __importDefault(require("@components/Button"));
const Select_1 = __importDefault(require("@components/common/Select"));
const TextField_1 = __importDefault(require("@components/TextField"));
const session_1 = require("supertokens-auth-react/recipe/session");
// Matches backend TaskStatus enum
var TaskStatusEnum;
(function (TaskStatusEnum) {
    TaskStatusEnum["PENDING"] = "pending";
    TaskStatusEnum["ACTIVE"] = "active";
    TaskStatusEnum["PROCESSING_COMPLETION"] = "processing_completion";
    TaskStatusEnum["COMPLETED"] = "completed";
    TaskStatusEnum["ERROR"] = "error";
})(TaskStatusEnum || (TaskStatusEnum = {}));
const LIVE_MEETING_WORKER_URL = process.env.NEXT_PUBLIC_LIVE_MEETING_WORKER_URL || 'http://localhost:8001'; // Default to Python worker port
const LiveMeetingAttendanceSettings = () => {
    const [audioDevices, setAudioDevices] = (0, react_1.useState)([]);
    const [selectedAudioDevice, setSelectedAudioDevice] = (0, react_1.useState)('');
    const [isLoadingDevices, setIsLoadingDevices] = (0, react_1.useState)(false);
    const [deviceError, setDeviceError] = (0, react_1.useState)(null);
    const [platform, setPlatform] = (0, react_1.useState)('googlemeet');
    const [meetingId, setMeetingId] = (0, react_1.useState)(''); // Renamed from meetingIdentifier
    const [notionPageTitle, setNotionPageTitle] = (0, react_1.useState)(''); // Renamed from notionNoteTitle
    const [isProcessing, setIsProcessing] = (0, react_1.useState)(false); // General processing state for start/stop
    const [submitError, setSubmitError] = (0, react_1.useState)(null);
    const [currentTask, setCurrentTask] = (0, react_1.useState)(null);
    const [pollingIntervalId, setPollingIntervalId] = (0, react_1.useState)(null);
    const { userId, isLoading: isLoadingSession } = (0, session_1.useSession)();
    const fetchAudioDevices = (0, react_1.useCallback)(async () => {
        setIsLoadingDevices(true);
        setDeviceError(null);
        try {
            const response = await fetch(`${LIVE_MEETING_WORKER_URL}/list_audio_devices`);
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(errorData.detail || `Failed to fetch audio devices: ${response.statusText} (Worker might be down or URL incorrect)`);
            }
            const data = await response.json();
            setAudioDevices(data.devices || []);
            if (data.devices && data.devices.length > 0) {
                setSelectedAudioDevice(data.devices[0].id); // Default to first device's ID
            }
            else {
                setDeviceError("No audio input devices found. Please check your system's audio configuration and the live meeting worker.");
            }
        }
        catch (error) {
            console.error("Error fetching audio devices:", error);
            setDeviceError(error.message || "Could not connect to the live meeting worker to get audio devices.");
            setAudioDevices([]);
        }
        setIsLoadingDevices(false);
    }, []);
    (0, react_1.useEffect)(() => {
        fetchAudioDevices(); // Fetch on component mount
    }, [fetchAudioDevices]);
    const clearPolling = () => {
        if (pollingIntervalId) {
            clearInterval(pollingIntervalId);
            setPollingIntervalId(null);
        }
    };
    const handleStartMeeting = async () => {
        if (!userId) {
            setSubmitError("User not authenticated. Please log in.");
            return;
        }
        if (!meetingId || !notionPageTitle) {
            setSubmitError("Meeting ID/URL and Notion Page Title are required.");
            return;
        }
        if (audioDevices.length > 0 && !selectedAudioDevice) {
            setSubmitError("Please select an audio device.");
            return;
        }
        if (!selectedAudioDevice && audioDevices.length === 0 && !deviceError) {
            setSubmitError("No audio devices available. Cannot start meeting.");
            return;
        }
        setIsProcessing(true);
        setSubmitError(null);
        setCurrentTask(null);
        clearPolling();
        const payload = {
            platform,
            meeting_id: meetingId,
            audio_device_id: selectedAudioDevice,
            notion_page_title: notionPageTitle,
            user_id: userId,
        };
        try {
            const response = await fetch(`${LIVE_MEETING_WORKER_URL}/start_meeting_attendance`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
            });
            const result = await response.json();
            if (!response.ok) {
                throw new Error(result.detail || result.message || `Failed to initiate meeting attendance: ${response.statusText}`);
            }
            // result should be StartMeetingResponse { task_id, status, message }
            // but we want to store the full MeetingTask structure eventually, so we synthesize it or fetch immediately
            setCurrentTask(prev => ({
                ...prev, // Keep any old data if needed, though usually it's a new task
                task_id: result.task_id,
                status: result.status,
                message: result.message || "Task initiated. Waiting for detailed status...",
                platform,
                meeting_id: meetingId,
                audio_device_id: selectedAudioDevice,
                notion_page_title: notionPageTitle,
                user_id: userId,
            }));
            // Start polling for status
            const intervalId = setInterval(() => pollTaskStatus(result.task_id), 5000);
            setPollingIntervalId(intervalId);
            pollTaskStatus(result.task_id); // Initial poll immediately
        }
        catch (error) {
            console.error("Error initiating meeting attendance:", error);
            setSubmitError(error.message || "An unknown error occurred while starting.");
            setCurrentTask(null); // Clear task on error
        }
        setIsProcessing(false);
    };
    const pollTaskStatus = async (taskId) => {
        try {
            const response = await fetch(`${LIVE_MEETING_WORKER_URL}/meeting_attendance_status/${taskId}`);
            if (!response.ok) {
                if (response.status === 404) {
                    setSubmitError(`Task status not found (ID: ${taskId}). It might have been cleared or is an old ID.`);
                    clearPolling();
                    setCurrentTask(null); // Task is gone
                    return;
                }
                const errorData = await response.json().catch(() => ({}));
                throw new Error(errorData.detail || `Failed to fetch task status: ${response.statusText}`);
            }
            const statusData = await response.json();
            setCurrentTask(statusData);
            // Stop polling if task is in a terminal state
            if (statusData.status === TaskStatusEnum.COMPLETED || statusData.status === TaskStatusEnum.ERROR) {
                clearPolling();
            }
        }
        catch (error) {
            console.error(`Error polling task status for ${taskId}:`, error);
            setSubmitError(`Error fetching task status: ${error.message}. Polling may be affected.`);
            // Potentially stop polling on repeated errors or specific error types
        }
    };
    const handleStopMeeting = async () => {
        if (!currentTask || !currentTask.task_id) {
            setSubmitError("No active task to stop.");
            return;
        }
        if (currentTask.status === TaskStatusEnum.COMPLETED || currentTask.status === TaskStatusEnum.ERROR) {
            setSubmitError("Task is already in a terminal state.");
            return;
        }
        setIsProcessing(true);
        setSubmitError(null);
        clearPolling(); // Stop regular polling as we are sending a stop command
        try {
            const response = await fetch(`${LIVE_MEETING_WORKER_URL}/stop_meeting_attendance/${currentTask.task_id}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
            });
            const result = await response.json(); // Expects updated task details
            if (!response.ok) {
                throw new Error(result.message || result.detail || `Failed to stop meeting: ${response.statusText}`);
            }
            setCurrentTask(result); // Update with final status from stop response
            if (result.status !== TaskStatusEnum.COMPLETED && result.status !== TaskStatusEnum.ERROR) {
                // If not yet terminal, poll once more or restart polling briefly
                const intervalId = setInterval(() => pollTaskStatus(result.task_id), 3000);
                setPollingIntervalId(intervalId);
            }
        }
        catch (error) {
            console.error("Error stopping meeting attendance:", error);
            setSubmitError(error.message || "An unknown error occurred while stopping.");
            // Optionally, restart polling if stop command failed, to get latest status
            if (currentTask && currentTask.task_id && !pollingIntervalId) {
                const intervalId = setInterval(() => pollTaskStatus(currentTask.task_id), 5000);
                setPollingIntervalId(intervalId);
            }
        }
        setIsProcessing(false);
    };
    // Clear interval on unmount
    (0, react_1.useEffect)(() => {
        return () => {
            clearPolling();
        };
    }, [pollingIntervalId]); // Dependency array ensures cleanup if pollingIntervalId changes, but clearPolling handles its own state.
    const platformOptions = [
        { label: 'Google Meet', value: 'googlemeet' },
        { label: 'Zoom', value: 'zoom' },
        { label: 'Microsoft Teams', value: 'msteams' },
        { label: 'Other/Desktop Audio', value: 'other' },
    ];
    const audioDeviceOptions = audioDevices.map(device => ({
        label: `${device.name} (ID: ${device.id})`,
        value: device.id,
    }));
    const isTaskActiveOrPending = currentTask &&
        (currentTask.status === TaskStatusEnum.ACTIVE ||
            currentTask.status === TaskStatusEnum.PENDING ||
            currentTask.status === TaskStatusEnum.PROCESSING_COMPLETION);
    return ((0, jsx_runtime_1.jsxs)(Box_1.default, { padding: { phone: 'm', tablet: 'l' }, borderWidth: 1, borderColor: "hairline", borderRadius: "m", margin: { phone: 'm', tablet: 'l' }, backgroundColor: "white", children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "sectionHeader", marginBottom: "m", children: "Live Meeting Attendance" }), (0, jsx_runtime_1.jsxs)(Text_1.default, { variant: "body", fontSize: "sm", color: "gray.600", marginBottom: "m", children: ["Configure Atom to capture audio from online meetings or desktop, (eventually) transcribe, and generate notes. Refer to the ", (0, jsx_runtime_1.jsx)("a", { href: "/docs/live-meeting-attendance-setup.md", target: "_blank", rel: "noopener noreferrer", style: { color: 'blue' }, children: "setup guide" }), " for audio configuration."] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { marginBottom: "l", children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "subHeader", marginBottom: "s", children: "Audio Device Selection" }), (0, jsx_runtime_1.jsx)(Button_1.default, { onPress: fetchAudioDevices, disabled: isLoadingDevices || isProcessing, marginBottom: "s", children: isLoadingDevices ? 'Refreshing Devices...' : 'Refresh Audio Devices' }), deviceError && (0, jsx_runtime_1.jsx)(Text_1.default, { color: "red.500", marginBottom: "s", fontSize: "sm", children: deviceError }), audioDevices.length > 0 && ((0, jsx_runtime_1.jsx)(Select_1.default, { label: "Select Audio Device (for meeting/desktop audio capture)", options: audioDeviceOptions, value: selectedAudioDevice, onChange: (value) => setSelectedAudioDevice(value), placeholder: "Select an audio device", disabled: isProcessing || isTaskActiveOrPending })), audioDevices.length === 0 && !isLoadingDevices && !deviceError && ((0, jsx_runtime_1.jsx)(Text_1.default, { fontSize: "sm", children: "No audio devices found or loaded. Try refreshing, or check worker logs." })), (0, jsx_runtime_1.jsx)(Text_1.default, { variant: "body", fontSize: "xs", color: "gray.500", marginTop: "xs", children: "The selected device should ideally be a virtual audio output/loopback that captures the meeting's sound (not your microphone, unless intended)." })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { marginBottom: "l", children: [(0, jsx_runtime_1.jsx)(Text_1.default, { variant: "subHeader", marginBottom: "s", children: "Meeting Details" }), (0, jsx_runtime_1.jsx)(Select_1.default, { label: "Platform", options: platformOptions, value: platform, onChange: (value) => setPlatform(value), disabled: isProcessing || isTaskActiveOrPending }), (0, jsx_runtime_1.jsx)(TextField_1.default, { label: "Meeting ID or Description", value: meetingId, onChange: (e) => setMeetingId(e.target.value), placeholder: "e.g., https://meet.google.com/abc-def-ghi or 'Client Call'", marginTop: "s", disabled: isProcessing || isTaskActiveOrPending }), (0, jsx_runtime_1.jsx)(TextField_1.default, { label: "Notion Page Title (for Notes)", value: notionPageTitle, onChange: (e) => setNotionPageTitle(e.target.value), placeholder: "e.g., Project Phoenix Sync - Oct 28", marginTop: "s", disabled: isProcessing || isTaskActiveOrPending })] }), (0, jsx_runtime_1.jsxs)(Box_1.default, { flexDirection: "row", justifyContent: "space-between", children: [(0, jsx_runtime_1.jsx)(Button_1.default, { onPress: handleStartMeeting, disabled: isProcessing || isLoadingDevices || isLoadingSession || isTaskActiveOrPending || (!selectedAudioDevice && audioDevices.length > 0), variant: "primary", children: isProcessing && currentTask?.status !== TaskStatusEnum.ACTIVE ? 'Starting...' : 'Start Attending Meeting' }), isTaskActiveOrPending && ((0, jsx_runtime_1.jsx)(Button_1.default, { onPress: handleStopMeeting, disabled: isProcessing, variant: "warning", marginLeft: "m", children: isProcessing && currentTask?.status === TaskStatusEnum.ACTIVE ? 'Stopping...' : 'Stop Attending Meeting' }))] }), submitError && (0, jsx_runtime_1.jsx)(Text_1.default, { color: "red.500", marginTop: "s", fontSize: "sm", children: submitError }), isLoadingSession && (0, jsx_runtime_1.jsx)(Text_1.default, { color: "orange.500", marginTop: "s", fontSize: "sm", children: "Loading user session..." }), currentTask && ((0, jsx_runtime_1.jsxs)(Box_1.default, { marginTop: "l", padding: "m", borderWidth: 1, borderColor: "gray.300", borderRadius: "s", children: [(0, jsx_runtime_1.jsxs)(Text_1.default, { variant: "subHeader", marginBottom: "s", children: ["Task Status (ID: ", currentTask.task_id, ")"] }), (0, jsx_runtime_1.jsxs)(Text_1.default, { children: [(0, jsx_runtime_1.jsx)("strong", { children: "Status:" }), " ", currentTask.status, " ", currentTask.message ? `(${currentTask.message})` : ''] }), currentTask.start_time && (0, jsx_runtime_1.jsxs)(Text_1.default, { children: [(0, jsx_runtime_1.jsx)("strong", { children: "Started:" }), " ", new Date(currentTask.start_time).toLocaleString()] }), currentTask.duration_seconds !== null && typeof currentTask.duration_seconds !== 'undefined' && ((0, jsx_runtime_1.jsxs)(Text_1.default, { children: [(0, jsx_runtime_1.jsx)("strong", { children: "Duration:" }), " ", Math.round(currentTask.duration_seconds), "s"] })), currentTask.transcript_preview && (0, jsx_runtime_1.jsxs)(Text_1.default, { children: [(0, jsx_runtime_1.jsx)("strong", { children: "Transcript Preview:" }), " ", currentTask.transcript_preview] }), currentTask.notes_preview && (0, jsx_runtime_1.jsxs)(Text_1.default, { children: [(0, jsx_runtime_1.jsx)("strong", { children: "Notes Preview:" }), " ", currentTask.notes_preview] }), currentTask.status === TaskStatusEnum.COMPLETED && ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [currentTask.final_transcript_location && ((0, jsx_runtime_1.jsxs)(Text_1.default, { children: [(0, jsx_runtime_1.jsx)("strong", { children: "Final Transcript:" }), " ", currentTask.final_transcript_location] })), currentTask.final_notes_location && ((0, jsx_runtime_1.jsxs)(Text_1.default, { children: [(0, jsx_runtime_1.jsx)("strong", { children: "Final Notes:" }), " ", currentTask.final_notes_location, " (Note: Actual Notion page creation is a future step for the worker)"] }))] })), currentTask.status === TaskStatusEnum.ERROR && currentTask.message && ((0, jsx_runtime_1.jsxs)(Text_1.default, { color: "red.500", children: [(0, jsx_runtime_1.jsx)("strong", { children: "Error Details:" }), " ", currentTask.message] }))] }))] }));
};
exports.default = LiveMeetingAttendanceSettings;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTGl2ZU1lZXRpbmdBdHRlbmRhbmNlU2V0dGluZ3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJMaXZlTWVldGluZ0F0dGVuZGFuY2VTZXR0aW5ncy50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsaUNBQWdFO0FBQ2hFLGlFQUF5QztBQUN6QyxtRUFBMkM7QUFDM0MsZ0VBQXdDO0FBQ3hDLHVFQUErQztBQUMvQyxzRUFBOEM7QUFDOUMsbUVBQW1FO0FBUW5FLGtDQUFrQztBQUNsQyxJQUFLLGNBTUo7QUFORCxXQUFLLGNBQWM7SUFDakIscUNBQW1CLENBQUE7SUFDbkIsbUNBQWlCLENBQUE7SUFDakIsaUVBQStDLENBQUE7SUFDL0MseUNBQXVCLENBQUE7SUFDdkIsaUNBQWUsQ0FBQTtBQUNqQixDQUFDLEVBTkksY0FBYyxLQUFkLGNBQWMsUUFNbEI7QUFxQkQsTUFBTSx1QkFBdUIsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLG1DQUFtQyxJQUFJLHVCQUF1QixDQUFDLENBQUMsZ0NBQWdDO0FBRTVJLE1BQU0sNkJBQTZCLEdBQUcsR0FBRyxFQUFFO0lBQ3pDLE1BQU0sQ0FBQyxZQUFZLEVBQUUsZUFBZSxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFnQixFQUFFLENBQUMsQ0FBQztJQUNwRSxNQUFNLENBQUMsbUJBQW1CLEVBQUUsc0JBQXNCLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQWtCLEVBQUUsQ0FBQyxDQUFDO0lBQ3BGLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSxtQkFBbUIsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBVSxLQUFLLENBQUMsQ0FBQztJQUN6RSxNQUFNLENBQUMsV0FBVyxFQUFFLGNBQWMsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBZ0IsSUFBSSxDQUFDLENBQUM7SUFFcEUsTUFBTSxDQUFDLFFBQVEsRUFBRSxXQUFXLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQThDLFlBQVksQ0FBQyxDQUFDO0lBQ3BHLE1B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LE9BQU8sSUFBSSxDQUN0RSx3QkFBQyxjQUFJLElBQUMsS0FBSyxFQUFDLFNBQVMsYUFBQyxnRUFBK0IsT0FBRSxXQUFXLENBQUMsT0FBTyxJQUFRLENBQ25GLElBQ0csQ0FDUCxJQUNHLENBQ1AsQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGLGtCQUFlLDZCQUE2QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QsIHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IEJveCBmcm9tICdAY29tcG9uZW50cy9jb21tb24vQm94JztcbmltcG9ydCBUZXh0IGZyb20gJ0Bjb21wb25lbnRzL2NvbW1vbi9UZXh0JztcbmltcG9ydCBCdXR0b24gZnJvbSAnQGNvbXBvbmVudHMvQnV0dG9uJztcbmltcG9ydCBTZWxlY3QgZnJvbSAnQGNvbXBvbmVudHMvY29tbW9uL1NlbGVjdCc7XG5pbXBvcnQgVGV4dEZpZWxkIGZyb20gJ0Bjb21wb25lbnRzL1RleHRGaWVsZCc7XG5pbXBvcnQgeyB1c2VTZXNzaW9uIH0gZnJvbSAnc3VwZXJ0b2tlbnMtYXV0aC1yZWFjdC9yZWNpcGUvc2Vzc2lvbic7XG5cbi8vIE1hdGNoZXMgYmFja2VuZCBBdWRpb0RldmljZSBtb2RlbFxuaW50ZXJmYWNlIEF1ZGlvRGV2aWNlIHtcbiAgaWQ6IHN0cmluZyB8IG51bWJlcjsgLy8gQ2FuIGJlIHN0cmluZyBvciBudW1iZXIgZnJvbSBiYWNrZW5kXG4gIG5hbWU6IHN0cmluZztcbn1cblxuLy8gTWF0Y2hlcyBiYWNrZW5kIFRhc2tTdGF0dXMgZW51bVxuZW51bSBUYXNrU3RhdHVzRW51bSB7XG4gIFBFTkRJTkcgPSBcInBlbmRpbmdcIixcbiAgQUNUSVZFID0gXCJhY3RpdmVcIixcbiAgUFJPQ0VTU0lOR19DT01QTEVUSU9OID0gXCJwcm9jZXNzaW5nX2NvbXBsZXRpb25cIixcbiAgQ09NUExFVEVEID0gXCJjb21wbGV0ZWRcIixcbiAgRVJST1IgPSBcImVycm9yXCIsXG59XG5cbi8vIE1hdGNoZXMgYmFja2VuZCBNZWV0aW5nVGFzayBtb2RlbCAocmVsZXZhbnQgcGFydHMgZm9yIGZyb250ZW5kKVxuaW50ZXJmYWNlIE1lZXRpbmdUYXNrIHtcbiAgdGFza19pZDogc3RyaW5nO1xuICB1c2VyX2lkOiBzdHJpbmc7XG4gIHBsYXRmb3JtOiBzdHJpbmc7XG4gIG1lZXRpbmdfaWQ6IHN0cmluZzsgLy8gUmVuYW1lZCBmcm9tIG1lZXRpbmdfaWRlbnRpZmllciBmb3IgY29uc2lzdGVuY3lcbiAgYXVkaW9fZGV2aWNlX2lkOiBzdHJpbmcgfCBudW1iZXI7XG4gIG5vdGlvbl9wYWdlX3RpdGxlOiBzdHJpbmc7XG4gIHN0YXR1czogVGFza1N0YXR1c0VudW07XG4gIG1lc3NhZ2U/OiBzdHJpbmcgfCBudWxsO1xuICBzdGFydF90aW1lPzogc3RyaW5nIHwgbnVsbDsgLy8gSVNPIGRhdGUgc3RyaW5nXG4gIGVuZF90aW1lPzogc3RyaW5nIHwgbnVsbDsgLy8gSVNPIGRhdGUgc3RyaW5nXG4gIGR1cmF0aW9uX3NlY29uZHM/OiBudW1iZXIgfCBudWxsO1xuICB0cmFuc2NyaXB0X3ByZXZpZXc/OiBzdHJpbmcgfCBudWxsO1xuICBub3Rlc19wcmV2aWV3Pzogc3RyaW5nIHwgbnVsbDtcbiAgZmluYWxfdHJhbnNjcmlwdF9sb2NhdGlvbj86IHN0cmluZyB8IG51bGw7XG4gIGZpbmFsX25vdGVzX2xvY2F0aW9uPzogc3RyaW5nIHwgbnVsbDtcbn1cblxuY29uc3QgTElWRV9NRUVUSU5HX1dPUktFUl9VUkwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19MSVZFX01FRVRJTkdfV09SS0VSX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDo4MDAxJzsgLy8gRGVmYXVsdCB0byBQeXRob24gd29ya2VyIHBvcnRcblxuY29uc3QgTGl2ZU1lZXRpbmdBdHRlbmRhbmNlU2V0dGluZ3MgPSAoKSA9PiB7XG4gIGNvbnN0IFthdWRpb0RldmljZXMsIHNldEF1ZGlvRGV2aWNlc10gPSB1c2VTdGF0ZTxBdWRpb0RldmljZVtdPihbXSk7XG4gIGNvbnN0IFtzZWxlY3RlZEF1ZGlvRGV2aWNlLCBzZXRTZWxlY3RlZEF1ZGlvRGV2aWNlXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bWJlcj4oJycpO1xuICBjb25zdCBbaXNMb2FkaW5nRGV2aWNlcywgc2V0SXNMb2FkaW5nRGV2aWNlc10gPSB1c2VTdGF0ZTxib29sZWFuPihmYWxzZSk7XG4gIGNvbnN0IFtkZXZpY2VFcnJvciwgc2V0RGV2aWNlRXJyb3JdID0gdXNlU3RhdGU8c3RyaW5nIHwgbnVsbD4obnVsbCk7XG5cbiAgY29uc3QgW3BsYXRmb3JtLCBzZXRQbGF0Zm9ybV0gPSB1c2VTdGF0ZTwnem9vbScgfCAnZ29vZ2xlbWVldCcgfCAnbXN0ZWFtcycgfCAnb3RoZXInPignZ29vZ2xlbWVldCcpO1xuICBjb25zdCBbbWVldGluZ0lkLCBzZXRNZWV0aW5nSWRdID0gdXNlU3RhdGU8c3RyaW5nPignJyk7IC8vIFJlbmFtZWQgZnJvbSBtZWV0aW5nSWRlbnRpZmllclxuICBjb25zdCBbbm90aW9uUGFnZVRpdGxlLCBzZXROb3Rpb25QYWdlVGl0bGVdID0gdXNlU3RhdGU8c3RyaW5nPignJyk7IC8vIFJlbmFtZWQgZnJvbSBub3Rpb25Ob3RlVGl0bGVcblxuICBjb25zdCBbaXNQcm9jZXNzaW5nLCBzZXRJc1Byb2Nlc3NpbmddID0gdXNlU3RhdGU8Ym9vbGVhbj4oZmFsc2UpOyAvLyBHZW5lcmFsIHByb2Nlc3Npbmcgc3RhdGUgZm9yIHN0YXJ0L3N0b3BcbiAgY29uc3QgW3N1Ym1pdEVycm9yLCBzZXRTdWJtaXRFcnJvcl0gPSB1c2VTdGF0ZTxzdHJpbmcgfCBudWxsPihudWxsKTtcbiAgY29uc3QgW2N1cnJlbnRUYXNrLCBzZXRDdXJyZW50VGFza10gPSB1c2VTdGF0ZTxNZWV0aW5nVGFzayB8IG51bGw+KG51bGwpO1xuICBjb25zdCBbcG9sbGluZ0ludGVydmFsSWQsIHNldFBvbGxpbmdJbnRlcnZhbElkXSA9IHVzZVN0YXRlPE5vZGVKUy5UaW1lb3V0IHwgbnVsbD4obnVsbCk7XG5cbiAgY29uc3QgeyB1c2VySWQsIGlzTG9hZGluZzogaXNMb2FkaW5nU2Vzc2lvbiB9ID0gdXNlU2Vzc2lvbigpO1xuXG4gIGNvbnN0IGZldGNoQXVkaW9EZXZpY2VzID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT4ge1xuICAgIHNldElzTG9hZGluZ0RldmljZXModHJ1ZSk7XG4gICAgc2V0RGV2aWNlRXJyb3IobnVsbCk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7TElWRV9NRUVUSU5HX1dPUktFUl9VUkx9L2xpc3RfYXVkaW9fZGV2aWNlc2ApO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCkuY2F0Y2goKCkgPT4gKHt9KSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvckRhdGEuZGV0YWlsIHx8IGBGYWlsZWQgdG8gZmV0Y2ggYXVkaW8gZGV2aWNlczogJHtyZXNwb25zZS5zdGF0dXNUZXh0fSAoV29ya2VyIG1pZ2h0IGJlIGRvd24gb3IgVVJMIGluY29ycmVjdClgKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGRhdGE6IHsgZGV2aWNlczogQXVkaW9EZXZpY2VbXSB9ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgc2V0QXVkaW9EZXZpY2VzKGRhdGEuZGV2aWNlcyB8fCBbXSk7XG4gICAgICBpZiAoZGF0YS5kZXZpY2VzICYmIGRhdGEuZGV2aWNlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHNldFNlbGVjdGVkQXVkaW9EZXZpY2UoZGF0YS5kZXZpY2VzWzBdLmlkKTsgLy8gRGVmYXVsdCB0byBmaXJzdCBkZXZpY2UncyBJRFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2V0RGV2aWNlRXJyb3IoXCJObyBhdWRpbyBpbnB1dCBkZXZpY2VzIGZvdW5kLiBQbGVhc2UgY2hlY2sgeW91ciBzeXN0ZW0ncyBhdWRpbyBjb25maWd1cmF0aW9uIGFuZCB0aGUgbGl2ZSBtZWV0aW5nIHdvcmtlci5cIik7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGF1ZGlvIGRldmljZXM6XCIsIGVycm9yKTtcbiAgICAgIHNldERldmljZUVycm9yKGVycm9yLm1lc3NhZ2UgfHwgXCJDb3VsZCBub3QgY29ubmVjdCB0byB0aGUgbGl2ZSBtZWV0aW5nIHdvcmtlciB0byBnZXQgYXVkaW8gZGV2aWNlcy5cIik7XG4gICAgICBzZXRBdWRpb0RldmljZXMoW10pO1xuICAgIH1cbiAgICBzZXRJc0xvYWRpbmdEZXZpY2VzKGZhbHNlKTtcbiAgfSwgW10pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgZmV0Y2hBdWRpb0RldmljZXMoKTsgLy8gRmV0Y2ggb24gY29tcG9uZW50IG1vdW50XG4gIH0sIFtmZXRjaEF1ZGlvRGV2aWNlc10pO1xuXG4gIGNvbnN0IGNsZWFyUG9sbGluZyA9ICgpID0+IHtcbiAgICBpZiAocG9sbGluZ0ludGVydmFsSWQpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwocG9sbGluZ0ludGVydmFsSWQpO1xuICAgICAgc2V0UG9sbGluZ0ludGVydmFsSWQobnVsbCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGhhbmRsZVN0YXJ0TWVldGluZyA9IGFzeW5jICgpID0+IHtcbiAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgc2V0U3VibWl0RXJyb3IoXCJVc2VyIG5vdCBhdXRoZW50aWNhdGVkLiBQbGVhc2UgbG9nIGluLlwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFtZWV0aW5nSWQgfHwgIW5vdGlvblBhZ2VUaXRsZSkge1xuICAgICAgc2V0U3VibWl0RXJyb3IoXCJNZWV0aW5nIElEL1VSTCBhbmQgTm90aW9uIFBhZ2UgVGl0bGUgYXJlIHJlcXVpcmVkLlwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGF1ZGlvRGV2aWNlcy5sZW5ndGggPiAwICYmICFzZWxlY3RlZEF1ZGlvRGV2aWNlKSB7XG4gICAgICAgIHNldFN1Ym1pdEVycm9yKFwiUGxlYXNlIHNlbGVjdCBhbiBhdWRpbyBkZXZpY2UuXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghc2VsZWN0ZWRBdWRpb0RldmljZSAmJiBhdWRpb0RldmljZXMubGVuZ3RoID09PSAwICYmICFkZXZpY2VFcnJvcikge1xuICAgICAgICBzZXRTdWJtaXRFcnJvcihcIk5vIGF1ZGlvIGRldmljZXMgYXZhaWxhYmxlLiBDYW5ub3Qgc3RhcnQgbWVldGluZy5cIik7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cblxuICAgIHNldElzUHJvY2Vzc2luZyh0cnVlKTtcbiAgICBzZXRTdWJtaXRFcnJvcihudWxsKTtcbiAgICBzZXRDdXJyZW50VGFzayhudWxsKTtcbiAgICBjbGVhclBvbGxpbmcoKTtcblxuICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICBwbGF0Zm9ybSxcbiAgICAgIG1lZXRpbmdfaWQ6IG1lZXRpbmdJZCxcbiAgICAgIGF1ZGlvX2RldmljZV9pZDogc2VsZWN0ZWRBdWRpb0RldmljZSxcbiAgICAgIG5vdGlvbl9wYWdlX3RpdGxlOiBub3Rpb25QYWdlVGl0bGUsXG4gICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0xJVkVfTUVFVElOR19XT1JLRVJfVVJMfS9zdGFydF9tZWV0aW5nX2F0dGVuZGFuY2VgLCB7XG4gICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocGF5bG9hZCksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihyZXN1bHQuZGV0YWlsIHx8IHJlc3VsdC5tZXNzYWdlIHx8IGBGYWlsZWQgdG8gaW5pdGlhdGUgbWVldGluZyBhdHRlbmRhbmNlOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gICAgICB9XG5cbiAgICAgIC8vIHJlc3VsdCBzaG91bGQgYmUgU3RhcnRNZWV0aW5nUmVzcG9uc2UgeyB0YXNrX2lkLCBzdGF0dXMsIG1lc3NhZ2UgfVxuICAgICAgLy8gYnV0IHdlIHdhbnQgdG8gc3RvcmUgdGhlIGZ1bGwgTWVldGluZ1Rhc2sgc3RydWN0dXJlIGV2ZW50dWFsbHksIHNvIHdlIHN5bnRoZXNpemUgaXQgb3IgZmV0Y2ggaW1tZWRpYXRlbHlcbiAgICAgIHNldEN1cnJlbnRUYXNrKHByZXYgPT4gKHsgLy8gT3B0aW1pc3RpY2FsbHkgc2V0IGJhc2ljIHRhc2sgaW5mb1xuICAgICAgICAuLi4ocHJldiBhcyBNZWV0aW5nVGFzayksIC8vIEtlZXAgYW55IG9sZCBkYXRhIGlmIG5lZWRlZCwgdGhvdWdoIHVzdWFsbHkgaXQncyBhIG5ldyB0YXNrXG4gICAgICAgIHRhc2tfaWQ6IHJlc3VsdC50YXNrX2lkLFxuICAgICAgICBzdGF0dXM6IHJlc3VsdC5zdGF0dXMgYXMgVGFza1N0YXR1c0VudW0sXG4gICAgICAgIG1lc3NhZ2U6IHJlc3VsdC5tZXNzYWdlIHx8IFwiVGFzayBpbml0aWF0ZWQuIFdhaXRpbmcgZm9yIGRldGFpbGVkIHN0YXR1cy4uLlwiLFxuICAgICAgICBwbGF0Zm9ybSxcbiAgICAgICAgbWVldGluZ19pZDogbWVldGluZ0lkLFxuICAgICAgICBhdWRpb19kZXZpY2VfaWQ6IHNlbGVjdGVkQXVkaW9EZXZpY2UsXG4gICAgICAgIG5vdGlvbl9wYWdlX3RpdGxlOiBub3Rpb25QYWdlVGl0bGUsXG4gICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgIH0pKTtcblxuICAgICAgLy8gU3RhcnQgcG9sbGluZyBmb3Igc3RhdHVzXG4gICAgICBjb25zdCBpbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoKCkgPT4gcG9sbFRhc2tTdGF0dXMocmVzdWx0LnRhc2tfaWQpLCA1MDAwKTtcbiAgICAgIHNldFBvbGxpbmdJbnRlcnZhbElkKGludGVydmFsSWQpO1xuICAgICAgcG9sbFRhc2tTdGF0dXMocmVzdWx0LnRhc2tfaWQpOyAvLyBJbml0aWFsIHBvbGwgaW1tZWRpYXRlbHlcblxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBpbml0aWF0aW5nIG1lZXRpbmcgYXR0ZW5kYW5jZTpcIiwgZXJyb3IpO1xuICAgICAgc2V0U3VibWl0RXJyb3IoZXJyb3IubWVzc2FnZSB8fCBcIkFuIHVua25vd24gZXJyb3Igb2NjdXJyZWQgd2hpbGUgc3RhcnRpbmcuXCIpO1xuICAgICAgc2V0Q3VycmVudFRhc2sobnVsbCk7IC8vIENsZWFyIHRhc2sgb24gZXJyb3JcbiAgICB9XG4gICAgc2V0SXNQcm9jZXNzaW5nKGZhbHNlKTtcbiAgfTtcblxuICBjb25zdCBwb2xsVGFza1N0YXR1cyA9IGFzeW5jICh0YXNrSWQ6IHN0cmluZykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0xJVkVfTUVFVElOR19XT1JLRVJfVVJMfS9tZWV0aW5nX2F0dGVuZGFuY2Vfc3RhdHVzLyR7dGFza0lkfWApO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpIHtcbiAgICAgICAgICAgIHNldFN1Ym1pdEVycm9yKGBUYXNrIHN0YXR1cyBub3QgZm91bmQgKElEOiAke3Rhc2tJZH0pLiBJdCBtaWdodCBoYXZlIGJlZW4gY2xlYXJlZCBvciBpcyBhbiBvbGQgSUQuYCk7XG4gICAgICAgICAgICBjbGVhclBvbGxpbmcoKTtcbiAgICAgICAgICAgIHNldEN1cnJlbnRUYXNrKG51bGwpOyAvLyBUYXNrIGlzIGdvbmVcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBlcnJvckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCkuY2F0Y2goKCkgPT4gKHt9KSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvckRhdGEuZGV0YWlsIHx8IGBGYWlsZWQgdG8gZmV0Y2ggdGFzayBzdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHN0YXR1c0RhdGE6IE1lZXRpbmdUYXNrID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgc2V0Q3VycmVudFRhc2soc3RhdHVzRGF0YSk7XG5cbiAgICAgIC8vIFN0b3AgcG9sbGluZyBpZiB0YXNrIGlzIGluIGEgdGVybWluYWwgc3RhdGVcbiAgICAgIGlmIChzdGF0dXNEYXRhLnN0YXR1cyA9PT0gVGFza1N0YXR1c0VudW0uQ09NUExFVEVEIHx8IHN0YXR1c0RhdGEuc3RhdHVzID09PSBUYXNrU3RhdHVzRW51bS5FUlJPUikge1xuICAgICAgICBjbGVhclBvbGxpbmcoKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBwb2xsaW5nIHRhc2sgc3RhdHVzIGZvciAke3Rhc2tJZH06YCwgZXJyb3IpO1xuICAgICAgc2V0U3VibWl0RXJyb3IoYEVycm9yIGZldGNoaW5nIHRhc2sgc3RhdHVzOiAke2Vycm9yLm1lc3NhZ2V9LiBQb2xsaW5nIG1heSBiZSBhZmZlY3RlZC5gKTtcbiAgICAgIC8vIFBvdGVudGlhbGx5IHN0b3AgcG9sbGluZyBvbiByZXBlYXRlZCBlcnJvcnMgb3Igc3BlY2lmaWMgZXJyb3IgdHlwZXNcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgaGFuZGxlU3RvcE1lZXRpbmcgPSBhc3luYyAoKSA9PiB7XG4gICAgaWYgKCFjdXJyZW50VGFzayB8fCAhY3VycmVudFRhc2sudGFza19pZCkge1xuICAgICAgc2V0U3VibWl0RXJyb3IoXCJObyBhY3RpdmUgdGFzayB0byBzdG9wLlwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGN1cnJlbnRUYXNrLnN0YXR1cyA9PT0gVGFza1N0YXR1c0VudW0uQ09NUExFVEVEIHx8IGN1cnJlbnRUYXNrLnN0YXR1cyA9PT0gVGFza1N0YXR1c0VudW0uRVJST1IpIHtcbiAgICAgIHNldFN1Ym1pdEVycm9yKFwiVGFzayBpcyBhbHJlYWR5IGluIGEgdGVybWluYWwgc3RhdGUuXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHNldElzUHJvY2Vzc2luZyh0cnVlKTtcbiAgICBzZXRTdWJtaXRFcnJvcihudWxsKTtcbiAgICBjbGVhclBvbGxpbmcoKTsgLy8gU3RvcCByZWd1bGFyIHBvbGxpbmcgYXMgd2UgYXJlIHNlbmRpbmcgYSBzdG9wIGNvbW1hbmRcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0xJVkVfTUVFVElOR19XT1JLRVJfVVJMfS9zdG9wX21lZXRpbmdfYXR0ZW5kYW5jZS8ke2N1cnJlbnRUYXNrLnRhc2tfaWR9YCwge1xuICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0OiBNZWV0aW5nVGFzayA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsgLy8gRXhwZWN0cyB1cGRhdGVkIHRhc2sgZGV0YWlsc1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzdWx0Lm1lc3NhZ2UgfHwgKHJlc3VsdCBhcyBhbnkpLmRldGFpbCB8fCBgRmFpbGVkIHRvIHN0b3AgbWVldGluZzogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgfVxuXG4gICAgICBzZXRDdXJyZW50VGFzayhyZXN1bHQpOyAvLyBVcGRhdGUgd2l0aCBmaW5hbCBzdGF0dXMgZnJvbSBzdG9wIHJlc3BvbnNlXG4gICAgICBpZiAocmVzdWx0LnN0YXR1cyAhPT0gVGFza1N0YXR1c0VudW0uQ09NUExFVEVEICYmIHJlc3VsdC5zdGF0dXMgIT09IFRhc2tTdGF0dXNFbnVtLkVSUk9SKSB7XG4gICAgICAgIC8vIElmIG5vdCB5ZXQgdGVybWluYWwsIHBvbGwgb25jZSBtb3JlIG9yIHJlc3RhcnQgcG9sbGluZyBicmllZmx5XG4gICAgICAgIGNvbnN0IGludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKSA9PiBwb2xsVGFza1N0YXR1cyhyZXN1bHQudGFza19pZCksIDMwMDApO1xuICAgICAgICBzZXRQb2xsaW5nSW50ZXJ2YWxJZChpbnRlcnZhbElkKTtcbiAgICAgIH1cblxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzdG9wcGluZyBtZWV0aW5nIGF0dGVuZGFuY2U6XCIsIGVycm9yKTtcbiAgICAgIHNldFN1Ym1pdEVycm9yKGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmtub3duIGVycm9yIG9jY3VycmVkIHdoaWxlIHN0b3BwaW5nLlwiKTtcbiAgICAgIC8vIE9wdGlvbmFsbHksIHJlc3RhcnQgcG9sbGluZyBpZiBzdG9wIGNvbW1hbmQgZmFpbGVkLCB0byBnZXQgbGF0ZXN0IHN0YXR1c1xuICAgICAgaWYgKGN1cnJlbnRUYXNrICYmIGN1cnJlbnRUYXNrLnRhc2tfaWQgJiYgIXBvbGxpbmdJbnRlcnZhbElkKSB7XG4gICAgICAgIGNvbnN0IGludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKSA9PiBwb2xsVGFza1N0YXR1cyhjdXJyZW50VGFzay50YXNrX2lkKSwgNTAwMCk7XG4gICAgICAgIHNldFBvbGxpbmdJbnRlcnZhbElkKGludGVydmFsSWQpO1xuICAgICAgfVxuICAgIH1cbiAgICBzZXRJc1Byb2Nlc3NpbmcoZmFsc2UpO1xuICB9O1xuXG5cbiAgLy8gQ2xlYXIgaW50ZXJ2YWwgb24gdW5tb3VudFxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBjbGVhclBvbGxpbmcoKTtcbiAgICB9O1xuICB9LCBbcG9sbGluZ0ludGVydmFsSWRdKTsgLy8gRGVwZW5kZW5jeSBhcnJheSBlbnN1cmVzIGNsZWFudXAgaWYgcG9sbGluZ0ludGVydmFsSWQgY2hhbmdlcywgYnV0IGNsZWFyUG9sbGluZyBoYW5kbGVzIGl0cyBvd24gc3RhdGUuXG5cbiAgY29uc3QgcGxhdGZvcm1PcHRpb25zID0gW1xuICAgIHsgbGFiZWw6ICdHb29nbGUgTWVldCcsIHZhbHVlOiAnZ29vZ2xlbWVldCcgfSxcbiAgICB7IGxhYmVsOiAnWm9vbScsIHZhbHVlOiAnem9vbScgfSxcbiAgICB7IGxhYmVsOiAnTWljcm9zb2Z0IFRlYW1zJywgdmFsdWU6ICdtc3RlYW1zJyB9LFxuICAgIHsgbGFiZWw6ICdPdGhlci9EZXNrdG9wIEF1ZGlvJywgdmFsdWU6ICdvdGhlcicgfSxcbiAgXTtcblxuICBjb25zdCBhdWRpb0RldmljZU9wdGlvbnMgPSBhdWRpb0RldmljZXMubWFwKGRldmljZSA9PiAoe1xuICAgIGxhYmVsOiBgJHtkZXZpY2UubmFtZX0gKElEOiAke2RldmljZS5pZH0pYCxcbiAgICB2YWx1ZTogZGV2aWNlLmlkLFxuICB9KSk7XG5cbiAgY29uc3QgaXNUYXNrQWN0aXZlT3JQZW5kaW5nID0gY3VycmVudFRhc2sgJiZcbiAgICAoY3VycmVudFRhc2suc3RhdHVzID09PSBUYXNrU3RhdHVzRW51bS5BQ1RJVkUgfHxcbiAgICAgY3VycmVudFRhc2suc3RhdHVzID09PSBUYXNrU3RhdHVzRW51bS5QRU5ESU5HIHx8XG4gICAgIGN1cnJlbnRUYXNrLnN0YXR1cyA9PT0gVGFza1N0YXR1c0VudW0uUFJPQ0VTU0lOR19DT01QTEVUSU9OKTtcblxuXG4gIHJldHVybiAoXG4gICAgPEJveFxuICAgICAgcGFkZGluZz17eyBwaG9uZTogJ20nLCB0YWJsZXQ6ICdsJyB9fVxuICAgICAgYm9yZGVyV2lkdGg9ezF9XG4gICAgICBib3JkZXJDb2xvcj1cImhhaXJsaW5lXCJcbiAgICAgIGJvcmRlclJhZGl1cz1cIm1cIlxuICAgICAgbWFyZ2luPXt7IHBob25lOiAnbScsIHRhYmxldDogJ2wnIH19XG4gICAgICBiYWNrZ3JvdW5kQ29sb3I9XCJ3aGl0ZVwiXG4gICAgPlxuICAgICAgPFRleHQgdmFyaWFudD1cInNlY3Rpb25IZWFkZXJcIiBtYXJnaW5Cb3R0b209XCJtXCI+XG4gICAgICAgIExpdmUgTWVldGluZyBBdHRlbmRhbmNlXG4gICAgICA8L1RleHQ+XG4gICAgICA8VGV4dCB2YXJpYW50PVwiYm9keVwiIGZvbnRTaXplPVwic21cIiBjb2xvcj1cImdyYXkuNjAwXCIgbWFyZ2luQm90dG9tPVwibVwiPlxuICAgICAgICBDb25maWd1cmUgQXRvbSB0byBjYXB0dXJlIGF1ZGlvIGZyb20gb25saW5lIG1lZXRpbmdzIG9yIGRlc2t0b3AsIChldmVudHVhbGx5KSB0cmFuc2NyaWJlLCBhbmQgZ2VuZXJhdGUgbm90ZXMuXG4gICAgICAgIFJlZmVyIHRvIHRoZSA8YSBocmVmPVwiL2RvY3MvbGl2ZS1tZWV0aW5nLWF0dGVuZGFuY2Utc2V0dXAubWRcIiB0YXJnZXQ9XCJfYmxhbmtcIiByZWw9XCJub29wZW5lciBub3JlZmVycmVyXCIgc3R5bGU9e3tjb2xvcjogJ2JsdWUnfX0+c2V0dXAgZ3VpZGU8L2E+IGZvciBhdWRpbyBjb25maWd1cmF0aW9uLlxuICAgICAgPC9UZXh0PlxuXG4gICAgICA8Qm94IG1hcmdpbkJvdHRvbT1cImxcIj5cbiAgICAgICAgPFRleHQgdmFyaWFudD1cInN1YkhlYWRlclwiIG1hcmdpbkJvdHRvbT1cInNcIj5BdWRpbyBEZXZpY2UgU2VsZWN0aW9uPC9UZXh0PlxuICAgICAgICA8QnV0dG9uIG9uUHJlc3M9e2ZldGNoQXVkaW9EZXZpY2VzfSBkaXNhYmxlZD17aXNMb2FkaW5nRGV2aWNlcyB8fCBpc1Byb2Nlc3Npbmd9IG1hcmdpbkJvdHRvbT1cInNcIj5cbiAgICAgICAgICB7aXNMb2FkaW5nRGV2aWNlcyA/ICdSZWZyZXNoaW5nIERldmljZXMuLi4nIDogJ1JlZnJlc2ggQXVkaW8gRGV2aWNlcyd9XG4gICAgICAgIDwvQnV0dG9uPlxuICAgICAgICB7ZGV2aWNlRXJyb3IgJiYgPFRleHQgY29sb3I9XCJyZWQuNTAwXCIgbWFyZ2luQm90dG9tPVwic1wiIGZvbnRTaXplPVwic21cIj57ZGV2aWNlRXJyb3J9PC9UZXh0Pn1cbiAgICAgICAge2F1ZGlvRGV2aWNlcy5sZW5ndGggPiAwICYmIChcbiAgICAgICAgICA8U2VsZWN0XG4gICAgICAgICAgICBsYWJlbD1cIlNlbGVjdCBBdWRpbyBEZXZpY2UgKGZvciBtZWV0aW5nL2Rlc2t0b3AgYXVkaW8gY2FwdHVyZSlcIlxuICAgICAgICAgICAgb3B0aW9ucz17YXVkaW9EZXZpY2VPcHRpb25zfVxuICAgICAgICAgICAgdmFsdWU9e3NlbGVjdGVkQXVkaW9EZXZpY2V9XG4gICAgICAgICAgICBvbkNoYW5nZT17KHZhbHVlKSA9PiBzZXRTZWxlY3RlZEF1ZGlvRGV2aWNlKHZhbHVlIGFzIHN0cmluZyB8IG51bWJlcil9XG4gICAgICAgICAgICBwbGFjZWhvbGRlcj1cIlNlbGVjdCBhbiBhdWRpbyBkZXZpY2VcIlxuICAgICAgICAgICAgZGlzYWJsZWQ9e2lzUHJvY2Vzc2luZyB8fCBpc1Rhc2tBY3RpdmVPclBlbmRpbmd9XG4gICAgICAgICAgLz5cbiAgICAgICAgKX1cbiAgICAgICAge2F1ZGlvRGV2aWNlcy5sZW5ndGggPT09IDAgJiYgIWlzTG9hZGluZ0RldmljZXMgJiYgIWRldmljZUVycm9yICYmIChcbiAgICAgICAgICAgIDxUZXh0IGZvbnRTaXplPVwic21cIj5ObyBhdWRpbyBkZXZpY2VzIGZvdW5kIG9yIGxvYWRlZC4gVHJ5IHJlZnJlc2hpbmcsIG9yIGNoZWNrIHdvcmtlciBsb2dzLjwvVGV4dD5cbiAgICAgICAgKX1cbiAgICAgICAgPFRleHQgdmFyaWFudD1cImJvZHlcIiBmb250U2l6ZT1cInhzXCIgY29sb3I9XCJncmF5LjUwMFwiIG1hcmdpblRvcD1cInhzXCI+XG4gICAgICAgICAgICBUaGUgc2VsZWN0ZWQgZGV2aWNlIHNob3VsZCBpZGVhbGx5IGJlIGEgdmlydHVhbCBhdWRpbyBvdXRwdXQvbG9vcGJhY2sgdGhhdCBjYXB0dXJlcyB0aGUgbWVldGluZydzIHNvdW5kIChub3QgeW91ciBtaWNyb3Bob25lLCB1bmxlc3MgaW50ZW5kZWQpLlxuICAgICAgICA8L1RleHQ+XG4gICAgICA8L0JveD5cblxuICAgICAgPEJveCBtYXJnaW5Cb3R0b209XCJsXCI+XG4gICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJzdWJIZWFkZXJcIiBtYXJnaW5Cb3R0b209XCJzXCI+TWVldGluZyBEZXRhaWxzPC9UZXh0PlxuICAgICAgICA8U2VsZWN0XG4gICAgICAgICAgICBsYWJlbD1cIlBsYXRmb3JtXCJcbiAgICAgICAgICAgIG9wdGlvbnM9e3BsYXRmb3JtT3B0aW9uc31cbiAgICAgICAgICAgIHZhbHVlPXtwbGF0Zm9ybX1cbiAgICAgICAgICAgIG9uQ2hhbmdlPXsodmFsdWUpID0+IHNldFBsYXRmb3JtKHZhbHVlIGFzICd6b29tJyB8ICdnb29nbGVtZWV0JyB8ICdtc3RlYW1zJyB8ICdvdGhlcicpfVxuICAgICAgICAgICAgZGlzYWJsZWQ9e2lzUHJvY2Vzc2luZyB8fCBpc1Rhc2tBY3RpdmVPclBlbmRpbmd9XG4gICAgICAgIC8+XG4gICAgICAgIDxUZXh0RmllbGRcbiAgICAgICAgICBsYWJlbD1cIk1lZXRpbmcgSUQgb3IgRGVzY3JpcHRpb25cIlxuICAgICAgICAgIHZhbHVlPXttZWV0aW5nSWR9XG4gICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRNZWV0aW5nSWQoZS50YXJnZXQudmFsdWUpfVxuICAgICAgICAgIHBsYWNlaG9sZGVyPVwiZS5nLiwgaHR0cHM6Ly9tZWV0Lmdvb2dsZS5jb20vYWJjLWRlZi1naGkgb3IgJ0NsaWVudCBDYWxsJ1wiXG4gICAgICAgICAgbWFyZ2luVG9wPVwic1wiXG4gICAgICAgICAgZGlzYWJsZWQ9e2lzUHJvY2Vzc2luZyB8fCBpc1Rhc2tBY3RpdmVPclBlbmRpbmd9XG4gICAgICAgIC8+XG4gICAgICAgIDxUZXh0RmllbGRcbiAgICAgICAgICBsYWJlbD1cIk5vdGlvbiBQYWdlIFRpdGxlIChmb3IgTm90ZXMpXCJcbiAgICAgICAgICB2YWx1ZT17bm90aW9uUGFnZVRpdGxlfVxuICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0Tm90aW9uUGFnZVRpdGxlKGUudGFyZ2V0LnZhbHVlKX1cbiAgICAgICAgICBwbGFjZWhvbGRlcj1cImUuZy4sIFByb2plY3QgUGhvZW5peCBTeW5jIC0gT2N0IDI4XCJcbiAgICAgICAgICBtYXJnaW5Ub3A9XCJzXCJcbiAgICAgICAgICBkaXNhYmxlZD17aXNQcm9jZXNzaW5nIHx8IGlzVGFza0FjdGl2ZU9yUGVuZGluZ31cbiAgICAgICAgLz5cbiAgICAgIDwvQm94PlxuXG4gICAgICB7LyogQVBJIEtleSBpbnB1dHMgcmVtb3ZlZCBhcyB0aGV5IGFyZSBub3QgcGFydCBvZiB0aGUgbmV3IHdvcmtlciBBUEkgY29udHJhY3QgKi99XG5cbiAgICAgIDxCb3ggZmxleERpcmVjdGlvbj1cInJvd1wiIGp1c3RpZnlDb250ZW50PVwic3BhY2UtYmV0d2VlblwiPlxuICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICBvblByZXNzPXtoYW5kbGVTdGFydE1lZXRpbmd9XG4gICAgICAgICAgICBkaXNhYmxlZD17aXNQcm9jZXNzaW5nIHx8IGlzTG9hZGluZ0RldmljZXMgfHwgaXNMb2FkaW5nU2Vzc2lvbiB8fCBpc1Rhc2tBY3RpdmVPclBlbmRpbmcgfHwgKCFzZWxlY3RlZEF1ZGlvRGV2aWNlICYmIGF1ZGlvRGV2aWNlcy5sZW5ndGggPiAwKX1cbiAgICAgICAgICAgIHZhcmlhbnQ9XCJwcmltYXJ5XCJcbiAgICAgICAgPlxuICAgICAgICAgIHtpc1Byb2Nlc3NpbmcgJiYgY3VycmVudFRhc2s/LnN0YXR1cyAhPT0gVGFza1N0YXR1c0VudW0uQUNUSVZFID8gJ1N0YXJ0aW5nLi4uJyA6ICdTdGFydCBBdHRlbmRpbmcgTWVldGluZyd9XG4gICAgICAgIDwvQnV0dG9uPlxuICAgICAgICB7aXNUYXNrQWN0aXZlT3JQZW5kaW5nICYmIChcbiAgICAgICAgICAgIDxCdXR0b24gb25QcmVzcz17aGFuZGxlU3RvcE1lZXRpbmd9IGRpc2FibGVkPXtpc1Byb2Nlc3Npbmd9IHZhcmlhbnQ9XCJ3YXJuaW5nXCIgbWFyZ2luTGVmdD1cIm1cIj5cbiAgICAgICAgICAgICB7aXNQcm9jZXNzaW5nICYmIGN1cnJlbnRUYXNrPy5zdGF0dXMgPT09IFRhc2tTdGF0dXNFbnVtLkFDVElWRSA/ICdTdG9wcGluZy4uLicgOiAnU3RvcCBBdHRlbmRpbmcgTWVldGluZyd9XG4gICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgKX1cbiAgICAgIDwvQm94PlxuICAgICAge3N1Ym1pdEVycm9yICYmIDxUZXh0IGNvbG9yPVwicmVkLjUwMFwiIG1hcmdpblRvcD1cInNcIiBmb250U2l6ZT1cInNtXCI+e3N1Ym1pdEVycm9yfTwvVGV4dD59XG4gICAgICB7aXNMb2FkaW5nU2Vzc2lvbiAmJiA8VGV4dCBjb2xvcj1cIm9yYW5nZS41MDBcIiBtYXJnaW5Ub3A9XCJzXCIgZm9udFNpemU9XCJzbVwiPkxvYWRpbmcgdXNlciBzZXNzaW9uLi4uPC9UZXh0Pn1cblxuXG4gICAgICB7Y3VycmVudFRhc2sgJiYgKFxuICAgICAgICA8Qm94IG1hcmdpblRvcD1cImxcIiBwYWRkaW5nPVwibVwiIGJvcmRlcldpZHRoPXsxfSBib3JkZXJDb2xvcj1cImdyYXkuMzAwXCIgYm9yZGVyUmFkaXVzPVwic1wiPlxuICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9XCJzdWJIZWFkZXJcIiBtYXJnaW5Cb3R0b209XCJzXCI+VGFzayBTdGF0dXMgKElEOiB7Y3VycmVudFRhc2sudGFza19pZH0pPC9UZXh0PlxuICAgICAgICAgIDxUZXh0PjxzdHJvbmc+U3RhdHVzOjwvc3Ryb25nPiB7Y3VycmVudFRhc2suc3RhdHVzfSB7Y3VycmVudFRhc2subWVzc2FnZSA/IGAoJHtjdXJyZW50VGFzay5tZXNzYWdlfSlgIDogJyd9PC9UZXh0PlxuICAgICAgICAgIHtjdXJyZW50VGFzay5zdGFydF90aW1lICYmIDxUZXh0PjxzdHJvbmc+U3RhcnRlZDo8L3N0cm9uZz4ge25ldyBEYXRlKGN1cnJlbnRUYXNrLnN0YXJ0X3RpbWUpLnRvTG9jYWxlU3RyaW5nKCl9PC9UZXh0Pn1cbiAgICAgICAgICB7Y3VycmVudFRhc2suZHVyYXRpb25fc2Vjb25kcyAhPT0gbnVsbCAmJiB0eXBlb2YgY3VycmVudFRhc2suZHVyYXRpb25fc2Vjb25kcyAhPT0gJ3VuZGVmaW5lZCcgJiYgKFxuICAgICAgICAgICAgPFRleHQ+PHN0cm9uZz5EdXJhdGlvbjo8L3N0cm9uZz4ge01hdGgucm91bmQoY3VycmVudFRhc2suZHVyYXRpb25fc2Vjb25kcyl9czwvVGV4dD5cbiAgICAgICAgICApfVxuICAgICAgICAgIHtjdXJyZW50VGFzay50cmFuc2NyaXB0X3ByZXZpZXcgJiYgPFRleHQ+PHN0cm9uZz5UcmFuc2NyaXB0IFByZXZpZXc6PC9zdHJvbmc+IHtjdXJyZW50VGFzay50cmFuc2NyaXB0X3ByZXZpZXd9PC9UZXh0Pn1cbiAgICAgICAgICB7Y3VycmVudFRhc2subm90ZXNfcHJldmlldyAmJiA8VGV4dD48c3Ryb25nPk5vdGVzIFByZXZpZXc6PC9zdHJvbmc+IHtjdXJyZW50VGFzay5ub3Rlc19wcmV2aWV3fTwvVGV4dD59XG5cbiAgICAgICAgICB7Y3VycmVudFRhc2suc3RhdHVzID09PSBUYXNrU3RhdHVzRW51bS5DT01QTEVURUQgJiYgKFxuICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAge2N1cnJlbnRUYXNrLmZpbmFsX3RyYW5zY3JpcHRfbG9jYXRpb24gJiYgKFxuICAgICAgICAgICAgICAgIDxUZXh0PjxzdHJvbmc+RmluYWwgVHJhbnNjcmlwdDo8L3N0cm9uZz4ge2N1cnJlbnRUYXNrLmZpbmFsX3RyYW5zY3JpcHRfbG9jYXRpb259PC9UZXh0PlxuICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICB7Y3VycmVudFRhc2suZmluYWxfbm90ZXNfbG9jYXRpb24gJiYgKFxuICAgICAgICAgICAgICAgIDxUZXh0PjxzdHJvbmc+RmluYWwgTm90ZXM6PC9zdHJvbmc+IHtjdXJyZW50VGFzay5maW5hbF9ub3Rlc19sb2NhdGlvbn0gKE5vdGU6IEFjdHVhbCBOb3Rpb24gcGFnZSBjcmVhdGlvbiBpcyBhIGZ1dHVyZSBzdGVwIGZvciB0aGUgd29ya2VyKTwvVGV4dD5cbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIDwvPlxuICAgICAgICAgICl9XG4gICAgICAgICAgIHtjdXJyZW50VGFzay5zdGF0dXMgPT09IFRhc2tTdGF0dXNFbnVtLkVSUk9SICYmIGN1cnJlbnRUYXNrLm1lc3NhZ2UgJiYgKFxuICAgICAgICAgICAgPFRleHQgY29sb3I9XCJyZWQuNTAwXCI+PHN0cm9uZz5FcnJvciBEZXRhaWxzOjwvc3Ryb25nPiB7Y3VycmVudFRhc2subWVzc2FnZX08L1RleHQ+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC9Cb3g+XG4gICAgICApfVxuICAgIDwvQm94PlxuICApO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgTGl2ZU1lZXRpbmdBdHRlbmRhbmNlU2V0dGluZ3M7XG4iXX0=