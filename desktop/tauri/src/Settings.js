"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const secure_storage_1 = require("./lib/secure-storage");
require("./Settings.css");
const Settings = () => {
    // State for each setting
    const [notionApiKey, setNotionApiKey] = (0, react_1.useState)('');
    const [notionDatabaseId, setNotionDatabaseId] = (0, react_1.useState)('');
    const [zapierUrl, setZapierUrl] = (0, react_1.useState)('');
    const [ttsProvider, setTtsProvider] = (0, react_1.useState)('elevenlabs');
    const [ttsApiKey, setTtsApiKey] = (0, react_1.useState)('');
    const [githubApiKey, setGithubApiKey] = (0, react_1.useState)('');
    const [githubOwner, setGithubOwner] = (0, react_1.useState)('');
    const [githubRepo, setGithubRepo] = (0, react_1.useState)('');
    const [slackChannelId, setSlackChannelId] = (0, react_1.useState)('');
    // UI feedback state
    const [message, setMessage] = (0, react_1.useState)('');
    const [error, setError] = (0, react_1.useState)('');
    // Load settings on component mount
    (0, react_1.useEffect)(() => {
        const loadSettings = async () => {
            // Notion
            if (await (0, secure_storage_1.getSettingStatus)('notion_api_key')) {
                setNotionApiKey('********');
            }
            const savedNotionDbId = await (0, secure_storage_1.getSetting)('notion_tasks_database_id');
            setNotionDatabaseId(savedNotionDbId || '');
            // Zapier
            const savedZapierUrl = await (0, secure_storage_1.getSetting)('zapier_webhook_url');
            setZapierUrl(savedZapierUrl || '');
            // TTS Provider
            const savedTtsProvider = await (0, secure_storage_1.getSetting)('tts_provider');
            if (savedTtsProvider) {
                setTtsProvider(savedTtsProvider);
            }
            // TTS API Key (check based on the loaded provider)
            if (await (0, secure_storage_1.getSettingStatus)(`${savedTtsProvider || ttsProvider}_api_key`)) {
                setTtsApiKey('********');
            }
            // GitHub
            if (await (0, secure_storage_1.getSettingStatus)('github_api_key')) {
                setGithubApiKey('********');
            }
            const savedGithubOwner = await (0, secure_storage_1.getSetting)('github_owner');
            setGithubOwner(savedGithubOwner || '');
            const savedGithubRepo = await (0, secure_storage_1.getSetting)('github_repo');
            setGithubRepo(savedGithubRepo || '');
            const savedSlackChannelId = await (0, secure_storage_1.getSetting)('slack_channel_id');
            setSlackChannelId(savedSlackChannelId || '');
        };
        loadSettings();
    }, []);
    const handleSave = async () => {
        setMessage('');
        setError('');
        try {
            // Save Notion API Key (only if it's not masked)
            if (notionApiKey !== '********') {
                await (0, secure_storage_1.saveSetting)('notion_api_key', notionApiKey);
            }
            // Save Notion Database ID
            await (0, secure_storage_1.saveSetting)('notion_tasks_database_id', notionDatabaseId);
            // Save Zapier URL
            await (0, secure_storage_1.saveSetting)('zapier_webhook_url', zapierUrl);
            // Save TTS Provider
            await (0, secure_storage_1.saveSetting)('tts_provider', ttsProvider);
            // Save TTS API Key (only if it's not masked)
            if (ttsApiKey !== '********') {
                await (0, secure_storage_1.saveSetting)(`${ttsProvider}_api_key`, ttsApiKey);
            }
            // Save GitHub API Key (only if it's not masked)
            if (githubApiKey !== '********') {
                await (0, secure_storage_1.saveSetting)('github_api_key', githubApiKey);
            }
            // Save GitHub Owner and Repo
            await (0, secure_storage_1.saveSetting)('github_owner', githubOwner);
            await (0, secure_storage_1.saveSetting)('github_repo', githubRepo);
            await (0, secure_storage_1.saveSetting)('slack_channel_id', slackChannelId);
            setMessage('Settings saved successfully!');
            // Re-mask keys after saving
            if (notionApiKey && notionApiKey !== '********')
                setNotionApiKey('********');
            if (ttsApiKey && ttsApiKey !== '********')
                setTtsApiKey('********');
            if (githubApiKey && githubApiKey !== '********') {
                await (0, secure_storage_1.saveSetting)('github_api_key', githubApiKey);
                setGithubApiKey('********');
            }
        }
        catch (err) {
            setError('Failed to save settings.');
            console.error(err);
        }
    };
    return ((0, jsx_runtime_1.jsxs)("div", { className: "settings-container", children: [(0, jsx_runtime_1.jsx)("h2", { children: "Settings" }), message && (0, jsx_runtime_1.jsx)("div", { className: "save-message success", children: message }), error && (0, jsx_runtime_1.jsx)("div", { className: "save-message error", children: error }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsx)("label", { children: "Notion API Key" }), (0, jsx_runtime_1.jsx)("input", { type: "password", value: notionApiKey, onChange: (e) => setNotionApiKey(e.target.value), placeholder: "Enter Notion API Key" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsx)("label", { children: "Notion Tasks Database ID" }), (0, jsx_runtime_1.jsx)("input", { type: "text", value: notionDatabaseId, onChange: (e) => setNotionDatabaseId(e.target.value), placeholder: "Enter Notion Tasks Database ID" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsx)("label", { children: "GitHub Personal Access Token" }), (0, jsx_runtime_1.jsx)("input", { type: "password", value: githubApiKey, onChange: (e) => setGithubApiKey(e.target.value), placeholder: "Enter GitHub Personal Access Token" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsx)("label", { children: "Slack Channel ID" }), (0, jsx_runtime_1.jsx)("input", { type: "text", value: slackChannelId, onChange: (e) => setSlackChannelId(e.target.value), placeholder: "Enter Slack Channel ID to monitor" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsx)("label", { children: "Zapier Webhook URL" }), (0, jsx_runtime_1.jsx)("input", { type: "text", value: zapierUrl, onChange: (e) => setZapierUrl(e.target.value), placeholder: "Enter Zapier Webhook URL" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsx)("label", { children: "TTS Provider" }), (0, jsx_runtime_1.jsxs)("select", { value: ttsProvider, onChange: (e) => {
                            setTtsProvider(e.target.value);
                            setTtsApiKey(''); // Reset API key when provider changes
                        }, children: [(0, jsx_runtime_1.jsx)("option", { value: "elevenlabs", children: "ElevenLabs" }), (0, jsx_runtime_1.jsx)("option", { value: "deepgram", children: "Deepgram" })] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsxs)("label", { children: [ttsProvider === 'elevenlabs' ? 'ElevenLabs' : 'Deepgram', " API Key"] }), (0, jsx_runtime_1.jsx)("input", { type: "password", value: ttsApiKey, onChange: (e) => setTtsApiKey(e.target.value), placeholder: `Enter ${ttsProvider === 'elevenlabs' ? 'ElevenLabs' : 'Deepgram'} API Key` })] }), (0, jsx_runtime_1.jsx)("button", { onClick: handleSave, children: "Save Settings" })] }));
};
exports.default = Settings;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiU2V0dGluZ3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJTZXR0aW5ncy50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsaUNBQW1EO0FBQ25ELHlEQUFpRjtBQUNqRiwwQkFBd0I7QUFFeEIsTUFBTSxRQUFRLEdBQUcsR0FBRyxFQUFFO0lBQ3BCLHlCQUF5QjtJQUN6QixNQUFNLENBQUMsWUFBWSxFQUFFLGVBQWUsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxFQUFFLENBQUMsQ0FBQztJQUNyRCxNQUFNLENBQUMsZ0JBQWdCLEVBQUUsbUJBQW1CLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDN0QsTUFBTSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDL0MsTUFBTSxDQUFDLFdBQVcsRUFBRSxjQUFjLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsWUFBWSxDQUFDLENBQUM7SUFDN0QsTUFBTSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDL0MsTUFBTSxDQUFDLFlBQVksRUFBRSxlQUFlLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDckQsTUFBTSxDQUFDLFdBQVcsRUFBRSxjQUFjLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDbkQsTUFBTSxDQUFDLFVBQVUsRUFBRSxhQUFhLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDakQsTUFBTSxDQUFDLGNBQWMsRUFBRSxpQkFBaUIsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxFQUFFLENBQUMsQ0FBQztJQUV6RCxvQkFBb0I7SUFDcEIsTUFBTSxDQUFDLE9BQU8sRUFBRSxVQUFVLENBQUMsR0FBRyxJQUFBLGdC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QVEsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQzdDLFdBQVcsRUFBQywwQkFBMEIsR0FDdEMsSUFDRSxFQUdOLGlDQUFLLFNBQVMsRUFBQyxTQUFTLGFBQ3RCLDZEQUEyQixFQUMzQixvQ0FBUSxLQUFLLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFOzRCQUMxQyxjQUFjLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQzs0QkFDL0IsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsc0NBQXNDO3dCQUMxRCxDQUFDLGFBQ0MsbUNBQVEsS0FBSyxFQUFDLFlBQVksMkJBQW9CLEVBQzlDLG1DQUFRLEtBQUssRUFBQyxVQUFVLHlCQUFrQixJQUNuQyxJQUNMLEVBQ04saUNBQUssU0FBUyxFQUFDLFNBQVMsYUFDdEIsOENBQVEsV0FBVyxLQUFLLFlBQVksQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxVQUFVLGdCQUFpQixFQUNqRixrQ0FDRSxJQUFJLEVBQUMsVUFBVSxFQUNmLEtBQUssRUFBRSxTQUFTLEVBQ2hCLFFBQVEsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQzdDLFdBQVcsRUFBRSxTQUFTLFdBQVcsS0FBSyxZQUFZLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsVUFBVSxVQUFVLEdBQ3hGLElBQ0UsRUFFTixtQ0FBUSxPQUFPLEVBQUUsVUFBVSw4QkFBd0IsSUFDL0MsQ0FDUCxDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBRUYsa0JBQWUsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBzYXZlU2V0dGluZywgZ2V0U2V0dGluZywgZ2V0U2V0dGluZ1N0YXR1cyB9IGZyb20gJy4vbGliL3NlY3VyZS1zdG9yYWdlJztcbmltcG9ydCAnLi9TZXR0aW5ncy5jc3MnO1xuXG5jb25zdCBTZXR0aW5ncyA9ICgpID0+IHtcbiAgLy8gU3RhdGUgZm9yIGVhY2ggc2V0dGluZ1xuICBjb25zdCBbbm90aW9uQXBpS2V5LCBzZXROb3Rpb25BcGlLZXldID0gdXNlU3RhdGUoJycpO1xuICBjb25zdCBbbm90aW9uRGF0YWJhc2VJZCwgc2V0Tm90aW9uRGF0YWJhc2VJZF0gPSB1c2VTdGF0ZSgnJyk7XG4gIGNvbnN0IFt6YXBpZXJVcmwsIHNldFphcGllclVybF0gPSB1c2VTdGF0ZSgnJyk7XG4gIGNvbnN0IFt0dHNQcm92aWRlciwgc2V0VHRzUHJvdmlkZXJdID0gdXNlU3RhdGUoJ2VsZXZlbmxhYnMnKTtcbiAgY29uc3QgW3R0c0FwaUtleSwgc2V0VHRzQXBpS2V5XSA9IHVzZVN0YXRlKCcnKTtcbiAgY29uc3QgW2dpdGh1YkFwaUtleSwgc2V0R2l0aHViQXBpS2V5XSA9IHVzZVN0YXRlKCcnKTtcbiAgY29uc3QgW2dpdGh1Yk93bmVyLCBzZXRHaXRodWJPd25lcl0gPSB1c2VTdGF0ZSgnJyk7XG4gIGNvbnN0IFtnaXRodWJSZXBvLCBzZXRHaXRodWJSZXBvXSA9IHVzZVN0YXRlKCcnKTtcbiAgY29uc3QgW3NsYWNrQ2hhbm5lbElkLCBzZXRTbGFja0NoYW5uZWxJZF0gPSB1c2VTdGF0ZSgnJyk7XG5cbiAgLy8gVUkgZmVlZGJhY2sgc3RhdGVcbiAgY29uc3QgW21lc3NhZ2UsIHNldE1lc3NhZ2VdID0gdXNlU3RhdGUoJycpO1xuICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9IHVzZVN0YXRlKCcnKTtcblxuICAvLyBMb2FkIHNldHRpbmdzIG9uIGNvbXBvbmVudCBtb3VudFxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IGxvYWRTZXR0aW5ncyA9IGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE5vdGlvblxuICAgICAgaWYgKGF3YWl0IGdldFNldHRpbmdTdGF0dXMoJ25vdGlvbl9hcGlfa2V5JykpIHtcbiAgICAgICAgc2V0Tm90aW9uQXBpS2V5KCcqKioqKioqKicpO1xuICAgICAgfVxuICAgICAgY29uc3Qgc2F2ZWROb3Rpb25EYklkID0gYXdhaXQgZ2V0U2V0dGluZygnbm90aW9uX3Rhc2tzX2RhdGFiYXNlX2lkJyk7XG4gICAgICBzZXROb3Rpb25EYXRhYmFzZUlkKHNhdmVkTm90aW9uRGJJZCB8fCAnJyk7XG4gICAgICAvLyBaYXBpZXJcbiAgICAgIGNvbnN0IHNhdmVkWmFwaWVyVXJsID0gYXdhaXQgZ2V0U2V0dGluZygnemFwaWVyX3dlYmhvb2tfdXJsJyk7XG4gICAgICBzZXRaYXBpZXJVcmwoc2F2ZWRaYXBpZXJVcmwgfHwgJycpO1xuICAgICAgLy8gVFRTIFByb3ZpZGVyXG4gICAgICBjb25zdCBzYXZlZFR0c1Byb3ZpZGVyID0gYXdhaXQgZ2V0U2V0dGluZygndHRzX3Byb3ZpZGVyJyk7XG4gICAgICBpZiAoc2F2ZWRUdHNQcm92aWRlcikge1xuICAgICAgICBzZXRUdHNQcm92aWRlcihzYXZlZFR0c1Byb3ZpZGVyKTtcbiAgICAgIH1cbiAgICAgIC8vIFRUUyBBUEkgS2V5IChjaGVjayBiYXNlZCBvbiB0aGUgbG9hZGVkIHByb3ZpZGVyKVxuICAgICAgaWYgKGF3YWl0IGdldFNldHRpbmdTdGF0dXMoYCR7c2F2ZWRUdHNQcm92aWRlciB8fCB0dHNQcm92aWRlcn1fYXBpX2tleWApKSB7XG4gICAgICAgIHNldFR0c0FwaUtleSgnKioqKioqKionKTtcbiAgICAgIH1cbiAgICAgIC8vIEdpdEh1YlxuICAgICAgaWYgKGF3YWl0IGdldFNldHRpbmdTdGF0dXMoJ2dpdGh1Yl9hcGlfa2V5JykpIHtcbiAgICAgICAgc2V0R2l0aHViQXBpS2V5KCcqKioqKioqKicpO1xuICAgICAgfVxuICAgICAgY29uc3Qgc2F2ZWRHaXRodWJPd25lciA9IGF3YWl0IGdldFNldHRpbmcoJ2dpdGh1Yl9vd25lcicpO1xuICAgICAgc2V0R2l0aHViT3duZXIoc2F2ZWRHaXRodWJPd25lciB8fCAnJyk7XG4gICAgICBjb25zdCBzYXZlZEdpdGh1YlJlcG8gPSBhd2FpdCBnZXRTZXR0aW5nKCdnaXRodWJfcmVwbycpO1xuICAgICAgc2V0R2l0aHViUmVwbyhzYXZlZEdpdGh1YlJlcG8gfHwgJycpO1xuICAgICAgY29uc3Qgc2F2ZWRTbGFja0NoYW5uZWxJZCA9IGF3YWl0IGdldFNldHRpbmcoJ3NsYWNrX2NoYW5uZWxfaWQnKTtcbiAgICAgIHNldFNsYWNrQ2hhbm5lbElkKHNhdmVkU2xhY2tDaGFubmVsSWQgfHwgJycpO1xuICAgIH07XG4gICAgbG9hZFNldHRpbmdzKCk7XG4gIH0sIFtdKTtcblxuICBjb25zdCBoYW5kbGVTYXZlID0gYXN5bmMgKCkgPT4ge1xuICAgIHNldE1lc3NhZ2UoJycpO1xuICAgIHNldEVycm9yKCcnKTtcbiAgICB0cnkge1xuICAgICAgLy8gU2F2ZSBOb3Rpb24gQVBJIEtleSAob25seSBpZiBpdCdzIG5vdCBtYXNrZWQpXG4gICAgICBpZiAobm90aW9uQXBpS2V5ICE9PSAnKioqKioqKionKSB7XG4gICAgICAgIGF3YWl0IHNhdmVTZXR0aW5nKCdub3Rpb25fYXBpX2tleScsIG5vdGlvbkFwaUtleSk7XG4gICAgICB9XG4gICAgICAvLyBTYXZlIE5vdGlvbiBEYXRhYmFzZSBJRFxuICAgICAgYXdhaXQgc2F2ZVNldHRpbmcoJ25vdGlvbl90YXNrc19kYXRhYmFzZV9pZCcsIG5vdGlvbkRhdGFiYXNlSWQpO1xuICAgICAgLy8gU2F2ZSBaYXBpZXIgVVJMXG4gICAgICBhd2FpdCBzYXZlU2V0dGluZygnemFwaWVyX3dlYmhvb2tfdXJsJywgemFwaWVyVXJsKTtcbiAgICAgIC8vIFNhdmUgVFRTIFByb3ZpZGVyXG4gICAgICBhd2FpdCBzYXZlU2V0dGluZygndHRzX3Byb3ZpZGVyJywgdHRzUHJvdmlkZXIpO1xuICAgICAgLy8gU2F2ZSBUVFMgQVBJIEtleSAob25seSBpZiBpdCdzIG5vdCBtYXNrZWQpXG4gICAgICBpZiAodHRzQXBpS2V5ICE9PSAnKioqKioqKionKSB7XG4gICAgICAgIGF3YWl0IHNhdmVTZXR0aW5nKGAke3R0c1Byb3ZpZGVyfV9hcGlfa2V5YCwgdHRzQXBpS2V5KTtcbiAgICAgIH1cbiAgICAgIC8vIFNhdmUgR2l0SHViIEFQSSBLZXkgKG9ubHkgaWYgaXQncyBub3QgbWFza2VkKVxuICAgICAgaWYgKGdpdGh1YkFwaUtleSAhPT0gJyoqKioqKioqJykge1xuICAgICAgICBhd2FpdCBzYXZlU2V0dGluZygnZ2l0aHViX2FwaV9rZXknLCBnaXRodWJBcGlLZXkpO1xuICAgICAgfVxuICAgICAgLy8gU2F2ZSBHaXRIdWIgT3duZXIgYW5kIFJlcG9cbiAgICAgIGF3YWl0IHNhdmVTZXR0aW5nKCdnaXRodWJfb3duZXInLCBnaXRodWJPd25lcik7XG4gICAgICBhd2FpdCBzYXZlU2V0dGluZygnZ2l0aHViX3JlcG8nLCBnaXRodWJSZXBvKTtcbiAgICAgIGF3YWl0IHNhdmVTZXR0aW5nKCdzbGFja19jaGFubmVsX2lkJywgc2xhY2tDaGFubmVsSWQpO1xuICAgICAgXG4gICAgICBzZXRNZXNzYWdlKCdTZXR0aW5ncyBzYXZlZCBzdWNjZXNzZnVsbHkhJyk7XG4gICAgICAvLyBSZS1tYXNrIGtleXMgYWZ0ZXIgc2F2aW5nXG4gICAgICBpZiAobm90aW9uQXBpS2V5ICYmIG5vdGlvbkFwaUtleSAhPT0gJyoqKioqKioqJykgc2V0Tm90aW9uQXBpS2V5KCcqKioqKioqKicpO1xuICAgICAgaWYgKHR0c0FwaUtleSAmJiB0dHNBcGlLZXkgIT09ICcqKioqKioqKicpIHNldFR0c0FwaUtleSgnKioqKioqKionKTtcbiAgICAgIGlmIChnaXRodWJBcGlLZXkgJiYgZ2l0aHViQXBpS2V5ICE9PSAnKioqKioqKionKSB7XG4gICAgICAgIGF3YWl0IHNhdmVTZXR0aW5nKCdnaXRodWJfYXBpX2tleScsIGdpdGh1YkFwaUtleSk7XG4gICAgICAgIHNldEdpdGh1YkFwaUtleSgnKioqKioqKionKTtcbiAgICAgIH1cblxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgc2V0RXJyb3IoJ0ZhaWxlZCB0byBzYXZlIHNldHRpbmdzLicpO1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPVwic2V0dGluZ3MtY29udGFpbmVyXCI+XG4gICAgICA8aDI+U2V0dGluZ3M8L2gyPlxuICAgICAge21lc3NhZ2UgJiYgPGRpdiBjbGFzc05hbWU9XCJzYXZlLW1lc3NhZ2Ugc3VjY2Vzc1wiPnttZXNzYWdlfTwvZGl2Pn1cbiAgICAgIHtlcnJvciAmJiA8ZGl2IGNsYXNzTmFtZT1cInNhdmUtbWVzc2FnZSBlcnJvclwiPntlcnJvcn08L2Rpdj59XG5cbiAgICAgIHsvKiBOb3Rpb24gU2V0dGluZ3MgKi99XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cInNldHRpbmdcIj5cbiAgICAgICAgPGxhYmVsPk5vdGlvbiBBUEkgS2V5PC9sYWJlbD5cbiAgICAgICAgPGlucHV0XG4gICAgICAgICAgdHlwZT1cInBhc3N3b3JkXCJcbiAgICAgICAgICB2YWx1ZT17bm90aW9uQXBpS2V5fVxuICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0Tm90aW9uQXBpS2V5KGUudGFyZ2V0LnZhbHVlKX1cbiAgICAgICAgICBwbGFjZWhvbGRlcj1cIkVudGVyIE5vdGlvbiBBUEkgS2V5XCJcbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJzZXR0aW5nXCI+XG4gICAgICAgIDxsYWJlbD5Ob3Rpb24gVGFza3MgRGF0YWJhc2UgSUQ8L2xhYmVsPlxuICAgICAgICA8aW5wdXRcbiAgICAgICAgICB0eXBlPVwidGV4dFwiXG4gICAgICAgICAgdmFsdWU9e25vdGlvbkRhdGFiYXNlSWR9XG4gICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXROb3Rpb25EYXRhYmFzZUlkKGUudGFyZ2V0LnZhbHVlKX1cbiAgICAgICAgICBwbGFjZWhvbGRlcj1cIkVudGVyIE5vdGlvbiBUYXNrcyBEYXRhYmFzZSBJRFwiXG4gICAgICAgIC8+XG4gICAgICA8L2Rpdj5cblxuICAgICAgey8qIEdpdEh1YiBTZXR0aW5ncyAqL31cbiAgICAgIHsvKiBHaXRIdWIgU2V0dGluZ3MgKi99XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cInNldHRpbmdcIj5cbiAgICAgICAgPGxhYmVsPkdpdEh1YiBQZXJzb25hbCBBY2Nlc3MgVG9rZW48L2xhYmVsPlxuICAgICAgICA8aW5wdXRcbiAgICAgICAgICB0eXBlPVwicGFzc3dvcmRcIlxuICAgICAgICAgIHZhbHVlPXtnaXRodWJBcGlLZXl9XG4gICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRHaXRodWJBcGlLZXkoZS50YXJnZXQudmFsdWUpfVxuICAgICAgICAgIHBsYWNlaG9sZGVyPVwiRW50ZXIgR2l0SHViIFBlcnNvbmFsIEFjY2VzcyBUb2tlblwiXG4gICAgICAgIC8+XG4gICAgICA8L2Rpdj5cblxuICAgICAgey8qIFNsYWNrIFNldHRpbmdzICovfVxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJzZXR0aW5nXCI+XG4gICAgICAgIDxsYWJlbD5TbGFjayBDaGFubmVsIElEPC9sYWJlbD5cbiAgICAgICAgPGlucHV0XG4gICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgIHZhbHVlPXtzbGFja0NoYW5uZWxJZH1cbiAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHNldFNsYWNrQ2hhbm5lbElkKGUudGFyZ2V0LnZhbHVlKX1cbiAgICAgICAgICBwbGFjZWhvbGRlcj1cIkVudGVyIFNsYWNrIENoYW5uZWwgSUQgdG8gbW9uaXRvclwiXG4gICAgICAgIC8+XG4gICAgICA8L2Rpdj5cblxuICAgICAgey8qIFphcGllciBTZXR0aW5ncyAqL31cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwic2V0dGluZ1wiPlxuICAgICAgICA8bGFiZWw+WmFwaWVyIFdlYmhvb2sgVVJMPC9sYWJlbD5cbiAgICAgICAgPGlucHV0XG4gICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgIHZhbHVlPXt6YXBpZXJVcmx9XG4gICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRaYXBpZXJVcmwoZS50YXJnZXQudmFsdWUpfVxuICAgICAgICAgIHBsYWNlaG9sZGVyPVwiRW50ZXIgWmFwaWVyIFdlYmhvb2sgVVJMXCJcbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuXG4gICAgICB7LyogVm9pY2UgU2V0dGluZ3MgKi99XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cInNldHRpbmdcIj5cbiAgICAgICAgPGxhYmVsPlRUUyBQcm92aWRlcjwvbGFiZWw+XG4gICAgICAgIDxzZWxlY3QgdmFsdWU9e3R0c1Byb3ZpZGVyfSBvbkNoYW5nZT17KGUpID0+IHtcbiAgICAgICAgICBzZXRUdHNQcm92aWRlcihlLnRhcmdldC52YWx1ZSk7XG4gICAgICAgICAgc2V0VHRzQXBpS2V5KCcnKTsgLy8gUmVzZXQgQVBJIGtleSB3aGVuIHByb3ZpZGVyIGNoYW5nZXNcbiAgICAgICAgfX0+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImVsZXZlbmxhYnNcIj5FbGV2ZW5MYWJzPC9vcHRpb24+XG4gICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cImRlZXBncmFtXCI+RGVlcGdyYW08L29wdGlvbj5cbiAgICAgICAgPC9zZWxlY3Q+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwic2V0dGluZ1wiPlxuICAgICAgICA8bGFiZWw+e3R0c1Byb3ZpZGVyID09PSAnZWxldmVubGFicycgPyAnRWxldmVuTGFicycgOiAnRGVlcGdyYW0nfSBBUEkgS2V5PC9sYWJlbD5cbiAgICAgICAgPGlucHV0XG4gICAgICAgICAgdHlwZT1cInBhc3N3b3JkXCJcbiAgICAgICAgICB2YWx1ZT17dHRzQXBpS2V5fVxuICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0VHRzQXBpS2V5KGUudGFyZ2V0LnZhbHVlKX1cbiAgICAgICAgICBwbGFjZWhvbGRlcj17YEVudGVyICR7dHRzUHJvdmlkZXIgPT09ICdlbGV2ZW5sYWJzJyA/ICdFbGV2ZW5MYWJzJyA6ICdEZWVwZ3JhbSd9IEFQSSBLZXlgfVxuICAgICAgICAvPlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDxidXR0b24gb25DbGljaz17aGFuZGxlU2F2ZX0+U2F2ZSBTZXR0aW5nczwvYnV0dG9uPlxuICAgIDwvZGl2PlxuICApO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgU2V0dGluZ3M7XG4iXX0=