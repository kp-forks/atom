"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const secure_storage_1 = require("../lib/secure-storage");
require("../Settings.css");
const Integrations = () => {
    // State for each setting
    const [boxClientId, setBoxClientId] = (0, react_1.useState)('');
    const [boxClientSecret, setBoxClientSecret] = (0, react_1.useState)('');
    const [asanaClientId, setAsanaClientId] = (0, react_1.useState)('');
    const [asanaClientSecret, setAsanaClientSecret] = (0, react_1.useState)('');
    const [trelloApiKey, setTrelloApiKey] = (0, react_1.useState)('');
    const [trelloApiSecret, setTrelloApiSecret] = (0, react_1.useState)('');
    const [jiraServerUrl, setJiraServerUrl] = (0, react_1.useState)('');
    const [jiraUsername, setJiraUsername] = (0, react_1.useState)('');
    const [jiraApiKey, setJiraApiKey] = (0, react_1.useState)('');
    // UI feedback state
    const [message, setMessage] = (0, react_1.useState)('');
    const [error, setError] = (0, react_1.useState)('');
    // Load settings on component mount
    (0, react_1.useEffect)(() => {
        const loadSettings = async () => {
            // Box
            if (await (0, secure_storage_1.getSettingStatus)('box_client_id')) {
                setBoxClientId('********');
            }
            if (await (0, secure_storage_1.getSettingStatus)('box_client_secret')) {
                setBoxClientSecret('********');
            }
            // Asana
            if (await (0, secure_storage_1.getSettingStatus)('asana_client_id')) {
                setAsanaClientId('********');
            }
            if (await (0, secure_storage_1.getSettingStatus)('asana_client_secret')) {
                setAsanaClientSecret('********');
            }
            // Trello
            if (await (0, secure_storage_1.getSettingStatus)('trello_api_key')) {
                setTrelloApiKey('********');
            }
            if (await (0, secure_storage_1.getSettingStatus)('trello_api_secret')) {
                setTrelloApiSecret('********');
            }
            // Jira
            const savedJiraServerUrl = await (0, secure_storage_1.getSetting)('jira_server_url');
            setJiraServerUrl(savedJiraServerUrl || '');
            const savedJiraUsername = await (0, secure_storage_1.getSetting)('jira_username');
            setJiraUsername(savedJiraUsername || '');
            if (await (0, secure_storage_1.getSettingStatus)('jira_api_key')) {
                setJiraApiKey('********');
            }
        };
        loadSettings();
    }, []);
    const handleSave = async () => {
        setMessage('');
        setError('');
        try {
            // Box
            if (boxClientId !== '********') {
                await (0, secure_storage_1.saveSetting)('box_client_id', boxClientId);
            }
            if (boxClientSecret !== '********') {
                await (0, secure_storage_1.saveSetting)('box_client_secret', boxClientSecret);
            }
            // Asana
            if (asanaClientId !== '********') {
                await (0, secure_storage_1.saveSetting)('asana_client_id', asanaClientId);
            }
            if (asanaClientSecret !== '********') {
                await (0, secure_storage_1.saveSetting)('asana_client_secret', asanaClientSecret);
            }
            // Trello
            if (trelloApiKey !== '********') {
                await (0, secure_storage_1.saveSetting)('trello_api_key', trelloApiKey);
            }
            if (trelloApiSecret !== '********') {
                await (0, secure_storage_1.saveSetting)('trello_api_secret', trelloApiSecret);
            }
            // Jira
            await (0, secure_storage_1.saveSetting)('jira_server_url', jiraServerUrl);
            await (0, secure_storage_1.saveSetting)('jira_username', jiraUsername);
            if (jiraApiKey !== '********') {
                await (0, secure_storage_1.saveSetting)('jira_api_key', jiraApiKey);
            }
            setMessage('Settings saved successfully!');
            // Re-mask keys after saving
            if (boxClientId && boxClientId !== '********')
                setBoxClientId('********');
            if (boxClientSecret && boxClientSecret !== '********')
                setBoxClientSecret('********');
            if (asanaClientId && asanaClientId !== '********')
                setAsanaClientId('********');
            if (asanaClientSecret && asanaClientSecret !== '********')
                setAsanaClientSecret('********');
            if (trelloApiKey && trelloApiKey !== '********')
                setTrelloApiKey('********');
            if (trelloApiSecret && trelloApiSecret !== '********')
                setTrelloApiSecret('********');
            if (jiraApiKey && jiraApiKey !== '********')
                setJiraApiKey('********');
        }
        catch (err) {
            setError('Failed to save settings.');
            console.error(err);
        }
    };
    return ((0, jsx_runtime_1.jsxs)("div", { className: "settings-container", children: [(0, jsx_runtime_1.jsx)("h2", { children: "Integrations" }), message && (0, jsx_runtime_1.jsx)("div", { className: "save-message success", children: message }), error && (0, jsx_runtime_1.jsx)("div", { className: "save-message error", children: error }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsx)("label", { children: "Box Client ID" }), (0, jsx_runtime_1.jsx)("input", { type: "password", value: boxClientId, onChange: (e) => setBoxClientId(e.target.value), placeholder: "Enter Box Client ID" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsx)("label", { children: "Box Client Secret" }), (0, jsx_runtime_1.jsx)("input", { type: "password", value: boxClientSecret, onChange: (e) => setBoxClientSecret(e.target.value), placeholder: "Enter Box Client Secret" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsx)("label", { children: "Asana Client ID" }), (0, jsx_runtime_1.jsx)("input", { type: "password", value: asanaClientId, onChange: (e) => setAsanaClientId(e.target.value), placeholder: "Enter Asana Client ID" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsx)("label", { children: "Asana Client Secret" }), (0, jsx_runtime_1.jsx)("input", { type: "password", value: asanaClientSecret, onChange: (e) => setAsanaClientSecret(e.target.value), placeholder: "Enter Asana Client Secret" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsx)("label", { children: "Trello API Key" }), (0, jsx_runtime_1.jsx)("input", { type: "password", value: trelloApiKey, onChange: (e) => setTrelloApiKey(e.target.value), placeholder: "Enter Trello API Key" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsx)("label", { children: "Trello API Secret" }), (0, jsx_runtime_1.jsx)("input", { type: "password", value: trelloApiSecret, onChange: (e) => setTrelloApiSecret(e.target.value), placeholder: "Enter Trello API Secret" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsx)("label", { children: "Jira Server URL" }), (0, jsx_runtime_1.jsx)("input", { type: "text", value: jiraServerUrl, onChange: (e) => setJiraServerUrl(e.target.value), placeholder: "Enter Jira Server URL" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsx)("label", { children: "Jira Username" }), (0, jsx_runtime_1.jsx)("input", { type: "text", value: jiraUsername, onChange: (e) => setJiraUsername(e.target.value), placeholder: "Enter Jira Username" })] }), (0, jsx_runtime_1.jsxs)("div", { className: "setting", children: [(0, jsx_runtime_1.jsx)("label", { children: "Jira API Key" }), (0, jsx_runtime_1.jsx)("input", { type: "password", value: jiraApiKey, onChange: (e) => setJiraApiKey(e.target.value), placeholder: "Enter Jira API Key" })] }), (0, jsx_runtime_1.jsx)("button", { onClick: handleSave, children: "Save Settings" })] }));
};
exports.default = Integrations;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW50ZWdyYXRpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiSW50ZWdyYXRpb25zLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxpQ0FBbUQ7QUFDbkQsMERBQWtGO0FBQ2xGLDJCQUF5QjtBQUV6QixNQUFNLFlBQVksR0FBRyxHQUFHLEVBQUU7SUFDeEIseUJBQXlCO0lBQ3pCLE1BQU0sQ0FBQyxXQUFXLEVBQUUsY0FBYyxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ25ELE1BQU0sQ0FBQyxlQUFlLEVBQUUsa0JBQWtCLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDM0QsTUFBTSxDQUFDLGFBQWEsRUFBRSxnQkFBZ0IsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxFQUFFLENBQUMsQ0FBQztJQUN2RCxNQUFNLENBQUMsaUJBQWlCLEVBQUUsb0JBQW9CLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDL0QsTUFBTSxDQUFDLFlBQVksRUFBRSxlQUFlLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDckQsTUFBTSxDQUFDLGVBQWUsRUFBRSxrQkFBa0IsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxFQUFFLENBQUMsQ0FBQztJQUMzRCxNQUFNLENBQUMsYUFBYSxFQUFFLGdCQUFnQixDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZELE1BQU0sQ0FBQyxZQUFZLEVBQUUsZUFBZSxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3JELE1BQU0sQ0FBQyxVQUFVLEVBQUUsYUFBYSxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLEVBQUUsQ0FBQyxDQUFDO0lBRWpELG9CQUFvQjtJQUNwQixNQUFNLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FB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QUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUNoRCxXQUFXLEVBQUMscUJBQXFCLEdBQ2pDLElBQ0UsRUFDTixpQ0FBSyxTQUFTLEVBQUMsU0FBUyxhQUN0Qiw2REFBMkIsRUFDM0Isa0NBQ0UsSUFBSSxFQUFDLFVBQVUsRUFDZixLQUFLLEVBQUUsVUFBVSxFQUNqQixRQUFRLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUM5QyxXQUFXLEVBQUMsb0JBQW9CLEdBQ2hDLElBQ0UsRUFFTixtQ0FBUSxPQUFPLEVBQUUsVUFBVSw4QkFBd0IsSUFDL0MsQ0FDUCxDQUFDO0FBQ0osQ0FBQyxDQUFDO0FBRUYsa0JBQWUsWUFBWSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZVN0YXRlLCB1c2VFZmZlY3QgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBzYXZlU2V0dGluZywgZ2V0U2V0dGluZywgZ2V0U2V0dGluZ1N0YXR1cyB9IGZyb20gJy4uL2xpYi9zZWN1cmUtc3RvcmFnZSc7XG5pbXBvcnQgJy4uL1NldHRpbmdzLmNzcyc7XG5cbmNvbnN0IEludGVncmF0aW9ucyA9ICgpID0+IHtcbiAgLy8gU3RhdGUgZm9yIGVhY2ggc2V0dGluZ1xuICBjb25zdCBbYm94Q2xpZW50SWQsIHNldEJveENsaWVudElkXSA9IHVzZVN0YXRlKCcnKTtcbiAgY29uc3QgW2JveENsaWVudFNlY3JldCwgc2V0Qm94Q2xpZW50U2VjcmV0XSA9IHVzZVN0YXRlKCcnKTtcbiAgY29uc3QgW2FzYW5hQ2xpZW50SWQsIHNldEFzYW5hQ2xpZW50SWRdID0gdXNlU3RhdGUoJycpO1xuICBjb25zdCBbYXNhbmFDbGllbnRTZWNyZXQsIHNldEFzYW5hQ2xpZW50U2VjcmV0XSA9IHVzZVN0YXRlKCcnKTtcbiAgY29uc3QgW3RyZWxsb0FwaUtleSwgc2V0VHJlbGxvQXBpS2V5XSA9IHVzZVN0YXRlKCcnKTtcbiAgY29uc3QgW3RyZWxsb0FwaVNlY3JldCwgc2V0VHJlbGxvQXBpU2VjcmV0XSA9IHVzZVN0YXRlKCcnKTtcbiAgY29uc3QgW2ppcmFTZXJ2ZXJVcmwsIHNldEppcmFTZXJ2ZXJVcmxdID0gdXNlU3RhdGUoJycpO1xuICBjb25zdCBbamlyYVVzZXJuYW1lLCBzZXRKaXJhVXNlcm5hbWVdID0gdXNlU3RhdGUoJycpO1xuICBjb25zdCBbamlyYUFwaUtleSwgc2V0SmlyYUFwaUtleV0gPSB1c2VTdGF0ZSgnJyk7XG5cbiAgLy8gVUkgZmVlZGJhY2sgc3RhdGVcbiAgY29uc3QgW21lc3NhZ2UsIHNldE1lc3NhZ2VdID0gdXNlU3RhdGUoJycpO1xuICBjb25zdCBbZXJyb3IsIHNldEVycm9yXSA9IHVzZVN0YXRlKCcnKTtcblxuICAvLyBMb2FkIHNldHRpbmdzIG9uIGNvbXBvbmVudCBtb3VudFxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IGxvYWRTZXR0aW5ncyA9IGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEJveFxuICAgICAgaWYgKGF3YWl0IGdldFNldHRpbmdTdGF0dXMoJ2JveF9jbGllbnRfaWQnKSkge1xuICAgICAgICBzZXRCb3hDbGllbnRJZCgnKioqKioqKionKTtcbiAgICAgIH1cbiAgICAgIGlmIChhd2FpdCBnZXRTZXR0aW5nU3RhdHVzKCdib3hfY2xpZW50X3NlY3JldCcpKSB7XG4gICAgICAgIHNldEJveENsaWVudFNlY3JldCgnKioqKioqKionKTtcbiAgICAgIH1cbiAgICAgIC8vIEFzYW5hXG4gICAgICBpZiAoYXdhaXQgZ2V0U2V0dGluZ1N0YXR1cygnYXNhbmFfY2xpZW50X2lkJykpIHtcbiAgICAgICAgc2V0QXNhbmFDbGllbnRJZCgnKioqKioqKionKTtcbiAgICAgIH1cbiAgICAgIGlmIChhd2FpdCBnZXRTZXR0aW5nU3RhdHVzKCdhc2FuYV9jbGllbnRfc2VjcmV0JykpIHtcbiAgICAgICAgc2V0QXNhbmFDbGllbnRTZWNyZXQoJyoqKioqKioqJyk7XG4gICAgICB9XG4gICAgICAvLyBUcmVsbG9cbiAgICAgIGlmIChhd2FpdCBnZXRTZXR0aW5nU3RhdHVzKCd0cmVsbG9fYXBpX2tleScpKSB7XG4gICAgICAgIHNldFRyZWxsb0FwaUtleSgnKioqKioqKionKTtcbiAgICAgIH1cbiAgICAgIGlmIChhd2FpdCBnZXRTZXR0aW5nU3RhdHVzKCd0cmVsbG9fYXBpX3NlY3JldCcpKSB7XG4gICAgICAgIHNldFRyZWxsb0FwaVNlY3JldCgnKioqKioqKionKTtcbiAgICAgIH1cbiAgICAgIC8vIEppcmFcbiAgICAgIGNvbnN0IHNhdmVkSmlyYVNlcnZlclVybCA9IGF3YWl0IGdldFNldHRpbmcoJ2ppcmFfc2VydmVyX3VybCcpO1xuICAgICAgc2V0SmlyYVNlcnZlclVybChzYXZlZEppcmFTZXJ2ZXJVcmwgfHwgJycpO1xuICAgICAgY29uc3Qgc2F2ZWRKaXJhVXNlcm5hbWUgPSBhd2FpdCBnZXRTZXR0aW5nKCdqaXJhX3VzZXJuYW1lJyk7XG4gICAgICBzZXRKaXJhVXNlcm5hbWUoc2F2ZWRKaXJhVXNlcm5hbWUgfHwgJycpO1xuICAgICAgaWYgKGF3YWl0IGdldFNldHRpbmdTdGF0dXMoJ2ppcmFfYXBpX2tleScpKSB7XG4gICAgICAgIHNldEppcmFBcGlLZXkoJyoqKioqKioqJyk7XG4gICAgICB9XG4gICAgfTtcbiAgICBsb2FkU2V0dGluZ3MoKTtcbiAgfSwgW10pO1xuXG4gIGNvbnN0IGhhbmRsZVNhdmUgPSBhc3luYyAoKSA9PiB7XG4gICAgc2V0TWVzc2FnZSgnJyk7XG4gICAgc2V0RXJyb3IoJycpO1xuICAgIHRyeSB7XG4gICAgICAvLyBCb3hcbiAgICAgIGlmIChib3hDbGllbnRJZCAhPT0gJyoqKioqKioqJykge1xuICAgICAgICBhd2FpdCBzYXZlU2V0dGluZygnYm94X2NsaWVudF9pZCcsIGJveENsaWVudElkKTtcbiAgICAgIH1cbiAgICAgIGlmIChib3hDbGllbnRTZWNyZXQgIT09ICcqKioqKioqKicpIHtcbiAgICAgICAgYXdhaXQgc2F2ZVNldHRpbmcoJ2JveF9jbGllbnRfc2VjcmV0JywgYm94Q2xpZW50U2VjcmV0KTtcbiAgICAgIH1cbiAgICAgIC8vIEFzYW5hXG4gICAgICBpZiAoYXNhbmFDbGllbnRJZCAhPT0gJyoqKioqKioqJykge1xuICAgICAgICBhd2FpdCBzYXZlU2V0dGluZygnYXNhbmFfY2xpZW50X2lkJywgYXNhbmFDbGllbnRJZCk7XG4gICAgICB9XG4gICAgICBpZiAoYXNhbmFDbGllbnRTZWNyZXQgIT09ICcqKioqKioqKicpIHtcbiAgICAgICAgYXdhaXQgc2F2ZVNldHRpbmcoJ2FzYW5hX2NsaWVudF9zZWNyZXQnLCBhc2FuYUNsaWVudFNlY3JldCk7XG4gICAgICB9XG4gICAgICAvLyBUcmVsbG9cbiAgICAgIGlmICh0cmVsbG9BcGlLZXkgIT09ICcqKioqKioqKicpIHtcbiAgICAgICAgYXdhaXQgc2F2ZVNldHRpbmcoJ3RyZWxsb19hcGlfa2V5JywgdHJlbGxvQXBpS2V5KTtcbiAgICAgIH1cbiAgICAgIGlmICh0cmVsbG9BcGlTZWNyZXQgIT09ICcqKioqKioqKicpIHtcbiAgICAgICAgYXdhaXQgc2F2ZVNldHRpbmcoJ3RyZWxsb19hcGlfc2VjcmV0JywgdHJlbGxvQXBpU2VjcmV0KTtcbiAgICAgIH1cbiAgICAgIC8vIEppcmFcbiAgICAgIGF3YWl0IHNhdmVTZXR0aW5nKCdqaXJhX3NlcnZlcl91cmwnLCBqaXJhU2VydmVyVXJsKTtcbiAgICAgIGF3YWl0IHNhdmVTZXR0aW5nKCdqaXJhX3VzZXJuYW1lJywgamlyYVVzZXJuYW1lKTtcbiAgICAgIGlmIChqaXJhQXBpS2V5ICE9PSAnKioqKioqKionKSB7XG4gICAgICAgIGF3YWl0IHNhdmVTZXR0aW5nKCdqaXJhX2FwaV9rZXknLCBqaXJhQXBpS2V5KTtcbiAgICAgIH1cblxuICAgICAgc2V0TWVzc2FnZSgnU2V0dGluZ3Mgc2F2ZWQgc3VjY2Vzc2Z1bGx5IScpO1xuICAgICAgLy8gUmUtbWFzayBrZXlzIGFmdGVyIHNhdmluZ1xuICAgICAgaWYgKGJveENsaWVudElkICYmIGJveENsaWVudElkICE9PSAnKioqKioqKionKSBzZXRCb3hDbGllbnRJZCgnKioqKioqKionKTtcbiAgICAgIGlmIChib3hDbGllbnRTZWNyZXQgJiYgYm94Q2xpZW50U2VjcmV0ICE9PSAnKioqKioqKionKSBzZXRCb3hDbGllbnRTZWNyZXQoJyoqKioqKioqJyk7XG4gICAgICBpZiAoYXNhbmFDbGllbnRJZCAmJiBhc2FuYUNsaWVudElkICE9PSAnKioqKioqKionKSBzZXRBc2FuYUNsaWVudElkKCcqKioqKioqKicpO1xuICAgICAgaWYgKGFzYW5hQ2xpZW50U2VjcmV0ICYmIGFzYW5hQ2xpZW50U2VjcmV0ICE9PSAnKioqKioqKionKSBzZXRBc2FuYUNsaWVudFNlY3JldCgnKioqKioqKionKTtcbiAgICAgIGlmICh0cmVsbG9BcGlLZXkgJiYgdHJlbGxvQXBpS2V5ICE9PSAnKioqKioqKionKSBzZXRUcmVsbG9BcGlLZXkoJyoqKioqKioqJyk7XG4gICAgICBpZiAodHJlbGxvQXBpU2VjcmV0ICYmIHRyZWxsb0FwaVNlY3JldCAhPT0gJyoqKioqKioqJykgc2V0VHJlbGxvQXBpU2VjcmV0KCcqKioqKioqKicpO1xuICAgICAgaWYgKGppcmFBcGlLZXkgJiYgamlyYUFwaUtleSAhPT0gJyoqKioqKioqJykgc2V0SmlyYUFwaUtleSgnKioqKioqKionKTtcblxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgc2V0RXJyb3IoJ0ZhaWxlZCB0byBzYXZlIHNldHRpbmdzLicpO1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPVwic2V0dGluZ3MtY29udGFpbmVyXCI+XG4gICAgICA8aDI+SW50ZWdyYXRpb25zPC9oMj5cbiAgICAgIHttZXNzYWdlICYmIDxkaXYgY2xhc3NOYW1lPVwic2F2ZS1tZXNzYWdlIHN1Y2Nlc3NcIj57bWVzc2FnZX08L2Rpdj59XG4gICAgICB7ZXJyb3IgJiYgPGRpdiBjbGFzc05hbWU9XCJzYXZlLW1lc3NhZ2UgZXJyb3JcIj57ZXJyb3J9PC9kaXY+fVxuXG4gICAgICB7LyogQm94IFNldHRpbmdzICovfVxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJzZXR0aW5nXCI+XG4gICAgICAgIDxsYWJlbD5Cb3ggQ2xpZW50IElEPC9sYWJlbD5cbiAgICAgICAgPGlucHV0XG4gICAgICAgICAgdHlwZT1cInBhc3N3b3JkXCJcbiAgICAgICAgICB2YWx1ZT17Ym94Q2xpZW50SWR9XG4gICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRCb3hDbGllbnRJZChlLnRhcmdldC52YWx1ZSl9XG4gICAgICAgICAgcGxhY2Vob2xkZXI9XCJFbnRlciBCb3ggQ2xpZW50IElEXCJcbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJzZXR0aW5nXCI+XG4gICAgICAgIDxsYWJlbD5Cb3ggQ2xpZW50IFNlY3JldDwvbGFiZWw+XG4gICAgICAgIDxpbnB1dFxuICAgICAgICAgIHR5cGU9XCJwYXNzd29yZFwiXG4gICAgICAgICAgdmFsdWU9e2JveENsaWVudFNlY3JldH1cbiAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHNldEJveENsaWVudFNlY3JldChlLnRhcmdldC52YWx1ZSl9XG4gICAgICAgICAgcGxhY2Vob2xkZXI9XCJFbnRlciBCb3ggQ2xpZW50IFNlY3JldFwiXG4gICAgICAgIC8+XG4gICAgICA8L2Rpdj5cblxuICAgICAgey8qIEFzYW5hIFNldHRpbmdzICovfVxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJzZXR0aW5nXCI+XG4gICAgICAgIDxsYWJlbD5Bc2FuYSBDbGllbnQgSUQ8L2xhYmVsPlxuICAgICAgICA8aW5wdXRcbiAgICAgICAgICB0eXBlPVwicGFzc3dvcmRcIlxuICAgICAgICAgIHZhbHVlPXthc2FuYUNsaWVudElkfVxuICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0QXNhbmFDbGllbnRJZChlLnRhcmdldC52YWx1ZSl9XG4gICAgICAgICAgcGxhY2Vob2xkZXI9XCJFbnRlciBBc2FuYSBDbGllbnQgSURcIlxuICAgICAgICAvPlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cInNldHRpbmdcIj5cbiAgICAgICAgPGxhYmVsPkFzYW5hIENsaWVudCBTZWNyZXQ8L2xhYmVsPlxuICAgICAgICA8aW5wdXRcbiAgICAgICAgICB0eXBlPVwicGFzc3dvcmRcIlxuICAgICAgICAgIHZhbHVlPXthc2FuYUNsaWVudFNlY3JldH1cbiAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHNldEFzYW5hQ2xpZW50U2VjcmV0KGUudGFyZ2V0LnZhbHVlKX1cbiAgICAgICAgICBwbGFjZWhvbGRlcj1cIkVudGVyIEFzYW5hIENsaWVudCBTZWNyZXRcIlxuICAgICAgICAvPlxuICAgICAgPC9kaXY+XG5cbiAgICAgIHsvKiBUcmVsbG8gU2V0dGluZ3MgKi99XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cInNldHRpbmdcIj5cbiAgICAgICAgPGxhYmVsPlRyZWxsbyBBUEkgS2V5PC9sYWJlbD5cbiAgICAgICAgPGlucHV0XG4gICAgICAgICAgdHlwZT1cInBhc3N3b3JkXCJcbiAgICAgICAgICB2YWx1ZT17dHJlbGxvQXBpS2V5fVxuICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gc2V0VHJlbGxvQXBpS2V5KGUudGFyZ2V0LnZhbHVlKX1cbiAgICAgICAgICBwbGFjZWhvbGRlcj1cIkVudGVyIFRyZWxsbyBBUEkgS2V5XCJcbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJzZXR0aW5nXCI+XG4gICAgICAgIDxsYWJlbD5UcmVsbG8gQVBJIFNlY3JldDwvbGFiZWw+XG4gICAgICAgIDxpbnB1dFxuICAgICAgICAgIHR5cGU9XCJwYXNzd29yZFwiXG4gICAgICAgICAgdmFsdWU9e3RyZWxsb0FwaVNlY3JldH1cbiAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHNldFRyZWxsb0FwaVNlY3JldChlLnRhcmdldC52YWx1ZSl9XG4gICAgICAgICAgcGxhY2Vob2xkZXI9XCJFbnRlciBUcmVsbG8gQVBJIFNlY3JldFwiXG4gICAgICAgIC8+XG4gICAgICA8L2Rpdj5cblxuICAgICAgey8qIEppcmEgU2V0dGluZ3MgKi99XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cInNldHRpbmdcIj5cbiAgICAgICAgPGxhYmVsPkppcmEgU2VydmVyIFVSTDwvbGFiZWw+XG4gICAgICAgIDxpbnB1dFxuICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICB2YWx1ZT17amlyYVNlcnZlclVybH1cbiAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHNldEppcmFTZXJ2ZXJVcmwoZS50YXJnZXQudmFsdWUpfVxuICAgICAgICAgIHBsYWNlaG9sZGVyPVwiRW50ZXIgSmlyYSBTZXJ2ZXIgVVJMXCJcbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJzZXR0aW5nXCI+XG4gICAgICAgIDxsYWJlbD5KaXJhIFVzZXJuYW1lPC9sYWJlbD5cbiAgICAgICAgPGlucHV0XG4gICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgIHZhbHVlPXtqaXJhVXNlcm5hbWV9XG4gICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRKaXJhVXNlcm5hbWUoZS50YXJnZXQudmFsdWUpfVxuICAgICAgICAgIHBsYWNlaG9sZGVyPVwiRW50ZXIgSmlyYSBVc2VybmFtZVwiXG4gICAgICAgIC8+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwic2V0dGluZ1wiPlxuICAgICAgICA8bGFiZWw+SmlyYSBBUEkgS2V5PC9sYWJlbD5cbiAgICAgICAgPGlucHV0XG4gICAgICAgICAgdHlwZT1cInBhc3N3b3JkXCJcbiAgICAgICAgICB2YWx1ZT17amlyYUFwaUtleX1cbiAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHNldEppcmFBcGlLZXkoZS50YXJnZXQudmFsdWUpfVxuICAgICAgICAgIHBsYWNlaG9sZGVyPVwiRW50ZXIgSmlyYSBBUEkgS2V5XCJcbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuXG4gICAgICA8YnV0dG9uIG9uQ2xpY2s9e2hhbmRsZVNhdmV9PlNhdmUgU2V0dGluZ3M8L2J1dHRvbj5cbiAgICA8L2Rpdj5cbiAgKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IEludGVncmF0aW9ucztcbiJdfQ==